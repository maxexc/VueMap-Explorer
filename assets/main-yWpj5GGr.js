(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const O of document.querySelectorAll('link[rel="modulepreload"]'))R(O);new MutationObserver(O=>{for(const U of O)if(U.type==="childList")for(const $ of U.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&R($)}).observe(document,{childList:!0,subtree:!0});function M(O){const U={};return O.integrity&&(U.integrity=O.integrity),O.referrerPolicy&&(U.referrerPolicy=O.referrerPolicy),O.crossOrigin==="use-credentials"?U.credentials="include":O.crossOrigin==="anonymous"?U.credentials="omit":U.credentials="same-origin",U}function R(O){if(O.ep)return;O.ep=!0;const U=M(O);fetch(O.href,U)}})();/**
* @vue/shared v3.5.6
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function ay(d){const g=Object.create(null);for(const M of d.split(","))g[M]=1;return M=>M in g}const Dr={},ku=[],Ro=()=>{},uM=()=>!1,mm=d=>d.charCodeAt(0)===111&&d.charCodeAt(1)===110&&(d.charCodeAt(2)>122||d.charCodeAt(2)<97),ly=d=>d.startsWith("onUpdate:"),In=Object.assign,cy=(d,g)=>{const M=d.indexOf(g);M>-1&&d.splice(M,1)},hM=Object.prototype.hasOwnProperty,gr=(d,g)=>hM.call(d,g),Fi=Array.isArray,Ou=d=>_m(d)==="[object Map]",xb=d=>_m(d)==="[object Set]",ji=d=>typeof d=="function",en=d=>typeof d=="string",dl=d=>typeof d=="symbol",qr=d=>d!==null&&typeof d=="object",vb=d=>(qr(d)||ji(d))&&ji(d.then)&&ji(d.catch),bb=Object.prototype.toString,_m=d=>bb.call(d),dM=d=>_m(d).slice(8,-1),wb=d=>_m(d)==="[object Object]",uy=d=>en(d)&&d!=="NaN"&&d[0]!=="-"&&""+parseInt(d,10)===d,Nd=ay(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),gm=d=>{const g=Object.create(null);return M=>g[M]||(g[M]=d(M))},fM=/-(\w)/g,ao=gm(d=>d.replace(fM,(g,M)=>M?M.toUpperCase():"")),pM=/\B([A-Z])/g,pc=gm(d=>d.replace(pM,"-$1").toLowerCase()),ym=gm(d=>d.charAt(0).toUpperCase()+d.slice(1)),wg=gm(d=>d?`on${ym(d)}`:""),al=(d,g)=>!Object.is(d,g),Tg=(d,...g)=>{for(let M=0;M<d.length;M++)d[M](...g)},Tb=(d,g,M,R=!1)=>{Object.defineProperty(d,g,{configurable:!0,enumerable:!1,writable:R,value:M})},mM=d=>{const g=parseFloat(d);return isNaN(g)?d:g};let a1;const Eb=()=>a1||(a1=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function hy(d){if(Fi(d)){const g={};for(let M=0;M<d.length;M++){const R=d[M],O=en(R)?xM(R):hy(R);if(O)for(const U in O)g[U]=O[U]}return g}else if(en(d)||qr(d))return d}const _M=/;(?![^(]*\))/g,gM=/:([^]+)/,yM=/\/\*[^]*?\*\//g;function xM(d){const g={};return d.replace(yM,"").split(_M).forEach(M=>{if(M){const R=M.split(gM);R.length>1&&(g[R[0].trim()]=R[1].trim())}}),g}function lo(d){let g="";if(en(d))g=d;else if(Fi(d))for(let M=0;M<d.length;M++){const R=lo(d[M]);R&&(g+=R+" ")}else if(qr(d))for(const M in d)d[M]&&(g+=M+" ");return g.trim()}const vM="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",bM=ay(vM);function Sb(d){return!!d||d===""}const Mb=d=>!!(d&&d.__v_isRef===!0),ll=d=>en(d)?d:d==null?"":Fi(d)||qr(d)&&(d.toString===bb||!ji(d.toString))?Mb(d)?ll(d.value):JSON.stringify(d,Ab,2):String(d),Ab=(d,g)=>Mb(g)?Ab(d,g.value):Ou(g)?{[`Map(${g.size})`]:[...g.entries()].reduce((M,[R,O],U)=>(M[Eg(R,U)+" =>"]=O,M),{})}:xb(g)?{[`Set(${g.size})`]:[...g.values()].map(M=>Eg(M))}:dl(g)?Eg(g):qr(g)&&!Fi(g)&&!wb(g)?String(g):g,Eg=(d,g="")=>{var M;return dl(d)?`Symbol(${(M=d.description)!=null?M:g})`:d};/**
* @vue/reactivity v3.5.6
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ts;class Ib{constructor(g=!1){this.detached=g,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ts,!g&&Ts&&(this.index=(Ts.scopes||(Ts.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let g,M;if(this.scopes)for(g=0,M=this.scopes.length;g<M;g++)this.scopes[g].pause();for(g=0,M=this.effects.length;g<M;g++)this.effects[g].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let g,M;if(this.scopes)for(g=0,M=this.scopes.length;g<M;g++)this.scopes[g].resume();for(g=0,M=this.effects.length;g<M;g++)this.effects[g].resume()}}run(g){if(this._active){const M=Ts;try{return Ts=this,g()}finally{Ts=M}}}on(){Ts=this}off(){Ts=this.parent}stop(g){if(this._active){let M,R;for(M=0,R=this.effects.length;M<R;M++)this.effects[M].stop();for(M=0,R=this.cleanups.length;M<R;M++)this.cleanups[M]();if(this.scopes)for(M=0,R=this.scopes.length;M<R;M++)this.scopes[M].stop(!0);if(!this.detached&&this.parent&&!g){const O=this.parent.scopes.pop();O&&O!==this&&(this.parent.scopes[this.index]=O,O.index=this.index)}this.parent=void 0,this._active=!1}}}function wM(d){return new Ib(d)}function TM(){return Ts}let Cr;const Sg=new WeakSet;class Cb{constructor(g){this.fn=g,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ts&&Ts.active&&Ts.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Sg.has(this)&&(Sg.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Rb(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,l1(this),Lb(this);const g=Cr,M=oo;Cr=this,oo=!0;try{return this.fn()}finally{Db(this),Cr=g,oo=M,this.flags&=-3}}stop(){if(this.flags&1){for(let g=this.deps;g;g=g.nextDep)py(g);this.deps=this.depsTail=void 0,l1(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Sg.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){$g(this)&&this.run()}get dirty(){return $g(this)}}let Pb=0,Vd;function Rb(d){d.flags|=8,d.next=Vd,Vd=d}function dy(){Pb++}function fy(){if(--Pb>0)return;let d;for(;Vd;){let g=Vd;for(Vd=void 0;g;){const M=g.next;if(g.next=void 0,g.flags&=-9,g.flags&1)try{g.trigger()}catch(R){d||(d=R)}g=M}}if(d)throw d}function Lb(d){for(let g=d.deps;g;g=g.nextDep)g.version=-1,g.prevActiveLink=g.dep.activeLink,g.dep.activeLink=g}function Db(d){let g,M=d.depsTail,R=M;for(;R;){const O=R.prevDep;R.version===-1?(R===M&&(M=O),py(R),EM(R)):g=R,R.dep.activeLink=R.prevActiveLink,R.prevActiveLink=void 0,R=O}d.deps=g,d.depsTail=M}function $g(d){for(let g=d.deps;g;g=g.nextDep)if(g.dep.version!==g.version||g.dep.computed&&(zb(g.dep.computed)||g.dep.version!==g.version))return!0;return!!d._dirty}function zb(d){if(d.flags&4&&!(d.flags&16)||(d.flags&=-17,d.globalVersion===Zd))return;d.globalVersion=Zd;const g=d.dep;if(d.flags|=2,g.version>0&&!d.isSSR&&d.deps&&!$g(d)){d.flags&=-3;return}const M=Cr,R=oo;Cr=d,oo=!0;try{Lb(d);const O=d.fn(d._value);(g.version===0||al(O,d._value))&&(d._value=O,g.version++)}catch(O){throw g.version++,O}finally{Cr=M,oo=R,Db(d),d.flags&=-3}}function py(d){const{dep:g,prevSub:M,nextSub:R}=d;if(M&&(M.nextSub=R,d.prevSub=void 0),R&&(R.prevSub=M,d.nextSub=void 0),g.subs===d&&(g.subs=M),!g.subs&&g.computed){g.computed.flags&=-5;for(let O=g.computed.deps;O;O=O.nextDep)py(O)}}function EM(d){const{prevDep:g,nextDep:M}=d;g&&(g.nextDep=M,d.prevDep=void 0),M&&(M.prevDep=g,d.nextDep=void 0)}let oo=!0;const kb=[];function fl(){kb.push(oo),oo=!1}function pl(){const d=kb.pop();oo=d===void 0?!0:d}function l1(d){const{cleanup:g}=d;if(d.cleanup=void 0,g){const M=Cr;Cr=void 0;try{g()}finally{Cr=M}}}let Zd=0;class SM{constructor(g,M){this.sub=g,this.dep=M,this.version=M.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class my{constructor(g){this.computed=g,this.version=0,this.activeLink=void 0,this.subs=void 0}track(g){if(!Cr||!oo||Cr===this.computed)return;let M=this.activeLink;if(M===void 0||M.sub!==Cr)M=this.activeLink=new SM(Cr,this),Cr.deps?(M.prevDep=Cr.depsTail,Cr.depsTail.nextDep=M,Cr.depsTail=M):Cr.deps=Cr.depsTail=M,Cr.flags&4&&Ob(M);else if(M.version===-1&&(M.version=this.version,M.nextDep)){const R=M.nextDep;R.prevDep=M.prevDep,M.prevDep&&(M.prevDep.nextDep=R),M.prevDep=Cr.depsTail,M.nextDep=void 0,Cr.depsTail.nextDep=M,Cr.depsTail=M,Cr.deps===M&&(Cr.deps=R)}return M}trigger(g){this.version++,Zd++,this.notify(g)}notify(g){dy();try{for(let M=this.subs;M;M=M.prevSub)M.sub.notify()&&M.sub.dep.notify()}finally{fy()}}}function Ob(d){const g=d.dep.computed;if(g&&!d.dep.subs){g.flags|=20;for(let R=g.deps;R;R=R.nextDep)Ob(R)}const M=d.dep.subs;M!==d&&(d.prevSub=M,M&&(M.nextSub=d)),d.dep.subs=d}const Zg=new WeakMap,uc=Symbol(""),Hg=Symbol(""),Hd=Symbol("");function Un(d,g,M){if(oo&&Cr){let R=Zg.get(d);R||Zg.set(d,R=new Map);let O=R.get(M);O||R.set(M,O=new my),O.track()}}function ra(d,g,M,R,O,U){const $=Zg.get(d);if(!$){Zd++;return}const K=s=>{s&&s.trigger()};if(dy(),g==="clear")$.forEach(K);else{const s=Fi(d),ce=s&&uy(M);if(s&&M==="length"){const pe=Number(R);$.forEach((me,ke)=>{(ke==="length"||ke===Hd||!dl(ke)&&ke>=pe)&&K(me)})}else switch(M!==void 0&&K($.get(M)),ce&&K($.get(Hd)),g){case"add":s?ce&&K($.get("length")):(K($.get(uc)),Ou(d)&&K($.get(Hg)));break;case"delete":s||(K($.get(uc)),Ou(d)&&K($.get(Hg)));break;case"set":Ou(d)&&K($.get(uc));break}}fy()}function Lu(d){const g=fr(d);return g===d?g:(Un(g,"iterate",Hd),Gs(d)?g:g.map(Bn))}function xm(d){return Un(d=fr(d),"iterate",Hd),d}const MM={__proto__:null,[Symbol.iterator](){return Mg(this,Symbol.iterator,Bn)},concat(...d){return Lu(this).concat(...d.map(g=>Fi(g)?Lu(g):g))},entries(){return Mg(this,"entries",d=>(d[1]=Bn(d[1]),d))},every(d,g){return ea(this,"every",d,g,void 0,arguments)},filter(d,g){return ea(this,"filter",d,g,M=>M.map(Bn),arguments)},find(d,g){return ea(this,"find",d,g,Bn,arguments)},findIndex(d,g){return ea(this,"findIndex",d,g,void 0,arguments)},findLast(d,g){return ea(this,"findLast",d,g,Bn,arguments)},findLastIndex(d,g){return ea(this,"findLastIndex",d,g,void 0,arguments)},forEach(d,g){return ea(this,"forEach",d,g,void 0,arguments)},includes(...d){return Ag(this,"includes",d)},indexOf(...d){return Ag(this,"indexOf",d)},join(d){return Lu(this).join(d)},lastIndexOf(...d){return Ag(this,"lastIndexOf",d)},map(d,g){return ea(this,"map",d,g,void 0,arguments)},pop(){return kd(this,"pop")},push(...d){return kd(this,"push",d)},reduce(d,...g){return c1(this,"reduce",d,g)},reduceRight(d,...g){return c1(this,"reduceRight",d,g)},shift(){return kd(this,"shift")},some(d,g){return ea(this,"some",d,g,void 0,arguments)},splice(...d){return kd(this,"splice",d)},toReversed(){return Lu(this).toReversed()},toSorted(d){return Lu(this).toSorted(d)},toSpliced(...d){return Lu(this).toSpliced(...d)},unshift(...d){return kd(this,"unshift",d)},values(){return Mg(this,"values",Bn)}};function Mg(d,g,M){const R=xm(d),O=R[g]();return R!==d&&!Gs(d)&&(O._next=O.next,O.next=()=>{const U=O._next();return U.value&&(U.value=M(U.value)),U}),O}const AM=Array.prototype;function ea(d,g,M,R,O,U){const $=xm(d),K=$!==d&&!Gs(d),s=$[g];if(s!==AM[g]){const me=s.apply(d,U);return K?Bn(me):me}let ce=M;$!==d&&(K?ce=function(me,ke){return M.call(this,Bn(me),ke,d)}:M.length>2&&(ce=function(me,ke){return M.call(this,me,ke,d)}));const pe=s.call($,ce,R);return K&&O?O(pe):pe}function c1(d,g,M,R){const O=xm(d);let U=M;return O!==d&&(Gs(d)?M.length>3&&(U=function($,K,s){return M.call(this,$,K,s,d)}):U=function($,K,s){return M.call(this,$,Bn(K),s,d)}),O[g](U,...R)}function Ag(d,g,M){const R=fr(d);Un(R,"iterate",Hd);const O=R[g](...M);return(O===-1||O===!1)&&vy(M[0])?(M[0]=fr(M[0]),R[g](...M)):O}function kd(d,g,M=[]){fl(),dy();const R=fr(d)[g].apply(d,M);return fy(),pl(),R}const IM=ay("__proto__,__v_isRef,__isVue"),Bb=new Set(Object.getOwnPropertyNames(Symbol).filter(d=>d!=="arguments"&&d!=="caller").map(d=>Symbol[d]).filter(dl));function CM(d){dl(d)||(d=String(d));const g=fr(this);return Un(g,"has",d),g.hasOwnProperty(d)}class Fb{constructor(g=!1,M=!1){this._isReadonly=g,this._isShallow=M}get(g,M,R){const O=this._isReadonly,U=this._isShallow;if(M==="__v_isReactive")return!O;if(M==="__v_isReadonly")return O;if(M==="__v_isShallow")return U;if(M==="__v_raw")return R===(O?U?jM:jb:U?Ub:Vb).get(g)||Object.getPrototypeOf(g)===Object.getPrototypeOf(R)?g:void 0;const $=Fi(g);if(!O){let s;if($&&(s=MM[M]))return s;if(M==="hasOwnProperty")return CM}const K=Reflect.get(g,M,Vn(g)?g:R);return(dl(M)?Bb.has(M):IM(M))||(O||Un(g,"get",M),U)?K:Vn(K)?$&&uy(M)?K:K.value:qr(K)?O?Gb(K):mc(K):K}}class Nb extends Fb{constructor(g=!1){super(!1,g)}set(g,M,R,O){let U=g[M];if(!this._isShallow){const s=dc(U);if(!Gs(R)&&!dc(R)&&(U=fr(U),R=fr(R)),!Fi(g)&&Vn(U)&&!Vn(R))return s?!1:(U.value=R,!0)}const $=Fi(g)&&uy(M)?Number(M)<g.length:gr(g,M),K=Reflect.set(g,M,R,Vn(g)?g:O);return g===fr(O)&&($?al(R,U)&&ra(g,"set",M,R):ra(g,"add",M,R)),K}deleteProperty(g,M){const R=gr(g,M);g[M];const O=Reflect.deleteProperty(g,M);return O&&R&&ra(g,"delete",M,void 0),O}has(g,M){const R=Reflect.has(g,M);return(!dl(M)||!Bb.has(M))&&Un(g,"has",M),R}ownKeys(g){return Un(g,"iterate",Fi(g)?"length":uc),Reflect.ownKeys(g)}}class PM extends Fb{constructor(g=!1){super(!0,g)}set(g,M){return!0}deleteProperty(g,M){return!0}}const RM=new Nb,LM=new PM,DM=new Nb(!0);const _y=d=>d,vm=d=>Reflect.getPrototypeOf(d);function Hp(d,g,M=!1,R=!1){d=d.__v_raw;const O=fr(d),U=fr(g);M||(al(g,U)&&Un(O,"get",g),Un(O,"get",U));const{has:$}=vm(O),K=R?_y:M?by:Bn;if($.call(O,g))return K(d.get(g));if($.call(O,U))return K(d.get(U));d!==O&&d.get(g)}function Wp(d,g=!1){const M=this.__v_raw,R=fr(M),O=fr(d);return g||(al(d,O)&&Un(R,"has",d),Un(R,"has",O)),d===O?M.has(d):M.has(d)||M.has(O)}function Xp(d,g=!1){return d=d.__v_raw,!g&&Un(fr(d),"iterate",uc),Reflect.get(d,"size",d)}function u1(d,g=!1){!g&&!Gs(d)&&!dc(d)&&(d=fr(d));const M=fr(this);return vm(M).has.call(M,d)||(M.add(d),ra(M,"add",d,d)),this}function h1(d,g,M=!1){!M&&!Gs(g)&&!dc(g)&&(g=fr(g));const R=fr(this),{has:O,get:U}=vm(R);let $=O.call(R,d);$||(d=fr(d),$=O.call(R,d));const K=U.call(R,d);return R.set(d,g),$?al(g,K)&&ra(R,"set",d,g):ra(R,"add",d,g),this}function d1(d){const g=fr(this),{has:M,get:R}=vm(g);let O=M.call(g,d);O||(d=fr(d),O=M.call(g,d)),R&&R.call(g,d);const U=g.delete(d);return O&&ra(g,"delete",d,void 0),U}function f1(){const d=fr(this),g=d.size!==0,M=d.clear();return g&&ra(d,"clear",void 0,void 0),M}function Yp(d,g){return function(R,O){const U=this,$=U.__v_raw,K=fr($),s=g?_y:d?by:Bn;return!d&&Un(K,"iterate",uc),$.forEach((ce,pe)=>R.call(O,s(ce),s(pe),U))}}function Kp(d,g,M){return function(...R){const O=this.__v_raw,U=fr(O),$=Ou(U),K=d==="entries"||d===Symbol.iterator&&$,s=d==="keys"&&$,ce=O[d](...R),pe=M?_y:g?by:Bn;return!g&&Un(U,"iterate",s?Hg:uc),{next(){const{value:me,done:ke}=ce.next();return ke?{value:me,done:ke}:{value:K?[pe(me[0]),pe(me[1])]:pe(me),done:ke}},[Symbol.iterator](){return this}}}}function el(d){return function(...g){return d==="delete"?!1:d==="clear"?void 0:this}}function zM(){const d={get(U){return Hp(this,U)},get size(){return Xp(this)},has:Wp,add:u1,set:h1,delete:d1,clear:f1,forEach:Yp(!1,!1)},g={get(U){return Hp(this,U,!1,!0)},get size(){return Xp(this)},has:Wp,add(U){return u1.call(this,U,!0)},set(U,$){return h1.call(this,U,$,!0)},delete:d1,clear:f1,forEach:Yp(!1,!0)},M={get(U){return Hp(this,U,!0)},get size(){return Xp(this,!0)},has(U){return Wp.call(this,U,!0)},add:el("add"),set:el("set"),delete:el("delete"),clear:el("clear"),forEach:Yp(!0,!1)},R={get(U){return Hp(this,U,!0,!0)},get size(){return Xp(this,!0)},has(U){return Wp.call(this,U,!0)},add:el("add"),set:el("set"),delete:el("delete"),clear:el("clear"),forEach:Yp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(U=>{d[U]=Kp(U,!1,!1),M[U]=Kp(U,!0,!1),g[U]=Kp(U,!1,!0),R[U]=Kp(U,!0,!0)}),[d,M,g,R]}const[kM,OM,BM,FM]=zM();function gy(d,g){const M=g?d?FM:BM:d?OM:kM;return(R,O,U)=>O==="__v_isReactive"?!d:O==="__v_isReadonly"?d:O==="__v_raw"?R:Reflect.get(gr(M,O)&&O in R?M:R,O,U)}const NM={get:gy(!1,!1)},VM={get:gy(!1,!0)},UM={get:gy(!0,!1)};const Vb=new WeakMap,Ub=new WeakMap,jb=new WeakMap,jM=new WeakMap;function GM(d){switch(d){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function qM(d){return d.__v_skip||!Object.isExtensible(d)?0:GM(dM(d))}function mc(d){return dc(d)?d:xy(d,!1,RM,NM,Vb)}function yy(d){return xy(d,!1,DM,VM,Ub)}function Gb(d){return xy(d,!0,LM,UM,jb)}function xy(d,g,M,R,O){if(!qr(d)||d.__v_raw&&!(g&&d.__v_isReactive))return d;const U=O.get(d);if(U)return U;const $=qM(d);if($===0)return d;const K=new Proxy(d,$===2?R:M);return O.set(d,K),K}function Bu(d){return dc(d)?Bu(d.__v_raw):!!(d&&d.__v_isReactive)}function dc(d){return!!(d&&d.__v_isReadonly)}function Gs(d){return!!(d&&d.__v_isShallow)}function vy(d){return d?!!d.__v_raw:!1}function fr(d){const g=d&&d.__v_raw;return g?fr(g):d}function qb(d){return!gr(d,"__v_skip")&&Object.isExtensible(d)&&Tb(d,"__v_skip",!0),d}const Bn=d=>qr(d)?mc(d):d,by=d=>qr(d)?Gb(d):d;function Vn(d){return d?d.__v_isRef===!0:!1}function fn(d){return $b(d,!1)}function $M(d){return $b(d,!0)}function $b(d,g){return Vn(d)?d:new ZM(d,g)}class ZM{constructor(g,M){this.dep=new my,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=M?g:fr(g),this._value=M?g:Bn(g),this.__v_isShallow=M}get value(){return this.dep.track(),this._value}set value(g){const M=this._rawValue,R=this.__v_isShallow||Gs(g)||dc(g);g=R?g:fr(g),al(g,M)&&(this._rawValue=g,this._value=R?g:Bn(g),this.dep.trigger())}}function Hi(d){return Vn(d)?d.value:d}const HM={get:(d,g,M)=>g==="__v_raw"?d:Hi(Reflect.get(d,g,M)),set:(d,g,M,R)=>{const O=d[g];return Vn(O)&&!Vn(M)?(O.value=M,!0):Reflect.set(d,g,M,R)}};function Zb(d){return Bu(d)?d:new Proxy(d,HM)}class WM{constructor(g,M,R){this.fn=g,this.setter=M,this._value=void 0,this.dep=new my(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Zd-1,this.effect=this,this.__v_isReadonly=!M,this.isSSR=R}notify(){if(this.flags|=16,!(this.flags&8)&&Cr!==this)return Rb(this),!0}get value(){const g=this.dep.track();return zb(this),g&&(g.version=this.dep.version),this._value}set value(g){this.setter&&this.setter(g)}}function XM(d,g,M=!1){let R,O;return ji(d)?R=d:(R=d.get,O=d.set),new WM(R,O,M)}const Jp={},om=new WeakMap;let lc;function YM(d,g=!1,M=lc){if(M){let R=om.get(M);R||om.set(M,R=[]),R.push(d)}}function KM(d,g,M=Dr){const{immediate:R,deep:O,once:U,scheduler:$,augmentJob:K,call:s}=M,ce=Gt=>O?Gt:Gs(Gt)||O===!1||O===0?ol(Gt,1):ol(Gt);let pe,me,ke,qe,it=!1,et=!1;if(Vn(d)?(me=()=>d.value,it=Gs(d)):Bu(d)?(me=()=>ce(d),it=!0):Fi(d)?(et=!0,it=d.some(Gt=>Bu(Gt)||Gs(Gt)),me=()=>d.map(Gt=>{if(Vn(Gt))return Gt.value;if(Bu(Gt))return ce(Gt);if(ji(Gt))return s?s(Gt,2):Gt()})):ji(d)?g?me=s?()=>s(d,2):d:me=()=>{if(ke){fl();try{ke()}finally{pl()}}const Gt=lc;lc=pe;try{return s?s(d,3,[qe]):d(qe)}finally{lc=Gt}}:me=Ro,g&&O){const Gt=me,Rt=O===!0?1/0:O;me=()=>ol(Gt(),Rt)}const ct=TM(),St=()=>{pe.stop(),ct&&cy(ct.effects,pe)};if(U&&g){const Gt=g;g=(...Rt)=>{Gt(...Rt),St()}}let _t=et?new Array(d.length).fill(Jp):Jp;const zt=Gt=>{if(!(!(pe.flags&1)||!pe.dirty&&!Gt))if(g){const Rt=pe.run();if(O||it||(et?Rt.some((yi,Ti)=>al(yi,_t[Ti])):al(Rt,_t))){ke&&ke();const yi=lc;lc=pe;try{const Ti=[Rt,_t===Jp?void 0:et&&_t[0]===Jp?[]:_t,qe];s?s(g,3,Ti):g(...Ti),_t=Rt}finally{lc=yi}}}else pe.run()};return K&&K(zt),pe=new Cb(me),pe.scheduler=$?()=>$(zt,!1):zt,qe=Gt=>YM(Gt,!1,pe),ke=pe.onStop=()=>{const Gt=om.get(pe);if(Gt){if(s)s(Gt,4);else for(const Rt of Gt)Rt();om.delete(pe)}},g?R?zt(!0):_t=pe.run():$?$(zt.bind(null,!0),!0):pe.run(),St.pause=pe.pause.bind(pe),St.resume=pe.resume.bind(pe),St.stop=St,St}function ol(d,g=1/0,M){if(g<=0||!qr(d)||d.__v_skip||(M=M||new Set,M.has(d)))return d;if(M.add(d),g--,Vn(d))ol(d.value,g,M);else if(Fi(d))for(let R=0;R<d.length;R++)ol(d[R],g,M);else if(xb(d)||Ou(d))d.forEach(R=>{ol(R,g,M)});else if(wb(d)){for(const R in d)ol(d[R],g,M);for(const R of Object.getOwnPropertySymbols(d))Object.prototype.propertyIsEnumerable.call(d,R)&&ol(d[R],g,M)}return d}/**
* @vue/runtime-core v3.5.6
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ef(d,g,M,R){try{return R?d(...R):d()}catch(O){bm(O,g,M)}}function zo(d,g,M,R){if(ji(d)){const O=ef(d,g,M,R);return O&&vb(O)&&O.catch(U=>{bm(U,g,M)}),O}if(Fi(d)){const O=[];for(let U=0;U<d.length;U++)O.push(zo(d[U],g,M,R));return O}}function bm(d,g,M,R=!0){const O=g?g.vnode:null,{errorHandler:U,throwUnhandledErrorInProduction:$}=g&&g.appContext.config||Dr;if(g){let K=g.parent;const s=g.proxy,ce=`https://vuejs.org/error-reference/#runtime-${M}`;for(;K;){const pe=K.ec;if(pe){for(let me=0;me<pe.length;me++)if(pe[me](d,s,ce)===!1)return}K=K.parent}if(U){fl(),ef(U,null,10,[d,s,ce]),pl();return}}JM(d,M,O,R,$)}function JM(d,g,M,R=!0,O=!1){if(O)throw d;console.error(d)}let Wd=!1,Wg=!1;const es=[];let Co=0;const Fu=[];let rl=null,Du=0;const Hb=Promise.resolve();let wy=null;function Ty(d){const g=wy||Hb;return d?g.then(this?d.bind(this):d):g}function QM(d){let g=Wd?Co+1:0,M=es.length;for(;g<M;){const R=g+M>>>1,O=es[R],U=Xd(O);U<d||U===d&&O.flags&2?g=R+1:M=R}return g}function Ey(d){if(!(d.flags&1)){const g=Xd(d),M=es[es.length-1];!M||!(d.flags&2)&&g>=Xd(M)?es.push(d):es.splice(QM(g),0,d),d.flags|=1,Wb()}}function Wb(){!Wd&&!Wg&&(Wg=!0,wy=Hb.then(Yb))}function eA(d){Fi(d)?Fu.push(...d):rl&&d.id===-1?rl.splice(Du+1,0,d):d.flags&1||(Fu.push(d),d.flags|=1),Wb()}function p1(d,g,M=Wd?Co+1:0){for(;M<es.length;M++){const R=es[M];if(R&&R.flags&2){if(d&&R.id!==d.uid)continue;es.splice(M,1),M--,R.flags&4&&(R.flags&=-2),R(),R.flags&=-2}}}function Xb(d){if(Fu.length){const g=[...new Set(Fu)].sort((M,R)=>Xd(M)-Xd(R));if(Fu.length=0,rl){rl.push(...g);return}for(rl=g,Du=0;Du<rl.length;Du++){const M=rl[Du];M.flags&4&&(M.flags&=-2),M.flags&8||M(),M.flags&=-2}rl=null,Du=0}}const Xd=d=>d.id==null?d.flags&2?-1:1/0:d.id;function Yb(d){Wg=!1,Wd=!0;try{for(Co=0;Co<es.length;Co++){const g=es[Co];g&&!(g.flags&8)&&(g.flags&4&&(g.flags&=-2),ef(g,g.i,g.i?15:14),g.flags&=-2)}}finally{for(;Co<es.length;Co++){const g=es[Co];g&&(g.flags&=-2)}Co=0,es.length=0,Xb(),Wd=!1,wy=null,(es.length||Fu.length)&&Yb()}}let Nn=null,Kb=null;function am(d){const g=Nn;return Nn=d,Kb=d&&d.type.__scopeId||null,g}function nn(d,g=Nn,M){if(!g||d._n)return d;const R=(...O)=>{R._d&&S1(-1);const U=am(g);let $;try{$=d(...O)}finally{am(U),R._d&&S1(1)}return $};return R._n=!0,R._c=!0,R._d=!0,R}function sc(d,g,M,R){const O=d.dirs,U=g&&g.dirs;for(let $=0;$<O.length;$++){const K=O[$];U&&(K.oldValue=U[$].value);let s=K.dir[R];s&&(fl(),zo(s,M,8,[d.el,K,d,g]),pl())}}const Jb=Symbol("_vte"),tA=d=>d.__isTeleport,Ud=d=>d&&(d.disabled||d.disabled===""),iA=d=>d&&(d.defer||d.defer===""),m1=d=>typeof SVGElement<"u"&&d instanceof SVGElement,_1=d=>typeof MathMLElement=="function"&&d instanceof MathMLElement,Xg=(d,g)=>{const M=d&&d.to;return en(M)?g?g(M):null:M},rA={name:"Teleport",__isTeleport:!0,process(d,g,M,R,O,U,$,K,s,ce){const{mc:pe,pc:me,pbc:ke,o:{insert:qe,querySelector:it,createText:et,createComment:ct}}=ce,St=Ud(g.props);let{shapeFlag:_t,children:zt,dynamicChildren:Gt}=g;if(d==null){const Rt=g.el=et(""),yi=g.anchor=et("");qe(Rt,M,R),qe(yi,M,R);const Ti=(lr,Sr)=>{_t&16&&(O&&O.isCE&&(O.ce._teleportTarget=lr),pe(zt,lr,Sr,O,U,$,K,s))},kt=()=>{const lr=g.target=Xg(g.props,it),Sr=Qb(lr,g,et,qe);lr&&($!=="svg"&&m1(lr)?$="svg":$!=="mathml"&&_1(lr)&&($="mathml"),St||(Ti(lr,Sr),tm(g)))};St&&(Ti(M,yi),tm(g)),iA(g.props)?ls(kt,U):kt()}else{g.el=d.el,g.targetStart=d.targetStart;const Rt=g.anchor=d.anchor,yi=g.target=d.target,Ti=g.targetAnchor=d.targetAnchor,kt=Ud(d.props),lr=kt?M:yi,Sr=kt?Rt:Ti;if($==="svg"||m1(yi)?$="svg":($==="mathml"||_1(yi))&&($="mathml"),Gt?(ke(d.dynamicChildren,Gt,lr,O,U,$,K),Cy(d,g,!0)):s||me(d,g,lr,Sr,O,U,$,K,!1),St)kt?g.props&&d.props&&g.props.to!==d.props.to&&(g.props.to=d.props.to):Qp(g,M,Rt,ce,1);else if((g.props&&g.props.to)!==(d.props&&d.props.to)){const qt=g.target=Xg(g.props,it);qt&&Qp(g,qt,null,ce,0)}else kt&&Qp(g,yi,Ti,ce,1);tm(g)}},remove(d,g,M,{um:R,o:{remove:O}},U){const{shapeFlag:$,children:K,anchor:s,targetStart:ce,targetAnchor:pe,target:me,props:ke}=d;if(me&&(O(ce),O(pe)),U&&O(s),$&16){const qe=U||!Ud(ke);for(let it=0;it<K.length;it++){const et=K[it];R(et,g,M,qe,!!et.dynamicChildren)}}},move:Qp,hydrate:nA};function Qp(d,g,M,{o:{insert:R},m:O},U=2){U===0&&R(d.targetAnchor,g,M);const{el:$,anchor:K,shapeFlag:s,children:ce,props:pe}=d,me=U===2;if(me&&R($,g,M),(!me||Ud(pe))&&s&16)for(let ke=0;ke<ce.length;ke++)O(ce[ke],g,M,2);me&&R(K,g,M)}function nA(d,g,M,R,O,U,{o:{nextSibling:$,parentNode:K,querySelector:s,insert:ce,createText:pe}},me){const ke=g.target=Xg(g.props,s);if(ke){const qe=ke._lpa||ke.firstChild;if(g.shapeFlag&16)if(Ud(g.props))g.anchor=me($(d),g,K(d),M,R,O,U),g.targetStart=qe,g.targetAnchor=qe&&$(qe);else{g.anchor=$(d);let it=qe;for(;it;){if(it&&it.nodeType===8){if(it.data==="teleport start anchor")g.targetStart=it;else if(it.data==="teleport anchor"){g.targetAnchor=it,ke._lpa=g.targetAnchor&&$(g.targetAnchor);break}}it=$(it)}g.targetAnchor||Qb(ke,g,pe,ce),me(qe&&$(qe),g,ke,M,R,O,U)}tm(g)}return g.anchor&&$(g.anchor)}const sA=rA;function tm(d){const g=d.ctx;if(g&&g.ut){let M=d.targetStart;for(;M&&M!==d.targetAnchor;)M.nodeType===1&&M.setAttribute("data-v-owner",g.uid),M=M.nextSibling;g.ut()}}function Qb(d,g,M,R){const O=g.targetStart=M(""),U=g.targetAnchor=M("");return O[Jb]=U,d&&(R(O,d),R(U,d)),U}function Sy(d,g){d.shapeFlag&6&&d.component?(d.transition=g,Sy(d.component.subTree,g)):d.shapeFlag&128?(d.ssContent.transition=g.clone(d.ssContent),d.ssFallback.transition=g.clone(d.ssFallback)):d.transition=g}/*! #__NO_SIDE_EFFECTS__ */function ew(d,g){return ji(d)?In({name:d.name},g,{setup:d}):d}function tw(d){d.ids=[d.ids[0]+d.ids[2]+++"-",0,0]}function Yg(d,g,M,R,O=!1){if(Fi(d)){d.forEach((it,et)=>Yg(it,g&&(Fi(g)?g[et]:g),M,R,O));return}if(Nu(R)&&!O)return;const U=R.shapeFlag&4?Ry(R.component):R.el,$=O?null:U,{i:K,r:s}=d,ce=g&&g.r,pe=K.refs===Dr?K.refs={}:K.refs,me=K.setupState,ke=fr(me),qe=me===Dr?()=>!1:it=>gr(ke,it);if(ce!=null&&ce!==s&&(en(ce)?(pe[ce]=null,qe(ce)&&(me[ce]=null)):Vn(ce)&&(ce.value=null)),ji(s))ef(s,K,12,[$,pe]);else{const it=en(s),et=Vn(s);if(it||et){const ct=()=>{if(d.f){const St=it?qe(s)?me[s]:pe[s]:s.value;O?Fi(St)&&cy(St,U):Fi(St)?St.includes(U)||St.push(U):it?(pe[s]=[U],qe(s)&&(me[s]=pe[s])):(s.value=[U],d.k&&(pe[d.k]=s.value))}else it?(pe[s]=$,qe(s)&&(me[s]=$)):et&&(s.value=$,d.k&&(pe[d.k]=$))};$?(ct.id=-1,ls(ct,M)):ct()}}}const Nu=d=>!!d.type.__asyncLoader,iw=d=>d.type.__isKeepAlive;function oA(d,g){rw(d,"a",g)}function aA(d,g){rw(d,"da",g)}function rw(d,g,M=An){const R=d.__wdc||(d.__wdc=()=>{let O=M;for(;O;){if(O.isDeactivated)return;O=O.parent}return d()});if(wm(g,R,M),M){let O=M.parent;for(;O&&O.parent;)iw(O.parent.vnode)&&lA(R,g,M,O),O=O.parent}}function lA(d,g,M,R){const O=wm(g,d,R,!0);_c(()=>{cy(R[g],O)},M)}function wm(d,g,M=An,R=!1){if(M){const O=M[d]||(M[d]=[]),U=g.__weh||(g.__weh=(...$)=>{fl();const K=tf(M),s=zo(g,M,d,$);return K(),pl(),s});return R?O.unshift(U):O.push(U),U}}const na=d=>(g,M=An)=>{(!Mm||d==="sp")&&wm(d,(...R)=>g(...R),M)},cA=na("bm"),Hu=na("m"),uA=na("bu"),hA=na("u"),dA=na("bum"),_c=na("um"),fA=na("sp"),pA=na("rtg"),mA=na("rtc");function _A(d,g=An){wm("ec",d,g)}const gA="components",nw=Symbol.for("v-ndc");function My(d){return en(d)?yA(gA,d,!1)||d:d||nw}function yA(d,g,M=!0,R=!1){const O=Nn||An;if(O){const U=O.type;{const K=oI(U,!1);if(K&&(K===g||K===ao(g)||K===ym(ao(g))))return U}const $=g1(O[d]||U[d],g)||g1(O.appContext[d],g);return!$&&R?U:$}}function g1(d,g){return d&&(d[g]||d[ao(g)]||d[ym(ao(g))])}function sw(d,g,M,R){let O;const U=M,$=Fi(d);if($||en(d)){const K=$&&Bu(d);let s=!1;K&&(s=!Gs(d),d=xm(d)),O=new Array(d.length);for(let ce=0,pe=d.length;ce<pe;ce++)O[ce]=g(s?Bn(d[ce]):d[ce],ce,void 0,U)}else if(typeof d=="number"){O=new Array(d);for(let K=0;K<d;K++)O[K]=g(K+1,K,void 0,U)}else if(qr(d))if(d[Symbol.iterator])O=Array.from(d,(K,s)=>g(K,s,void 0,U));else{const K=Object.keys(d);O=new Array(K.length);for(let s=0,ce=K.length;s<ce;s++){const pe=K[s];O[s]=g(d[pe],pe,s,U)}}else O=[];return O}function Ms(d,g,M={},R,O){if(Nn.ce||Nn.parent&&Nu(Nn.parent)&&Nn.parent.ce)return g!=="default"&&(M.name=g),Si(),ts(Fn,null,[Ei("slot",M,R&&R())],64);let U=d[g];U&&U._c&&(U._d=!1),Si();const $=U&&ow(U(M)),K=ts(Fn,{key:(M.key||$&&$.key||`_${g}`)+(!$&&R?"_fb":"")},$||(R?R():[]),$&&d._===1?64:-2);return!O&&K.scopeId&&(K.slotScopeIds=[K.scopeId+"-s"]),U&&U._c&&(U._d=!0),K}function ow(d){return d.some(g=>cm(g)?!(g.type===cl||g.type===Fn&&!ow(g.children)):!0)?d:null}const Kg=d=>d?Mw(d)?Ry(d):Kg(d.parent):null,jd=In(Object.create(null),{$:d=>d,$el:d=>d.vnode.el,$data:d=>d.data,$props:d=>d.props,$attrs:d=>d.attrs,$slots:d=>d.slots,$refs:d=>d.refs,$parent:d=>Kg(d.parent),$root:d=>Kg(d.root),$host:d=>d.ce,$emit:d=>d.emit,$options:d=>Ay(d),$forceUpdate:d=>d.f||(d.f=()=>{Ey(d.update)}),$nextTick:d=>d.n||(d.n=Ty.bind(d.proxy)),$watch:d=>UA.bind(d)}),Ig=(d,g)=>d!==Dr&&!d.__isScriptSetup&&gr(d,g),xA={get({_:d},g){if(g==="__v_skip")return!0;const{ctx:M,setupState:R,data:O,props:U,accessCache:$,type:K,appContext:s}=d;let ce;if(g[0]!=="$"){const qe=$[g];if(qe!==void 0)switch(qe){case 1:return R[g];case 2:return O[g];case 4:return M[g];case 3:return U[g]}else{if(Ig(R,g))return $[g]=1,R[g];if(O!==Dr&&gr(O,g))return $[g]=2,O[g];if((ce=d.propsOptions[0])&&gr(ce,g))return $[g]=3,U[g];if(M!==Dr&&gr(M,g))return $[g]=4,M[g];Jg&&($[g]=0)}}const pe=jd[g];let me,ke;if(pe)return g==="$attrs"&&Un(d.attrs,"get",""),pe(d);if((me=K.__cssModules)&&(me=me[g]))return me;if(M!==Dr&&gr(M,g))return $[g]=4,M[g];if(ke=s.config.globalProperties,gr(ke,g))return ke[g]},set({_:d},g,M){const{data:R,setupState:O,ctx:U}=d;return Ig(O,g)?(O[g]=M,!0):R!==Dr&&gr(R,g)?(R[g]=M,!0):gr(d.props,g)||g[0]==="$"&&g.slice(1)in d?!1:(U[g]=M,!0)},has({_:{data:d,setupState:g,accessCache:M,ctx:R,appContext:O,propsOptions:U}},$){let K;return!!M[$]||d!==Dr&&gr(d,$)||Ig(g,$)||(K=U[0])&&gr(K,$)||gr(R,$)||gr(jd,$)||gr(O.config.globalProperties,$)},defineProperty(d,g,M){return M.get!=null?d._.accessCache[g]=0:gr(M,"value")&&this.set(d,g,M.value,null),Reflect.defineProperty(d,g,M)}};function vA(){return aw().slots}function bA(){return aw().attrs}function aw(){const d=iI();return d.setupContext||(d.setupContext=Iw(d))}function y1(d){return Fi(d)?d.reduce((g,M)=>(g[M]=null,g),{}):d}let Jg=!0;function wA(d){const g=Ay(d),M=d.proxy,R=d.ctx;Jg=!1,g.beforeCreate&&x1(g.beforeCreate,d,"bc");const{data:O,computed:U,methods:$,watch:K,provide:s,inject:ce,created:pe,beforeMount:me,mounted:ke,beforeUpdate:qe,updated:it,activated:et,deactivated:ct,beforeDestroy:St,beforeUnmount:_t,destroyed:zt,unmounted:Gt,render:Rt,renderTracked:yi,renderTriggered:Ti,errorCaptured:kt,serverPrefetch:lr,expose:Sr,inheritAttrs:qt,components:Xt,directives:sn,filters:Cn}=g;if(ce&&TA(ce,R,null),$)for(const Li in $){const Vi=$[Li];ji(Vi)&&(R[Li]=Vi.bind(M))}if(O){const Li=O.call(M,M);qr(Li)&&(d.data=mc(Li))}if(Jg=!0,U)for(const Li in U){const Vi=U[Li],pn=ji(Vi)?Vi.bind(M,M):ji(Vi.get)?Vi.get.bind(M,M):Ro,Qt=!ji(Vi)&&ji(Vi.set)?Vi.set.bind(M):Ro,on=zr({get:pn,set:Qt});Object.defineProperty(R,Li,{enumerable:!0,configurable:!0,get:()=>on.value,set:Xr=>on.value=Xr})}if(K)for(const Li in K)lw(K[Li],R,M,Li);if(s){const Li=ji(s)?s.call(M):s;Reflect.ownKeys(Li).forEach(Vi=>{Gd(Vi,Li[Vi])})}pe&&x1(pe,d,"c");function Ht(Li,Vi){Fi(Vi)?Vi.forEach(pn=>Li(pn.bind(M))):Vi&&Li(Vi.bind(M))}if(Ht(cA,me),Ht(Hu,ke),Ht(uA,qe),Ht(hA,it),Ht(oA,et),Ht(aA,ct),Ht(_A,kt),Ht(mA,yi),Ht(pA,Ti),Ht(dA,_t),Ht(_c,Gt),Ht(fA,lr),Fi(Sr))if(Sr.length){const Li=d.exposed||(d.exposed={});Sr.forEach(Vi=>{Object.defineProperty(Li,Vi,{get:()=>M[Vi],set:pn=>M[Vi]=pn})})}else d.exposed||(d.exposed={});Rt&&d.render===Ro&&(d.render=Rt),qt!=null&&(d.inheritAttrs=qt),Xt&&(d.components=Xt),sn&&(d.directives=sn),lr&&tw(d)}function TA(d,g,M=Ro){Fi(d)&&(d=Qg(d));for(const R in d){const O=d[R];let U;qr(O)?"default"in O?U=Lo(O.from||R,O.default,!0):U=Lo(O.from||R):U=Lo(O),Vn(U)?Object.defineProperty(g,R,{enumerable:!0,configurable:!0,get:()=>U.value,set:$=>U.value=$}):g[R]=U}}function x1(d,g,M){zo(Fi(d)?d.map(R=>R.bind(g.proxy)):d.bind(g.proxy),g,M)}function lw(d,g,M,R){let O=R.includes(".")?bw(M,R):()=>M[R];if(en(d)){const U=g[d];ji(U)&&Do(O,U)}else if(ji(d))Do(O,d.bind(M));else if(qr(d))if(Fi(d))d.forEach(U=>lw(U,g,M,R));else{const U=ji(d.handler)?d.handler.bind(M):g[d.handler];ji(U)&&Do(O,U,d)}}function Ay(d){const g=d.type,{mixins:M,extends:R}=g,{mixins:O,optionsCache:U,config:{optionMergeStrategies:$}}=d.appContext,K=U.get(g);let s;return K?s=K:!O.length&&!M&&!R?s=g:(s={},O.length&&O.forEach(ce=>lm(s,ce,$,!0)),lm(s,g,$)),qr(g)&&U.set(g,s),s}function lm(d,g,M,R=!1){const{mixins:O,extends:U}=g;U&&lm(d,U,M,!0),O&&O.forEach($=>lm(d,$,M,!0));for(const $ in g)if(!(R&&$==="expose")){const K=EA[$]||M&&M[$];d[$]=K?K(d[$],g[$]):g[$]}return d}const EA={data:v1,props:b1,emits:b1,methods:Fd,computed:Fd,beforeCreate:Qn,created:Qn,beforeMount:Qn,mounted:Qn,beforeUpdate:Qn,updated:Qn,beforeDestroy:Qn,beforeUnmount:Qn,destroyed:Qn,unmounted:Qn,activated:Qn,deactivated:Qn,errorCaptured:Qn,serverPrefetch:Qn,components:Fd,directives:Fd,watch:MA,provide:v1,inject:SA};function v1(d,g){return g?d?function(){return In(ji(d)?d.call(this,this):d,ji(g)?g.call(this,this):g)}:g:d}function SA(d,g){return Fd(Qg(d),Qg(g))}function Qg(d){if(Fi(d)){const g={};for(let M=0;M<d.length;M++)g[d[M]]=d[M];return g}return d}function Qn(d,g){return d?[...new Set([].concat(d,g))]:g}function Fd(d,g){return d?In(Object.create(null),d,g):g}function b1(d,g){return d?Fi(d)&&Fi(g)?[...new Set([...d,...g])]:In(Object.create(null),y1(d),y1(g??{})):g}function MA(d,g){if(!d)return g;if(!g)return d;const M=In(Object.create(null),d);for(const R in g)M[R]=Qn(d[R],g[R]);return M}function cw(){return{app:null,config:{isNativeTag:uM,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let AA=0;function IA(d,g){return function(R,O=null){ji(R)||(R=In({},R)),O!=null&&!qr(O)&&(O=null);const U=cw(),$=new WeakSet,K=[];let s=!1;const ce=U.app={_uid:AA++,_component:R,_props:O,_container:null,_context:U,_instance:null,version:lI,get config(){return U.config},set config(pe){},use(pe,...me){return $.has(pe)||(pe&&ji(pe.install)?($.add(pe),pe.install(ce,...me)):ji(pe)&&($.add(pe),pe(ce,...me))),ce},mixin(pe){return U.mixins.includes(pe)||U.mixins.push(pe),ce},component(pe,me){return me?(U.components[pe]=me,ce):U.components[pe]},directive(pe,me){return me?(U.directives[pe]=me,ce):U.directives[pe]},mount(pe,me,ke){if(!s){const qe=ce._ceVNode||Ei(R,O);return qe.appContext=U,ke===!0?ke="svg":ke===!1&&(ke=void 0),me&&g?g(qe,pe):d(qe,pe,ke),s=!0,ce._container=pe,pe.__vue_app__=ce,Ry(qe.component)}},onUnmount(pe){K.push(pe)},unmount(){s&&(zo(K,ce._instance,16),d(null,ce._container),delete ce._container.__vue_app__)},provide(pe,me){return U.provides[pe]=me,ce},runWithContext(pe){const me=Vu;Vu=ce;try{return pe()}finally{Vu=me}}};return ce}}let Vu=null;function Gd(d,g){if(An){let M=An.provides;const R=An.parent&&An.parent.provides;R===M&&(M=An.provides=Object.create(R)),M[d]=g}}function Lo(d,g,M=!1){const R=An||Nn;if(R||Vu){const O=Vu?Vu._context.provides:R?R.parent==null?R.vnode.appContext&&R.vnode.appContext.provides:R.parent.provides:void 0;if(O&&d in O)return O[d];if(arguments.length>1)return M&&ji(g)?g.call(R&&R.proxy):g}}const uw={},hw=()=>Object.create(uw),dw=d=>Object.getPrototypeOf(d)===uw;function CA(d,g,M,R=!1){const O={},U=hw();d.propsDefaults=Object.create(null),fw(d,g,O,U);for(const $ in d.propsOptions[0])$ in O||(O[$]=void 0);M?d.props=R?O:yy(O):d.type.props?d.props=O:d.props=U,d.attrs=U}function PA(d,g,M,R){const{props:O,attrs:U,vnode:{patchFlag:$}}=d,K=fr(O),[s]=d.propsOptions;let ce=!1;if((R||$>0)&&!($&16)){if($&8){const pe=d.vnode.dynamicProps;for(let me=0;me<pe.length;me++){let ke=pe[me];if(Tm(d.emitsOptions,ke))continue;const qe=g[ke];if(s)if(gr(U,ke))qe!==U[ke]&&(U[ke]=qe,ce=!0);else{const it=ao(ke);O[it]=ey(s,K,it,qe,d,!1)}else qe!==U[ke]&&(U[ke]=qe,ce=!0)}}}else{fw(d,g,O,U)&&(ce=!0);let pe;for(const me in K)(!g||!gr(g,me)&&((pe=pc(me))===me||!gr(g,pe)))&&(s?M&&(M[me]!==void 0||M[pe]!==void 0)&&(O[me]=ey(s,K,me,void 0,d,!0)):delete O[me]);if(U!==K)for(const me in U)(!g||!gr(g,me))&&(delete U[me],ce=!0)}ce&&ra(d.attrs,"set","")}function fw(d,g,M,R){const[O,U]=d.propsOptions;let $=!1,K;if(g)for(let s in g){if(Nd(s))continue;const ce=g[s];let pe;O&&gr(O,pe=ao(s))?!U||!U.includes(pe)?M[pe]=ce:(K||(K={}))[pe]=ce:Tm(d.emitsOptions,s)||(!(s in R)||ce!==R[s])&&(R[s]=ce,$=!0)}if(U){const s=fr(M),ce=K||Dr;for(let pe=0;pe<U.length;pe++){const me=U[pe];M[me]=ey(O,s,me,ce[me],d,!gr(ce,me))}}return $}function ey(d,g,M,R,O,U){const $=d[M];if($!=null){const K=gr($,"default");if(K&&R===void 0){const s=$.default;if($.type!==Function&&!$.skipFactory&&ji(s)){const{propsDefaults:ce}=O;if(M in ce)R=ce[M];else{const pe=tf(O);R=ce[M]=s.call(null,g),pe()}}else R=s;O.ce&&O.ce._setProp(M,R)}$[0]&&(U&&!K?R=!1:$[1]&&(R===""||R===pc(M))&&(R=!0))}return R}const RA=new WeakMap;function pw(d,g,M=!1){const R=M?RA:g.propsCache,O=R.get(d);if(O)return O;const U=d.props,$={},K=[];let s=!1;if(!ji(d)){const pe=me=>{s=!0;const[ke,qe]=pw(me,g,!0);In($,ke),qe&&K.push(...qe)};!M&&g.mixins.length&&g.mixins.forEach(pe),d.extends&&pe(d.extends),d.mixins&&d.mixins.forEach(pe)}if(!U&&!s)return qr(d)&&R.set(d,ku),ku;if(Fi(U))for(let pe=0;pe<U.length;pe++){const me=ao(U[pe]);w1(me)&&($[me]=Dr)}else if(U)for(const pe in U){const me=ao(pe);if(w1(me)){const ke=U[pe],qe=$[me]=Fi(ke)||ji(ke)?{type:ke}:In({},ke),it=qe.type;let et=!1,ct=!0;if(Fi(it))for(let St=0;St<it.length;++St){const _t=it[St],zt=ji(_t)&&_t.name;if(zt==="Boolean"){et=!0;break}else zt==="String"&&(ct=!1)}else et=ji(it)&&it.name==="Boolean";qe[0]=et,qe[1]=ct,(et||gr(qe,"default"))&&K.push(me)}}const ce=[$,K];return qr(d)&&R.set(d,ce),ce}function w1(d){return d[0]!=="$"&&!Nd(d)}const mw=d=>d[0]==="_"||d==="$stable",Iy=d=>Fi(d)?d.map(Po):[Po(d)],LA=(d,g,M)=>{if(g._n)return g;const R=nn((...O)=>Iy(g(...O)),M);return R._c=!1,R},_w=(d,g,M)=>{const R=d._ctx;for(const O in d){if(mw(O))continue;const U=d[O];if(ji(U))g[O]=LA(O,U,R);else if(U!=null){const $=Iy(U);g[O]=()=>$}}},gw=(d,g)=>{const M=Iy(g);d.slots.default=()=>M},yw=(d,g,M)=>{for(const R in g)(M||R!=="_")&&(d[R]=g[R])},DA=(d,g,M)=>{const R=d.slots=hw();if(d.vnode.shapeFlag&32){const O=g._;O?(yw(R,g,M),M&&Tb(R,"_",O,!0)):_w(g,R)}else g&&gw(d,g)},zA=(d,g,M)=>{const{vnode:R,slots:O}=d;let U=!0,$=Dr;if(R.shapeFlag&32){const K=g._;K?M&&K===1?U=!1:yw(O,g,M):(U=!g.$stable,_w(g,O)),$=g}else g&&(gw(d,g),$={default:1});if(U)for(const K in O)!mw(K)&&$[K]==null&&delete O[K]},ls=WA;function kA(d){return OA(d)}function OA(d,g){const M=Eb();M.__VUE__=!0;const{insert:R,remove:O,patchProp:U,createElement:$,createText:K,createComment:s,setText:ce,setElementText:pe,parentNode:me,nextSibling:ke,setScopeId:qe=Ro,insertStaticContent:it}=d,et=(Ae,ze,Se,wt=null,lt=null,Et=null,dt=void 0,Pt=null,Dt=!!ze.dynamicChildren)=>{if(Ae===ze)return;Ae&&!Od(Ae,ze)&&(wt=ht(Ae),Xr(Ae,lt,Et,!0),Ae=null),ze.patchFlag===-2&&(Dt=!1,ze.dynamicChildren=null);const{type:It,ref:hi,shapeFlag:$t}=ze;switch(It){case Em:ct(Ae,ze,Se,wt);break;case cl:St(Ae,ze,Se,wt);break;case im:Ae==null&&_t(ze,Se,wt,dt);break;case Fn:Xt(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt);break;default:$t&1?Rt(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt):$t&6?sn(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt):($t&64||$t&128)&&It.process(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt,ni)}hi!=null&&lt&&Yg(hi,Ae&&Ae.ref,Et,ze||Ae,!ze)},ct=(Ae,ze,Se,wt)=>{if(Ae==null)R(ze.el=K(ze.children),Se,wt);else{const lt=ze.el=Ae.el;ze.children!==Ae.children&&ce(lt,ze.children)}},St=(Ae,ze,Se,wt)=>{Ae==null?R(ze.el=s(ze.children||""),Se,wt):ze.el=Ae.el},_t=(Ae,ze,Se,wt)=>{[Ae.el,Ae.anchor]=it(Ae.children,ze,Se,wt,Ae.el,Ae.anchor)},zt=({el:Ae,anchor:ze},Se,wt)=>{let lt;for(;Ae&&Ae!==ze;)lt=ke(Ae),R(Ae,Se,wt),Ae=lt;R(ze,Se,wt)},Gt=({el:Ae,anchor:ze})=>{let Se;for(;Ae&&Ae!==ze;)Se=ke(Ae),O(Ae),Ae=Se;O(ze)},Rt=(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt)=>{ze.type==="svg"?dt="svg":ze.type==="math"&&(dt="mathml"),Ae==null?yi(ze,Se,wt,lt,Et,dt,Pt,Dt):lr(Ae,ze,lt,Et,dt,Pt,Dt)},yi=(Ae,ze,Se,wt,lt,Et,dt,Pt)=>{let Dt,It;const{props:hi,shapeFlag:$t,transition:gt,dirs:vi}=Ae;if(Dt=Ae.el=$(Ae.type,Et,hi&&hi.is,hi),$t&8?pe(Dt,Ae.children):$t&16&&kt(Ae.children,Dt,null,wt,lt,Cg(Ae,Et),dt,Pt),vi&&sc(Ae,null,wt,"created"),Ti(Dt,Ae,Ae.scopeId,dt,wt),hi){for(const rr in hi)rr!=="value"&&!Nd(rr)&&U(Dt,rr,null,hi[rr],Et,wt);"value"in hi&&U(Dt,"value",null,hi.value,Et),(It=hi.onVnodeBeforeMount)&&Io(It,wt,Ae)}vi&&sc(Ae,null,wt,"beforeMount");const Di=BA(lt,gt);Di&&gt.beforeEnter(Dt),R(Dt,ze,Se),((It=hi&&hi.onVnodeMounted)||Di||vi)&&ls(()=>{It&&Io(It,wt,Ae),Di&&gt.enter(Dt),vi&&sc(Ae,null,wt,"mounted")},lt)},Ti=(Ae,ze,Se,wt,lt)=>{if(Se&&qe(Ae,Se),wt)for(let Et=0;Et<wt.length;Et++)qe(Ae,wt[Et]);if(lt){let Et=lt.subTree;if(ze===Et||Tw(Et.type)&&(Et.ssContent===ze||Et.ssFallback===ze)){const dt=lt.vnode;Ti(Ae,dt,dt.scopeId,dt.slotScopeIds,lt.parent)}}},kt=(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt=0)=>{for(let It=Dt;It<Ae.length;It++){const hi=Ae[It]=Pt?nl(Ae[It]):Po(Ae[It]);et(null,hi,ze,Se,wt,lt,Et,dt,Pt)}},lr=(Ae,ze,Se,wt,lt,Et,dt)=>{const Pt=ze.el=Ae.el;let{patchFlag:Dt,dynamicChildren:It,dirs:hi}=ze;Dt|=Ae.patchFlag&16;const $t=Ae.props||Dr,gt=ze.props||Dr;let vi;if(Se&&oc(Se,!1),(vi=gt.onVnodeBeforeUpdate)&&Io(vi,Se,ze,Ae),hi&&sc(ze,Ae,Se,"beforeUpdate"),Se&&oc(Se,!0),($t.innerHTML&&gt.innerHTML==null||$t.textContent&&gt.textContent==null)&&pe(Pt,""),It?Sr(Ae.dynamicChildren,It,Pt,Se,wt,Cg(ze,lt),Et):dt||Vi(Ae,ze,Pt,null,Se,wt,Cg(ze,lt),Et,!1),Dt>0){if(Dt&16)qt(Pt,$t,gt,Se,lt);else if(Dt&2&&$t.class!==gt.class&&U(Pt,"class",null,gt.class,lt),Dt&4&&U(Pt,"style",$t.style,gt.style,lt),Dt&8){const Di=ze.dynamicProps;for(let rr=0;rr<Di.length;rr++){const Mi=Di[rr],yr=$t[Mi],Vr=gt[Mi];(Vr!==yr||Mi==="value")&&U(Pt,Mi,yr,Vr,lt,Se)}}Dt&1&&Ae.children!==ze.children&&pe(Pt,ze.children)}else!dt&&It==null&&qt(Pt,$t,gt,Se,lt);((vi=gt.onVnodeUpdated)||hi)&&ls(()=>{vi&&Io(vi,Se,ze,Ae),hi&&sc(ze,Ae,Se,"updated")},wt)},Sr=(Ae,ze,Se,wt,lt,Et,dt)=>{for(let Pt=0;Pt<ze.length;Pt++){const Dt=Ae[Pt],It=ze[Pt],hi=Dt.el&&(Dt.type===Fn||!Od(Dt,It)||Dt.shapeFlag&70)?me(Dt.el):Se;et(Dt,It,hi,null,wt,lt,Et,dt,!0)}},qt=(Ae,ze,Se,wt,lt)=>{if(ze!==Se){if(ze!==Dr)for(const Et in ze)!Nd(Et)&&!(Et in Se)&&U(Ae,Et,ze[Et],null,lt,wt);for(const Et in Se){if(Nd(Et))continue;const dt=Se[Et],Pt=ze[Et];dt!==Pt&&Et!=="value"&&U(Ae,Et,Pt,dt,lt,wt)}"value"in Se&&U(Ae,"value",ze.value,Se.value,lt)}},Xt=(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt)=>{const It=ze.el=Ae?Ae.el:K(""),hi=ze.anchor=Ae?Ae.anchor:K("");let{patchFlag:$t,dynamicChildren:gt,slotScopeIds:vi}=ze;vi&&(Pt=Pt?Pt.concat(vi):vi),Ae==null?(R(It,Se,wt),R(hi,Se,wt),kt(ze.children||[],Se,hi,lt,Et,dt,Pt,Dt)):$t>0&&$t&64&&gt&&Ae.dynamicChildren?(Sr(Ae.dynamicChildren,gt,Se,lt,Et,dt,Pt),(ze.key!=null||lt&&ze===lt.subTree)&&Cy(Ae,ze,!0)):Vi(Ae,ze,Se,hi,lt,Et,dt,Pt,Dt)},sn=(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt)=>{ze.slotScopeIds=Pt,Ae==null?ze.shapeFlag&512?lt.ctx.activate(ze,Se,wt,dt,Dt):Cn(ze,Se,wt,lt,Et,dt,Dt):hs(Ae,ze,Dt)},Cn=(Ae,ze,Se,wt,lt,Et,dt)=>{const Pt=Ae.component=tI(Ae,wt,lt);if(iw(Ae)&&(Pt.ctx.renderer=ni),rI(Pt,!1,dt),Pt.asyncDep){if(lt&&lt.registerDep(Pt,Ht,dt),!Ae.el){const Dt=Pt.subTree=Ei(cl);St(null,Dt,ze,Se)}}else Ht(Pt,Ae,ze,Se,lt,Et,dt)},hs=(Ae,ze,Se)=>{const wt=ze.component=Ae.component;if(ZA(Ae,ze,Se))if(wt.asyncDep&&!wt.asyncResolved){Li(wt,ze,Se);return}else wt.next=ze,wt.update();else ze.el=Ae.el,wt.vnode=ze},Ht=(Ae,ze,Se,wt,lt,Et,dt)=>{const Pt=()=>{if(Ae.isMounted){let{next:$t,bu:gt,u:vi,parent:Di,vnode:rr}=Ae;{const Yr=xw(Ae);if(Yr){$t&&($t.el=rr.el,Li(Ae,$t,dt)),Yr.asyncDep.then(()=>{Ae.isUnmounted||Pt()});return}}let Mi=$t,yr;oc(Ae,!1),$t?($t.el=rr.el,Li(Ae,$t,dt)):$t=rr,gt&&Tg(gt),(yr=$t.props&&$t.props.onVnodeBeforeUpdate)&&Io(yr,Di,$t,rr),oc(Ae,!0);const Vr=Pg(Ae),cn=Ae.subTree;Ae.subTree=Vr,et(cn,Vr,me(cn.el),ht(cn),Ae,lt,Et),$t.el=Vr.el,Mi===null&&HA(Ae,Vr.el),vi&&ls(vi,lt),(yr=$t.props&&$t.props.onVnodeUpdated)&&ls(()=>Io(yr,Di,$t,rr),lt)}else{let $t;const{el:gt,props:vi}=ze,{bm:Di,m:rr,parent:Mi,root:yr,type:Vr}=Ae,cn=Nu(ze);if(oc(Ae,!1),Di&&Tg(Di),!cn&&($t=vi&&vi.onVnodeBeforeMount)&&Io($t,Mi,ze),oc(Ae,!0),gt&&nr){const Yr=()=>{Ae.subTree=Pg(Ae),nr(gt,Ae.subTree,Ae,lt,null)};cn&&Vr.__asyncHydrate?Vr.__asyncHydrate(gt,Ae,Yr):Yr()}else{yr.ce&&yr.ce._injectChildStyle(Vr);const Yr=Ae.subTree=Pg(Ae);et(null,Yr,Se,wt,Ae,lt,Et),ze.el=Yr.el}if(rr&&ls(rr,lt),!cn&&($t=vi&&vi.onVnodeMounted)){const Yr=ze;ls(()=>Io($t,Mi,Yr),lt)}(ze.shapeFlag&256||Mi&&Nu(Mi.vnode)&&Mi.vnode.shapeFlag&256)&&Ae.a&&ls(Ae.a,lt),Ae.isMounted=!0,ze=Se=wt=null}};Ae.scope.on();const Dt=Ae.effect=new Cb(Pt);Ae.scope.off();const It=Ae.update=Dt.run.bind(Dt),hi=Ae.job=Dt.runIfDirty.bind(Dt);hi.i=Ae,hi.id=Ae.uid,Dt.scheduler=()=>Ey(hi),oc(Ae,!0),It()},Li=(Ae,ze,Se)=>{ze.component=Ae;const wt=Ae.vnode.props;Ae.vnode=ze,Ae.next=null,PA(Ae,ze.props,wt,Se),zA(Ae,ze.children,Se),fl(),p1(Ae),pl()},Vi=(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt=!1)=>{const It=Ae&&Ae.children,hi=Ae?Ae.shapeFlag:0,$t=ze.children,{patchFlag:gt,shapeFlag:vi}=ze;if(gt>0){if(gt&128){Qt(It,$t,Se,wt,lt,Et,dt,Pt,Dt);return}else if(gt&256){pn(It,$t,Se,wt,lt,Et,dt,Pt,Dt);return}}vi&8?(hi&16&&Pr(It,lt,Et),$t!==It&&pe(Se,$t)):hi&16?vi&16?Qt(It,$t,Se,wt,lt,Et,dt,Pt,Dt):Pr(It,lt,Et,!0):(hi&8&&pe(Se,""),vi&16&&kt($t,Se,wt,lt,Et,dt,Pt,Dt))},pn=(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt)=>{Ae=Ae||ku,ze=ze||ku;const It=Ae.length,hi=ze.length,$t=Math.min(It,hi);let gt;for(gt=0;gt<$t;gt++){const vi=ze[gt]=Dt?nl(ze[gt]):Po(ze[gt]);et(Ae[gt],vi,Se,null,lt,Et,dt,Pt,Dt)}It>hi?Pr(Ae,lt,Et,!0,!1,$t):kt(ze,Se,wt,lt,Et,dt,Pt,Dt,$t)},Qt=(Ae,ze,Se,wt,lt,Et,dt,Pt,Dt)=>{let It=0;const hi=ze.length;let $t=Ae.length-1,gt=hi-1;for(;It<=$t&&It<=gt;){const vi=Ae[It],Di=ze[It]=Dt?nl(ze[It]):Po(ze[It]);if(Od(vi,Di))et(vi,Di,Se,null,lt,Et,dt,Pt,Dt);else break;It++}for(;It<=$t&&It<=gt;){const vi=Ae[$t],Di=ze[gt]=Dt?nl(ze[gt]):Po(ze[gt]);if(Od(vi,Di))et(vi,Di,Se,null,lt,Et,dt,Pt,Dt);else break;$t--,gt--}if(It>$t){if(It<=gt){const vi=gt+1,Di=vi<hi?ze[vi].el:wt;for(;It<=gt;)et(null,ze[It]=Dt?nl(ze[It]):Po(ze[It]),Se,Di,lt,Et,dt,Pt,Dt),It++}}else if(It>gt)for(;It<=$t;)Xr(Ae[It],lt,Et,!0),It++;else{const vi=It,Di=It,rr=new Map;for(It=Di;It<=gt;It++){const Kr=ze[It]=Dt?nl(ze[It]):Po(ze[It]);Kr.key!=null&&rr.set(Kr.key,It)}let Mi,yr=0;const Vr=gt-Di+1;let cn=!1,Yr=0;const xn=new Array(Vr);for(It=0;It<Vr;It++)xn[It]=0;for(It=vi;It<=$t;It++){const Kr=Ae[It];if(yr>=Vr){Xr(Kr,lt,Et,!0);continue}let Or;if(Kr.key!=null)Or=rr.get(Kr.key);else for(Mi=Di;Mi<=gt;Mi++)if(xn[Mi-Di]===0&&Od(Kr,ze[Mi])){Or=Mi;break}Or===void 0?Xr(Kr,lt,Et,!0):(xn[Or-Di]=It+1,Or>=Yr?Yr=Or:cn=!0,et(Kr,ze[Or],Se,null,lt,Et,dt,Pt,Dt),yr++)}const Cs=cn?FA(xn):ku;for(Mi=Cs.length-1,It=Vr-1;It>=0;It--){const Kr=Di+It,Or=ze[Kr],uo=Kr+1<hi?ze[Kr+1].el:wt;xn[It]===0?et(null,Or,Se,uo,lt,Et,dt,Pt,Dt):cn&&(Mi<0||It!==Cs[Mi]?on(Or,Se,uo,2):Mi--)}}},on=(Ae,ze,Se,wt,lt=null)=>{const{el:Et,type:dt,transition:Pt,children:Dt,shapeFlag:It}=Ae;if(It&6){on(Ae.component.subTree,ze,Se,wt);return}if(It&128){Ae.suspense.move(ze,Se,wt);return}if(It&64){dt.move(Ae,ze,Se,ni);return}if(dt===Fn){R(Et,ze,Se);for(let $t=0;$t<Dt.length;$t++)on(Dt[$t],ze,Se,wt);R(Ae.anchor,ze,Se);return}if(dt===im){zt(Ae,ze,Se);return}if(wt!==2&&It&1&&Pt)if(wt===0)Pt.beforeEnter(Et),R(Et,ze,Se),ls(()=>Pt.enter(Et),lt);else{const{leave:$t,delayLeave:gt,afterLeave:vi}=Pt,Di=()=>R(Et,ze,Se),rr=()=>{$t(Et,()=>{Di(),vi&&vi()})};gt?gt(Et,Di,rr):rr()}else R(Et,ze,Se)},Xr=(Ae,ze,Se,wt=!1,lt=!1)=>{const{type:Et,props:dt,ref:Pt,children:Dt,dynamicChildren:It,shapeFlag:hi,patchFlag:$t,dirs:gt,cacheIndex:vi}=Ae;if($t===-2&&(lt=!1),Pt!=null&&Yg(Pt,null,Se,Ae,!0),vi!=null&&(ze.renderCache[vi]=void 0),hi&256){ze.ctx.deactivate(Ae);return}const Di=hi&1&&gt,rr=!Nu(Ae);let Mi;if(rr&&(Mi=dt&&dt.onVnodeBeforeUnmount)&&Io(Mi,ze,Ae),hi&6)Is(Ae.component,Se,wt);else{if(hi&128){Ae.suspense.unmount(Se,wt);return}Di&&sc(Ae,null,ze,"beforeUnmount"),hi&64?Ae.type.remove(Ae,ze,Se,ni,wt):It&&!It.hasOnce&&(Et!==Fn||$t>0&&$t&64)?Pr(It,ze,Se,!1,!0):(Et===Fn&&$t&384||!lt&&hi&16)&&Pr(Dt,ze,Se),wt&&Gn(Ae)}(rr&&(Mi=dt&&dt.onVnodeUnmounted)||Di)&&ls(()=>{Mi&&Io(Mi,ze,Ae),Di&&sc(Ae,null,ze,"unmounted")},Se)},Gn=Ae=>{const{type:ze,el:Se,anchor:wt,transition:lt}=Ae;if(ze===Fn){Jt(Se,wt);return}if(ze===im){Gt(Ae);return}const Et=()=>{O(Se),lt&&!lt.persisted&&lt.afterLeave&&lt.afterLeave()};if(Ae.shapeFlag&1&&lt&&!lt.persisted){const{leave:dt,delayLeave:Pt}=lt,Dt=()=>dt(Se,Et);Pt?Pt(Ae.el,Et,Dt):Dt()}else Et()},Jt=(Ae,ze)=>{let Se;for(;Ae!==ze;)Se=ke(Ae),O(Ae),Ae=Se;O(ze)},Is=(Ae,ze,Se)=>{const{bum:wt,scope:lt,job:Et,subTree:dt,um:Pt,m:Dt,a:It}=Ae;T1(Dt),T1(It),wt&&Tg(wt),lt.stop(),Et&&(Et.flags|=8,Xr(dt,Ae,ze,Se)),Pt&&ls(Pt,ze),ls(()=>{Ae.isUnmounted=!0},ze),ze&&ze.pendingBranch&&!ze.isUnmounted&&Ae.asyncDep&&!Ae.asyncResolved&&Ae.suspenseId===ze.pendingId&&(ze.deps--,ze.deps===0&&ze.resolve())},Pr=(Ae,ze,Se,wt=!1,lt=!1,Et=0)=>{for(let dt=Et;dt<Ae.length;dt++)Xr(Ae[dt],ze,Se,wt,lt)},ht=Ae=>{if(Ae.shapeFlag&6)return ht(Ae.component.subTree);if(Ae.shapeFlag&128)return Ae.suspense.next();const ze=ke(Ae.anchor||Ae.el),Se=ze&&ze[Jb];return Se?ke(Se):ze};let Wt=!1;const jt=(Ae,ze,Se)=>{Ae==null?ze._vnode&&Xr(ze._vnode,null,null,!0):et(ze._vnode||null,Ae,ze,null,null,null,Se),ze._vnode=Ae,Wt||(Wt=!0,p1(),Xb(),Wt=!1)},ni={p:et,um:Xr,m:on,r:Gn,mt:Cn,mc:kt,pc:Vi,pbc:Sr,n:ht,o:d};let ge,nr;return{render:jt,hydrate:ge,createApp:IA(jt,ge)}}function Cg({type:d,props:g},M){return M==="svg"&&d==="foreignObject"||M==="mathml"&&d==="annotation-xml"&&g&&g.encoding&&g.encoding.includes("html")?void 0:M}function oc({effect:d,job:g},M){M?(d.flags|=32,g.flags|=4):(d.flags&=-33,g.flags&=-5)}function BA(d,g){return(!d||d&&!d.pendingBranch)&&g&&!g.persisted}function Cy(d,g,M=!1){const R=d.children,O=g.children;if(Fi(R)&&Fi(O))for(let U=0;U<R.length;U++){const $=R[U];let K=O[U];K.shapeFlag&1&&!K.dynamicChildren&&((K.patchFlag<=0||K.patchFlag===32)&&(K=O[U]=nl(O[U]),K.el=$.el),!M&&K.patchFlag!==-2&&Cy($,K)),K.type===Em&&(K.el=$.el)}}function FA(d){const g=d.slice(),M=[0];let R,O,U,$,K;const s=d.length;for(R=0;R<s;R++){const ce=d[R];if(ce!==0){if(O=M[M.length-1],d[O]<ce){g[R]=O,M.push(R);continue}for(U=0,$=M.length-1;U<$;)K=U+$>>1,d[M[K]]<ce?U=K+1:$=K;ce<d[M[U]]&&(U>0&&(g[R]=M[U-1]),M[U]=R)}}for(U=M.length,$=M[U-1];U-- >0;)M[U]=$,$=g[$];return M}function xw(d){const g=d.subTree.component;if(g)return g.asyncDep&&!g.asyncResolved?g:xw(g)}function T1(d){if(d)for(let g=0;g<d.length;g++)d[g].flags|=8}const NA=Symbol.for("v-scx"),VA=()=>Lo(NA);function Do(d,g,M){return vw(d,g,M)}function vw(d,g,M=Dr){const{immediate:R,deep:O,flush:U,once:$}=M,K=In({},M);let s;if(Mm)if(U==="sync"){const ke=VA();s=ke.__watcherHandles||(ke.__watcherHandles=[])}else if(!g||R)K.once=!0;else{const ke=()=>{};return ke.stop=Ro,ke.resume=Ro,ke.pause=Ro,ke}const ce=An;K.call=(ke,qe,it)=>zo(ke,ce,qe,it);let pe=!1;U==="post"?K.scheduler=ke=>{ls(ke,ce&&ce.suspense)}:U!=="sync"&&(pe=!0,K.scheduler=(ke,qe)=>{qe?ke():Ey(ke)}),K.augmentJob=ke=>{g&&(ke.flags|=4),pe&&(ke.flags|=2,ce&&(ke.id=ce.uid,ke.i=ce))};const me=KM(d,g,K);return s&&s.push(me),me}function UA(d,g,M){const R=this.proxy,O=en(d)?d.includes(".")?bw(R,d):()=>R[d]:d.bind(R,R);let U;ji(g)?U=g:(U=g.handler,M=g);const $=tf(this),K=vw(O,U.bind(R),M);return $(),K}function bw(d,g){const M=g.split(".");return()=>{let R=d;for(let O=0;O<M.length&&R;O++)R=R[M[O]];return R}}const jA=(d,g)=>g==="modelValue"||g==="model-value"?d.modelModifiers:d[`${g}Modifiers`]||d[`${ao(g)}Modifiers`]||d[`${pc(g)}Modifiers`];function GA(d,g,...M){if(d.isUnmounted)return;const R=d.vnode.props||Dr;let O=M;const U=g.startsWith("update:"),$=U&&jA(R,g.slice(7));$&&($.trim&&(O=M.map(pe=>en(pe)?pe.trim():pe)),$.number&&(O=M.map(mM)));let K,s=R[K=wg(g)]||R[K=wg(ao(g))];!s&&U&&(s=R[K=wg(pc(g))]),s&&zo(s,d,6,O);const ce=R[K+"Once"];if(ce){if(!d.emitted)d.emitted={};else if(d.emitted[K])return;d.emitted[K]=!0,zo(ce,d,6,O)}}function ww(d,g,M=!1){const R=g.emitsCache,O=R.get(d);if(O!==void 0)return O;const U=d.emits;let $={},K=!1;if(!ji(d)){const s=ce=>{const pe=ww(ce,g,!0);pe&&(K=!0,In($,pe))};!M&&g.mixins.length&&g.mixins.forEach(s),d.extends&&s(d.extends),d.mixins&&d.mixins.forEach(s)}return!U&&!K?(qr(d)&&R.set(d,null),null):(Fi(U)?U.forEach(s=>$[s]=null):In($,U),qr(d)&&R.set(d,$),$)}function Tm(d,g){return!d||!mm(g)?!1:(g=g.slice(2).replace(/Once$/,""),gr(d,g[0].toLowerCase()+g.slice(1))||gr(d,pc(g))||gr(d,g))}function Pg(d){const{type:g,vnode:M,proxy:R,withProxy:O,propsOptions:[U],slots:$,attrs:K,emit:s,render:ce,renderCache:pe,props:me,data:ke,setupState:qe,ctx:it,inheritAttrs:et}=d,ct=am(d);let St,_t;try{if(M.shapeFlag&4){const Gt=O||R,Rt=Gt;St=Po(ce.call(Rt,Gt,pe,me,qe,ke,it)),_t=K}else{const Gt=g;St=Po(Gt.length>1?Gt(me,{attrs:K,slots:$,emit:s}):Gt(me,null)),_t=g.props?K:qA(K)}}catch(Gt){qd.length=0,bm(Gt,d,1),St=Ei(cl)}let zt=St;if(_t&&et!==!1){const Gt=Object.keys(_t),{shapeFlag:Rt}=zt;Gt.length&&Rt&7&&(U&&Gt.some(ly)&&(_t=$A(_t,U)),zt=Gu(zt,_t,!1,!0))}return M.dirs&&(zt=Gu(zt,null,!1,!0),zt.dirs=zt.dirs?zt.dirs.concat(M.dirs):M.dirs),M.transition&&Sy(zt,M.transition),St=zt,am(ct),St}const qA=d=>{let g;for(const M in d)(M==="class"||M==="style"||mm(M))&&((g||(g={}))[M]=d[M]);return g},$A=(d,g)=>{const M={};for(const R in d)(!ly(R)||!(R.slice(9)in g))&&(M[R]=d[R]);return M};function ZA(d,g,M){const{props:R,children:O,component:U}=d,{props:$,children:K,patchFlag:s}=g,ce=U.emitsOptions;if(g.dirs||g.transition)return!0;if(M&&s>=0){if(s&1024)return!0;if(s&16)return R?E1(R,$,ce):!!$;if(s&8){const pe=g.dynamicProps;for(let me=0;me<pe.length;me++){const ke=pe[me];if($[ke]!==R[ke]&&!Tm(ce,ke))return!0}}}else return(O||K)&&(!K||!K.$stable)?!0:R===$?!1:R?$?E1(R,$,ce):!0:!!$;return!1}function E1(d,g,M){const R=Object.keys(g);if(R.length!==Object.keys(d).length)return!0;for(let O=0;O<R.length;O++){const U=R[O];if(g[U]!==d[U]&&!Tm(M,U))return!0}return!1}function HA({vnode:d,parent:g},M){for(;g;){const R=g.subTree;if(R.suspense&&R.suspense.activeBranch===d&&(R.el=d.el),R===d)(d=g.vnode).el=M,g=g.parent;else break}}const Tw=d=>d.__isSuspense;function WA(d,g){g&&g.pendingBranch?Fi(d)?g.effects.push(...d):g.effects.push(d):eA(d)}const Fn=Symbol.for("v-fgt"),Em=Symbol.for("v-txt"),cl=Symbol.for("v-cmt"),im=Symbol.for("v-stc"),qd=[];let Ss=null;function Si(d=!1){qd.push(Ss=d?null:[])}function XA(){qd.pop(),Ss=qd[qd.length-1]||null}let Yd=1;function S1(d){Yd+=d,d<0&&Ss&&(Ss.hasOnce=!0)}function Ew(d){return d.dynamicChildren=Yd>0?Ss||ku:null,XA(),Yd>0&&Ss&&Ss.push(d),d}function hr(d,g,M,R,O,U){return Ew(Ut(d,g,M,R,O,U,!0))}function ts(d,g,M,R,O){return Ew(Ei(d,g,M,R,O,!0))}function cm(d){return d?d.__v_isVNode===!0:!1}function Od(d,g){return d.type===g.type&&d.key===g.key}const Sw=({key:d})=>d??null,rm=({ref:d,ref_key:g,ref_for:M})=>(typeof d=="number"&&(d=""+d),d!=null?en(d)||Vn(d)||ji(d)?{i:Nn,r:d,k:g,f:!!M}:d:null);function Ut(d,g=null,M=null,R=0,O=null,U=d===Fn?0:1,$=!1,K=!1){const s={__v_isVNode:!0,__v_skip:!0,type:d,props:g,key:g&&Sw(g),ref:g&&rm(g),scopeId:Kb,slotScopeIds:null,children:M,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:U,patchFlag:R,dynamicProps:O,dynamicChildren:null,appContext:null,ctx:Nn};return K?(Py(s,M),U&128&&d.normalize(s)):M&&(s.shapeFlag|=en(M)?8:16),Yd>0&&!$&&Ss&&(s.patchFlag>0||U&6)&&s.patchFlag!==32&&Ss.push(s),s}const Ei=YA;function YA(d,g=null,M=null,R=0,O=null,U=!1){if((!d||d===nw)&&(d=cl),cm(d)){const K=Gu(d,g,!0);return M&&Py(K,M),Yd>0&&!U&&Ss&&(K.shapeFlag&6?Ss[Ss.indexOf(d)]=K:Ss.push(K)),K.patchFlag=-2,K}if(aI(d)&&(d=d.__vccOpts),g){g=KA(g);let{class:K,style:s}=g;K&&!en(K)&&(g.class=lo(K)),qr(s)&&(vy(s)&&!Fi(s)&&(s=In({},s)),g.style=hy(s))}const $=en(d)?1:Tw(d)?128:tA(d)?64:qr(d)?4:ji(d)?2:0;return Ut(d,g,M,R,O,$,U,!0)}function KA(d){return d?vy(d)||dw(d)?In({},d):d:null}function Gu(d,g,M=!1,R=!1){const{props:O,ref:U,patchFlag:$,children:K,transition:s}=d,ce=g?Sm(O||{},g):O,pe={__v_isVNode:!0,__v_skip:!0,type:d.type,props:ce,key:ce&&Sw(ce),ref:g&&g.ref?M&&U?Fi(U)?U.concat(rm(g)):[U,rm(g)]:rm(g):U,scopeId:d.scopeId,slotScopeIds:d.slotScopeIds,children:K,target:d.target,targetStart:d.targetStart,targetAnchor:d.targetAnchor,staticCount:d.staticCount,shapeFlag:d.shapeFlag,patchFlag:g&&d.type!==Fn?$===-1?16:$|16:$,dynamicProps:d.dynamicProps,dynamicChildren:d.dynamicChildren,appContext:d.appContext,dirs:d.dirs,transition:s,component:d.component,suspense:d.suspense,ssContent:d.ssContent&&Gu(d.ssContent),ssFallback:d.ssFallback&&Gu(d.ssFallback),el:d.el,anchor:d.anchor,ctx:d.ctx,ce:d.ce};return s&&R&&Sy(pe,s.clone(pe)),pe}function cs(d=" ",g=0){return Ei(Em,null,d,g)}function JA(d,g){const M=Ei(im,null,d);return M.staticCount=g,M}function Kd(d="",g=!1){return g?(Si(),ts(cl,null,d)):Ei(cl,null,d)}function Po(d){return d==null||typeof d=="boolean"?Ei(cl):Fi(d)?Ei(Fn,null,d.slice()):typeof d=="object"?nl(d):Ei(Em,null,String(d))}function nl(d){return d.el===null&&d.patchFlag!==-1||d.memo?d:Gu(d)}function Py(d,g){let M=0;const{shapeFlag:R}=d;if(g==null)g=null;else if(Fi(g))M=16;else if(typeof g=="object")if(R&65){const O=g.default;O&&(O._c&&(O._d=!1),Py(d,O()),O._c&&(O._d=!0));return}else{M=32;const O=g._;!O&&!dw(g)?g._ctx=Nn:O===3&&Nn&&(Nn.slots._===1?g._=1:(g._=2,d.patchFlag|=1024))}else ji(g)?(g={default:g,_ctx:Nn},M=32):(g=String(g),R&64?(M=16,g=[cs(g)]):M=8);d.children=g,d.shapeFlag|=M}function Sm(...d){const g={};for(let M=0;M<d.length;M++){const R=d[M];for(const O in R)if(O==="class")g.class!==R.class&&(g.class=lo([g.class,R.class]));else if(O==="style")g.style=hy([g.style,R.style]);else if(mm(O)){const U=g[O],$=R[O];$&&U!==$&&!(Fi(U)&&U.includes($))&&(g[O]=U?[].concat(U,$):$)}else O!==""&&(g[O]=R[O])}return g}function Io(d,g,M,R=null){zo(d,g,7,[M,R])}const QA=cw();let eI=0;function tI(d,g,M){const R=d.type,O=(g?g.appContext:d.appContext)||QA,U={uid:eI++,vnode:d,type:R,parent:g,appContext:O,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ib(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:g?g.provides:Object.create(O.provides),ids:g?g.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pw(R,O),emitsOptions:ww(R,O),emit:null,emitted:null,propsDefaults:Dr,inheritAttrs:R.inheritAttrs,ctx:Dr,data:Dr,props:Dr,attrs:Dr,slots:Dr,refs:Dr,setupState:Dr,setupContext:null,suspense:M,suspenseId:M?M.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return U.ctx={_:U},U.root=g?g.root:U,U.emit=GA.bind(null,U),d.ce&&d.ce(U),U}let An=null;const iI=()=>An||Nn;let um,ty;{const d=Eb(),g=(M,R)=>{let O;return(O=d[M])||(O=d[M]=[]),O.push(R),U=>{O.length>1?O.forEach($=>$(U)):O[0](U)}};um=g("__VUE_INSTANCE_SETTERS__",M=>An=M),ty=g("__VUE_SSR_SETTERS__",M=>Mm=M)}const tf=d=>{const g=An;return um(d),d.scope.on(),()=>{d.scope.off(),um(g)}},M1=()=>{An&&An.scope.off(),um(null)};function Mw(d){return d.vnode.shapeFlag&4}let Mm=!1;function rI(d,g=!1,M=!1){g&&ty(g);const{props:R,children:O}=d.vnode,U=Mw(d);CA(d,R,U,g),DA(d,O,M);const $=U?nI(d,g):void 0;return g&&ty(!1),$}function nI(d,g){const M=d.type;d.accessCache=Object.create(null),d.proxy=new Proxy(d.ctx,xA);const{setup:R}=M;if(R){const O=d.setupContext=R.length>1?Iw(d):null,U=tf(d);fl();const $=ef(R,d,0,[d.props,O]);if(pl(),U(),vb($)){if(Nu(d)||tw(d),$.then(M1,M1),g)return $.then(K=>{A1(d,K,g)}).catch(K=>{bm(K,d,0)});d.asyncDep=$}else A1(d,$,g)}else Aw(d,g)}function A1(d,g,M){ji(g)?d.type.__ssrInlineRender?d.ssrRender=g:d.render=g:qr(g)&&(d.setupState=Zb(g)),Aw(d,M)}let I1;function Aw(d,g,M){const R=d.type;if(!d.render){if(!g&&I1&&!R.render){const O=R.template||Ay(d).template;if(O){const{isCustomElement:U,compilerOptions:$}=d.appContext.config,{delimiters:K,compilerOptions:s}=R,ce=In(In({isCustomElement:U,delimiters:K},$),s);R.render=I1(O,ce)}}d.render=R.render||Ro}{const O=tf(d);fl();try{wA(d)}finally{pl(),O()}}}const sI={get(d,g){return Un(d,"get",""),d[g]}};function Iw(d){const g=M=>{d.exposed=M||{}};return{attrs:new Proxy(d.attrs,sI),slots:d.slots,emit:d.emit,expose:g}}function Ry(d){return d.exposed?d.exposeProxy||(d.exposeProxy=new Proxy(Zb(qb(d.exposed)),{get(g,M){if(M in g)return g[M];if(M in jd)return jd[M](d)},has(g,M){return M in g||M in jd}})):d.proxy}function oI(d,g=!0){return ji(d)?d.displayName||d.name:d.name||g&&d.__name}function aI(d){return ji(d)&&"__vccOpts"in d}const zr=(d,g)=>XM(d,g,Mm);function Cw(d,g,M){const R=arguments.length;return R===2?qr(g)&&!Fi(g)?cm(g)?Ei(d,null,[g]):Ei(d,g):Ei(d,null,g):(R>3?M=Array.prototype.slice.call(arguments,2):R===3&&cm(M)&&(M=[M]),Ei(d,g,M))}const lI="3.5.6";/**
* @vue/runtime-dom v3.5.6
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let iy;const C1=typeof window<"u"&&window.trustedTypes;if(C1)try{iy=C1.createPolicy("vue",{createHTML:d=>d})}catch{}const Pw=iy?d=>iy.createHTML(d):d=>d,cI="http://www.w3.org/2000/svg",uI="http://www.w3.org/1998/Math/MathML",ia=typeof document<"u"?document:null,P1=ia&&ia.createElement("template"),hI={insert:(d,g,M)=>{g.insertBefore(d,M||null)},remove:d=>{const g=d.parentNode;g&&g.removeChild(d)},createElement:(d,g,M,R)=>{const O=g==="svg"?ia.createElementNS(cI,d):g==="mathml"?ia.createElementNS(uI,d):M?ia.createElement(d,{is:M}):ia.createElement(d);return d==="select"&&R&&R.multiple!=null&&O.setAttribute("multiple",R.multiple),O},createText:d=>ia.createTextNode(d),createComment:d=>ia.createComment(d),setText:(d,g)=>{d.nodeValue=g},setElementText:(d,g)=>{d.textContent=g},parentNode:d=>d.parentNode,nextSibling:d=>d.nextSibling,querySelector:d=>ia.querySelector(d),setScopeId(d,g){d.setAttribute(g,"")},insertStaticContent(d,g,M,R,O,U){const $=M?M.previousSibling:g.lastChild;if(O&&(O===U||O.nextSibling))for(;g.insertBefore(O.cloneNode(!0),M),!(O===U||!(O=O.nextSibling)););else{P1.innerHTML=Pw(R==="svg"?`<svg>${d}</svg>`:R==="mathml"?`<math>${d}</math>`:d);const K=P1.content;if(R==="svg"||R==="mathml"){const s=K.firstChild;for(;s.firstChild;)K.appendChild(s.firstChild);K.removeChild(s)}g.insertBefore(K,M)}return[$?$.nextSibling:g.firstChild,M?M.previousSibling:g.lastChild]}},dI=Symbol("_vtc");function fI(d,g,M){const R=d[dI];R&&(g=(g?[g,...R]:[...R]).join(" ")),g==null?d.removeAttribute("class"):M?d.setAttribute("class",g):d.className=g}const R1=Symbol("_vod"),pI=Symbol("_vsh"),mI=Symbol(""),_I=/(^|;)\s*display\s*:/;function gI(d,g,M){const R=d.style,O=en(M);let U=!1;if(M&&!O){if(g)if(en(g))for(const $ of g.split(";")){const K=$.slice(0,$.indexOf(":")).trim();M[K]==null&&nm(R,K,"")}else for(const $ in g)M[$]==null&&nm(R,$,"");for(const $ in M)$==="display"&&(U=!0),nm(R,$,M[$])}else if(O){if(g!==M){const $=R[mI];$&&(M+=";"+$),R.cssText=M,U=_I.test(M)}}else g&&d.removeAttribute("style");R1 in d&&(d[R1]=U?R.display:"",d[pI]&&(R.display="none"))}const L1=/\s*!important$/;function nm(d,g,M){if(Fi(M))M.forEach(R=>nm(d,g,R));else if(M==null&&(M=""),g.startsWith("--"))d.setProperty(g,M);else{const R=yI(d,g);L1.test(M)?d.setProperty(pc(R),M.replace(L1,""),"important"):d[R]=M}}const D1=["Webkit","Moz","ms"],Rg={};function yI(d,g){const M=Rg[g];if(M)return M;let R=ao(g);if(R!=="filter"&&R in d)return Rg[g]=R;R=ym(R);for(let O=0;O<D1.length;O++){const U=D1[O]+R;if(U in d)return Rg[g]=U}return g}const z1="http://www.w3.org/1999/xlink";function k1(d,g,M,R,O,U=bM(g)){R&&g.startsWith("xlink:")?M==null?d.removeAttributeNS(z1,g.slice(6,g.length)):d.setAttributeNS(z1,g,M):M==null||U&&!Sb(M)?d.removeAttribute(g):d.setAttribute(g,U?"":dl(M)?String(M):M)}function xI(d,g,M,R){if(g==="innerHTML"||g==="textContent"){M!=null&&(d[g]=g==="innerHTML"?Pw(M):M);return}const O=d.tagName;if(g==="value"&&O!=="PROGRESS"&&!O.includes("-")){const $=O==="OPTION"?d.getAttribute("value")||"":d.value,K=M==null?d.type==="checkbox"?"on":"":String(M);($!==K||!("_value"in d))&&(d.value=K),M==null&&d.removeAttribute(g),d._value=M;return}let U=!1;if(M===""||M==null){const $=typeof d[g];$==="boolean"?M=Sb(M):M==null&&$==="string"?(M="",U=!0):$==="number"&&(M=0,U=!0)}try{d[g]=M}catch{}U&&d.removeAttribute(g)}function vI(d,g,M,R){d.addEventListener(g,M,R)}function bI(d,g,M,R){d.removeEventListener(g,M,R)}const O1=Symbol("_vei");function wI(d,g,M,R,O=null){const U=d[O1]||(d[O1]={}),$=U[g];if(R&&$)$.value=R;else{const[K,s]=TI(g);if(R){const ce=U[g]=MI(R,O);vI(d,K,ce,s)}else $&&(bI(d,K,$,s),U[g]=void 0)}}const B1=/(?:Once|Passive|Capture)$/;function TI(d){let g;if(B1.test(d)){g={};let R;for(;R=d.match(B1);)d=d.slice(0,d.length-R[0].length),g[R[0].toLowerCase()]=!0}return[d[2]===":"?d.slice(3):pc(d.slice(2)),g]}let Lg=0;const EI=Promise.resolve(),SI=()=>Lg||(EI.then(()=>Lg=0),Lg=Date.now());function MI(d,g){const M=R=>{if(!R._vts)R._vts=Date.now();else if(R._vts<=M.attached)return;zo(AI(R,M.value),g,5,[R])};return M.value=d,M.attached=SI(),M}function AI(d,g){if(Fi(g)){const M=d.stopImmediatePropagation;return d.stopImmediatePropagation=()=>{M.call(d),d._stopped=!0},g.map(R=>O=>!O._stopped&&R&&R(O))}else return g}const F1=d=>d.charCodeAt(0)===111&&d.charCodeAt(1)===110&&d.charCodeAt(2)>96&&d.charCodeAt(2)<123,II=(d,g,M,R,O,U)=>{const $=O==="svg";g==="class"?fI(d,R,$):g==="style"?gI(d,M,R):mm(g)?ly(g)||wI(d,g,M,R,U):(g[0]==="."?(g=g.slice(1),!0):g[0]==="^"?(g=g.slice(1),!1):CI(d,g,R,$))?(xI(d,g,R),!d.tagName.includes("-")&&(g==="value"||g==="checked"||g==="selected")&&k1(d,g,R,$,U,g!=="value")):(g==="true-value"?d._trueValue=R:g==="false-value"&&(d._falseValue=R),k1(d,g,R,$))};function CI(d,g,M,R){if(R)return!!(g==="innerHTML"||g==="textContent"||g in d&&F1(g)&&ji(M));if(g==="spellcheck"||g==="draggable"||g==="translate"||g==="form"||g==="list"&&d.tagName==="INPUT"||g==="type"&&d.tagName==="TEXTAREA")return!1;if(g==="width"||g==="height"){const O=d.tagName;if(O==="IMG"||O==="VIDEO"||O==="CANVAS"||O==="SOURCE")return!1}return F1(g)&&en(M)?!1:!!(g in d||d._isVueCE&&(/[A-Z]/.test(g)||!en(M)))}const PI=["ctrl","shift","alt","meta"],RI={stop:d=>d.stopPropagation(),prevent:d=>d.preventDefault(),self:d=>d.target!==d.currentTarget,ctrl:d=>!d.ctrlKey,shift:d=>!d.shiftKey,alt:d=>!d.altKey,meta:d=>!d.metaKey,left:d=>"button"in d&&d.button!==0,middle:d=>"button"in d&&d.button!==1,right:d=>"button"in d&&d.button!==2,exact:(d,g)=>PI.some(M=>d[`${M}Key`]&&!g.includes(M))},Am=(d,g)=>{const M=d._withMods||(d._withMods={}),R=g.join(".");return M[R]||(M[R]=(O,...U)=>{for(let $=0;$<g.length;$++){const K=RI[g[$]];if(K&&K(O,g))return}return d(O,...U)})},LI=In({patchProp:II},hI);let N1;function DI(){return N1||(N1=kA(LI))}const zI=(...d)=>{const g=DI().createApp(...d),{mount:M}=g;return g.mount=R=>{const O=OI(R);if(!O)return;const U=g._component;!ji(U)&&!U.render&&!U.template&&(U.template=O.innerHTML),O.nodeType===1&&(O.textContent="");const $=M(O,!1,kI(O));return O instanceof Element&&(O.removeAttribute("v-cloak"),O.setAttribute("data-v-app","")),$},g};function kI(d){if(d instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&d instanceof MathMLElement)return"mathml"}function OI(d){return en(d)?document.querySelector(d):d}var BI=!1;/*!
 * pinia v2.2.2
 * (c) 2024 Eduardo San Martin Morote
 * @license MIT
 */const FI=Symbol();var V1;(function(d){d.direct="direct",d.patchObject="patch object",d.patchFunction="patch function"})(V1||(V1={}));function NI(){const d=wM(!0),g=d.run(()=>fn({}));let M=[],R=[];const O=qb({install(U){O._a=U,U.provide(FI,O),U.config.globalProperties.$pinia=O,R.forEach($=>M.push($)),R=[]},use(U){return!this._a&&!BI?R.push(U):M.push(U),this},_p:M,_a:null,_e:d,_s:new Map,state:g});return O}/*!
  * vue-router v4.4.5
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const zu=typeof document<"u";function Rw(d){return typeof d=="object"||"displayName"in d||"props"in d||"__vccOpts"in d}function VI(d){return d.__esModule||d[Symbol.toStringTag]==="Module"||d.default&&Rw(d.default)}const Gr=Object.assign;function Dg(d,g){const M={};for(const R in g){const O=g[R];M[R]=co(O)?O.map(d):d(O)}return M}const $d=()=>{},co=Array.isArray,Lw=/#/g,UI=/&/g,jI=/\//g,GI=/=/g,qI=/\?/g,Dw=/\+/g,$I=/%5B/g,ZI=/%5D/g,zw=/%5E/g,HI=/%60/g,kw=/%7B/g,WI=/%7C/g,Ow=/%7D/g,XI=/%20/g;function Ly(d){return encodeURI(""+d).replace(WI,"|").replace($I,"[").replace(ZI,"]")}function YI(d){return Ly(d).replace(kw,"{").replace(Ow,"}").replace(zw,"^")}function ry(d){return Ly(d).replace(Dw,"%2B").replace(XI,"+").replace(Lw,"%23").replace(UI,"%26").replace(HI,"`").replace(kw,"{").replace(Ow,"}").replace(zw,"^")}function KI(d){return ry(d).replace(GI,"%3D")}function JI(d){return Ly(d).replace(Lw,"%23").replace(qI,"%3F")}function QI(d){return d==null?"":JI(d).replace(jI,"%2F")}function Jd(d){try{return decodeURIComponent(""+d)}catch{}return""+d}const eC=/\/$/,tC=d=>d.replace(eC,"");function zg(d,g,M="/"){let R,O={},U="",$="";const K=g.indexOf("#");let s=g.indexOf("?");return K<s&&K>=0&&(s=-1),s>-1&&(R=g.slice(0,s),U=g.slice(s+1,K>-1?K:g.length),O=d(U)),K>-1&&(R=R||g.slice(0,K),$=g.slice(K,g.length)),R=sC(R??g,M),{fullPath:R+(U&&"?")+U+$,path:R,query:O,hash:Jd($)}}function iC(d,g){const M=g.query?d(g.query):"";return g.path+(M&&"?")+M+(g.hash||"")}function rC(d,g,M){const R=g.matched.length-1,O=M.matched.length-1;return R>-1&&R===O&&qu(g.matched[R],M.matched[O])&&Bw(g.params,M.params)&&d(g.query)===d(M.query)&&g.hash===M.hash}function qu(d,g){return(d.aliasOf||d)===(g.aliasOf||g)}function Bw(d,g){if(Object.keys(d).length!==Object.keys(g).length)return!1;for(const M in d)if(!nC(d[M],g[M]))return!1;return!0}function nC(d,g){return co(d)?U1(d,g):co(g)?U1(g,d):d===g}function U1(d,g){return co(g)?d.length===g.length&&d.every((M,R)=>M===g[R]):d.length===1&&d[0]===g}function sC(d,g){if(d.startsWith("/"))return d;if(!d)return g;const M=g.split("/"),R=d.split("/"),O=R[R.length-1];(O===".."||O===".")&&R.push("");let U=M.length-1,$,K;for($=0;$<R.length;$++)if(K=R[$],K!==".")if(K==="..")U>1&&U--;else break;return M.slice(0,U).join("/")+"/"+R.slice($).join("/")}const tl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Qd;(function(d){d.pop="pop",d.push="push"})(Qd||(Qd={}));var hm;(function(d){d.back="back",d.forward="forward",d.unknown=""})(hm||(hm={}));const kg="";function oC(d){if(!d)if(zu){const g=document.querySelector("base");d=g&&g.getAttribute("href")||"/",d=d.replace(/^\w+:\/\/[^\/]+/,"")}else d="/";return d[0]!=="/"&&d[0]!=="#"&&(d="/"+d),tC(d)}const aC=/^[^#]+#/;function lC(d,g){return d.replace(aC,"#")+g}function cC(d,g){const M=document.documentElement.getBoundingClientRect(),R=d.getBoundingClientRect();return{behavior:g.behavior,left:R.left-M.left-(g.left||0),top:R.top-M.top-(g.top||0)}}const uC=()=>({left:window.scrollX,top:window.scrollY});function hC(d){let g;if("el"in d){const M=d.el,R=typeof M=="string"&&M.startsWith("#"),O=typeof M=="string"?R?document.getElementById(M.slice(1)):document.querySelector(M):M;if(!O)return;g=cC(O,d)}else g=d;"scrollBehavior"in document.documentElement.style?window.scrollTo(g):window.scrollTo(g.left!=null?g.left:window.scrollX,g.top!=null?g.top:window.scrollY)}function j1(d,g){return(history.state?history.state.position-g:-1)+d}const ny=new Map;function dC(d,g){ny.set(d,g)}function fC(d){const g=ny.get(d);return ny.delete(d),g}function pC(d=""){let g=[],M=[kg],R=0;d=oC(d);function O(K){R++,R!==M.length&&M.splice(R),M.push(K)}function U(K,s,{direction:ce,delta:pe}){const me={direction:ce,delta:pe,type:Qd.pop};for(const ke of g)ke(K,s,me)}const $={location:kg,state:{},base:d,createHref:lC.bind(null,d),replace(K){M.splice(R--,1),O(K)},push(K,s){O(K)},listen(K){return g.push(K),()=>{const s=g.indexOf(K);s>-1&&g.splice(s,1)}},destroy(){g=[],M=[kg],R=0},go(K,s=!0){const ce=this.location,pe=K<0?hm.back:hm.forward;R=Math.max(0,Math.min(R+K,M.length-1)),s&&U(this.location,ce,{direction:pe,delta:K})}};return Object.defineProperty($,"location",{enumerable:!0,get:()=>M[R]}),$}function mC(d){return typeof d=="string"||d&&typeof d=="object"}function Fw(d){return typeof d=="string"||typeof d=="symbol"}const Nw=Symbol("");var G1;(function(d){d[d.aborted=4]="aborted",d[d.cancelled=8]="cancelled",d[d.duplicated=16]="duplicated"})(G1||(G1={}));function $u(d,g){return Gr(new Error,{type:d,[Nw]:!0},g)}function ta(d,g){return d instanceof Error&&Nw in d&&(g==null||!!(d.type&g))}const q1="[^/]+?",_C={sensitive:!1,strict:!1,start:!0,end:!0},gC=/[.+*?^${}()[\]/\\]/g;function yC(d,g){const M=Gr({},_C,g),R=[];let O=M.start?"^":"";const U=[];for(const ce of d){const pe=ce.length?[]:[90];M.strict&&!ce.length&&(O+="/");for(let me=0;me<ce.length;me++){const ke=ce[me];let qe=40+(M.sensitive?.25:0);if(ke.type===0)me||(O+="/"),O+=ke.value.replace(gC,"\\$&"),qe+=40;else if(ke.type===1){const{value:it,repeatable:et,optional:ct,regexp:St}=ke;U.push({name:it,repeatable:et,optional:ct});const _t=St||q1;if(_t!==q1){qe+=10;try{new RegExp(`(${_t})`)}catch(Gt){throw new Error(`Invalid custom RegExp for param "${it}" (${_t}): `+Gt.message)}}let zt=et?`((?:${_t})(?:/(?:${_t}))*)`:`(${_t})`;me||(zt=ct&&ce.length<2?`(?:/${zt})`:"/"+zt),ct&&(zt+="?"),O+=zt,qe+=20,ct&&(qe+=-8),et&&(qe+=-20),_t===".*"&&(qe+=-50)}pe.push(qe)}R.push(pe)}if(M.strict&&M.end){const ce=R.length-1;R[ce][R[ce].length-1]+=.7000000000000001}M.strict||(O+="/?"),M.end?O+="$":M.strict&&(O+="(?:/|$)");const $=new RegExp(O,M.sensitive?"":"i");function K(ce){const pe=ce.match($),me={};if(!pe)return null;for(let ke=1;ke<pe.length;ke++){const qe=pe[ke]||"",it=U[ke-1];me[it.name]=qe&&it.repeatable?qe.split("/"):qe}return me}function s(ce){let pe="",me=!1;for(const ke of d){(!me||!pe.endsWith("/"))&&(pe+="/"),me=!1;for(const qe of ke)if(qe.type===0)pe+=qe.value;else if(qe.type===1){const{value:it,repeatable:et,optional:ct}=qe,St=it in ce?ce[it]:"";if(co(St)&&!et)throw new Error(`Provided param "${it}" is an array but it is not repeatable (* or + modifiers)`);const _t=co(St)?St.join("/"):St;if(!_t)if(ct)ke.length<2&&(pe.endsWith("/")?pe=pe.slice(0,-1):me=!0);else throw new Error(`Missing required param "${it}"`);pe+=_t}}return pe||"/"}return{re:$,score:R,keys:U,parse:K,stringify:s}}function xC(d,g){let M=0;for(;M<d.length&&M<g.length;){const R=g[M]-d[M];if(R)return R;M++}return d.length<g.length?d.length===1&&d[0]===80?-1:1:d.length>g.length?g.length===1&&g[0]===80?1:-1:0}function Vw(d,g){let M=0;const R=d.score,O=g.score;for(;M<R.length&&M<O.length;){const U=xC(R[M],O[M]);if(U)return U;M++}if(Math.abs(O.length-R.length)===1){if($1(R))return 1;if($1(O))return-1}return O.length-R.length}function $1(d){const g=d[d.length-1];return d.length>0&&g[g.length-1]<0}const vC={type:0,value:""},bC=/[a-zA-Z0-9_]/;function wC(d){if(!d)return[[]];if(d==="/")return[[vC]];if(!d.startsWith("/"))throw new Error(`Invalid path "${d}"`);function g(qe){throw new Error(`ERR (${M})/"${ce}": ${qe}`)}let M=0,R=M;const O=[];let U;function $(){U&&O.push(U),U=[]}let K=0,s,ce="",pe="";function me(){ce&&(M===0?U.push({type:0,value:ce}):M===1||M===2||M===3?(U.length>1&&(s==="*"||s==="+")&&g(`A repeatable param (${ce}) must be alone in its segment. eg: '/:ids+.`),U.push({type:1,value:ce,regexp:pe,repeatable:s==="*"||s==="+",optional:s==="*"||s==="?"})):g("Invalid state to consume buffer"),ce="")}function ke(){ce+=s}for(;K<d.length;){if(s=d[K++],s==="\\"&&M!==2){R=M,M=4;continue}switch(M){case 0:s==="/"?(ce&&me(),$()):s===":"?(me(),M=1):ke();break;case 4:ke(),M=R;break;case 1:s==="("?M=2:bC.test(s)?ke():(me(),M=0,s!=="*"&&s!=="?"&&s!=="+"&&K--);break;case 2:s===")"?pe[pe.length-1]=="\\"?pe=pe.slice(0,-1)+s:M=3:pe+=s;break;case 3:me(),M=0,s!=="*"&&s!=="?"&&s!=="+"&&K--,pe="";break;default:g("Unknown state");break}}return M===2&&g(`Unfinished custom RegExp for param "${ce}"`),me(),$(),O}function TC(d,g,M){const R=yC(wC(d.path),M),O=Gr(R,{record:d,parent:g,children:[],alias:[]});return g&&!O.record.aliasOf==!g.record.aliasOf&&g.children.push(O),O}function EC(d,g){const M=[],R=new Map;g=X1({strict:!1,end:!0,sensitive:!1},g);function O(me){return R.get(me)}function U(me,ke,qe){const it=!qe,et=H1(me);et.aliasOf=qe&&qe.record;const ct=X1(g,me),St=[et];if("alias"in me){const Gt=typeof me.alias=="string"?[me.alias]:me.alias;for(const Rt of Gt)St.push(H1(Gr({},et,{components:qe?qe.record.components:et.components,path:Rt,aliasOf:qe?qe.record:et})))}let _t,zt;for(const Gt of St){const{path:Rt}=Gt;if(ke&&Rt[0]!=="/"){const yi=ke.record.path,Ti=yi[yi.length-1]==="/"?"":"/";Gt.path=ke.record.path+(Rt&&Ti+Rt)}if(_t=TC(Gt,ke,ct),qe?qe.alias.push(_t):(zt=zt||_t,zt!==_t&&zt.alias.push(_t),it&&me.name&&!W1(_t)&&$(me.name)),Uw(_t)&&s(_t),et.children){const yi=et.children;for(let Ti=0;Ti<yi.length;Ti++)U(yi[Ti],_t,qe&&qe.children[Ti])}qe=qe||_t}return zt?()=>{$(zt)}:$d}function $(me){if(Fw(me)){const ke=R.get(me);ke&&(R.delete(me),M.splice(M.indexOf(ke),1),ke.children.forEach($),ke.alias.forEach($))}else{const ke=M.indexOf(me);ke>-1&&(M.splice(ke,1),me.record.name&&R.delete(me.record.name),me.children.forEach($),me.alias.forEach($))}}function K(){return M}function s(me){const ke=AC(me,M);M.splice(ke,0,me),me.record.name&&!W1(me)&&R.set(me.record.name,me)}function ce(me,ke){let qe,it={},et,ct;if("name"in me&&me.name){if(qe=R.get(me.name),!qe)throw $u(1,{location:me});ct=qe.record.name,it=Gr(Z1(ke.params,qe.keys.filter(zt=>!zt.optional).concat(qe.parent?qe.parent.keys.filter(zt=>zt.optional):[]).map(zt=>zt.name)),me.params&&Z1(me.params,qe.keys.map(zt=>zt.name))),et=qe.stringify(it)}else if(me.path!=null)et=me.path,qe=M.find(zt=>zt.re.test(et)),qe&&(it=qe.parse(et),ct=qe.record.name);else{if(qe=ke.name?R.get(ke.name):M.find(zt=>zt.re.test(ke.path)),!qe)throw $u(1,{location:me,currentLocation:ke});ct=qe.record.name,it=Gr({},ke.params,me.params),et=qe.stringify(it)}const St=[];let _t=qe;for(;_t;)St.unshift(_t.record),_t=_t.parent;return{name:ct,path:et,params:it,matched:St,meta:MC(St)}}d.forEach(me=>U(me));function pe(){M.length=0,R.clear()}return{addRoute:U,resolve:ce,removeRoute:$,clearRoutes:pe,getRoutes:K,getRecordMatcher:O}}function Z1(d,g){const M={};for(const R of g)R in d&&(M[R]=d[R]);return M}function H1(d){const g={path:d.path,redirect:d.redirect,name:d.name,meta:d.meta||{},aliasOf:d.aliasOf,beforeEnter:d.beforeEnter,props:SC(d),children:d.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in d?d.components||null:d.component&&{default:d.component}};return Object.defineProperty(g,"mods",{value:{}}),g}function SC(d){const g={},M=d.props||!1;if("component"in d)g.default=M;else for(const R in d.components)g[R]=typeof M=="object"?M[R]:M;return g}function W1(d){for(;d;){if(d.record.aliasOf)return!0;d=d.parent}return!1}function MC(d){return d.reduce((g,M)=>Gr(g,M.meta),{})}function X1(d,g){const M={};for(const R in d)M[R]=R in g?g[R]:d[R];return M}function AC(d,g){let M=0,R=g.length;for(;M!==R;){const U=M+R>>1;Vw(d,g[U])<0?R=U:M=U+1}const O=IC(d);return O&&(R=g.lastIndexOf(O,R-1)),R}function IC(d){let g=d;for(;g=g.parent;)if(Uw(g)&&Vw(d,g)===0)return g}function Uw({record:d}){return!!(d.name||d.components&&Object.keys(d.components).length||d.redirect)}function CC(d){const g={};if(d===""||d==="?")return g;const R=(d[0]==="?"?d.slice(1):d).split("&");for(let O=0;O<R.length;++O){const U=R[O].replace(Dw," "),$=U.indexOf("="),K=Jd($<0?U:U.slice(0,$)),s=$<0?null:Jd(U.slice($+1));if(K in g){let ce=g[K];co(ce)||(ce=g[K]=[ce]),ce.push(s)}else g[K]=s}return g}function Y1(d){let g="";for(let M in d){const R=d[M];if(M=KI(M),R==null){R!==void 0&&(g+=(g.length?"&":"")+M);continue}(co(R)?R.map(U=>U&&ry(U)):[R&&ry(R)]).forEach(U=>{U!==void 0&&(g+=(g.length?"&":"")+M,U!=null&&(g+="="+U))})}return g}function PC(d){const g={};for(const M in d){const R=d[M];R!==void 0&&(g[M]=co(R)?R.map(O=>O==null?null:""+O):R==null?R:""+R)}return g}const RC=Symbol(""),K1=Symbol(""),Dy=Symbol(""),jw=Symbol(""),sy=Symbol("");function Bd(){let d=[];function g(R){return d.push(R),()=>{const O=d.indexOf(R);O>-1&&d.splice(O,1)}}function M(){d=[]}return{add:g,list:()=>d.slice(),reset:M}}function sl(d,g,M,R,O,U=$=>$()){const $=R&&(R.enterCallbacks[O]=R.enterCallbacks[O]||[]);return()=>new Promise((K,s)=>{const ce=ke=>{ke===!1?s($u(4,{from:M,to:g})):ke instanceof Error?s(ke):mC(ke)?s($u(2,{from:g,to:ke})):($&&R.enterCallbacks[O]===$&&typeof ke=="function"&&$.push(ke),K())},pe=U(()=>d.call(R&&R.instances[O],g,M,ce));let me=Promise.resolve(pe);d.length<3&&(me=me.then(ce)),me.catch(ke=>s(ke))})}function Og(d,g,M,R,O=U=>U()){const U=[];for(const $ of d)for(const K in $.components){let s=$.components[K];if(!(g!=="beforeRouteEnter"&&!$.instances[K]))if(Rw(s)){const pe=(s.__vccOpts||s)[g];pe&&U.push(sl(pe,M,R,$,K,O))}else{let ce=s();U.push(()=>ce.then(pe=>{if(!pe)throw new Error(`Couldn't resolve component "${K}" at "${$.path}"`);const me=VI(pe)?pe.default:pe;$.mods[K]=pe,$.components[K]=me;const qe=(me.__vccOpts||me)[g];return qe&&sl(qe,M,R,$,K,O)()}))}}return U}function J1(d){const g=Lo(Dy),M=Lo(jw),R=zr(()=>{const s=Hi(d.to);return g.resolve(s)}),O=zr(()=>{const{matched:s}=R.value,{length:ce}=s,pe=s[ce-1],me=M.matched;if(!pe||!me.length)return-1;const ke=me.findIndex(qu.bind(null,pe));if(ke>-1)return ke;const qe=Q1(s[ce-2]);return ce>1&&Q1(pe)===qe&&me[me.length-1].path!==qe?me.findIndex(qu.bind(null,s[ce-2])):ke}),U=zr(()=>O.value>-1&&zC(M.params,R.value.params)),$=zr(()=>O.value>-1&&O.value===M.matched.length-1&&Bw(M.params,R.value.params));function K(s={}){return DC(s)?g[Hi(d.replace)?"replace":"push"](Hi(d.to)).catch($d):Promise.resolve()}return{route:R,href:zr(()=>R.value.href),isActive:U,isExactActive:$,navigate:K}}const LC=ew({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:J1,setup(d,{slots:g}){const M=mc(J1(d)),{options:R}=Lo(Dy),O=zr(()=>({[eb(d.activeClass,R.linkActiveClass,"router-link-active")]:M.isActive,[eb(d.exactActiveClass,R.linkExactActiveClass,"router-link-exact-active")]:M.isExactActive}));return()=>{const U=g.default&&g.default(M);return d.custom?U:Cw("a",{"aria-current":M.isExactActive?d.ariaCurrentValue:null,href:M.href,onClick:M.navigate,class:O.value},U)}}}),fc=LC;function DC(d){if(!(d.metaKey||d.altKey||d.ctrlKey||d.shiftKey)&&!d.defaultPrevented&&!(d.button!==void 0&&d.button!==0)){if(d.currentTarget&&d.currentTarget.getAttribute){const g=d.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(g))return}return d.preventDefault&&d.preventDefault(),!0}}function zC(d,g){for(const M in g){const R=g[M],O=d[M];if(typeof R=="string"){if(R!==O)return!1}else if(!co(O)||O.length!==R.length||R.some((U,$)=>U!==O[$]))return!1}return!0}function Q1(d){return d?d.aliasOf?d.aliasOf.path:d.path:""}const eb=(d,g,M)=>d??g??M,kC=ew({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(d,{attrs:g,slots:M}){const R=Lo(sy),O=zr(()=>d.route||R.value),U=Lo(K1,0),$=zr(()=>{let ce=Hi(U);const{matched:pe}=O.value;let me;for(;(me=pe[ce])&&!me.components;)ce++;return ce}),K=zr(()=>O.value.matched[$.value]);Gd(K1,zr(()=>$.value+1)),Gd(RC,K),Gd(sy,O);const s=fn();return Do(()=>[s.value,K.value,d.name],([ce,pe,me],[ke,qe,it])=>{pe&&(pe.instances[me]=ce,qe&&qe!==pe&&ce&&ce===ke&&(pe.leaveGuards.size||(pe.leaveGuards=qe.leaveGuards),pe.updateGuards.size||(pe.updateGuards=qe.updateGuards))),ce&&pe&&(!qe||!qu(pe,qe)||!ke)&&(pe.enterCallbacks[me]||[]).forEach(et=>et(ce))},{flush:"post"}),()=>{const ce=O.value,pe=d.name,me=K.value,ke=me&&me.components[pe];if(!ke)return tb(M.default,{Component:ke,route:ce});const qe=me.props[pe],it=qe?qe===!0?ce.params:typeof qe=="function"?qe(ce):qe:null,ct=Cw(ke,Gr({},it,g,{onVnodeUnmounted:St=>{St.component.isUnmounted&&(me.instances[pe]=null)},ref:s}));return tb(M.default,{Component:ct,route:ce})||ct}}});function tb(d,g){if(!d)return null;const M=d(g);return M.length===1?M[0]:M}const zy=kC;function OC(d){const g=EC(d.routes,d),M=d.parseQuery||CC,R=d.stringifyQuery||Y1,O=d.history,U=Bd(),$=Bd(),K=Bd(),s=$M(tl);let ce=tl;zu&&d.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const pe=Dg.bind(null,ht=>""+ht),me=Dg.bind(null,QI),ke=Dg.bind(null,Jd);function qe(ht,Wt){let jt,ni;return Fw(ht)?(jt=g.getRecordMatcher(ht),ni=Wt):ni=ht,g.addRoute(ni,jt)}function it(ht){const Wt=g.getRecordMatcher(ht);Wt&&g.removeRoute(Wt)}function et(){return g.getRoutes().map(ht=>ht.record)}function ct(ht){return!!g.getRecordMatcher(ht)}function St(ht,Wt){if(Wt=Gr({},Wt||s.value),typeof ht=="string"){const ze=zg(M,ht,Wt.path),Se=g.resolve({path:ze.path},Wt),wt=O.createHref(ze.fullPath);return Gr(ze,Se,{params:ke(Se.params),hash:Jd(ze.hash),redirectedFrom:void 0,href:wt})}let jt;if(ht.path!=null)jt=Gr({},ht,{path:zg(M,ht.path,Wt.path).path});else{const ze=Gr({},ht.params);for(const Se in ze)ze[Se]==null&&delete ze[Se];jt=Gr({},ht,{params:me(ze)}),Wt.params=me(Wt.params)}const ni=g.resolve(jt,Wt),ge=ht.hash||"";ni.params=pe(ke(ni.params));const nr=iC(R,Gr({},ht,{hash:YI(ge),path:ni.path})),Ae=O.createHref(nr);return Gr({fullPath:nr,hash:ge,query:R===Y1?PC(ht.query):ht.query||{}},ni,{redirectedFrom:void 0,href:Ae})}function _t(ht){return typeof ht=="string"?zg(M,ht,s.value.path):Gr({},ht)}function zt(ht,Wt){if(ce!==ht)return $u(8,{from:Wt,to:ht})}function Gt(ht){return Ti(ht)}function Rt(ht){return Gt(Gr(_t(ht),{replace:!0}))}function yi(ht){const Wt=ht.matched[ht.matched.length-1];if(Wt&&Wt.redirect){const{redirect:jt}=Wt;let ni=typeof jt=="function"?jt(ht):jt;return typeof ni=="string"&&(ni=ni.includes("?")||ni.includes("#")?ni=_t(ni):{path:ni},ni.params={}),Gr({query:ht.query,hash:ht.hash,params:ni.path!=null?{}:ht.params},ni)}}function Ti(ht,Wt){const jt=ce=St(ht),ni=s.value,ge=ht.state,nr=ht.force,Ae=ht.replace===!0,ze=yi(jt);if(ze)return Ti(Gr(_t(ze),{state:typeof ze=="object"?Gr({},ge,ze.state):ge,force:nr,replace:Ae}),Wt||jt);const Se=jt;Se.redirectedFrom=Wt;let wt;return!nr&&rC(R,ni,jt)&&(wt=$u(16,{to:Se,from:ni}),on(ni,ni,!0,!1)),(wt?Promise.resolve(wt):Sr(Se,ni)).catch(lt=>ta(lt)?ta(lt,2)?lt:Qt(lt):Vi(lt,Se,ni)).then(lt=>{if(lt){if(ta(lt,2))return Ti(Gr({replace:Ae},_t(lt.to),{state:typeof lt.to=="object"?Gr({},ge,lt.to.state):ge,force:nr}),Wt||Se)}else lt=Xt(Se,ni,!0,Ae,ge);return qt(Se,ni,lt),lt})}function kt(ht,Wt){const jt=zt(ht,Wt);return jt?Promise.reject(jt):Promise.resolve()}function lr(ht){const Wt=Jt.values().next().value;return Wt&&typeof Wt.runWithContext=="function"?Wt.runWithContext(ht):ht()}function Sr(ht,Wt){let jt;const[ni,ge,nr]=BC(ht,Wt);jt=Og(ni.reverse(),"beforeRouteLeave",ht,Wt);for(const ze of ni)ze.leaveGuards.forEach(Se=>{jt.push(sl(Se,ht,Wt))});const Ae=kt.bind(null,ht,Wt);return jt.push(Ae),Pr(jt).then(()=>{jt=[];for(const ze of U.list())jt.push(sl(ze,ht,Wt));return jt.push(Ae),Pr(jt)}).then(()=>{jt=Og(ge,"beforeRouteUpdate",ht,Wt);for(const ze of ge)ze.updateGuards.forEach(Se=>{jt.push(sl(Se,ht,Wt))});return jt.push(Ae),Pr(jt)}).then(()=>{jt=[];for(const ze of nr)if(ze.beforeEnter)if(co(ze.beforeEnter))for(const Se of ze.beforeEnter)jt.push(sl(Se,ht,Wt));else jt.push(sl(ze.beforeEnter,ht,Wt));return jt.push(Ae),Pr(jt)}).then(()=>(ht.matched.forEach(ze=>ze.enterCallbacks={}),jt=Og(nr,"beforeRouteEnter",ht,Wt,lr),jt.push(Ae),Pr(jt))).then(()=>{jt=[];for(const ze of $.list())jt.push(sl(ze,ht,Wt));return jt.push(Ae),Pr(jt)}).catch(ze=>ta(ze,8)?ze:Promise.reject(ze))}function qt(ht,Wt,jt){K.list().forEach(ni=>lr(()=>ni(ht,Wt,jt)))}function Xt(ht,Wt,jt,ni,ge){const nr=zt(ht,Wt);if(nr)return nr;const Ae=Wt===tl,ze=zu?history.state:{};jt&&(ni||Ae?O.replace(ht.fullPath,Gr({scroll:Ae&&ze&&ze.scroll},ge)):O.push(ht.fullPath,ge)),s.value=ht,on(ht,Wt,jt,Ae),Qt()}let sn;function Cn(){sn||(sn=O.listen((ht,Wt,jt)=>{if(!Is.listening)return;const ni=St(ht),ge=yi(ni);if(ge){Ti(Gr(ge,{replace:!0}),ni).catch($d);return}ce=ni;const nr=s.value;zu&&dC(j1(nr.fullPath,jt.delta),uC()),Sr(ni,nr).catch(Ae=>ta(Ae,12)?Ae:ta(Ae,2)?(Ti(Ae.to,ni).then(ze=>{ta(ze,20)&&!jt.delta&&jt.type===Qd.pop&&O.go(-1,!1)}).catch($d),Promise.reject()):(jt.delta&&O.go(-jt.delta,!1),Vi(Ae,ni,nr))).then(Ae=>{Ae=Ae||Xt(ni,nr,!1),Ae&&(jt.delta&&!ta(Ae,8)?O.go(-jt.delta,!1):jt.type===Qd.pop&&ta(Ae,20)&&O.go(-1,!1)),qt(ni,nr,Ae)}).catch($d)}))}let hs=Bd(),Ht=Bd(),Li;function Vi(ht,Wt,jt){Qt(ht);const ni=Ht.list();return ni.length?ni.forEach(ge=>ge(ht,Wt,jt)):console.error(ht),Promise.reject(ht)}function pn(){return Li&&s.value!==tl?Promise.resolve():new Promise((ht,Wt)=>{hs.add([ht,Wt])})}function Qt(ht){return Li||(Li=!ht,Cn(),hs.list().forEach(([Wt,jt])=>ht?jt(ht):Wt()),hs.reset()),ht}function on(ht,Wt,jt,ni){const{scrollBehavior:ge}=d;if(!zu||!ge)return Promise.resolve();const nr=!jt&&fC(j1(ht.fullPath,0))||(ni||!jt)&&history.state&&history.state.scroll||null;return Ty().then(()=>ge(ht,Wt,nr)).then(Ae=>Ae&&hC(Ae)).catch(Ae=>Vi(Ae,ht,Wt))}const Xr=ht=>O.go(ht);let Gn;const Jt=new Set,Is={currentRoute:s,listening:!0,addRoute:qe,removeRoute:it,clearRoutes:g.clearRoutes,hasRoute:ct,getRoutes:et,resolve:St,options:d,push:Gt,replace:Rt,go:Xr,back:()=>Xr(-1),forward:()=>Xr(1),beforeEach:U.add,beforeResolve:$.add,afterEach:K.add,onError:Ht.add,isReady:pn,install(ht){const Wt=this;ht.component("RouterLink",fc),ht.component("RouterView",zy),ht.config.globalProperties.$router=Wt,Object.defineProperty(ht.config.globalProperties,"$route",{enumerable:!0,get:()=>Hi(s)}),zu&&!Gn&&s.value===tl&&(Gn=!0,Gt(O.location).catch(ge=>{}));const jt={};for(const ge in tl)Object.defineProperty(jt,ge,{get:()=>s.value[ge],enumerable:!0});ht.provide(Dy,Wt),ht.provide(jw,yy(jt)),ht.provide(sy,s);const ni=ht.unmount;Jt.add(ht),ht.unmount=function(){Jt.delete(ht),Jt.size<1&&(ce=tl,sn&&sn(),sn=null,s.value=tl,Gn=!1,Li=!1),ni()}}};function Pr(ht){return ht.reduce((Wt,jt)=>Wt.then(()=>lr(jt)),Promise.resolve())}return Is}function BC(d,g){const M=[],R=[],O=[],U=Math.max(g.matched.length,d.matched.length);for(let $=0;$<U;$++){const K=g.matched[$];K&&(d.matched.find(ce=>qu(ce,K))?R.push(K):M.push(K));const s=d.matched[$];s&&(g.matched.find(ce=>qu(ce,s))||O.push(s))}return[M,R,O]}const FC="/VueMap-Explorer/assets/static-map-CEyR3Hmo.png",As=(d,g)=>{const M=d.__vccOpts||d;for(const[R,O]of g)M[R]=O;return M},NC={},VC={class:"flex h-screen"},UC={class:"flex-1 flex bg-primary justify-center items-center"},jC={class:"text-white px-5 max-w-[508px] w-full"};function GC(d,g){return Si(),hr("main",VC,[Ut("section",UC,[Ut("div",jC,[Ms(d.$slots,"default")])]),g[0]||(g[0]=Ut("section",{class:"flex-1"},[Ut("img",{class:"h-full w-full object-cover",src:FC,alt:""})],-1))])}const Gw=As(NC,[["render",GC]]),qC={class:"max-w-[500px] w-full bg-white p-10 rounded-2xl shadow-lg"},$C={class:"flex gap-11 justify-center mb-10 font-bold text-base"},ZC={__name:"AuthView",setup(d){return(g,M)=>(Si(),ts(Gw,null,{default:nn(()=>[Ut("section",qC,[Ut("nav",$C,[Ei(Hi(fc),{class:"text-grey","exact-active-class":"text-primary",to:"registration"},{default:nn(()=>M[0]||(M[0]=[cs(" Create an account ")])),_:1}),Ei(Hi(fc),{class:"text-grey",to:"login","exact-active-class":"text-primary"},{default:nn(()=>M[1]||(M[1]=[cs(" Sign In ")])),_:1})]),Ei(Hi(zy))])]),_:1}))}},HC={__name:"IButton",props:{variant:{default:"primary",type:String,validator:d=>["primary","gradient","outlined"].includes(d)},to:String},setup(d){const g=d,M=zr(()=>g.variant==="gradient"?"bg-gradient-to-r from-secondary to-primary":"bg-secondary"),R=zr(()=>!!g.to),O=zr(()=>R.value?fc:"button"),U=zr(()=>R.value?g.to:null);return($,K)=>(Si(),ts(Hi(O),{is:O.value,to:U.value,class:lo(["rounded-xl py-3 px-10 font-bold tracking-wider text-white overflow-hidden shadow-md transform transition duration-200 hover:shadow-lg active:scale-95",M.value])},{default:nn(()=>[Ms($.$slots,"default",{},void 0,!0)]),_:3},8,["is","to","class"]))}},rf=As(HC,[["__scopeId","data-v-80718f25"]]),WC={class:"w-full text-border"},XC={class:"block"},YC={class:"block text-xs px-3 mb-2"},ib="w-full text-sm rounded-[4px] border-[#2c2c2c46] border-[1px] py-2 px-3 focus:outline-primary",hc=Object.assign({inheritAttrs:!1},{__name:"IInput",props:{modelValue:String,label:String,placeholder:String,type:{default:"text",type:String}},emits:["update:modelValue"],setup(d,{emit:g}){const M=d,R=g,O=zr(()=>M.type==="textarea"),U=zr(()=>O.value?ib+" resize-none":ib),$=zr(()=>O.value?"textarea":"input");return(K,s)=>(Si(),hr("div",WC,[Ut("label",XC,[Ut("span",YC,ll(M.label),1),(Si(),ts(My($.value),Sm({rows:"3",class:U.value},{...K.$props,...K.$attrs},{value:d.modelValue,onInput:s[0]||(s[0]=ce=>R("update:modelValue",ce.target.value))}),null,16,["class","value"]))])]))}}),KC={},JC={width:"24",height:"24",viewBox:"0 0 24 24",fill:"#2c2c2c80",class:"icon icon-eye-off"};function QC(d,g){return Si(),hr("svg",JC,g[0]||(g[0]=[Ut("symbol",{id:"icon-eye-off",viewBox:"0 0 24 24"},[Ut("path",{d:"M14.12 14.12C13.8454 14.4147 13.5141 14.6511 13.1462 14.8151C12.7782 14.9791 12.3809 15.0673 11.9781 15.0744C11.5753 15.0815 11.1752 15.0074 10.8016 14.8565C10.4281 14.7056 10.0887 14.481 9.80385 14.1961C9.51897 13.9113 9.29439 13.5719 9.14351 13.1984C8.99262 12.8248 8.91853 12.4247 8.92563 12.0219C8.93274 11.6191 9.02091 11.2218 9.18488 10.8538C9.34884 10.4858 9.58525 10.1546 9.88 9.87999M17.94 17.94C16.2306 19.243 14.1491 19.9649 12 20C5 20 1 12 1 12C2.24389 9.68189 3.96914 7.6566 6.06 6.05999L17.94 17.94ZM9.9 4.23999C10.5883 4.07887 11.2931 3.99833 12 3.99999C19 3.99999 23 12 23 12C22.393 13.1356 21.6691 14.2047 20.84 15.19L9.9 4.23999Z",stroke:"#2C2C2C","stroke-opacity":"0.8","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),Ut("path",{d:"M1 1L23 23",stroke:"#2C2C2C","stroke-opacity":"0.8","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),Ut("use",{"xlink:href":"#icon-eye-off"},null,-1)]))}const qw=As(KC,[["render",QC]]),eP={},tP={width:"24",height:"24",viewBox:"0 0 24 24",fill:"#2c2c2c80",class:"icon icon-eye"};function iP(d,g){return Si(),hr("svg",tP,g[0]||(g[0]=[Ut("use",{"xlink:href":"#icon-eye"},null,-1),Ut("symbol",{id:"icon-eye",viewBox:"0 0 48 48"},[Ut("path",{d:"M0.212 23.106c-0.272 0.548-0.292 1.206 0 1.788 0 0 0.792 1.578 2.24 3.686 0.902 1.312 2.076 2.864 3.514 4.436 1.788 1.958 4.008 3.974 6.638 5.6 3.19 1.972 7.012 3.384 11.396 3.384s8.206-1.412 11.396-3.384c2.63-1.626 4.85-3.642 6.638-5.6 1.436-1.572 2.612-3.124 3.514-4.436 1.448-2.108 2.24-3.686 2.24-3.686 0.272-0.548 0.292-1.206 0-1.788 0 0-0.792-1.578-2.24-3.686-0.902-1.312-2.076-2.864-3.514-4.436-1.788-1.958-4.008-3.974-6.638-5.6-3.19-1.972-7.012-3.384-11.396-3.384s-8.206 1.412-11.396 3.384c-2.63 1.626-4.85 3.642-6.638 5.6-1.438 1.572-2.612 3.122-3.514 4.436-1.448 2.108-2.24 3.686-2.24 3.686zM4.28 24c0.326-0.562 0.814-1.362 1.468-2.316 0.82-1.192 1.88-2.592 3.17-4.002 1.61-1.762 3.55-3.512 5.788-4.896 2.7-1.668 5.802-2.786 9.294-2.786s6.594 1.118 9.292 2.786c2.238 1.384 4.178 3.134 5.788 4.896 1.288 1.41 2.35 2.81 3.17 4.002 0.656 0.954 1.144 1.752 1.468 2.316-0.326 0.562-0.814 1.362-1.468 2.316-0.82 1.192-1.88 2.592-3.17 4.002-1.61 1.762-3.55 3.512-5.788 4.896-2.698 1.668-5.8 2.786-9.292 2.786s-6.594-1.118-9.292-2.786c-2.238-1.384-4.178-3.134-5.788-4.896-1.288-1.41-2.35-2.81-3.17-4.002-0.656-0.954-1.144-1.754-1.47-2.316zM32 24c0-2.208-0.898-4.212-2.344-5.656s-3.448-2.344-5.656-2.344-4.212 0.898-5.656 2.344-2.344 3.448-2.344 5.656 0.898 4.212 2.344 5.656 3.448 2.344 5.656 2.344 4.212-0.898 5.656-2.344 2.344-3.448 2.344-5.656zM28 24c0 1.106-0.446 2.102-1.172 2.828s-1.722 1.172-2.828 1.172-2.102-0.446-2.828-1.172-1.172-1.722-1.172-2.828 0.446-2.102 1.172-2.828 1.722-1.172 2.828-1.172 2.102 0.446 2.828 1.172 1.172 1.722 1.172 2.828z",stroke:"#2C2C2C","stroke-opacity":"0.6","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))}const $w=As(eP,[["render",iP]]),rP={class:"relative"},nP={__name:"LoginForm",emits:["submit"],setup(d,{emit:g}){const M=g,R=mc({email:"",password:""}),O=fn(!1),U=()=>{O.value=!O.value};return($,K)=>(Si(),hr("form",{onSubmit:K[2]||(K[2]=Am(s=>M("submit",fr(R)),["prevent"]))},[Ei(hc,{class:"mb-4",label:"Email Address",placeholder:"email@gmail.com",type:"email",modelValue:R.email,"onUpdate:modelValue":K[0]||(K[0]=s=>R.email=s),autocomplete:"email",required:""},null,8,["modelValue"]),Ut("div",rP,[Ei(hc,{label:"Password",type:O.value?"text":"password",modelValue:R.password,"onUpdate:modelValue":K[1]||(K[1]=s=>R.password=s),autocomplete:"current-password",required:""},null,8,["type","modelValue"]),Ut("button",{onClick:U,type:"button",class:lo(["absolute bottom-2 right-0 pr-3 flex items-center transition-opacity",O.value?"opacity-100":"opacity-50"])},[(Si(),ts(My(O.value?$w:qw)))],2)]),Ei(rf,{class:"mt-10 w-full",variant:"gradient",type:"submit"},{default:nn(()=>K[3]||(K[3]=[cs("Sign In")])),_:1})],32))}},sP={__name:"LoginView",setup(d){const g=M=>{console.log("User data:",M)};return(M,R)=>(Si(),ts(nP,{onSubmit:g}))}},oP={class:"relative"},aP={__name:"RegistrationForm",emits:["submit"],setup(d,{emit:g}){const M=g,R=mc({name:"",email:"",password:""}),O=fn(!1),U=()=>{O.value=!O.value};return($,K)=>(Si(),hr("form",{onSubmit:K[3]||(K[3]=Am(s=>M("submit",fr(R)),["prevent"]))},[Ei(hc,{class:"mb-4",label:"Full Name",modelValue:R.name,"onUpdate:modelValue":K[0]||(K[0]=s=>R.name=s),required:""},null,8,["modelValue"]),Ei(hc,{class:"mb-4",label:"Email Address",placeholder:"email@gmail.com",type:"email",modelValue:R.email,"onUpdate:modelValue":K[1]||(K[1]=s=>R.email=s),autocomplete:"email",required:""},null,8,["modelValue"]),Ut("div",oP,[Ei(hc,{label:"Password",type:O.value?"text":"password",modelValue:R.password,"onUpdate:modelValue":K[2]||(K[2]=s=>R.password=s),autocomplete:"current-password",required:""},null,8,["type","modelValue"]),Ut("button",{onClick:U,type:"button",class:lo(["absolute bottom-2 right-0 pr-3 flex items-center transition-opacity",O.value?"opacity-100":"opacity-50"])},[(Si(),ts(My(O.value?$w:qw)))],2)]),Ei(rf,{class:"mt-10 w-full",variant:"gradient",type:"submit"},{default:nn(()=>K[4]||(K[4]=[cs("Create Account")])),_:1})],32))}},lP={__name:"Registration",setup(d){const g=M=>{console.log("User data:",M)};return(M,R)=>(Si(),ts(aP,{onSubmit:g}))}},cP="/VueMap-Explorer/assets/404-WYiUsRUJ.jpg",uP={class:"flex flex-col items-center justify-center text-center h-screen bg-white"},hP={__name:"NotFoundView",setup(d){return console.log("NotFoundView BASE",Es),(g,M)=>(Si(),hr("div",uP,[M[1]||(M[1]=Ut("img",{src:cP,alt:"Page Not Found",class:"mx-auto max-w-2xl rounded-3xl shadow-lg"},null,-1)),M[2]||(M[2]=Ut("h1",{class:"text-5xl font-bold mt-5 text-[#2C3E50]"},"404",-1)),M[3]||(M[3]=Ut("p",{class:"text-xl mt-2 text-[#333333]"},"Page Not Found",-1)),Ei(Hi(fc),{to:`${Hi(Es)}/`,class:"mt-5 bg-gradient-to-r from-secondary to-primary rounded-xl py-3 px-10 font-bold tracking-wider text-white overflow-hidden shadow-md transform transition duration-200 hover:shadow-lg active:scale-95"},{default:nn(()=>M[0]||(M[0]=[cs(" Back to Home Page ")])),_:1},8,["to"])]))}},dP=As(hP,[["__scopeId","data-v-c1f67dfe"]]);var so=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zw(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function fP(d){if(d.__esModule)return d;var g=d.default;if(typeof g=="function"){var M=function R(){return this instanceof R?Reflect.construct(g,arguments,this.constructor):g.apply(this,arguments)};M.prototype=g.prototype}else M={};return Object.defineProperty(M,"__esModule",{value:!0}),Object.keys(d).forEach(function(R){var O=Object.getOwnPropertyDescriptor(d,R);Object.defineProperty(M,R,O.get?O:{enumerable:!0,get:function(){return d[R]}})}),M}var Hw={exports:{}};(function(d,g){var M={};(function(R,O){d.exports=O()})(so,function(){var R,O,U;function $(s,ce){if(!R)R=ce;else if(!O)O=ce;else{var pe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+R+")(sharedChunk); ("+O+")(sharedChunk); self.onerror = null;",me={};R(me),U=ce(me),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(U.workerUrl=window.URL.createObjectURL(new Blob([pe],{type:"text/javascript"})))}}$(["exports"],function(s){function ce(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var pe,me={},ke={};function qe(){if(pe)return ke;pe=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.setMatrixArrayType=function(u){ke.ARRAY_TYPE=e=u},ke.toRadian=function(u){return u*o},ke.equals=function(u,a){return Math.abs(u-a)<=n*Math.max(1,Math.abs(u),Math.abs(a))},ke.RANDOM=ke.ARRAY_TYPE=ke.EPSILON=void 0;var n=1e-6;ke.EPSILON=n;var e=typeof Float32Array<"u"?Float32Array:Array;ke.ARRAY_TYPE=e;var i=Math.random;ke.RANDOM=i;var o=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var u=0,a=arguments.length;a--;)u+=arguments[a]*arguments[a];return Math.sqrt(u)}),ke}var it,et={};function ct(){if(it)return et;function n(a){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(a)}it=1,Object.defineProperty(et,"__esModule",{value:!0}),et.create=function(){var a=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},et.clone=function(a){var h=new e.ARRAY_TYPE(4);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h},et.copy=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a},et.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},et.fromValues=function(a,h,_,b){var E=new e.ARRAY_TYPE(4);return E[0]=a,E[1]=h,E[2]=_,E[3]=b,E},et.set=function(a,h,_,b,E){return a[0]=h,a[1]=_,a[2]=b,a[3]=E,a},et.transpose=function(a,h){if(a===h){var _=h[1];a[1]=h[2],a[2]=_}else a[0]=h[0],a[1]=h[2],a[2]=h[1],a[3]=h[3];return a},et.invert=function(a,h){var _=h[0],b=h[1],E=h[2],p=h[3],x=_*p-E*b;return x?(a[0]=p*(x=1/x),a[1]=-b*x,a[2]=-E*x,a[3]=_*x,a):null},et.adjoint=function(a,h){var _=h[0];return a[0]=h[3],a[1]=-h[1],a[2]=-h[2],a[3]=_,a},et.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},et.multiply=o,et.rotate=function(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=Math.sin(_),v=Math.cos(_);return a[0]=b*v+p*T,a[1]=E*v+x*T,a[2]=b*-T+p*v,a[3]=E*-T+x*v,a},et.scale=function(a,h,_){var b=h[1],E=h[2],p=h[3],x=_[0],T=_[1];return a[0]=h[0]*x,a[1]=b*x,a[2]=E*T,a[3]=p*T,a},et.fromRotation=function(a,h){var _=Math.sin(h),b=Math.cos(h);return a[0]=b,a[1]=_,a[2]=-_,a[3]=b,a},et.fromScaling=function(a,h){return a[0]=h[0],a[1]=0,a[2]=0,a[3]=h[1],a},et.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},et.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},et.LDU=function(a,h,_,b){return a[2]=b[2]/b[0],_[0]=b[0],_[1]=b[1],_[3]=b[3]-a[2]*_[1],[a,h,_]},et.add=function(a,h,_){return a[0]=h[0]+_[0],a[1]=h[1]+_[1],a[2]=h[2]+_[2],a[3]=h[3]+_[3],a},et.subtract=u,et.exactEquals=function(a,h){return a[0]===h[0]&&a[1]===h[1]&&a[2]===h[2]&&a[3]===h[3]},et.equals=function(a,h){var _=a[0],b=a[1],E=a[2],p=a[3],x=h[0],T=h[1],v=h[2],w=h[3];return Math.abs(_-x)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(x))&&Math.abs(b-T)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(T))&&Math.abs(E-v)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(v))&&Math.abs(p-w)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(w))},et.multiplyScalar=function(a,h,_){return a[0]=h[0]*_,a[1]=h[1]*_,a[2]=h[2]*_,a[3]=h[3]*_,a},et.multiplyScalarAndAdd=function(a,h,_,b){return a[0]=h[0]+_[0]*b,a[1]=h[1]+_[1]*b,a[2]=h[2]+_[2]*b,a[3]=h[3]+_[3]*b,a},et.sub=et.mul=void 0;var e=function(a,h){if(a&&a.__esModule)return a;if(a===null||n(a)!=="object"&&typeof a!="function")return{default:a};var _=i(void 0);if(_&&_.has(a))return _.get(a);var b={},E=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in a)if(p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)){var x=E?Object.getOwnPropertyDescriptor(a,p):null;x&&(x.get||x.set)?Object.defineProperty(b,p,x):b[p]=a[p]}return b.default=a,_&&_.set(a,b),b}(qe());function i(a){if(typeof WeakMap!="function")return null;var h=new WeakMap,_=new WeakMap;return(i=function(b){return b?_:h})(a)}function o(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=_[0],v=_[1],w=_[2],A=_[3];return a[0]=b*T+p*v,a[1]=E*T+x*v,a[2]=b*w+p*A,a[3]=E*w+x*A,a}function u(a,h,_){return a[0]=h[0]-_[0],a[1]=h[1]-_[1],a[2]=h[2]-_[2],a[3]=h[3]-_[3],a}return et.mul=o,et.sub=u,et}var St,_t={};function zt(){if(St)return _t;function n(a){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(a)}St=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.create=function(){var a=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[4]=0,a[5]=0),a[0]=1,a[3]=1,a},_t.clone=function(a){var h=new e.ARRAY_TYPE(6);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h},_t.copy=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a},_t.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},_t.fromValues=function(a,h,_,b,E,p){var x=new e.ARRAY_TYPE(6);return x[0]=a,x[1]=h,x[2]=_,x[3]=b,x[4]=E,x[5]=p,x},_t.set=function(a,h,_,b,E,p,x){return a[0]=h,a[1]=_,a[2]=b,a[3]=E,a[4]=p,a[5]=x,a},_t.invert=function(a,h){var _=h[0],b=h[1],E=h[2],p=h[3],x=h[4],T=h[5],v=_*p-b*E;return v?(a[0]=p*(v=1/v),a[1]=-b*v,a[2]=-E*v,a[3]=_*v,a[4]=(E*T-p*x)*v,a[5]=(b*x-_*T)*v,a):null},_t.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},_t.multiply=o,_t.rotate=function(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=h[4],v=h[5],w=Math.sin(_),A=Math.cos(_);return a[0]=b*A+p*w,a[1]=E*A+x*w,a[2]=b*-w+p*A,a[3]=E*-w+x*A,a[4]=T,a[5]=v,a},_t.scale=function(a,h,_){var b=h[1],E=h[2],p=h[3],x=h[4],T=h[5],v=_[0],w=_[1];return a[0]=h[0]*v,a[1]=b*v,a[2]=E*w,a[3]=p*w,a[4]=x,a[5]=T,a},_t.translate=function(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=h[4],v=h[5],w=_[0],A=_[1];return a[0]=b,a[1]=E,a[2]=p,a[3]=x,a[4]=b*w+p*A+T,a[5]=E*w+x*A+v,a},_t.fromRotation=function(a,h){var _=Math.sin(h),b=Math.cos(h);return a[0]=b,a[1]=_,a[2]=-_,a[3]=b,a[4]=0,a[5]=0,a},_t.fromScaling=function(a,h){return a[0]=h[0],a[1]=0,a[2]=0,a[3]=h[1],a[4]=0,a[5]=0,a},_t.fromTranslation=function(a,h){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=h[0],a[5]=h[1],a},_t.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},_t.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1)},_t.add=function(a,h,_){return a[0]=h[0]+_[0],a[1]=h[1]+_[1],a[2]=h[2]+_[2],a[3]=h[3]+_[3],a[4]=h[4]+_[4],a[5]=h[5]+_[5],a},_t.subtract=u,_t.multiplyScalar=function(a,h,_){return a[0]=h[0]*_,a[1]=h[1]*_,a[2]=h[2]*_,a[3]=h[3]*_,a[4]=h[4]*_,a[5]=h[5]*_,a},_t.multiplyScalarAndAdd=function(a,h,_,b){return a[0]=h[0]+_[0]*b,a[1]=h[1]+_[1]*b,a[2]=h[2]+_[2]*b,a[3]=h[3]+_[3]*b,a[4]=h[4]+_[4]*b,a[5]=h[5]+_[5]*b,a},_t.exactEquals=function(a,h){return a[0]===h[0]&&a[1]===h[1]&&a[2]===h[2]&&a[3]===h[3]&&a[4]===h[4]&&a[5]===h[5]},_t.equals=function(a,h){var _=a[0],b=a[1],E=a[2],p=a[3],x=a[4],T=a[5],v=h[0],w=h[1],A=h[2],C=h[3],D=h[4],F=h[5];return Math.abs(_-v)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(v))&&Math.abs(b-w)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(E-A)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(A))&&Math.abs(p-C)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(x-D)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(D))&&Math.abs(T-F)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(F))},_t.sub=_t.mul=void 0;var e=function(a,h){if(a&&a.__esModule)return a;if(a===null||n(a)!=="object"&&typeof a!="function")return{default:a};var _=i(void 0);if(_&&_.has(a))return _.get(a);var b={},E=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in a)if(p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)){var x=E?Object.getOwnPropertyDescriptor(a,p):null;x&&(x.get||x.set)?Object.defineProperty(b,p,x):b[p]=a[p]}return b.default=a,_&&_.set(a,b),b}(qe());function i(a){if(typeof WeakMap!="function")return null;var h=new WeakMap,_=new WeakMap;return(i=function(b){return b?_:h})(a)}function o(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=h[4],v=h[5],w=_[0],A=_[1],C=_[2],D=_[3],F=_[4],V=_[5];return a[0]=b*w+p*A,a[1]=E*w+x*A,a[2]=b*C+p*D,a[3]=E*C+x*D,a[4]=b*F+p*V+T,a[5]=E*F+x*V+v,a}function u(a,h,_){return a[0]=h[0]-_[0],a[1]=h[1]-_[1],a[2]=h[2]-_[2],a[3]=h[3]-_[3],a[4]=h[4]-_[4],a[5]=h[5]-_[5],a}return _t.mul=o,_t.sub=u,_t}var Gt,Rt={};function yi(){if(Gt)return Rt;function n(a){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(a)}Gt=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=function(){var a=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},Rt.fromMat4=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[4],a[4]=h[5],a[5]=h[6],a[6]=h[8],a[7]=h[9],a[8]=h[10],a},Rt.clone=function(a){var h=new e.ARRAY_TYPE(9);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h},Rt.copy=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a},Rt.fromValues=function(a,h,_,b,E,p,x,T,v){var w=new e.ARRAY_TYPE(9);return w[0]=a,w[1]=h,w[2]=_,w[3]=b,w[4]=E,w[5]=p,w[6]=x,w[7]=T,w[8]=v,w},Rt.set=function(a,h,_,b,E,p,x,T,v,w){return a[0]=h,a[1]=_,a[2]=b,a[3]=E,a[4]=p,a[5]=x,a[6]=T,a[7]=v,a[8]=w,a},Rt.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},Rt.transpose=function(a,h){if(a===h){var _=h[1],b=h[2],E=h[5];a[1]=h[3],a[2]=h[6],a[3]=_,a[5]=h[7],a[6]=b,a[7]=E}else a[0]=h[0],a[1]=h[3],a[2]=h[6],a[3]=h[1],a[4]=h[4],a[5]=h[7],a[6]=h[2],a[7]=h[5],a[8]=h[8];return a},Rt.invert=function(a,h){var _=h[0],b=h[1],E=h[2],p=h[3],x=h[4],T=h[5],v=h[6],w=h[7],A=h[8],C=A*x-T*w,D=-A*p+T*v,F=w*p-x*v,V=_*C+b*D+E*F;return V?(a[0]=C*(V=1/V),a[1]=(-A*b+E*w)*V,a[2]=(T*b-E*x)*V,a[3]=D*V,a[4]=(A*_-E*v)*V,a[5]=(-T*_+E*p)*V,a[6]=F*V,a[7]=(-w*_+b*v)*V,a[8]=(x*_-b*p)*V,a):null},Rt.adjoint=function(a,h){var _=h[0],b=h[1],E=h[2],p=h[3],x=h[4],T=h[5],v=h[6],w=h[7],A=h[8];return a[0]=x*A-T*w,a[1]=E*w-b*A,a[2]=b*T-E*x,a[3]=T*v-p*A,a[4]=_*A-E*v,a[5]=E*p-_*T,a[6]=p*w-x*v,a[7]=b*v-_*w,a[8]=_*x-b*p,a},Rt.determinant=function(a){var h=a[3],_=a[4],b=a[5],E=a[6],p=a[7],x=a[8];return a[0]*(x*_-b*p)+a[1]*(-x*h+b*E)+a[2]*(p*h-_*E)},Rt.multiply=o,Rt.translate=function(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=h[4],v=h[5],w=h[6],A=h[7],C=h[8],D=_[0],F=_[1];return a[0]=b,a[1]=E,a[2]=p,a[3]=x,a[4]=T,a[5]=v,a[6]=D*b+F*x+w,a[7]=D*E+F*T+A,a[8]=D*p+F*v+C,a},Rt.rotate=function(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=h[4],v=h[5],w=h[6],A=h[7],C=h[8],D=Math.sin(_),F=Math.cos(_);return a[0]=F*b+D*x,a[1]=F*E+D*T,a[2]=F*p+D*v,a[3]=F*x-D*b,a[4]=F*T-D*E,a[5]=F*v-D*p,a[6]=w,a[7]=A,a[8]=C,a},Rt.scale=function(a,h,_){var b=_[0],E=_[1];return a[0]=b*h[0],a[1]=b*h[1],a[2]=b*h[2],a[3]=E*h[3],a[4]=E*h[4],a[5]=E*h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a},Rt.fromTranslation=function(a,h){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=h[0],a[7]=h[1],a[8]=1,a},Rt.fromRotation=function(a,h){var _=Math.sin(h),b=Math.cos(h);return a[0]=b,a[1]=_,a[2]=0,a[3]=-_,a[4]=b,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},Rt.fromScaling=function(a,h){return a[0]=h[0],a[1]=0,a[2]=0,a[3]=0,a[4]=h[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},Rt.fromMat2d=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=0,a[3]=h[2],a[4]=h[3],a[5]=0,a[6]=h[4],a[7]=h[5],a[8]=1,a},Rt.fromQuat=function(a,h){var _=h[0],b=h[1],E=h[2],p=h[3],x=_+_,T=b+b,v=E+E,w=_*x,A=b*x,C=b*T,D=E*x,F=E*T,V=E*v,z=p*x,j=p*T,G=p*v;return a[0]=1-C-V,a[3]=A-G,a[6]=D+j,a[1]=A+G,a[4]=1-w-V,a[7]=F-z,a[2]=D-j,a[5]=F+z,a[8]=1-w-C,a},Rt.normalFromMat4=function(a,h){var _=h[0],b=h[1],E=h[2],p=h[3],x=h[4],T=h[5],v=h[6],w=h[7],A=h[8],C=h[9],D=h[10],F=h[11],V=h[12],z=h[13],j=h[14],G=h[15],Y=_*T-b*x,te=_*v-E*x,re=_*w-p*x,Q=b*v-E*T,ue=b*w-p*T,se=E*w-p*v,de=A*z-C*V,we=A*j-D*V,Ee=A*G-F*V,Me=C*j-D*z,Ie=C*G-F*z,Be=D*G-F*j,Pe=Y*Be-te*Ie+re*Me+Q*Ee-ue*we+se*de;return Pe?(a[0]=(T*Be-v*Ie+w*Me)*(Pe=1/Pe),a[1]=(v*Ee-x*Be-w*we)*Pe,a[2]=(x*Ie-T*Ee+w*de)*Pe,a[3]=(E*Ie-b*Be-p*Me)*Pe,a[4]=(_*Be-E*Ee+p*we)*Pe,a[5]=(b*Ee-_*Ie-p*de)*Pe,a[6]=(z*se-j*ue+G*Q)*Pe,a[7]=(j*re-V*se-G*te)*Pe,a[8]=(V*ue-z*re+G*Y)*Pe,a):null},Rt.projection=function(a,h,_){return a[0]=2/h,a[1]=0,a[2]=0,a[3]=0,a[4]=-2/_,a[5]=0,a[6]=-1,a[7]=1,a[8]=1,a},Rt.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},Rt.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},Rt.add=function(a,h,_){return a[0]=h[0]+_[0],a[1]=h[1]+_[1],a[2]=h[2]+_[2],a[3]=h[3]+_[3],a[4]=h[4]+_[4],a[5]=h[5]+_[5],a[6]=h[6]+_[6],a[7]=h[7]+_[7],a[8]=h[8]+_[8],a},Rt.subtract=u,Rt.multiplyScalar=function(a,h,_){return a[0]=h[0]*_,a[1]=h[1]*_,a[2]=h[2]*_,a[3]=h[3]*_,a[4]=h[4]*_,a[5]=h[5]*_,a[6]=h[6]*_,a[7]=h[7]*_,a[8]=h[8]*_,a},Rt.multiplyScalarAndAdd=function(a,h,_,b){return a[0]=h[0]+_[0]*b,a[1]=h[1]+_[1]*b,a[2]=h[2]+_[2]*b,a[3]=h[3]+_[3]*b,a[4]=h[4]+_[4]*b,a[5]=h[5]+_[5]*b,a[6]=h[6]+_[6]*b,a[7]=h[7]+_[7]*b,a[8]=h[8]+_[8]*b,a},Rt.exactEquals=function(a,h){return a[0]===h[0]&&a[1]===h[1]&&a[2]===h[2]&&a[3]===h[3]&&a[4]===h[4]&&a[5]===h[5]&&a[6]===h[6]&&a[7]===h[7]&&a[8]===h[8]},Rt.equals=function(a,h){var _=a[0],b=a[1],E=a[2],p=a[3],x=a[4],T=a[5],v=a[6],w=a[7],A=a[8],C=h[0],D=h[1],F=h[2],V=h[3],z=h[4],j=h[5],G=h[6],Y=h[7],te=h[8];return Math.abs(_-C)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(C))&&Math.abs(b-D)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(D))&&Math.abs(E-F)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(F))&&Math.abs(p-V)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(V))&&Math.abs(x-z)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(T-j)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(j))&&Math.abs(v-G)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(w-Y)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(Y))&&Math.abs(A-te)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(te))},Rt.sub=Rt.mul=void 0;var e=function(a,h){if(a&&a.__esModule)return a;if(a===null||n(a)!=="object"&&typeof a!="function")return{default:a};var _=i(void 0);if(_&&_.has(a))return _.get(a);var b={},E=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in a)if(p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)){var x=E?Object.getOwnPropertyDescriptor(a,p):null;x&&(x.get||x.set)?Object.defineProperty(b,p,x):b[p]=a[p]}return b.default=a,_&&_.set(a,b),b}(qe());function i(a){if(typeof WeakMap!="function")return null;var h=new WeakMap,_=new WeakMap;return(i=function(b){return b?_:h})(a)}function o(a,h,_){var b=h[0],E=h[1],p=h[2],x=h[3],T=h[4],v=h[5],w=h[6],A=h[7],C=h[8],D=_[0],F=_[1],V=_[2],z=_[3],j=_[4],G=_[5],Y=_[6],te=_[7],re=_[8];return a[0]=D*b+F*x+V*w,a[1]=D*E+F*T+V*A,a[2]=D*p+F*v+V*C,a[3]=z*b+j*x+G*w,a[4]=z*E+j*T+G*A,a[5]=z*p+j*v+G*C,a[6]=Y*b+te*x+re*w,a[7]=Y*E+te*T+re*A,a[8]=Y*p+te*v+re*C,a}function u(a,h,_){return a[0]=h[0]-_[0],a[1]=h[1]-_[1],a[2]=h[2]-_[2],a[3]=h[3]-_[3],a[4]=h[4]-_[4],a[5]=h[5]-_[5],a[6]=h[6]-_[6],a[7]=h[7]-_[7],a[8]=h[8]-_[8],a}return Rt.mul=o,Rt.sub=u,Rt}var Ti,kt={};function lr(){if(Ti)return kt;function n(p){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},n(p)}Ti=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=function(){var p=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},kt.clone=function(p){var x=new e.ARRAY_TYPE(16);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x[4]=p[4],x[5]=p[5],x[6]=p[6],x[7]=p[7],x[8]=p[8],x[9]=p[9],x[10]=p[10],x[11]=p[11],x[12]=p[12],x[13]=p[13],x[14]=p[14],x[15]=p[15],x},kt.copy=function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[4]=x[4],p[5]=x[5],p[6]=x[6],p[7]=x[7],p[8]=x[8],p[9]=x[9],p[10]=x[10],p[11]=x[11],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15],p},kt.fromValues=function(p,x,T,v,w,A,C,D,F,V,z,j,G,Y,te,re){var Q=new e.ARRAY_TYPE(16);return Q[0]=p,Q[1]=x,Q[2]=T,Q[3]=v,Q[4]=w,Q[5]=A,Q[6]=C,Q[7]=D,Q[8]=F,Q[9]=V,Q[10]=z,Q[11]=j,Q[12]=G,Q[13]=Y,Q[14]=te,Q[15]=re,Q},kt.set=function(p,x,T,v,w,A,C,D,F,V,z,j,G,Y,te,re,Q){return p[0]=x,p[1]=T,p[2]=v,p[3]=w,p[4]=A,p[5]=C,p[6]=D,p[7]=F,p[8]=V,p[9]=z,p[10]=j,p[11]=G,p[12]=Y,p[13]=te,p[14]=re,p[15]=Q,p},kt.identity=o,kt.transpose=function(p,x){if(p===x){var T=x[1],v=x[2],w=x[3],A=x[6],C=x[7],D=x[11];p[1]=x[4],p[2]=x[8],p[3]=x[12],p[4]=T,p[6]=x[9],p[7]=x[13],p[8]=v,p[9]=A,p[11]=x[14],p[12]=w,p[13]=C,p[14]=D}else p[0]=x[0],p[1]=x[4],p[2]=x[8],p[3]=x[12],p[4]=x[1],p[5]=x[5],p[6]=x[9],p[7]=x[13],p[8]=x[2],p[9]=x[6],p[10]=x[10],p[11]=x[14],p[12]=x[3],p[13]=x[7],p[14]=x[11],p[15]=x[15];return p},kt.invert=function(p,x){var T=x[0],v=x[1],w=x[2],A=x[3],C=x[4],D=x[5],F=x[6],V=x[7],z=x[8],j=x[9],G=x[10],Y=x[11],te=x[12],re=x[13],Q=x[14],ue=x[15],se=T*D-v*C,de=T*F-w*C,we=T*V-A*C,Ee=v*F-w*D,Me=v*V-A*D,Ie=w*V-A*F,Be=z*re-j*te,Pe=z*Q-G*te,Ze=z*ue-Y*te,Je=j*Q-G*re,Ue=j*ue-Y*re,xt=G*ue-Y*Q,pt=se*xt-de*Ue+we*Je+Ee*Ze-Me*Pe+Ie*Be;return pt?(p[0]=(D*xt-F*Ue+V*Je)*(pt=1/pt),p[1]=(w*Ue-v*xt-A*Je)*pt,p[2]=(re*Ie-Q*Me+ue*Ee)*pt,p[3]=(G*Me-j*Ie-Y*Ee)*pt,p[4]=(F*Ze-C*xt-V*Pe)*pt,p[5]=(T*xt-w*Ze+A*Pe)*pt,p[6]=(Q*we-te*Ie-ue*de)*pt,p[7]=(z*Ie-G*we+Y*de)*pt,p[8]=(C*Ue-D*Ze+V*Be)*pt,p[9]=(v*Ze-T*Ue-A*Be)*pt,p[10]=(te*Me-re*we+ue*se)*pt,p[11]=(j*we-z*Me-Y*se)*pt,p[12]=(D*Pe-C*Je-F*Be)*pt,p[13]=(T*Je-v*Pe+w*Be)*pt,p[14]=(re*de-te*Ee-Q*se)*pt,p[15]=(z*Ee-j*de+G*se)*pt,p):null},kt.adjoint=function(p,x){var T=x[0],v=x[1],w=x[2],A=x[3],C=x[4],D=x[5],F=x[6],V=x[7],z=x[8],j=x[9],G=x[10],Y=x[11],te=x[12],re=x[13],Q=x[14],ue=x[15];return p[0]=D*(G*ue-Y*Q)-j*(F*ue-V*Q)+re*(F*Y-V*G),p[1]=-(v*(G*ue-Y*Q)-j*(w*ue-A*Q)+re*(w*Y-A*G)),p[2]=v*(F*ue-V*Q)-D*(w*ue-A*Q)+re*(w*V-A*F),p[3]=-(v*(F*Y-V*G)-D*(w*Y-A*G)+j*(w*V-A*F)),p[4]=-(C*(G*ue-Y*Q)-z*(F*ue-V*Q)+te*(F*Y-V*G)),p[5]=T*(G*ue-Y*Q)-z*(w*ue-A*Q)+te*(w*Y-A*G),p[6]=-(T*(F*ue-V*Q)-C*(w*ue-A*Q)+te*(w*V-A*F)),p[7]=T*(F*Y-V*G)-C*(w*Y-A*G)+z*(w*V-A*F),p[8]=C*(j*ue-Y*re)-z*(D*ue-V*re)+te*(D*Y-V*j),p[9]=-(T*(j*ue-Y*re)-z*(v*ue-A*re)+te*(v*Y-A*j)),p[10]=T*(D*ue-V*re)-C*(v*ue-A*re)+te*(v*V-A*D),p[11]=-(T*(D*Y-V*j)-C*(v*Y-A*j)+z*(v*V-A*D)),p[12]=-(C*(j*Q-G*re)-z*(D*Q-F*re)+te*(D*G-F*j)),p[13]=T*(j*Q-G*re)-z*(v*Q-w*re)+te*(v*G-w*j),p[14]=-(T*(D*Q-F*re)-C*(v*Q-w*re)+te*(v*F-w*D)),p[15]=T*(D*G-F*j)-C*(v*G-w*j)+z*(v*F-w*D),p},kt.determinant=function(p){var x=p[0],T=p[1],v=p[2],w=p[3],A=p[4],C=p[5],D=p[6],F=p[7],V=p[8],z=p[9],j=p[10],G=p[11],Y=p[12],te=p[13],re=p[14],Q=p[15];return(x*C-T*A)*(j*Q-G*re)-(x*D-v*A)*(z*Q-G*te)+(x*F-w*A)*(z*re-j*te)+(T*D-v*C)*(V*Q-G*Y)-(T*F-w*C)*(V*re-j*Y)+(v*F-w*D)*(V*te-z*Y)},kt.multiply=u,kt.translate=function(p,x,T){var v,w,A,C,D,F,V,z,j,G,Y,te,re=T[0],Q=T[1],ue=T[2];return x===p?(p[12]=x[0]*re+x[4]*Q+x[8]*ue+x[12],p[13]=x[1]*re+x[5]*Q+x[9]*ue+x[13],p[14]=x[2]*re+x[6]*Q+x[10]*ue+x[14],p[15]=x[3]*re+x[7]*Q+x[11]*ue+x[15]):(w=x[1],A=x[2],C=x[3],D=x[4],F=x[5],V=x[6],z=x[7],j=x[8],G=x[9],Y=x[10],te=x[11],p[0]=v=x[0],p[1]=w,p[2]=A,p[3]=C,p[4]=D,p[5]=F,p[6]=V,p[7]=z,p[8]=j,p[9]=G,p[10]=Y,p[11]=te,p[12]=v*re+D*Q+j*ue+x[12],p[13]=w*re+F*Q+G*ue+x[13],p[14]=A*re+V*Q+Y*ue+x[14],p[15]=C*re+z*Q+te*ue+x[15]),p},kt.scale=function(p,x,T){var v=T[0],w=T[1],A=T[2];return p[0]=x[0]*v,p[1]=x[1]*v,p[2]=x[2]*v,p[3]=x[3]*v,p[4]=x[4]*w,p[5]=x[5]*w,p[6]=x[6]*w,p[7]=x[7]*w,p[8]=x[8]*A,p[9]=x[9]*A,p[10]=x[10]*A,p[11]=x[11]*A,p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15],p},kt.rotate=function(p,x,T,v){var w,A,C,D,F,V,z,j,G,Y,te,re,Q,ue,se,de,we,Ee,Me,Ie,Be,Pe,Ze,Je,Ue=v[0],xt=v[1],pt=v[2],ot=Math.hypot(Ue,xt,pt);return ot<e.EPSILON?null:(Ue*=ot=1/ot,xt*=ot,pt*=ot,w=Math.sin(T),A=Math.cos(T),F=x[1],V=x[2],z=x[3],G=x[5],Y=x[6],te=x[7],Q=x[9],ue=x[10],se=x[11],de=Ue*Ue*(C=1-A)+A,Me=Ue*xt*C-pt*w,Ie=xt*xt*C+A,Be=pt*xt*C+Ue*w,Pe=Ue*pt*C+xt*w,Ze=xt*pt*C-Ue*w,Je=pt*pt*C+A,p[0]=(D=x[0])*de+(j=x[4])*(we=xt*Ue*C+pt*w)+(re=x[8])*(Ee=pt*Ue*C-xt*w),p[1]=F*de+G*we+Q*Ee,p[2]=V*de+Y*we+ue*Ee,p[3]=z*de+te*we+se*Ee,p[4]=D*Me+j*Ie+re*Be,p[5]=F*Me+G*Ie+Q*Be,p[6]=V*Me+Y*Ie+ue*Be,p[7]=z*Me+te*Ie+se*Be,p[8]=D*Pe+j*Ze+re*Je,p[9]=F*Pe+G*Ze+Q*Je,p[10]=V*Pe+Y*Ze+ue*Je,p[11]=z*Pe+te*Ze+se*Je,x!==p&&(p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15]),p)},kt.rotateX=function(p,x,T){var v=Math.sin(T),w=Math.cos(T),A=x[4],C=x[5],D=x[6],F=x[7],V=x[8],z=x[9],j=x[10],G=x[11];return x!==p&&(p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15]),p[4]=A*w+V*v,p[5]=C*w+z*v,p[6]=D*w+j*v,p[7]=F*w+G*v,p[8]=V*w-A*v,p[9]=z*w-C*v,p[10]=j*w-D*v,p[11]=G*w-F*v,p},kt.rotateY=function(p,x,T){var v=Math.sin(T),w=Math.cos(T),A=x[0],C=x[1],D=x[2],F=x[3],V=x[8],z=x[9],j=x[10],G=x[11];return x!==p&&(p[4]=x[4],p[5]=x[5],p[6]=x[6],p[7]=x[7],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15]),p[0]=A*w-V*v,p[1]=C*w-z*v,p[2]=D*w-j*v,p[3]=F*w-G*v,p[8]=A*v+V*w,p[9]=C*v+z*w,p[10]=D*v+j*w,p[11]=F*v+G*w,p},kt.rotateZ=function(p,x,T){var v=Math.sin(T),w=Math.cos(T),A=x[0],C=x[1],D=x[2],F=x[3],V=x[4],z=x[5],j=x[6],G=x[7];return x!==p&&(p[8]=x[8],p[9]=x[9],p[10]=x[10],p[11]=x[11],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15]),p[0]=A*w+V*v,p[1]=C*w+z*v,p[2]=D*w+j*v,p[3]=F*w+G*v,p[4]=V*w-A*v,p[5]=z*w-C*v,p[6]=j*w-D*v,p[7]=G*w-F*v,p},kt.fromTranslation=function(p,x){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=x[0],p[13]=x[1],p[14]=x[2],p[15]=1,p},kt.fromScaling=function(p,x){return p[0]=x[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=x[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},kt.fromRotation=function(p,x,T){var v,w,A,C=T[0],D=T[1],F=T[2],V=Math.hypot(C,D,F);return V<e.EPSILON?null:(C*=V=1/V,D*=V,F*=V,v=Math.sin(x),w=Math.cos(x),p[0]=C*C*(A=1-w)+w,p[1]=D*C*A+F*v,p[2]=F*C*A-D*v,p[3]=0,p[4]=C*D*A-F*v,p[5]=D*D*A+w,p[6]=F*D*A+C*v,p[7]=0,p[8]=C*F*A+D*v,p[9]=D*F*A-C*v,p[10]=F*F*A+w,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p)},kt.fromXRotation=function(p,x){var T=Math.sin(x),v=Math.cos(x);return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=v,p[6]=T,p[7]=0,p[8]=0,p[9]=-T,p[10]=v,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},kt.fromYRotation=function(p,x){var T=Math.sin(x),v=Math.cos(x);return p[0]=v,p[1]=0,p[2]=-T,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=T,p[9]=0,p[10]=v,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},kt.fromZRotation=function(p,x){var T=Math.sin(x),v=Math.cos(x);return p[0]=v,p[1]=T,p[2]=0,p[3]=0,p[4]=-T,p[5]=v,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},kt.fromRotationTranslation=a,kt.fromQuat2=function(p,x){var T=new e.ARRAY_TYPE(3),v=-x[0],w=-x[1],A=-x[2],C=x[3],D=x[4],F=x[5],V=x[6],z=x[7],j=v*v+w*w+A*A+C*C;return j>0?(T[0]=2*(D*C+z*v+F*A-V*w)/j,T[1]=2*(F*C+z*w+V*v-D*A)/j,T[2]=2*(V*C+z*A+D*w-F*v)/j):(T[0]=2*(D*C+z*v+F*A-V*w),T[1]=2*(F*C+z*w+V*v-D*A),T[2]=2*(V*C+z*A+D*w-F*v)),a(p,x,T),p},kt.getTranslation=function(p,x){return p[0]=x[12],p[1]=x[13],p[2]=x[14],p},kt.getScaling=h,kt.getRotation=function(p,x){var T=new e.ARRAY_TYPE(3);h(T,x);var v=1/T[0],w=1/T[1],A=1/T[2],C=x[0]*v,D=x[1]*w,F=x[2]*A,V=x[4]*v,z=x[5]*w,j=x[6]*A,G=x[8]*v,Y=x[9]*w,te=x[10]*A,re=C+z+te,Q=0;return re>0?(Q=2*Math.sqrt(re+1),p[3]=.25*Q,p[0]=(j-Y)/Q,p[1]=(G-F)/Q,p[2]=(D-V)/Q):C>z&&C>te?(Q=2*Math.sqrt(1+C-z-te),p[3]=(j-Y)/Q,p[0]=.25*Q,p[1]=(D+V)/Q,p[2]=(G+F)/Q):z>te?(Q=2*Math.sqrt(1+z-C-te),p[3]=(G-F)/Q,p[0]=(D+V)/Q,p[1]=.25*Q,p[2]=(j+Y)/Q):(Q=2*Math.sqrt(1+te-C-z),p[3]=(D-V)/Q,p[0]=(G+F)/Q,p[1]=(j+Y)/Q,p[2]=.25*Q),p},kt.fromRotationTranslationScale=function(p,x,T,v){var w=x[0],A=x[1],C=x[2],D=x[3],F=w+w,V=A+A,z=C+C,j=w*F,G=w*V,Y=w*z,te=A*V,re=A*z,Q=C*z,ue=D*F,se=D*V,de=D*z,we=v[0],Ee=v[1],Me=v[2];return p[0]=(1-(te+Q))*we,p[1]=(G+de)*we,p[2]=(Y-se)*we,p[3]=0,p[4]=(G-de)*Ee,p[5]=(1-(j+Q))*Ee,p[6]=(re+ue)*Ee,p[7]=0,p[8]=(Y+se)*Me,p[9]=(re-ue)*Me,p[10]=(1-(j+te))*Me,p[11]=0,p[12]=T[0],p[13]=T[1],p[14]=T[2],p[15]=1,p},kt.fromRotationTranslationScaleOrigin=function(p,x,T,v,w){var A=x[0],C=x[1],D=x[2],F=x[3],V=A+A,z=C+C,j=D+D,G=A*V,Y=A*z,te=A*j,re=C*z,Q=C*j,ue=D*j,se=F*V,de=F*z,we=F*j,Ee=v[0],Me=v[1],Ie=v[2],Be=w[0],Pe=w[1],Ze=w[2],Je=(1-(re+ue))*Ee,Ue=(Y+we)*Ee,xt=(te-de)*Ee,pt=(Y-we)*Me,ot=(1-(G+ue))*Me,tt=(Q+se)*Me,Nt=(te+de)*Ie,yt=(Q-se)*Ie,Mt=(1-(G+re))*Ie;return p[0]=Je,p[1]=Ue,p[2]=xt,p[3]=0,p[4]=pt,p[5]=ot,p[6]=tt,p[7]=0,p[8]=Nt,p[9]=yt,p[10]=Mt,p[11]=0,p[12]=T[0]+Be-(Je*Be+pt*Pe+Nt*Ze),p[13]=T[1]+Pe-(Ue*Be+ot*Pe+yt*Ze),p[14]=T[2]+Ze-(xt*Be+tt*Pe+Mt*Ze),p[15]=1,p},kt.fromQuat=function(p,x){var T=x[0],v=x[1],w=x[2],A=x[3],C=T+T,D=v+v,F=w+w,V=T*C,z=v*C,j=v*D,G=w*C,Y=w*D,te=w*F,re=A*C,Q=A*D,ue=A*F;return p[0]=1-j-te,p[1]=z+ue,p[2]=G-Q,p[3]=0,p[4]=z-ue,p[5]=1-V-te,p[6]=Y+re,p[7]=0,p[8]=G+Q,p[9]=Y-re,p[10]=1-V-j,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},kt.frustum=function(p,x,T,v,w,A,C){var D=1/(T-x),F=1/(w-v),V=1/(A-C);return p[0]=2*A*D,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=2*A*F,p[6]=0,p[7]=0,p[8]=(T+x)*D,p[9]=(w+v)*F,p[10]=(C+A)*V,p[11]=-1,p[12]=0,p[13]=0,p[14]=C*A*2*V,p[15]=0,p},kt.perspectiveNO=_,kt.perspectiveZO=function(p,x,T,v,w){var A,C=1/Math.tan(x/2);return p[0]=C/T,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=C,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,w!=null&&w!==1/0?(p[10]=w*(A=1/(v-w)),p[14]=w*v*A):(p[10]=-1,p[14]=-v),p},kt.perspectiveFromFieldOfView=function(p,x,T,v){var w=Math.tan(x.upDegrees*Math.PI/180),A=Math.tan(x.downDegrees*Math.PI/180),C=Math.tan(x.leftDegrees*Math.PI/180),D=Math.tan(x.rightDegrees*Math.PI/180),F=2/(C+D),V=2/(w+A);return p[0]=F,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=V,p[6]=0,p[7]=0,p[8]=-(C-D)*F*.5,p[9]=(w-A)*V*.5,p[10]=v/(T-v),p[11]=-1,p[12]=0,p[13]=0,p[14]=v*T/(T-v),p[15]=0,p},kt.orthoNO=b,kt.orthoZO=function(p,x,T,v,w,A,C){var D=1/(x-T),F=1/(v-w),V=1/(A-C);return p[0]=-2*D,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*F,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=V,p[11]=0,p[12]=(x+T)*D,p[13]=(w+v)*F,p[14]=A*V,p[15]=1,p},kt.lookAt=function(p,x,T,v){var w,A,C,D,F,V,z,j,G,Y,te=x[0],re=x[1],Q=x[2],ue=v[0],se=v[1],de=v[2],we=T[0],Ee=T[1],Me=T[2];return Math.abs(te-we)<e.EPSILON&&Math.abs(re-Ee)<e.EPSILON&&Math.abs(Q-Me)<e.EPSILON?o(p):(z=te-we,j=re-Ee,G=Q-Me,w=se*(G*=Y=1/Math.hypot(z,j,G))-de*(j*=Y),A=de*(z*=Y)-ue*G,C=ue*j-se*z,(Y=Math.hypot(w,A,C))?(w*=Y=1/Y,A*=Y,C*=Y):(w=0,A=0,C=0),D=j*C-G*A,F=G*w-z*C,V=z*A-j*w,(Y=Math.hypot(D,F,V))?(D*=Y=1/Y,F*=Y,V*=Y):(D=0,F=0,V=0),p[0]=w,p[1]=D,p[2]=z,p[3]=0,p[4]=A,p[5]=F,p[6]=j,p[7]=0,p[8]=C,p[9]=V,p[10]=G,p[11]=0,p[12]=-(w*te+A*re+C*Q),p[13]=-(D*te+F*re+V*Q),p[14]=-(z*te+j*re+G*Q),p[15]=1,p)},kt.targetTo=function(p,x,T,v){var w=x[0],A=x[1],C=x[2],D=v[0],F=v[1],V=v[2],z=w-T[0],j=A-T[1],G=C-T[2],Y=z*z+j*j+G*G;Y>0&&(z*=Y=1/Math.sqrt(Y),j*=Y,G*=Y);var te=F*G-V*j,re=V*z-D*G,Q=D*j-F*z;return(Y=te*te+re*re+Q*Q)>0&&(te*=Y=1/Math.sqrt(Y),re*=Y,Q*=Y),p[0]=te,p[1]=re,p[2]=Q,p[3]=0,p[4]=j*Q-G*re,p[5]=G*te-z*Q,p[6]=z*re-j*te,p[7]=0,p[8]=z,p[9]=j,p[10]=G,p[11]=0,p[12]=w,p[13]=A,p[14]=C,p[15]=1,p},kt.str=function(p){return"mat4("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+", "+p[6]+", "+p[7]+", "+p[8]+", "+p[9]+", "+p[10]+", "+p[11]+", "+p[12]+", "+p[13]+", "+p[14]+", "+p[15]+")"},kt.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15])},kt.add=function(p,x,T){return p[0]=x[0]+T[0],p[1]=x[1]+T[1],p[2]=x[2]+T[2],p[3]=x[3]+T[3],p[4]=x[4]+T[4],p[5]=x[5]+T[5],p[6]=x[6]+T[6],p[7]=x[7]+T[7],p[8]=x[8]+T[8],p[9]=x[9]+T[9],p[10]=x[10]+T[10],p[11]=x[11]+T[11],p[12]=x[12]+T[12],p[13]=x[13]+T[13],p[14]=x[14]+T[14],p[15]=x[15]+T[15],p},kt.subtract=E,kt.multiplyScalar=function(p,x,T){return p[0]=x[0]*T,p[1]=x[1]*T,p[2]=x[2]*T,p[3]=x[3]*T,p[4]=x[4]*T,p[5]=x[5]*T,p[6]=x[6]*T,p[7]=x[7]*T,p[8]=x[8]*T,p[9]=x[9]*T,p[10]=x[10]*T,p[11]=x[11]*T,p[12]=x[12]*T,p[13]=x[13]*T,p[14]=x[14]*T,p[15]=x[15]*T,p},kt.multiplyScalarAndAdd=function(p,x,T,v){return p[0]=x[0]+T[0]*v,p[1]=x[1]+T[1]*v,p[2]=x[2]+T[2]*v,p[3]=x[3]+T[3]*v,p[4]=x[4]+T[4]*v,p[5]=x[5]+T[5]*v,p[6]=x[6]+T[6]*v,p[7]=x[7]+T[7]*v,p[8]=x[8]+T[8]*v,p[9]=x[9]+T[9]*v,p[10]=x[10]+T[10]*v,p[11]=x[11]+T[11]*v,p[12]=x[12]+T[12]*v,p[13]=x[13]+T[13]*v,p[14]=x[14]+T[14]*v,p[15]=x[15]+T[15]*v,p},kt.exactEquals=function(p,x){return p[0]===x[0]&&p[1]===x[1]&&p[2]===x[2]&&p[3]===x[3]&&p[4]===x[4]&&p[5]===x[5]&&p[6]===x[6]&&p[7]===x[7]&&p[8]===x[8]&&p[9]===x[9]&&p[10]===x[10]&&p[11]===x[11]&&p[12]===x[12]&&p[13]===x[13]&&p[14]===x[14]&&p[15]===x[15]},kt.equals=function(p,x){var T=p[0],v=p[1],w=p[2],A=p[3],C=p[4],D=p[5],F=p[6],V=p[7],z=p[8],j=p[9],G=p[10],Y=p[11],te=p[12],re=p[13],Q=p[14],ue=p[15],se=x[0],de=x[1],we=x[2],Ee=x[3],Me=x[4],Ie=x[5],Be=x[6],Pe=x[7],Ze=x[8],Je=x[9],Ue=x[10],xt=x[11],pt=x[12],ot=x[13],tt=x[14],Nt=x[15];return Math.abs(T-se)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(se))&&Math.abs(v-de)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(de))&&Math.abs(w-we)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(we))&&Math.abs(A-Ee)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ee))&&Math.abs(C-Me)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Me))&&Math.abs(D-Ie)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ie))&&Math.abs(F-Be)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(Be))&&Math.abs(V-Pe)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(Pe))&&Math.abs(z-Ze)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ze))&&Math.abs(j-Je)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(Je))&&Math.abs(G-Ue)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Ue))&&Math.abs(Y-xt)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(xt))&&Math.abs(te-pt)<=e.EPSILON*Math.max(1,Math.abs(te),Math.abs(pt))&&Math.abs(re-ot)<=e.EPSILON*Math.max(1,Math.abs(re),Math.abs(ot))&&Math.abs(Q-tt)<=e.EPSILON*Math.max(1,Math.abs(Q),Math.abs(tt))&&Math.abs(ue-Nt)<=e.EPSILON*Math.max(1,Math.abs(ue),Math.abs(Nt))},kt.sub=kt.mul=kt.ortho=kt.perspective=void 0;var e=function(p,x){if(p&&p.__esModule)return p;if(p===null||n(p)!=="object"&&typeof p!="function")return{default:p};var T=i(void 0);if(T&&T.has(p))return T.get(p);var v={},w=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var A in p)if(A!=="default"&&Object.prototype.hasOwnProperty.call(p,A)){var C=w?Object.getOwnPropertyDescriptor(p,A):null;C&&(C.get||C.set)?Object.defineProperty(v,A,C):v[A]=p[A]}return v.default=p,T&&T.set(p,v),v}(qe());function i(p){if(typeof WeakMap!="function")return null;var x=new WeakMap,T=new WeakMap;return(i=function(v){return v?T:x})(p)}function o(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function u(p,x,T){var v=x[0],w=x[1],A=x[2],C=x[3],D=x[4],F=x[5],V=x[6],z=x[7],j=x[8],G=x[9],Y=x[10],te=x[11],re=x[12],Q=x[13],ue=x[14],se=x[15],de=T[0],we=T[1],Ee=T[2],Me=T[3];return p[0]=de*v+we*D+Ee*j+Me*re,p[1]=de*w+we*F+Ee*G+Me*Q,p[2]=de*A+we*V+Ee*Y+Me*ue,p[3]=de*C+we*z+Ee*te+Me*se,p[4]=(de=T[4])*v+(we=T[5])*D+(Ee=T[6])*j+(Me=T[7])*re,p[5]=de*w+we*F+Ee*G+Me*Q,p[6]=de*A+we*V+Ee*Y+Me*ue,p[7]=de*C+we*z+Ee*te+Me*se,p[8]=(de=T[8])*v+(we=T[9])*D+(Ee=T[10])*j+(Me=T[11])*re,p[9]=de*w+we*F+Ee*G+Me*Q,p[10]=de*A+we*V+Ee*Y+Me*ue,p[11]=de*C+we*z+Ee*te+Me*se,p[12]=(de=T[12])*v+(we=T[13])*D+(Ee=T[14])*j+(Me=T[15])*re,p[13]=de*w+we*F+Ee*G+Me*Q,p[14]=de*A+we*V+Ee*Y+Me*ue,p[15]=de*C+we*z+Ee*te+Me*se,p}function a(p,x,T){var v=x[0],w=x[1],A=x[2],C=x[3],D=v+v,F=w+w,V=A+A,z=v*D,j=v*F,G=v*V,Y=w*F,te=w*V,re=A*V,Q=C*D,ue=C*F,se=C*V;return p[0]=1-(Y+re),p[1]=j+se,p[2]=G-ue,p[3]=0,p[4]=j-se,p[5]=1-(z+re),p[6]=te+Q,p[7]=0,p[8]=G+ue,p[9]=te-Q,p[10]=1-(z+Y),p[11]=0,p[12]=T[0],p[13]=T[1],p[14]=T[2],p[15]=1,p}function h(p,x){var T=x[4],v=x[5],w=x[6],A=x[8],C=x[9],D=x[10];return p[0]=Math.hypot(x[0],x[1],x[2]),p[1]=Math.hypot(T,v,w),p[2]=Math.hypot(A,C,D),p}function _(p,x,T,v,w){var A,C=1/Math.tan(x/2);return p[0]=C/T,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=C,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,w!=null&&w!==1/0?(p[10]=(w+v)*(A=1/(v-w)),p[14]=2*w*v*A):(p[10]=-1,p[14]=-2*v),p}function b(p,x,T,v,w,A,C){var D=1/(x-T),F=1/(v-w),V=1/(A-C);return p[0]=-2*D,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*F,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*V,p[11]=0,p[12]=(x+T)*D,p[13]=(w+v)*F,p[14]=(C+A)*V,p[15]=1,p}function E(p,x,T){return p[0]=x[0]-T[0],p[1]=x[1]-T[1],p[2]=x[2]-T[2],p[3]=x[3]-T[3],p[4]=x[4]-T[4],p[5]=x[5]-T[5],p[6]=x[6]-T[6],p[7]=x[7]-T[7],p[8]=x[8]-T[8],p[9]=x[9]-T[9],p[10]=x[10]-T[10],p[11]=x[11]-T[11],p[12]=x[12]-T[12],p[13]=x[13]-T[13],p[14]=x[14]-T[14],p[15]=x[15]-T[15],p}return kt.perspective=_,kt.ortho=b,kt.mul=u,kt.sub=E,kt}var Sr,qt={},Xt={};function sn(){if(Sr)return Xt;function n(w){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},n(w)}Sr=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=o,Xt.clone=function(w){var A=new e.ARRAY_TYPE(3);return A[0]=w[0],A[1]=w[1],A[2]=w[2],A},Xt.length=u,Xt.fromValues=function(w,A,C){var D=new e.ARRAY_TYPE(3);return D[0]=w,D[1]=A,D[2]=C,D},Xt.copy=function(w,A){return w[0]=A[0],w[1]=A[1],w[2]=A[2],w},Xt.set=function(w,A,C,D){return w[0]=A,w[1]=C,w[2]=D,w},Xt.add=function(w,A,C){return w[0]=A[0]+C[0],w[1]=A[1]+C[1],w[2]=A[2]+C[2],w},Xt.subtract=a,Xt.multiply=h,Xt.divide=_,Xt.ceil=function(w,A){return w[0]=Math.ceil(A[0]),w[1]=Math.ceil(A[1]),w[2]=Math.ceil(A[2]),w},Xt.floor=function(w,A){return w[0]=Math.floor(A[0]),w[1]=Math.floor(A[1]),w[2]=Math.floor(A[2]),w},Xt.min=function(w,A,C){return w[0]=Math.min(A[0],C[0]),w[1]=Math.min(A[1],C[1]),w[2]=Math.min(A[2],C[2]),w},Xt.max=function(w,A,C){return w[0]=Math.max(A[0],C[0]),w[1]=Math.max(A[1],C[1]),w[2]=Math.max(A[2],C[2]),w},Xt.round=function(w,A){return w[0]=Math.round(A[0]),w[1]=Math.round(A[1]),w[2]=Math.round(A[2]),w},Xt.scale=function(w,A,C){return w[0]=A[0]*C,w[1]=A[1]*C,w[2]=A[2]*C,w},Xt.scaleAndAdd=function(w,A,C,D){return w[0]=A[0]+C[0]*D,w[1]=A[1]+C[1]*D,w[2]=A[2]+C[2]*D,w},Xt.distance=b,Xt.squaredDistance=E,Xt.squaredLength=p,Xt.negate=function(w,A){return w[0]=-A[0],w[1]=-A[1],w[2]=-A[2],w},Xt.inverse=function(w,A){return w[0]=1/A[0],w[1]=1/A[1],w[2]=1/A[2],w},Xt.normalize=function(w,A){var C=A[0],D=A[1],F=A[2],V=C*C+D*D+F*F;return V>0&&(V=1/Math.sqrt(V)),w[0]=A[0]*V,w[1]=A[1]*V,w[2]=A[2]*V,w},Xt.dot=x,Xt.cross=function(w,A,C){var D=A[0],F=A[1],V=A[2],z=C[0],j=C[1],G=C[2];return w[0]=F*G-V*j,w[1]=V*z-D*G,w[2]=D*j-F*z,w},Xt.lerp=function(w,A,C,D){var F=A[0],V=A[1],z=A[2];return w[0]=F+D*(C[0]-F),w[1]=V+D*(C[1]-V),w[2]=z+D*(C[2]-z),w},Xt.hermite=function(w,A,C,D,F,V){var z=V*V,j=z*(2*V-3)+1,G=z*(V-2)+V,Y=z*(V-1),te=z*(3-2*V);return w[0]=A[0]*j+C[0]*G+D[0]*Y+F[0]*te,w[1]=A[1]*j+C[1]*G+D[1]*Y+F[1]*te,w[2]=A[2]*j+C[2]*G+D[2]*Y+F[2]*te,w},Xt.bezier=function(w,A,C,D,F,V){var z=1-V,j=z*z,G=V*V,Y=j*z,te=3*V*j,re=3*G*z,Q=G*V;return w[0]=A[0]*Y+C[0]*te+D[0]*re+F[0]*Q,w[1]=A[1]*Y+C[1]*te+D[1]*re+F[1]*Q,w[2]=A[2]*Y+C[2]*te+D[2]*re+F[2]*Q,w},Xt.random=function(w,A){A=A||1;var C=2*e.RANDOM()*Math.PI,D=2*e.RANDOM()-1,F=Math.sqrt(1-D*D)*A;return w[0]=Math.cos(C)*F,w[1]=Math.sin(C)*F,w[2]=D*A,w},Xt.transformMat4=function(w,A,C){var D=A[0],F=A[1],V=A[2],z=C[3]*D+C[7]*F+C[11]*V+C[15];return w[0]=(C[0]*D+C[4]*F+C[8]*V+C[12])/(z=z||1),w[1]=(C[1]*D+C[5]*F+C[9]*V+C[13])/z,w[2]=(C[2]*D+C[6]*F+C[10]*V+C[14])/z,w},Xt.transformMat3=function(w,A,C){var D=A[0],F=A[1],V=A[2];return w[0]=D*C[0]+F*C[3]+V*C[6],w[1]=D*C[1]+F*C[4]+V*C[7],w[2]=D*C[2]+F*C[5]+V*C[8],w},Xt.transformQuat=function(w,A,C){var D=C[0],F=C[1],V=C[2],z=A[0],j=A[1],G=A[2],Y=F*G-V*j,te=V*z-D*G,re=D*j-F*z,Q=F*re-V*te,ue=V*Y-D*re,se=D*te-F*Y,de=2*C[3];return te*=de,re*=de,ue*=2,se*=2,w[0]=z+(Y*=de)+(Q*=2),w[1]=j+te+ue,w[2]=G+re+se,w},Xt.rotateX=function(w,A,C,D){var F=[],V=[];return F[0]=A[0]-C[0],F[1]=A[1]-C[1],F[2]=A[2]-C[2],V[0]=F[0],V[1]=F[1]*Math.cos(D)-F[2]*Math.sin(D),V[2]=F[1]*Math.sin(D)+F[2]*Math.cos(D),w[0]=V[0]+C[0],w[1]=V[1]+C[1],w[2]=V[2]+C[2],w},Xt.rotateY=function(w,A,C,D){var F=[],V=[];return F[0]=A[0]-C[0],F[1]=A[1]-C[1],F[2]=A[2]-C[2],V[0]=F[2]*Math.sin(D)+F[0]*Math.cos(D),V[1]=F[1],V[2]=F[2]*Math.cos(D)-F[0]*Math.sin(D),w[0]=V[0]+C[0],w[1]=V[1]+C[1],w[2]=V[2]+C[2],w},Xt.rotateZ=function(w,A,C,D){var F=[],V=[];return F[0]=A[0]-C[0],F[1]=A[1]-C[1],F[2]=A[2]-C[2],V[0]=F[0]*Math.cos(D)-F[1]*Math.sin(D),V[1]=F[0]*Math.sin(D)+F[1]*Math.cos(D),V[2]=F[2],w[0]=V[0]+C[0],w[1]=V[1]+C[1],w[2]=V[2]+C[2],w},Xt.angle=function(w,A){var C=w[0],D=w[1],F=w[2],V=A[0],z=A[1],j=A[2],G=Math.sqrt(C*C+D*D+F*F)*Math.sqrt(V*V+z*z+j*j),Y=G&&x(w,A)/G;return Math.acos(Math.min(Math.max(Y,-1),1))},Xt.zero=function(w){return w[0]=0,w[1]=0,w[2]=0,w},Xt.str=function(w){return"vec3("+w[0]+", "+w[1]+", "+w[2]+")"},Xt.exactEquals=function(w,A){return w[0]===A[0]&&w[1]===A[1]&&w[2]===A[2]},Xt.equals=function(w,A){var C=w[0],D=w[1],F=w[2],V=A[0],z=A[1],j=A[2];return Math.abs(C-V)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(V))&&Math.abs(D-z)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(z))&&Math.abs(F-j)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(j))},Xt.forEach=Xt.sqrLen=Xt.len=Xt.sqrDist=Xt.dist=Xt.div=Xt.mul=Xt.sub=void 0;var e=function(w,A){if(w&&w.__esModule)return w;if(w===null||n(w)!=="object"&&typeof w!="function")return{default:w};var C=i(void 0);if(C&&C.has(w))return C.get(w);var D={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in w)if(V!=="default"&&Object.prototype.hasOwnProperty.call(w,V)){var z=F?Object.getOwnPropertyDescriptor(w,V):null;z&&(z.get||z.set)?Object.defineProperty(D,V,z):D[V]=w[V]}return D.default=w,C&&C.set(w,D),D}(qe());function i(w){if(typeof WeakMap!="function")return null;var A=new WeakMap,C=new WeakMap;return(i=function(D){return D?C:A})(w)}function o(){var w=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0),w}function u(w){return Math.hypot(w[0],w[1],w[2])}function a(w,A,C){return w[0]=A[0]-C[0],w[1]=A[1]-C[1],w[2]=A[2]-C[2],w}function h(w,A,C){return w[0]=A[0]*C[0],w[1]=A[1]*C[1],w[2]=A[2]*C[2],w}function _(w,A,C){return w[0]=A[0]/C[0],w[1]=A[1]/C[1],w[2]=A[2]/C[2],w}function b(w,A){return Math.hypot(A[0]-w[0],A[1]-w[1],A[2]-w[2])}function E(w,A){var C=A[0]-w[0],D=A[1]-w[1],F=A[2]-w[2];return C*C+D*D+F*F}function p(w){var A=w[0],C=w[1],D=w[2];return A*A+C*C+D*D}function x(w,A){return w[0]*A[0]+w[1]*A[1]+w[2]*A[2]}Xt.sub=a,Xt.mul=h,Xt.div=_,Xt.dist=b,Xt.sqrDist=E,Xt.len=u,Xt.sqrLen=p;var T,v=(T=o(),function(w,A,C,D,F,V){var z,j;for(A||(A=3),C||(C=0),j=D?Math.min(D*A+C,w.length):w.length,z=C;z<j;z+=A)T[0]=w[z],T[1]=w[z+1],T[2]=w[z+2],F(T,T,V),w[z]=T[0],w[z+1]=T[1],w[z+2]=T[2];return w});return Xt.forEach=v,Xt}var Cn,hs,Ht={};function Li(){if(Cn)return Ht;function n(v){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},n(v)}Cn=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.create=o,Ht.clone=function(v){var w=new e.ARRAY_TYPE(4);return w[0]=v[0],w[1]=v[1],w[2]=v[2],w[3]=v[3],w},Ht.fromValues=function(v,w,A,C){var D=new e.ARRAY_TYPE(4);return D[0]=v,D[1]=w,D[2]=A,D[3]=C,D},Ht.copy=function(v,w){return v[0]=w[0],v[1]=w[1],v[2]=w[2],v[3]=w[3],v},Ht.set=function(v,w,A,C,D){return v[0]=w,v[1]=A,v[2]=C,v[3]=D,v},Ht.add=function(v,w,A){return v[0]=w[0]+A[0],v[1]=w[1]+A[1],v[2]=w[2]+A[2],v[3]=w[3]+A[3],v},Ht.subtract=u,Ht.multiply=a,Ht.divide=h,Ht.ceil=function(v,w){return v[0]=Math.ceil(w[0]),v[1]=Math.ceil(w[1]),v[2]=Math.ceil(w[2]),v[3]=Math.ceil(w[3]),v},Ht.floor=function(v,w){return v[0]=Math.floor(w[0]),v[1]=Math.floor(w[1]),v[2]=Math.floor(w[2]),v[3]=Math.floor(w[3]),v},Ht.min=function(v,w,A){return v[0]=Math.min(w[0],A[0]),v[1]=Math.min(w[1],A[1]),v[2]=Math.min(w[2],A[2]),v[3]=Math.min(w[3],A[3]),v},Ht.max=function(v,w,A){return v[0]=Math.max(w[0],A[0]),v[1]=Math.max(w[1],A[1]),v[2]=Math.max(w[2],A[2]),v[3]=Math.max(w[3],A[3]),v},Ht.round=function(v,w){return v[0]=Math.round(w[0]),v[1]=Math.round(w[1]),v[2]=Math.round(w[2]),v[3]=Math.round(w[3]),v},Ht.scale=function(v,w,A){return v[0]=w[0]*A,v[1]=w[1]*A,v[2]=w[2]*A,v[3]=w[3]*A,v},Ht.scaleAndAdd=function(v,w,A,C){return v[0]=w[0]+A[0]*C,v[1]=w[1]+A[1]*C,v[2]=w[2]+A[2]*C,v[3]=w[3]+A[3]*C,v},Ht.distance=_,Ht.squaredDistance=b,Ht.length=E,Ht.squaredLength=p,Ht.negate=function(v,w){return v[0]=-w[0],v[1]=-w[1],v[2]=-w[2],v[3]=-w[3],v},Ht.inverse=function(v,w){return v[0]=1/w[0],v[1]=1/w[1],v[2]=1/w[2],v[3]=1/w[3],v},Ht.normalize=function(v,w){var A=w[0],C=w[1],D=w[2],F=w[3],V=A*A+C*C+D*D+F*F;return V>0&&(V=1/Math.sqrt(V)),v[0]=A*V,v[1]=C*V,v[2]=D*V,v[3]=F*V,v},Ht.dot=function(v,w){return v[0]*w[0]+v[1]*w[1]+v[2]*w[2]+v[3]*w[3]},Ht.cross=function(v,w,A,C){var D=A[0]*C[1]-A[1]*C[0],F=A[0]*C[2]-A[2]*C[0],V=A[0]*C[3]-A[3]*C[0],z=A[1]*C[2]-A[2]*C[1],j=A[1]*C[3]-A[3]*C[1],G=A[2]*C[3]-A[3]*C[2],Y=w[0],te=w[1],re=w[2],Q=w[3];return v[0]=te*G-re*j+Q*z,v[1]=-Y*G+re*V-Q*F,v[2]=Y*j-te*V+Q*D,v[3]=-Y*z+te*F-re*D,v},Ht.lerp=function(v,w,A,C){var D=w[0],F=w[1],V=w[2],z=w[3];return v[0]=D+C*(A[0]-D),v[1]=F+C*(A[1]-F),v[2]=V+C*(A[2]-V),v[3]=z+C*(A[3]-z),v},Ht.random=function(v,w){var A,C,D,F,V,z;w=w||1;do V=(A=2*e.RANDOM()-1)*A+(C=2*e.RANDOM()-1)*C;while(V>=1);do z=(D=2*e.RANDOM()-1)*D+(F=2*e.RANDOM()-1)*F;while(z>=1);var j=Math.sqrt((1-V)/z);return v[0]=w*A,v[1]=w*C,v[2]=w*D*j,v[3]=w*F*j,v},Ht.transformMat4=function(v,w,A){var C=w[0],D=w[1],F=w[2],V=w[3];return v[0]=A[0]*C+A[4]*D+A[8]*F+A[12]*V,v[1]=A[1]*C+A[5]*D+A[9]*F+A[13]*V,v[2]=A[2]*C+A[6]*D+A[10]*F+A[14]*V,v[3]=A[3]*C+A[7]*D+A[11]*F+A[15]*V,v},Ht.transformQuat=function(v,w,A){var C=w[0],D=w[1],F=w[2],V=A[0],z=A[1],j=A[2],G=A[3],Y=G*C+z*F-j*D,te=G*D+j*C-V*F,re=G*F+V*D-z*C,Q=-V*C-z*D-j*F;return v[0]=Y*G+Q*-V+te*-j-re*-z,v[1]=te*G+Q*-z+re*-V-Y*-j,v[2]=re*G+Q*-j+Y*-z-te*-V,v[3]=w[3],v},Ht.zero=function(v){return v[0]=0,v[1]=0,v[2]=0,v[3]=0,v},Ht.str=function(v){return"vec4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+")"},Ht.exactEquals=function(v,w){return v[0]===w[0]&&v[1]===w[1]&&v[2]===w[2]&&v[3]===w[3]},Ht.equals=function(v,w){var A=v[0],C=v[1],D=v[2],F=v[3],V=w[0],z=w[1],j=w[2],G=w[3];return Math.abs(A-V)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(V))&&Math.abs(C-z)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(z))&&Math.abs(D-j)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(j))&&Math.abs(F-G)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(G))},Ht.forEach=Ht.sqrLen=Ht.len=Ht.sqrDist=Ht.dist=Ht.div=Ht.mul=Ht.sub=void 0;var e=function(v,w){if(v&&v.__esModule)return v;if(v===null||n(v)!=="object"&&typeof v!="function")return{default:v};var A=i(void 0);if(A&&A.has(v))return A.get(v);var C={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in v)if(F!=="default"&&Object.prototype.hasOwnProperty.call(v,F)){var V=D?Object.getOwnPropertyDescriptor(v,F):null;V&&(V.get||V.set)?Object.defineProperty(C,F,V):C[F]=v[F]}return C.default=v,A&&A.set(v,C),C}(qe());function i(v){if(typeof WeakMap!="function")return null;var w=new WeakMap,A=new WeakMap;return(i=function(C){return C?A:w})(v)}function o(){var v=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0,v[3]=0),v}function u(v,w,A){return v[0]=w[0]-A[0],v[1]=w[1]-A[1],v[2]=w[2]-A[2],v[3]=w[3]-A[3],v}function a(v,w,A){return v[0]=w[0]*A[0],v[1]=w[1]*A[1],v[2]=w[2]*A[2],v[3]=w[3]*A[3],v}function h(v,w,A){return v[0]=w[0]/A[0],v[1]=w[1]/A[1],v[2]=w[2]/A[2],v[3]=w[3]/A[3],v}function _(v,w){return Math.hypot(w[0]-v[0],w[1]-v[1],w[2]-v[2],w[3]-v[3])}function b(v,w){var A=w[0]-v[0],C=w[1]-v[1],D=w[2]-v[2],F=w[3]-v[3];return A*A+C*C+D*D+F*F}function E(v){return Math.hypot(v[0],v[1],v[2],v[3])}function p(v){var w=v[0],A=v[1],C=v[2],D=v[3];return w*w+A*A+C*C+D*D}Ht.sub=u,Ht.mul=a,Ht.div=h,Ht.dist=_,Ht.sqrDist=b,Ht.len=E,Ht.sqrLen=p;var x,T=(x=o(),function(v,w,A,C,D,F){var V,z;for(w||(w=4),A||(A=0),z=C?Math.min(C*w+A,v.length):v.length,V=A;V<z;V+=w)x[0]=v[V],x[1]=v[V+1],x[2]=v[V+2],x[3]=v[V+3],D(x,x,F),v[V]=x[0],v[V+1]=x[1],v[V+2]=x[2],v[V+3]=x[3];return v});return Ht.forEach=T,Ht}function Vi(){if(hs)return qt;function n(se){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(de){return typeof de}:function(de){return de&&typeof Symbol=="function"&&de.constructor===Symbol&&de!==Symbol.prototype?"symbol":typeof de},n(se)}hs=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=_,qt.identity=function(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=1,se},qt.setAxisAngle=b,qt.getAxisAngle=function(se,de){var we=2*Math.acos(de[3]),Ee=Math.sin(we/2);return Ee>e.EPSILON?(se[0]=de[0]/Ee,se[1]=de[1]/Ee,se[2]=de[2]/Ee):(se[0]=1,se[1]=0,se[2]=0),we},qt.getAngle=function(se,de){var we=A(se,de);return Math.acos(2*we*we-1)},qt.multiply=E,qt.rotateX=function(se,de,we){we*=.5;var Ee=de[0],Me=de[1],Ie=de[2],Be=de[3],Pe=Math.sin(we),Ze=Math.cos(we);return se[0]=Ee*Ze+Be*Pe,se[1]=Me*Ze+Ie*Pe,se[2]=Ie*Ze-Me*Pe,se[3]=Be*Ze-Ee*Pe,se},qt.rotateY=function(se,de,we){we*=.5;var Ee=de[0],Me=de[1],Ie=de[2],Be=de[3],Pe=Math.sin(we),Ze=Math.cos(we);return se[0]=Ee*Ze-Ie*Pe,se[1]=Me*Ze+Be*Pe,se[2]=Ie*Ze+Ee*Pe,se[3]=Be*Ze-Me*Pe,se},qt.rotateZ=function(se,de,we){we*=.5;var Ee=de[0],Me=de[1],Ie=de[2],Be=de[3],Pe=Math.sin(we),Ze=Math.cos(we);return se[0]=Ee*Ze+Me*Pe,se[1]=Me*Ze-Ee*Pe,se[2]=Ie*Ze+Be*Pe,se[3]=Be*Ze-Ie*Pe,se},qt.calculateW=function(se,de){var we=de[0],Ee=de[1],Me=de[2];return se[0]=we,se[1]=Ee,se[2]=Me,se[3]=Math.sqrt(Math.abs(1-we*we-Ee*Ee-Me*Me)),se},qt.exp=p,qt.ln=x,qt.pow=function(se,de,we){return x(se,de),w(se,se,we),p(se,se),se},qt.slerp=T,qt.random=function(se){var de=e.RANDOM(),we=e.RANDOM(),Ee=e.RANDOM(),Me=Math.sqrt(1-de),Ie=Math.sqrt(de);return se[0]=Me*Math.sin(2*Math.PI*we),se[1]=Me*Math.cos(2*Math.PI*we),se[2]=Ie*Math.sin(2*Math.PI*Ee),se[3]=Ie*Math.cos(2*Math.PI*Ee),se},qt.invert=function(se,de){var we=de[0],Ee=de[1],Me=de[2],Ie=de[3],Be=we*we+Ee*Ee+Me*Me+Ie*Ie,Pe=Be?1/Be:0;return se[0]=-we*Pe,se[1]=-Ee*Pe,se[2]=-Me*Pe,se[3]=Ie*Pe,se},qt.conjugate=function(se,de){return se[0]=-de[0],se[1]=-de[1],se[2]=-de[2],se[3]=de[3],se},qt.fromMat3=v,qt.fromEuler=function(se,de,we,Ee){var Me=.5*Math.PI/180;de*=Me,we*=Me,Ee*=Me;var Ie=Math.sin(de),Be=Math.cos(de),Pe=Math.sin(we),Ze=Math.cos(we),Je=Math.sin(Ee),Ue=Math.cos(Ee);return se[0]=Ie*Ze*Ue-Be*Pe*Je,se[1]=Be*Pe*Ue+Ie*Ze*Je,se[2]=Be*Ze*Je-Ie*Pe*Ue,se[3]=Be*Ze*Ue+Ie*Pe*Je,se},qt.str=function(se){return"quat("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"},qt.setAxes=qt.sqlerp=qt.rotationTo=qt.equals=qt.exactEquals=qt.normalize=qt.sqrLen=qt.squaredLength=qt.len=qt.length=qt.lerp=qt.dot=qt.scale=qt.mul=qt.add=qt.set=qt.copy=qt.fromValues=qt.clone=void 0;var e=h(qe()),i=h(yi()),o=h(sn()),u=h(Li());function a(se){if(typeof WeakMap!="function")return null;var de=new WeakMap,we=new WeakMap;return(a=function(Ee){return Ee?we:de})(se)}function h(se,de){if(se&&se.__esModule)return se;if(se===null||n(se)!=="object"&&typeof se!="function")return{default:se};var we=a(de);if(we&&we.has(se))return we.get(se);var Ee={},Me=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ie in se)if(Ie!=="default"&&Object.prototype.hasOwnProperty.call(se,Ie)){var Be=Me?Object.getOwnPropertyDescriptor(se,Ie):null;Be&&(Be.get||Be.set)?Object.defineProperty(Ee,Ie,Be):Ee[Ie]=se[Ie]}return Ee.default=se,we&&we.set(se,Ee),Ee}function _(){var se=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0),se[3]=1,se}function b(se,de,we){we*=.5;var Ee=Math.sin(we);return se[0]=Ee*de[0],se[1]=Ee*de[1],se[2]=Ee*de[2],se[3]=Math.cos(we),se}function E(se,de,we){var Ee=de[0],Me=de[1],Ie=de[2],Be=de[3],Pe=we[0],Ze=we[1],Je=we[2],Ue=we[3];return se[0]=Ee*Ue+Be*Pe+Me*Je-Ie*Ze,se[1]=Me*Ue+Be*Ze+Ie*Pe-Ee*Je,se[2]=Ie*Ue+Be*Je+Ee*Ze-Me*Pe,se[3]=Be*Ue-Ee*Pe-Me*Ze-Ie*Je,se}function p(se,de){var we=de[0],Ee=de[1],Me=de[2],Ie=de[3],Be=Math.sqrt(we*we+Ee*Ee+Me*Me),Pe=Math.exp(Ie),Ze=Be>0?Pe*Math.sin(Be)/Be:0;return se[0]=we*Ze,se[1]=Ee*Ze,se[2]=Me*Ze,se[3]=Pe*Math.cos(Be),se}function x(se,de){var we=de[0],Ee=de[1],Me=de[2],Ie=de[3],Be=Math.sqrt(we*we+Ee*Ee+Me*Me),Pe=Be>0?Math.atan2(Be,Ie)/Be:0;return se[0]=we*Pe,se[1]=Ee*Pe,se[2]=Me*Pe,se[3]=.5*Math.log(we*we+Ee*Ee+Me*Me+Ie*Ie),se}function T(se,de,we,Ee){var Me,Ie,Be,Pe,Ze,Je=de[0],Ue=de[1],xt=de[2],pt=de[3],ot=we[0],tt=we[1],Nt=we[2],yt=we[3];return(Ie=Je*ot+Ue*tt+xt*Nt+pt*yt)<0&&(Ie=-Ie,ot=-ot,tt=-tt,Nt=-Nt,yt=-yt),1-Ie>e.EPSILON?(Me=Math.acos(Ie),Be=Math.sin(Me),Pe=Math.sin((1-Ee)*Me)/Be,Ze=Math.sin(Ee*Me)/Be):(Pe=1-Ee,Ze=Ee),se[0]=Pe*Je+Ze*ot,se[1]=Pe*Ue+Ze*tt,se[2]=Pe*xt+Ze*Nt,se[3]=Pe*pt+Ze*yt,se}function v(se,de){var we,Ee=de[0]+de[4]+de[8];if(Ee>0)we=Math.sqrt(Ee+1),se[3]=.5*we,se[0]=(de[5]-de[7])*(we=.5/we),se[1]=(de[6]-de[2])*we,se[2]=(de[1]-de[3])*we;else{var Me=0;de[4]>de[0]&&(Me=1),de[8]>de[3*Me+Me]&&(Me=2);var Ie=(Me+1)%3,Be=(Me+2)%3;we=Math.sqrt(de[3*Me+Me]-de[3*Ie+Ie]-de[3*Be+Be]+1),se[Me]=.5*we,se[3]=(de[3*Ie+Be]-de[3*Be+Ie])*(we=.5/we),se[Ie]=(de[3*Ie+Me]+de[3*Me+Ie])*we,se[Be]=(de[3*Be+Me]+de[3*Me+Be])*we}return se}qt.clone=u.clone,qt.fromValues=u.fromValues,qt.copy=u.copy,qt.set=u.set,qt.add=u.add,qt.mul=E;var w=u.scale;qt.scale=w;var A=u.dot;qt.dot=A,qt.lerp=u.lerp;var C=u.length;qt.length=C,qt.len=C;var D=u.squaredLength;qt.squaredLength=D,qt.sqrLen=D;var F=u.normalize;qt.normalize=F,qt.exactEquals=u.exactEquals,qt.equals=u.equals;var V,z,j,G=(V=o.create(),z=o.fromValues(1,0,0),j=o.fromValues(0,1,0),function(se,de,we){var Ee=o.dot(de,we);return Ee<-.999999?(o.cross(V,z,de),o.len(V)<1e-6&&o.cross(V,j,de),o.normalize(V,V),b(se,V,Math.PI),se):Ee>.999999?(se[0]=0,se[1]=0,se[2]=0,se[3]=1,se):(o.cross(V,de,we),se[0]=V[0],se[1]=V[1],se[2]=V[2],se[3]=1+Ee,F(se,se))});qt.rotationTo=G;var Y,te,re=(Y=_(),te=_(),function(se,de,we,Ee,Me,Ie){return T(Y,de,Me,Ie),T(te,we,Ee,Ie),T(se,Y,te,2*Ie*(1-Ie)),se});qt.sqlerp=re;var Q,ue=(Q=i.create(),function(se,de,we,Ee){return Q[0]=we[0],Q[3]=we[1],Q[6]=we[2],Q[1]=Ee[0],Q[4]=Ee[1],Q[7]=Ee[2],Q[2]=-de[0],Q[5]=-de[1],Q[8]=-de[2],F(se,v(se,Q))});return qt.setAxes=ue,qt}var pn,Qt={};function on(){if(pn)return Qt;function n(T){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},n(T)}pn=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=function(){var T=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[4]=0,T[5]=0,T[6]=0,T[7]=0),T[3]=1,T},Qt.clone=function(T){var v=new e.ARRAY_TYPE(8);return v[0]=T[0],v[1]=T[1],v[2]=T[2],v[3]=T[3],v[4]=T[4],v[5]=T[5],v[6]=T[6],v[7]=T[7],v},Qt.fromValues=function(T,v,w,A,C,D,F,V){var z=new e.ARRAY_TYPE(8);return z[0]=T,z[1]=v,z[2]=w,z[3]=A,z[4]=C,z[5]=D,z[6]=F,z[7]=V,z},Qt.fromRotationTranslationValues=function(T,v,w,A,C,D,F){var V=new e.ARRAY_TYPE(8);V[0]=T,V[1]=v,V[2]=w,V[3]=A;var z=.5*C,j=.5*D,G=.5*F;return V[4]=z*A+j*w-G*v,V[5]=j*A+G*T-z*w,V[6]=G*A+z*v-j*T,V[7]=-z*T-j*v-G*w,V},Qt.fromRotationTranslation=h,Qt.fromTranslation=function(T,v){return T[0]=0,T[1]=0,T[2]=0,T[3]=1,T[4]=.5*v[0],T[5]=.5*v[1],T[6]=.5*v[2],T[7]=0,T},Qt.fromRotation=function(T,v){return T[0]=v[0],T[1]=v[1],T[2]=v[2],T[3]=v[3],T[4]=0,T[5]=0,T[6]=0,T[7]=0,T},Qt.fromMat4=function(T,v){var w=i.create();o.getRotation(w,v);var A=new e.ARRAY_TYPE(3);return o.getTranslation(A,v),h(T,w,A),T},Qt.copy=_,Qt.identity=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=1,T[4]=0,T[5]=0,T[6]=0,T[7]=0,T},Qt.set=function(T,v,w,A,C,D,F,V,z){return T[0]=v,T[1]=w,T[2]=A,T[3]=C,T[4]=D,T[5]=F,T[6]=V,T[7]=z,T},Qt.getDual=function(T,v){return T[0]=v[4],T[1]=v[5],T[2]=v[6],T[3]=v[7],T},Qt.setDual=function(T,v){return T[4]=v[0],T[5]=v[1],T[6]=v[2],T[7]=v[3],T},Qt.getTranslation=function(T,v){var w=v[4],A=v[5],C=v[6],D=v[7],F=-v[0],V=-v[1],z=-v[2],j=v[3];return T[0]=2*(w*j+D*F+A*z-C*V),T[1]=2*(A*j+D*V+C*F-w*z),T[2]=2*(C*j+D*z+w*V-A*F),T},Qt.translate=function(T,v,w){var A=v[0],C=v[1],D=v[2],F=v[3],V=.5*w[0],z=.5*w[1],j=.5*w[2],G=v[4],Y=v[5],te=v[6],re=v[7];return T[0]=A,T[1]=C,T[2]=D,T[3]=F,T[4]=F*V+C*j-D*z+G,T[5]=F*z+D*V-A*j+Y,T[6]=F*j+A*z-C*V+te,T[7]=-A*V-C*z-D*j+re,T},Qt.rotateX=function(T,v,w){var A=-v[0],C=-v[1],D=-v[2],F=v[3],V=v[4],z=v[5],j=v[6],G=v[7],Y=V*F+G*A+z*D-j*C,te=z*F+G*C+j*A-V*D,re=j*F+G*D+V*C-z*A,Q=G*F-V*A-z*C-j*D;return i.rotateX(T,v,w),T[4]=Y*(F=T[3])+Q*(A=T[0])+te*(D=T[2])-re*(C=T[1]),T[5]=te*F+Q*C+re*A-Y*D,T[6]=re*F+Q*D+Y*C-te*A,T[7]=Q*F-Y*A-te*C-re*D,T},Qt.rotateY=function(T,v,w){var A=-v[0],C=-v[1],D=-v[2],F=v[3],V=v[4],z=v[5],j=v[6],G=v[7],Y=V*F+G*A+z*D-j*C,te=z*F+G*C+j*A-V*D,re=j*F+G*D+V*C-z*A,Q=G*F-V*A-z*C-j*D;return i.rotateY(T,v,w),T[4]=Y*(F=T[3])+Q*(A=T[0])+te*(D=T[2])-re*(C=T[1]),T[5]=te*F+Q*C+re*A-Y*D,T[6]=re*F+Q*D+Y*C-te*A,T[7]=Q*F-Y*A-te*C-re*D,T},Qt.rotateZ=function(T,v,w){var A=-v[0],C=-v[1],D=-v[2],F=v[3],V=v[4],z=v[5],j=v[6],G=v[7],Y=V*F+G*A+z*D-j*C,te=z*F+G*C+j*A-V*D,re=j*F+G*D+V*C-z*A,Q=G*F-V*A-z*C-j*D;return i.rotateZ(T,v,w),T[4]=Y*(F=T[3])+Q*(A=T[0])+te*(D=T[2])-re*(C=T[1]),T[5]=te*F+Q*C+re*A-Y*D,T[6]=re*F+Q*D+Y*C-te*A,T[7]=Q*F-Y*A-te*C-re*D,T},Qt.rotateByQuatAppend=function(T,v,w){var A=w[0],C=w[1],D=w[2],F=w[3],V=v[0],z=v[1],j=v[2],G=v[3];return T[0]=V*F+G*A+z*D-j*C,T[1]=z*F+G*C+j*A-V*D,T[2]=j*F+G*D+V*C-z*A,T[3]=G*F-V*A-z*C-j*D,T[4]=(V=v[4])*F+(G=v[7])*A+(z=v[5])*D-(j=v[6])*C,T[5]=z*F+G*C+j*A-V*D,T[6]=j*F+G*D+V*C-z*A,T[7]=G*F-V*A-z*C-j*D,T},Qt.rotateByQuatPrepend=function(T,v,w){var A=v[0],C=v[1],D=v[2],F=v[3],V=w[0],z=w[1],j=w[2],G=w[3];return T[0]=A*G+F*V+C*j-D*z,T[1]=C*G+F*z+D*V-A*j,T[2]=D*G+F*j+A*z-C*V,T[3]=F*G-A*V-C*z-D*j,T[4]=A*(G=w[7])+F*(V=w[4])+C*(j=w[6])-D*(z=w[5]),T[5]=C*G+F*z+D*V-A*j,T[6]=D*G+F*j+A*z-C*V,T[7]=F*G-A*V-C*z-D*j,T},Qt.rotateAroundAxis=function(T,v,w,A){if(Math.abs(A)<e.EPSILON)return _(T,v);var C=Math.hypot(w[0],w[1],w[2]);A*=.5;var D=Math.sin(A),F=D*w[0]/C,V=D*w[1]/C,z=D*w[2]/C,j=Math.cos(A),G=v[0],Y=v[1],te=v[2],re=v[3];T[0]=G*j+re*F+Y*z-te*V,T[1]=Y*j+re*V+te*F-G*z,T[2]=te*j+re*z+G*V-Y*F,T[3]=re*j-G*F-Y*V-te*z;var Q=v[4],ue=v[5],se=v[6],de=v[7];return T[4]=Q*j+de*F+ue*z-se*V,T[5]=ue*j+de*V+se*F-Q*z,T[6]=se*j+de*z+Q*V-ue*F,T[7]=de*j-Q*F-ue*V-se*z,T},Qt.add=function(T,v,w){return T[0]=v[0]+w[0],T[1]=v[1]+w[1],T[2]=v[2]+w[2],T[3]=v[3]+w[3],T[4]=v[4]+w[4],T[5]=v[5]+w[5],T[6]=v[6]+w[6],T[7]=v[7]+w[7],T},Qt.multiply=b,Qt.scale=function(T,v,w){return T[0]=v[0]*w,T[1]=v[1]*w,T[2]=v[2]*w,T[3]=v[3]*w,T[4]=v[4]*w,T[5]=v[5]*w,T[6]=v[6]*w,T[7]=v[7]*w,T},Qt.lerp=function(T,v,w,A){var C=1-A;return E(v,w)<0&&(A=-A),T[0]=v[0]*C+w[0]*A,T[1]=v[1]*C+w[1]*A,T[2]=v[2]*C+w[2]*A,T[3]=v[3]*C+w[3]*A,T[4]=v[4]*C+w[4]*A,T[5]=v[5]*C+w[5]*A,T[6]=v[6]*C+w[6]*A,T[7]=v[7]*C+w[7]*A,T},Qt.invert=function(T,v){var w=x(v);return T[0]=-v[0]/w,T[1]=-v[1]/w,T[2]=-v[2]/w,T[3]=v[3]/w,T[4]=-v[4]/w,T[5]=-v[5]/w,T[6]=-v[6]/w,T[7]=v[7]/w,T},Qt.conjugate=function(T,v){return T[0]=-v[0],T[1]=-v[1],T[2]=-v[2],T[3]=v[3],T[4]=-v[4],T[5]=-v[5],T[6]=-v[6],T[7]=v[7],T},Qt.normalize=function(T,v){var w=x(v);if(w>0){w=Math.sqrt(w);var A=v[0]/w,C=v[1]/w,D=v[2]/w,F=v[3]/w,V=v[4],z=v[5],j=v[6],G=v[7],Y=A*V+C*z+D*j+F*G;T[0]=A,T[1]=C,T[2]=D,T[3]=F,T[4]=(V-A*Y)/w,T[5]=(z-C*Y)/w,T[6]=(j-D*Y)/w,T[7]=(G-F*Y)/w}return T},Qt.str=function(T){return"quat2("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+", "+T[4]+", "+T[5]+", "+T[6]+", "+T[7]+")"},Qt.exactEquals=function(T,v){return T[0]===v[0]&&T[1]===v[1]&&T[2]===v[2]&&T[3]===v[3]&&T[4]===v[4]&&T[5]===v[5]&&T[6]===v[6]&&T[7]===v[7]},Qt.equals=function(T,v){var w=T[0],A=T[1],C=T[2],D=T[3],F=T[4],V=T[5],z=T[6],j=T[7],G=v[0],Y=v[1],te=v[2],re=v[3],Q=v[4],ue=v[5],se=v[6],de=v[7];return Math.abs(w-G)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(G))&&Math.abs(A-Y)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Y))&&Math.abs(C-te)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(te))&&Math.abs(D-re)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(re))&&Math.abs(F-Q)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(Q))&&Math.abs(V-ue)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ue))&&Math.abs(z-se)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(se))&&Math.abs(j-de)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(de))},Qt.sqrLen=Qt.squaredLength=Qt.len=Qt.length=Qt.dot=Qt.mul=Qt.setReal=Qt.getReal=void 0;var e=a(qe()),i=a(Vi()),o=a(lr());function u(T){if(typeof WeakMap!="function")return null;var v=new WeakMap,w=new WeakMap;return(u=function(A){return A?w:v})(T)}function a(T,v){if(T&&T.__esModule)return T;if(T===null||n(T)!=="object"&&typeof T!="function")return{default:T};var w=u(v);if(w&&w.has(T))return w.get(T);var A={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var D in T)if(D!=="default"&&Object.prototype.hasOwnProperty.call(T,D)){var F=C?Object.getOwnPropertyDescriptor(T,D):null;F&&(F.get||F.set)?Object.defineProperty(A,D,F):A[D]=T[D]}return A.default=T,w&&w.set(T,A),A}function h(T,v,w){var A=.5*w[0],C=.5*w[1],D=.5*w[2],F=v[0],V=v[1],z=v[2],j=v[3];return T[0]=F,T[1]=V,T[2]=z,T[3]=j,T[4]=A*j+C*z-D*V,T[5]=C*j+D*F-A*z,T[6]=D*j+A*V-C*F,T[7]=-A*F-C*V-D*z,T}function _(T,v){return T[0]=v[0],T[1]=v[1],T[2]=v[2],T[3]=v[3],T[4]=v[4],T[5]=v[5],T[6]=v[6],T[7]=v[7],T}function b(T,v,w){var A=v[0],C=v[1],D=v[2],F=v[3],V=w[4],z=w[5],j=w[6],G=w[7],Y=v[4],te=v[5],re=v[6],Q=v[7],ue=w[0],se=w[1],de=w[2],we=w[3];return T[0]=A*we+F*ue+C*de-D*se,T[1]=C*we+F*se+D*ue-A*de,T[2]=D*we+F*de+A*se-C*ue,T[3]=F*we-A*ue-C*se-D*de,T[4]=A*G+F*V+C*j-D*z+Y*we+Q*ue+te*de-re*se,T[5]=C*G+F*z+D*V-A*j+te*we+Q*se+re*ue-Y*de,T[6]=D*G+F*j+A*z-C*V+re*we+Q*de+Y*se-te*ue,T[7]=F*G-A*V-C*z-D*j+Q*we-Y*ue-te*se-re*de,T}Qt.getReal=i.copy,Qt.setReal=i.copy,Qt.mul=b;var E=i.dot;Qt.dot=E;var p=i.length;Qt.length=p,Qt.len=p;var x=i.squaredLength;return Qt.squaredLength=x,Qt.sqrLen=x,Qt}var Xr,Gn,Jt={};function Is(){if(Xr)return Jt;function n(v){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},n(v)}Xr=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=o,Jt.clone=function(v){var w=new e.ARRAY_TYPE(2);return w[0]=v[0],w[1]=v[1],w},Jt.fromValues=function(v,w){var A=new e.ARRAY_TYPE(2);return A[0]=v,A[1]=w,A},Jt.copy=function(v,w){return v[0]=w[0],v[1]=w[1],v},Jt.set=function(v,w,A){return v[0]=w,v[1]=A,v},Jt.add=function(v,w,A){return v[0]=w[0]+A[0],v[1]=w[1]+A[1],v},Jt.subtract=u,Jt.multiply=a,Jt.divide=h,Jt.ceil=function(v,w){return v[0]=Math.ceil(w[0]),v[1]=Math.ceil(w[1]),v},Jt.floor=function(v,w){return v[0]=Math.floor(w[0]),v[1]=Math.floor(w[1]),v},Jt.min=function(v,w,A){return v[0]=Math.min(w[0],A[0]),v[1]=Math.min(w[1],A[1]),v},Jt.max=function(v,w,A){return v[0]=Math.max(w[0],A[0]),v[1]=Math.max(w[1],A[1]),v},Jt.round=function(v,w){return v[0]=Math.round(w[0]),v[1]=Math.round(w[1]),v},Jt.scale=function(v,w,A){return v[0]=w[0]*A,v[1]=w[1]*A,v},Jt.scaleAndAdd=function(v,w,A,C){return v[0]=w[0]+A[0]*C,v[1]=w[1]+A[1]*C,v},Jt.distance=_,Jt.squaredDistance=b,Jt.length=E,Jt.squaredLength=p,Jt.negate=function(v,w){return v[0]=-w[0],v[1]=-w[1],v},Jt.inverse=function(v,w){return v[0]=1/w[0],v[1]=1/w[1],v},Jt.normalize=function(v,w){var A=w[0],C=w[1],D=A*A+C*C;return D>0&&(D=1/Math.sqrt(D)),v[0]=w[0]*D,v[1]=w[1]*D,v},Jt.dot=function(v,w){return v[0]*w[0]+v[1]*w[1]},Jt.cross=function(v,w,A){var C=w[0]*A[1]-w[1]*A[0];return v[0]=v[1]=0,v[2]=C,v},Jt.lerp=function(v,w,A,C){var D=w[0],F=w[1];return v[0]=D+C*(A[0]-D),v[1]=F+C*(A[1]-F),v},Jt.random=function(v,w){w=w||1;var A=2*e.RANDOM()*Math.PI;return v[0]=Math.cos(A)*w,v[1]=Math.sin(A)*w,v},Jt.transformMat2=function(v,w,A){var C=w[0],D=w[1];return v[0]=A[0]*C+A[2]*D,v[1]=A[1]*C+A[3]*D,v},Jt.transformMat2d=function(v,w,A){var C=w[0],D=w[1];return v[0]=A[0]*C+A[2]*D+A[4],v[1]=A[1]*C+A[3]*D+A[5],v},Jt.transformMat3=function(v,w,A){var C=w[0],D=w[1];return v[0]=A[0]*C+A[3]*D+A[6],v[1]=A[1]*C+A[4]*D+A[7],v},Jt.transformMat4=function(v,w,A){var C=w[0],D=w[1];return v[0]=A[0]*C+A[4]*D+A[12],v[1]=A[1]*C+A[5]*D+A[13],v},Jt.rotate=function(v,w,A,C){var D=w[0]-A[0],F=w[1]-A[1],V=Math.sin(C),z=Math.cos(C);return v[0]=D*z-F*V+A[0],v[1]=D*V+F*z+A[1],v},Jt.angle=function(v,w){var A=v[0],C=v[1],D=w[0],F=w[1],V=Math.sqrt(A*A+C*C)*Math.sqrt(D*D+F*F);return Math.acos(Math.min(Math.max(V&&(A*D+C*F)/V,-1),1))},Jt.zero=function(v){return v[0]=0,v[1]=0,v},Jt.str=function(v){return"vec2("+v[0]+", "+v[1]+")"},Jt.exactEquals=function(v,w){return v[0]===w[0]&&v[1]===w[1]},Jt.equals=function(v,w){var A=v[0],C=v[1],D=w[0],F=w[1];return Math.abs(A-D)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(D))&&Math.abs(C-F)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(F))},Jt.forEach=Jt.sqrLen=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=Jt.len=void 0;var e=function(v,w){if(v&&v.__esModule)return v;if(v===null||n(v)!=="object"&&typeof v!="function")return{default:v};var A=i(void 0);if(A&&A.has(v))return A.get(v);var C={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in v)if(F!=="default"&&Object.prototype.hasOwnProperty.call(v,F)){var V=D?Object.getOwnPropertyDescriptor(v,F):null;V&&(V.get||V.set)?Object.defineProperty(C,F,V):C[F]=v[F]}return C.default=v,A&&A.set(v,C),C}(qe());function i(v){if(typeof WeakMap!="function")return null;var w=new WeakMap,A=new WeakMap;return(i=function(C){return C?A:w})(v)}function o(){var v=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(v[0]=0,v[1]=0),v}function u(v,w,A){return v[0]=w[0]-A[0],v[1]=w[1]-A[1],v}function a(v,w,A){return v[0]=w[0]*A[0],v[1]=w[1]*A[1],v}function h(v,w,A){return v[0]=w[0]/A[0],v[1]=w[1]/A[1],v}function _(v,w){return Math.hypot(w[0]-v[0],w[1]-v[1])}function b(v,w){var A=w[0]-v[0],C=w[1]-v[1];return A*A+C*C}function E(v){return Math.hypot(v[0],v[1])}function p(v){var w=v[0],A=v[1];return w*w+A*A}Jt.len=E,Jt.sub=u,Jt.mul=a,Jt.div=h,Jt.dist=_,Jt.sqrDist=b,Jt.sqrLen=p;var x,T=(x=o(),function(v,w,A,C,D,F){var V,z;for(w||(w=2),A||(A=0),z=C?Math.min(C*w+A,v.length):v.length,V=A;V<z;V+=w)x[0]=v[V],x[1]=v[V+1],D(x,x,F),v[V]=x[0],v[V+1]=x[1];return v});return Jt.forEach=T,Jt}function Pr(){if(Gn)return me;function n(v){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},n(v)}Gn=1,Object.defineProperty(me,"__esModule",{value:!0}),me.vec4=me.vec3=me.vec2=me.quat2=me.quat=me.mat4=me.mat3=me.mat2d=me.mat2=me.glMatrix=void 0;var e=T(qe());me.glMatrix=e;var i=T(ct());me.mat2=i;var o=T(zt());me.mat2d=o;var u=T(yi());me.mat3=u;var a=T(lr());me.mat4=a;var h=T(Vi());me.quat=h;var _=T(on());me.quat2=_;var b=T(Is());me.vec2=b;var E=T(sn());me.vec3=E;var p=T(Li());function x(v){if(typeof WeakMap!="function")return null;var w=new WeakMap,A=new WeakMap;return(x=function(C){return C?A:w})(v)}function T(v,w){if(v&&v.__esModule)return v;if(v===null||n(v)!=="object"&&typeof v!="function")return{default:v};var A=x(w);if(A&&A.has(v))return A.get(v);var C={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in v)if(F!=="default"&&Object.prototype.hasOwnProperty.call(v,F)){var V=D?Object.getOwnPropertyDescriptor(v,F):null;V&&(V.get||V.set)?Object.defineProperty(C,F,V):C[F]=v[F]}return C.default=v,A&&A.set(v,C),C}return me.vec4=p,me}var ht,Wt,jt,ni,ge=Pr(),nr=function(){if(Wt)return ht;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return Wt=1,ht=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var a=this.sampleCurveX(o)-e;if(Math.abs(a)<i)return o;var h=this.sampleCurveDerivativeX(o);if(Math.abs(h)<1e-6)break;o-=a/h}var _=0,b=1;for(o=e,u=0;u<20&&(a=this.sampleCurveX(o),!(Math.abs(a-e)<i));u++)e>a?_=o:b=o,o=.5*(b-_)+_;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ht}(),Ae=ce(nr);function ze(){if(ni)return jt;function n(e,i){this.x=e,this.y=i}return ni=1,jt=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),u=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=u,this},_rotateAround:function(e,i){var o=Math.cos(e),u=Math.sin(e),a=i.y+u*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-u*(this.y-i.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},jt}var Se=ce(ze());function wt(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!wt(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!wt(n[i],e[i]))return!1;return!0}return n===e}const lt=Math.PI/180,Et=180/Math.PI;function dt(n){return n*lt}function Pt(n){return n*Et}const Dt=[[0,0],[1,0],[1,1],[0,1]];function It(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function hi(n,e,i,o){const u=new Ae(n,e,i,o);return function(a){return u.solve(a)}}const $t=hi(.25,.1,.25,1);function gt(n,e,i){return Math.min(i,Math.max(e,n))}function vi(n,e,i){return(i=gt((i-n)/(e-n),0,1))*i*(3-2*i)}function Di(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function rr(n,e,i){if(!n.length)return i(null,[]);let o=n.length;const u=new Array(n.length);let a=null;n.forEach((h,_)=>{e(h,(b,E)=>{b&&(a=b),u[_]=E,--o==0&&i(a,u)})})}function Mi(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let yr=1;function Vr(){return yr++}function cn(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Yr(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function xn(n,e){return n.indexOf(e,n.length-e.length)!==-1}function Cs(n,e,i){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function Kr(n,e,i){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function Or(n){return Array.isArray(n)?n.map(Or):typeof n=="object"&&n?Cs(n,Or):n}const uo={};function zi(n){uo[n]||(typeof console<"u"&&console.warn(n),uo[n]=!0)}function Ps(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function gc(n){let e=0;for(let i,o,u=0,a=n.length,h=a-1;u<a;h=u++)i=n[u],o=n[h],e+=(o.x-i.x)*(i.y+o.y);return e}function qn([n,e,i]){const o=dt(e+90),u=dt(i);return{x:n*Math.cos(o)*Math.sin(u),y:n*Math.sin(o)*Math.sin(u),z:n*Math.cos(u),azimuthal:e,polar:i}}function Oo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ml(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,u,a)=>{const h=u||a;return e[o]=!h||h.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let sa,_l=null;function Bo(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Ve(n,e,i,o){for(;e<i;){const u=e+i>>1;n[u]<o?e=u+1:i=u}return e}function X(n,e,i,o){for(;e<i;){const u=e+i>>1;n[u]<=o?e=u+1:i=u}return e}function J(n){return n>0?1/(1.001-n):1+n}function le(n){return n>0?1-1/(1.001-n):-n}const ve={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(sa==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{sa=M.API_URL_REGEX!=null?new RegExp(M.API_URL_REGEX):n}catch{sa=n}}return sa},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ve.API_URL)return null;try{const n=new URL(ve.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ye(n){return ve.API_URL_REGEX.test(n)}function Ce(n){return ve.API_SPRITE_REGEX.test(n)}let Fe,De,Ne,We,$e,nt;function vt(){return Fe==null&&(Fe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Fe}const bt={now:()=>We!==void 0?We:performance.now(),setNow(n){We=n},restoreNow(){We=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:o}=n;$e||($e=document.createElement("canvas"));const u=$e.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>$e.width||o>$e.height)&&($e.width=i,$e.height=o),u.clearRect(-e,-e,i+2*e,o+2*e),u.drawImage(n,0,0,i,o),u.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:n=>(De||(De=document.createElement("a")),De.href=n,De.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ne==null&&(Ne=window.matchMedia("(prefers-reduced-motion: reduce)")),Ne.matches)},hasCanvasFingerprintNoise(){if(nt!==void 0)return nt;if(!vt())return nt=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<n.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const o=e.getImageData(0,0,n.width,n.height);i=0;for(let u=0;u<o.data.length;++u)if(u%4!=3&&i++!==o.data[u])return nt=!0,!0;return nt=!1,!1}};function ii(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(n.slice(i));for(const u in e)o.set(u,e[u]);return`${n.slice(0,i)}?${o.toString()}`}function si(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const o=new URLSearchParams,u=new URLSearchParams(n.slice(i));for(const h of e.persistentParams){const _=u.get(h);_&&o.set(h,_)}const a=o.toString();return`${n.slice(0,i)}${a.length>0?`?${a}`:""}`}const ai="mapbox-tiles";let oi=500,Gi=50;const Yi=["language","worldview","jobid"];let di,Wi;function _r(){try{return caches}catch{}}function Ur(){const n=_r();n&&di==null&&(di=n.open(ai))}let $r=1/0;const an={supported:!1,testSupport:function(n){!yc&&qs&&(gl?xc(n):ds=n)}};let ds,qs,yc=!1,gl=!1;const oa=typeof self<"u"?self:{};function xc(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,qs),n.isContextLost())return;an.supported=!0}catch{}n.deleteTexture(e),yc=!0}oa.document&&(qs=oa.document.createElement("img"),qs.onload=function(){ds&&xc(ds),ds=null,gl=!0},qs.onerror=function(){yc=!0,ds=null},qs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const aa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(aa);class Xu extends Error{constructor(e,i,o){i===401&&ye(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Yu=Oo()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,yl=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Yu())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,u){const a=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Yu(),referrerPolicy:o.referrerPolicy,signal:a.signal});let _=!1,b=!1;const E=(p=h.url).indexOf("sku=")>0&&ye(p);var p;o.type==="json"&&h.headers.set("Accept","application/json");const x=(v,w,A)=>{if(b)return;if(v&&v.message!=="SecurityError"&&zi(v.toString()),w&&A)return T(w);const C=Date.now();fetch(h).then(D=>{if(D.ok){const F=E?D.clone():null;return T(D,F,C)}return u(new Xu(D.statusText,D.status,o.url))}).catch(D=>{D.name!=="AbortError"&&u(new Error(`${D.message} ${o.url}`))})},T=(v,w,A)=>{(o.type==="arrayBuffer"?v.arrayBuffer():o.type==="json"?v.json():v.text()).then(C=>{b||(w&&A&&function(D,F,V){if(Ur(),di==null)return;const z=ml(F.headers.get("Cache-Control")||"");if(z["no-store"])return;const j={status:F.status,statusText:F.statusText,headers:new Headers};F.headers.forEach((te,re)=>j.headers.set(re,te)),z["max-age"]&&j.headers.set("Expires",new Date(V+1e3*z["max-age"]).toUTCString());const G=j.headers.get("Expires");if(!G||new Date(G).getTime()-V<42e4)return;let Y=si(D.url,{persistentParams:Yi});if(F.status===206){const te=D.headers.get("Range");if(!te)return;j.status=200,Y=ii(Y,{range:te})}(function(te,re){if(Wi===void 0)try{new Response(new ReadableStream),Wi=!0}catch{Wi=!1}Wi?re(te.body):te.blob().then(re)})(F,te=>{const re=new Response((Q=F.status)!==200&&Q!==404&&[101,103,204,205,304].includes(Q)?null:te,j);var Q;Ur(),di!=null&&di.then(ue=>ue.put(Y,re)).catch(ue=>zi(ue.message))})}(h,w,A),_=!0,u(null,C,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(C=>{b||u(new Error(C.message))})};return E?function(v,w){if(Ur(),di==null)return w(null);di.then(A=>{let C=si(v.url,{persistentParams:Yi});const D=v.headers.get("Range");D&&(C=ii(C,{range:D})),A.match(C).then(F=>{const V=function(z){if(!z)return!1;const j=new Date(z.headers.get("Expires")||0),G=ml(z.headers.get("Cache-Control")||"");return j>Date.now()&&!G["no-cache"]}(F);A.delete(C),V&&A.put(C,F.clone()),w(null,F,V)}).catch(w)}).catch(w)}(h,x):x(null,null),{cancel:()=>{b=!0,_||a.abort()}}}(n,e);if(Oo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(o,u){const a=new XMLHttpRequest;a.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(a.responseType="arraybuffer");for(const h in o.headers)a.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(a.responseType="text",a.setRequestHeader("Accept","application/json")),a.withCredentials=o.credentials==="include",a.onerror=()=>{u(new Error(a.statusText))},a.onload=()=>{if((a.status>=200&&a.status<300||a.status===0)&&a.response!==null){let h=a.response;if(o.type==="json")try{h=JSON.parse(a.response)}catch(_){return u(_)}u(null,h,a.getResponseHeader("Cache-Control"),a.getResponseHeader("Expires"))}else u(new Xu(a.statusText,a.status,o.url))},a.send(o.body),{cancel:()=>a.abort()}}(n,e)},la=function(n,e){return yl(Mi(n,{type:"arrayBuffer"}),e)};function is(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const fs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ps,Pn;ps=[],Pn=0;const Rs=function(n,e){if(an.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Pn>=ve.MAX_PARALLEL_IMAGE_REQUESTS){const a={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ps.push(a),a}Pn++;let i=!1;const o=()=>{if(!i)for(i=!0,Pn--;ps.length&&Pn<ve.MAX_PARALLEL_IMAGE_REQUESTS;){const a=ps.shift(),{requestParameters:h,callback:_,cancelled:b}=a;b||(a.cancel=Rs(h,_).cancel)}},u=la(n,(a,h,_,b)=>{o(),a?e(a):h&&(self.createImageBitmap?function(E,p){const x=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(x).then(T=>{p(null,T)}).catch(T=>{p(new Error(`Could not load image because of ${T.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(E,p)=>e(E,p,_,b)):function(E,p){const x=new Image;x.onload=()=>{p(null,x),URL.revokeObjectURL(x.src),x.onload=null,requestAnimationFrame(()=>{x.src=fs})},x.onerror=()=>p(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const T=new Blob([new Uint8Array(E)],{type:"image/png"});x.src=E.byteLength?URL.createObjectURL(T):fs}(h,(E,p)=>e(E,p,_,b)))});return{cancel:()=>{u.cancel(),o()}}};var xl,Ku,Ju,Ls={exports:{}},vc={exports:{}},nf={exports:{}},Dm=function(){if(Ju)return Ls.exports;Ju=1;var n=(xl||(xl=1,vc.exports=function(i,o){var u,a,h,_,b,E,p,x;for(a=i.length-(u=3&i.length),h=o,b=3432918353,E=461845907,x=0;x<a;)p=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,h=27492+(65535&(_=5*(65535&(h=(h^=p=(65535&(p=(p=(65535&p)*b+(((p>>>16)*b&65535)<<16)&4294967295)<<15|p>>>17))*E+(((p>>>16)*E&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(p=0,u){case 3:p^=(255&i.charCodeAt(x+2))<<16;case 2:p^=(255&i.charCodeAt(x+1))<<8;case 1:h^=p=(65535&(p=(p=(65535&(p^=255&i.charCodeAt(x)))*b+(((p>>>16)*b&65535)<<16)&4294967295)<<15|p>>>17))*E+(((p>>>16)*E&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}),vc.exports),e=(Ku||(Ku=1,nf.exports=function(i,o){for(var u,a=i.length,h=o^a,_=0;a>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(u>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),a-=4,++_;switch(a){case 3:h^=(255&i.charCodeAt(_+2))<<16;case 2:h^=(255&i.charCodeAt(_+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(_)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}),nf.exports);return Ls.exports=n,Ls.exports.murmur3=n,Ls.exports.murmur2=e,Ls.exports}(),Rn=ce(Dm);class ho{constructor(e,...i){Mi(this,i[0]||{}),this.type=e}}class vl extends ho{constructor(e,i={}){super("error",Mi({error:e},i))}}function ca(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Qu(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class ua{on(e,i){return this._listeners=this._listeners||{},ca(e,i,this._listeners),this}off(e,i){return Qu(e,i,this._listeners),Qu(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},ca(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){const o=typeof e=="string"?new ho(e,i):e,u=o.type;if(this.listens(u)){o.target=this;const a=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of a)b.call(this,o);const h=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of h)Qu(u,b,this._oneTimeListeners),b.call(this,o);const _=this._eventedParent;_&&(Mi(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(o))}else o instanceof vl&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var eh,ki={},th=function(){if(eh)return ki;eh=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(a){return(a=Math.round(a))<0?0:a>255?255:a}function i(a){return e(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function o(a){return(h=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:h>1?1:h;var h}function u(a,h,_){return _<0?_+=1:_>1&&(_-=1),6*_<1?a+(h-a)*_*6:2*_<1?h:3*_<2?a+(h-a)*(2/3-_)*6:a}try{ki.parseCSSColor=function(a){var h,_=a.replace(/ /g,"").toLowerCase();if(_ in n)return n[_].slice();if(_[0]==="#")return _.length===4?(h=parseInt(_.substr(1),16))>=0&&h<=4095?[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,1]:null:_.length===7&&(h=parseInt(_.substr(1),16))>=0&&h<=16777215?[(16711680&h)>>16,(65280&h)>>8,255&h,1]:null;var b=_.indexOf("("),E=_.indexOf(")");if(b!==-1&&E+1===_.length){var p=_.substr(0,b),x=_.substr(b+1,E-(b+1)).split(","),T=1;switch(p){case"rgba":if(x.length!==4)return null;T=o(x.pop());case"rgb":return x.length!==3?null:[i(x[0]),i(x[1]),i(x[2]),T];case"hsla":if(x.length!==4)return null;T=o(x.pop());case"hsl":if(x.length!==3)return null;var v=(parseFloat(x[0])%360+360)%360/360,w=o(x[1]),A=o(x[2]),C=A<=.5?A*(w+1):A+w-A*w,D=2*A-C;return[e(255*u(D,C,v+1/3)),e(255*u(D,C,v)),e(255*u(D,C,v-1/3)),T];default:return null}}return null}}catch{}return ki}();class qi{constructor(e,i,o,u=1){this.r=e,this.g=i,this.b=o,this.a=u}static parse(e){if(!e)return;if(e instanceof qi)return e;if(typeof e!="string")return;const i=th.parseCSSColor(e);return i?new qi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,o,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${u})`}toRenderColor(e){const{r:i,g:o,b:u,a}=this;return new zm(e,i,o,u,a)}}class zm{constructor(e,i,o,u,a){if(e){const h=e.image.height,_=h*h;i=a===0?0:i/a*(h-1),o=a===0?0:o/a*(h-1),u=a===0?0:u/a*(h-1);const b=Math.floor(i),E=Math.floor(o),p=Math.floor(u),x=Math.ceil(i),T=Math.ceil(o),v=Math.ceil(u),w=i-b,A=o-E,C=u-p,D=e.image.data,F=4*(b+E*_+p*h),V=4*(b+E*_+v*h),z=4*(b+T*_+p*h),j=4*(b+T*_+v*h),G=4*(x+E*_+p*h),Y=4*(x+E*_+v*h),te=4*(x+T*_+p*h),re=4*(x+T*_+v*h);if(F<0||re>=D.length)throw new Error("out of range");this.r=Yt(Yt(Yt(D[F],D[V],C),Yt(D[z],D[j],C),A),Yt(Yt(D[G],D[Y],C),Yt(D[te],D[re],C),A),w)/255*a,this.g=Yt(Yt(Yt(D[F+1],D[V+1],C),Yt(D[z+1],D[j+1],C),A),Yt(Yt(D[G+1],D[Y+1],C),Yt(D[te+1],D[re+1],C),A),w)/255*a,this.b=Yt(Yt(Yt(D[F+2],D[V+2],C),Yt(D[z+2],D[j+2],C),A),Yt(Yt(D[G+2],D[Y+2],C),Yt(D[te+2],D[re+2],C),A),w)/255*a,this.a=a}else this.r=i,this.g=o,this.b=u,this.a=a}toArray(){const{r:e,g:i,b:o,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*i/u,255*o/u,u]}toArray01(){const{r:e,g:i,b:o,a:u}=this;return u===0?[0,0,0,0]:[e/u,i/u,o/u,u]}toArray01Scaled(e){const{r:i,g:o,b:u,a}=this;return a===0?[0,0,0]:[i/a*e,o/a*e,u/a*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:u}=this;return[e,i,o,u]}toArray01Linear(){const{r:e,g:i,b:o,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(i/u,2.2),Math.pow(o/u,2.2),u]}}function Yt(n,e,i){return n*(1-i)+e*i}function bl(n,e,i){return n.map((o,u)=>Yt(o,e[u],i))}qi.black=new qi(0,0,0,1),qi.white=new qi(1,1,1,1),qi.transparent=new qi(0,0,0,0),qi.red=new qi(1,0,0,1),qi.blue=new qi(0,0,1,1);var Fo=Object.freeze({__proto__:null,array:bl,color:function(n,e,i){return new qi(Yt(n.r,e.r,i),Yt(n.g,e.g,i),Yt(n.b,e.b,i),Yt(n.a,e.a,i))},number:Yt});function ha(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class Ds extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class bc{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new bc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ms={kind:"null"},Ct={kind:"number"},Ai={kind:"string"},Ii={kind:"boolean"},Ln={kind:"color"},mn={kind:"object"},Ri={kind:"value"},wc={kind:"collator"},da={kind:"formatted"},fa={kind:"resolvedImage"};function vn(n,e){return{kind:"array",itemType:n,N:e}}function Mr(n){if(n.kind==="array"){const e=Mr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const sf=[ms,Ct,Ai,Ii,Ln,da,mn,vn(Ri),fa];function pa(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!pa(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of sf)if(!pa(i,e))return null}}return`Expected ${Mr(n)} but found ${Mr(e)} instead.`}function ma(n,e){return e.some(i=>i.kind===n.kind)}function zs(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}class Tc{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $n{constructor(e,i,o,u,a){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=a}}class _n{constructor(e){this.sections=e}static fromString(e){return new _n([new $n(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof _n?e:_n.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class bn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new bn({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function of(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fo(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof qi||n instanceof Tc||n instanceof _n||n instanceof bn)return!0;if(Array.isArray(n)){for(const e of n)if(!fo(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!fo(n[e]))return!1;return!0}return!1}function Br(n){if(n===null)return ms;if(typeof n=="string")return Ai;if(typeof n=="boolean")return Ii;if(typeof n=="number")return Ct;if(n instanceof qi)return Ln;if(n instanceof Tc)return wc;if(n instanceof _n)return da;if(n instanceof bn)return fa;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=Br(o);if(i){if(i===u)continue;i=Ri;break}i=u}return vn(i||Ri,e)}return mn}function wn(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof qi||n instanceof _n||n instanceof bn?n.toString():JSON.stringify(n)}class _s{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!fo(e[1]))return i.error("invalid value");const o=e[1];let u=Br(o);const a=i.expectedType;return u.kind!=="array"||u.N!==0||!a||a.kind!=="array"||typeof a.N=="number"&&a.N!==0||(u=a),new _s(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof qi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof _n?this.value.serialize():this.value}}class Jr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ih={string:Ai,number:Ct,boolean:Ii,object:mn};class gs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const a=e[0];if(a==="array"){let _,b;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in ih)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=ih[E],u++}else _=Ri;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}o=vn(_,b)}else o=ih[a];const h=[];for(;u<e.length;u++){const _=i.parse(e[u],u,Ri);if(!_)return null;h.push(_)}return new gs(o,h)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!pa(this.type,Br(o)))return o;if(i===this.args.length-1)throw new Jr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Mr(Br(o))} but was expected to be of type ${Mr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(o=>o.serialize()))}}class _a{constructor(e){this.type=da,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let a=!1;for(let h=1;h<=e.length-1;++h){const _=e[h];if(a&&typeof _=="object"&&!Array.isArray(_)){a=!1;let b=null;if(_["font-scale"]&&(b=i.parseObjectValue(_["font-scale"],h,"font-scale",Ct),!b))return null;let E=null;if(_["text-font"]&&(E=i.parseObjectValue(_["text-font"],h,"text-font",vn(Ai)),!E))return null;let p=null;if(_["text-color"]&&(p=i.parseObjectValue(_["text-color"],h,"text-color",Ln),!p))return null;const x=u[u.length-1];x.scale=b,x.font=E,x.textColor=p}else{const b=i.parse(e[h],h,Ri);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new _a(u)}evaluate(e){return new _n(this.sections.map(i=>{const o=i.content.evaluate(e);return Br(o)===fa?new $n("",o,null,null,null):new $n(wn(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class No{constructor(e,i){this.type=fa,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const o=i.parse(e[1],1,Ai);if(!o)return i.error("No image name provided.");if(e.length===2)return new No(o);const u=i.parse(e[2],1,Ai);return u?new No(o,u):i.error("Secondary image variant is not a string.")}evaluate(e){const i=bn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Vo(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const Ec={"to-boolean":Ii,"to-color":Ln,"to-number":Ct,"to-string":Ai};class $s{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],u=[];let a=ms;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);a=vn(i.expectedType.itemType,h)}else{if(!(h>0&&fo(e[1][0])))return null;a=vn(Br(e[1][0]),h)}for(let _=0;_<h;_++){const b=e[1][_];let E;if(Vo(b)==="array")E=i.parse(b,void 0,a.itemType);else{const p=Vo(b);if(p!==a.itemType.kind)return i.error(`Expected ${a.itemType.kind} but found ${p}.`);E=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!E)return null;u.push(E)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");a=Ec[o];for(let h=1;h<e.length;h++){const _=i.parse(e[h],h,Ri);if(!_)return null;u.push(_)}}return new $s(a,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof qi)return i;if(typeof i=="string"){const a=e.parseColor(i);if(a)return a}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:of(i[0],i[1],i[2],i[3]),!o))return new qi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Jr(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Jr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?_n.fromString(wn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?bn.fromString(wn(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):wn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new _a([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new No(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const km=["Unknown","Point","LineString","Polygon"];class af{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?km[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=qi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Dn{constructor(e,i,o,u,a){this.name=e,this.type=i,this._evaluate=o,this.args=u,this._overloadIndex=a}evaluate(e){if(!this._evaluate){const i=Dn.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],u=Dn.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const a=Array.isArray(u)?u[0]:u.type,h=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=[];let b=null,E=-1;for(const[p,x]of h){if(Array.isArray(p)&&p.length!==e.length-1)continue;_.push(p),E++,b=new xf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const T=[];let v=!1;for(let w=1;w<e.length;w++){const A=e[w],C=Array.isArray(p)?p[w-1]:p.type,D=b.parse(A,1+T.length,C);if(!D){v=!0;break}T.push(D)}if(!v)if(Array.isArray(p)&&p.length!==T.length)b.error(`Expected ${p.length} arguments, but found ${T.length} instead.`);else{for(let w=0;w<T.length;w++){const A=Array.isArray(p)?p[w]:p.type,C=T[w];b.concat(w+1).checkSubtype(A,C.type)}if(b.errors.length===0)return new Dn(o,a,x,T,E)}}if(_.length===1)i.errors.push(...b.errors);else{const p=(_.length?_:h.map(([T])=>T)).map(Om).join(" | "),x=[];for(let T=1;T<e.length;T++){const v=i.parse(e[T],1+x.length);if(!v)return null;x.push(Mr(v.type))}i.error(`Expected arguments of type ${p}, but found (${x.join(", ")}) instead.`)}return null}static register(e,i){Dn.definitions=i;for(const o in i)e[o]=Dn}}function Om(n){return Array.isArray(n)?`(${n.map(Mr).join(", ")})`:`(${Mr(n.type)}...)`}class Sc{constructor(e,i,o){this.type=wc,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=o["case-sensitive"]===void 0?i.parse(!1,1,Ii):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",Ii);if(!u)return null;const a=o["diacritic-sensitive"]===void 0?i.parse(!1,1,Ii):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",Ii);if(!a)return null;let h=null;return o.locale&&(h=i.parseObjectValue(o.locale,1,"locale",Ai),!h)?null:new Sc(u,a,h)}evaluate(e){return new Tc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function lf(n,e,i=0,o=n.length-1,u=ya){for(;o>i;){if(o-i>600){const b=o-i+1,E=e-i+1,p=Math.log(b),x=.5*Math.exp(2*p/3),T=.5*Math.sqrt(p*x*(b-x)/b)*(E-b/2<0?-1:1);lf(n,e,Math.max(i,Math.floor(e-E*x/b+T)),Math.min(o,Math.floor(e+(b-E)*x/b+T)),u)}const a=n[e];let h=i,_=o;for(ga(n,i,e),u(n[o],a)>0&&ga(n,i,o);h<_;){for(ga(n,h,_),h++,_--;u(n[h],a)<0;)h++;for(;u(n[_],a)>0;)_--}u(n[i],a)===0?ga(n,i,_):(_++,ga(n,_,o)),_<=e&&(i=_+1),e<=_&&(o=_-1)}}function ga(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function ya(n,e){return n<e?-1:n>e?1:0}function Bm(n){let e=0;for(let i,o,u=0,a=n.length,h=a-1;u<a;h=u++)i=n[u],o=n[h],e+=(o.x-i.x)*(i.y+o.y);return e}function wl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Uo(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Fm(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],a=n[0]-i[0],h=n[1]-i[1];return o*h-a*u==0&&o*a<=0&&u*h<=0}function xa(n,e,i=!1){let o=!1;for(let _=0,b=e.length;_<b;_++){const E=e[_];for(let p=0,x=E.length,T=x-1;p<x;T=p++){const v=E[T],w=E[p];if(Fm(n,v,w))return i;(a=v)[1]>(u=n)[1]!=(h=w)[1]>u[1]&&u[0]<(h[0]-a[0])*(u[1]-a[1])/(h[1]-a[1])+a[0]&&(o=!o)}}var u,a,h;return o}function cf(n,e,i,o){const u=o[0]-i[0],a=o[1]-i[1],h=(n[0]-i[0])*a-u*(n[1]-i[1]),_=(e[0]-i[0])*a-u*(e[1]-i[1]);return h>0&&_<0||h<0&&_>0}function Mc(n,e,i,o){return(u=[o[0]-i[0],o[1]-i[1]])[0]*(a=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*a[0]!=0&&!(!cf(n,e,i,o)||!cf(i,o,n,e));var u,a}const Zn=8192;function bi(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Zn),Math.round(o*u*Zn)]}function Vt(n,e){for(let i=0;i<e.length;i++)if(xa(n,e[i]))return!0;return!1}function rh(n,e,i){for(const o of i)for(let u=0,a=o.length,h=a-1;u<a;h=u++)if(Mc(n,e,o[h],o[u]))return!0;return!1}function li(n,e){for(let i=0;i<n.length;++i)if(!xa(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(rh(n[i],n[i+1],e))return!1;return!0}function nh(n,e){for(let i=0;i<e.length;i++)if(li(n,e[i]))return!0;return!1}function Tl(n,e,i){const o=[];for(let u=0;u<n.length;u++){const a=[];for(let h=0;h<n[u].length;h++){const _=bi(n[u][h],i);wl(e,_),a.push(_)}o.push(a)}return o}function ei(n,e,i){const o=[];for(let u=0;u<n.length;u++){const a=Tl(n[u],e,i);o.push(a)}return o}function sh(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let a=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;a===0&&(a=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=a}wl(e,n)}function Ac(n,e,i,o){const u=Math.pow(2,o.z)*Zn,a=[o.x*Zn,o.y*Zn],h=[];if(!n)return h;for(const _ of n)for(const b of _){const E=[b.x+a[0],b.y+a[1]];sh(E,e,i,u),h.push(E)}return h}function oh(n,e,i,o){const u=Math.pow(2,o.z)*Zn,a=[o.x*Zn,o.y*Zn],h=[];if(!n)return h;for(const b of n){const E=[];for(const p of b){const x=[p.x+a[0],p.y+a[1]];wl(e,x),E.push(x)}h.push(E)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const b of h)for(const E of b)sh(E,e,i,u)}var _;return h}class po{constructor(e,i){this.type=Ii,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(fo(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let u=0;u<o.features.length;++u){const a=o.features[u].geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new po(o,o.features[u].geometry)}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new po(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new po(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const u=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){const _=Tl(o.coordinates,a,h),b=Ac(i.geometry(),u,a,h);if(!Uo(u,a))return!1;for(const E of b)if(!xa(E,_))return!1}if(o.type==="MultiPolygon"){const _=ei(o.coordinates,a,h),b=Ac(i.geometry(),u,a,h);if(!Uo(u,a))return!1;for(const E of b)if(!Vt(E,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const u=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){const _=Tl(o.coordinates,a,h),b=oh(i.geometry(),u,a,h);if(!Uo(u,a))return!1;for(const E of b)if(!li(E,_))return!1}if(o.type==="MultiPolygon"){const _=ei(o.coordinates,a,h),b=oh(i.geometry(),u,a,h);if(!Uo(u,a))return!1;for(const E of b)if(!nh(E,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const jo={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},un=1/298.257223563,Ic=un*(2-un),va=Math.PI/180;class ba{static fromTile(e,i,o){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),a=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/va;return new ba(a,o)}static get units(){return jo}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!jo[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(jo).join(", ")}`);const o=6378.137*va*(i?jo[i]:1),u=Math.cos(e*va),a=1/(1-Ic*(1-u*u)),h=Math.sqrt(a);this.kx=o*h*u,this.ky=o*h*a*(1-Ic)}distance(e,i){const o=xr(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+u*u)}bearing(e,i){const o=xr(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/va}destination(e,i,o){const u=o*va;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const u=e[o];for(let a=0,h=u.length,_=h-1;a<h;_=a++)i+=xr(u[a][0]-u[_][0])*(u[a][1]+u[_][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const a=e[u],h=e[u+1],_=this.distance(a,h);if(o+=_,o>i)return Zs(a,h,(i-(o-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[u,a]=i,h=xr(o[0]-u)*this.kx,_=(o[1]-a)*this.ky;if(h!==0||_!==0){const b=(xr(e[0]-u)*this.kx*h+(e[1]-a)*this.ky*_)/(h*h+_*_);b>1?(u=o[0],a=o[1]):b>0&&(u+=h/this.kx*b,a+=_/this.ky*b)}return h=xr(e[0]-u)*this.kx,_=(e[1]-a)*this.ky,Math.sqrt(h*h+_*_)}pointOnLine(e,i){let o=1/0,u=e[0][0],a=e[0][1],h=0,_=0;for(let b=0;b<e.length-1;b++){let E=e[b][0],p=e[b][1],x=xr(e[b+1][0]-E)*this.kx,T=(e[b+1][1]-p)*this.ky,v=0;x===0&&T===0||(v=(xr(i[0]-E)*this.kx*x+(i[1]-p)*this.ky*T)/(x*x+T*T),v>1?(E=e[b+1][0],p=e[b+1][1]):v>0&&(E+=x/this.kx*v,p+=T/this.ky*v)),x=xr(i[0]-E)*this.kx,T=(i[1]-p)*this.ky;const w=x*x+T*T;w<o&&(o=w,u=E,a=p,h=b,_=v)}return{point:[u,a],index:h,t:Math.max(0,Math.min(1,_))}}lineSlice(e,i,o){let u=this.pointOnLine(o,e),a=this.pointOnLine(o,i);if(u.index>a.index||u.index===a.index&&u.t>a.t){const E=u;u=a,a=E}const h=[u.point],_=u.index+1,b=a.index;!Cc(o[_],h[0])&&_<=b&&h.push(o[_]);for(let E=_+1;E<=b;E++)h.push(o[E]);return Cc(o[b],a.point)||h.push(a.point),h}lineSliceAlong(e,i,o){let u=0;const a=[];for(let h=0;h<o.length-1;h++){const _=o[h],b=o[h+1],E=this.distance(_,b);if(u+=E,u>e&&a.length===0&&a.push(Zs(_,b,(e-(u-E))/E)),u>=i)return a.push(Zs(_,b,(i-(u-E))/E)),a;u>e&&a.push(b)}return a}bufferPoint(e,i){const o=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-o,e[0]+u,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-o,e[2]+u,e[3]+o]}insideBBox(e,i){return xr(e[0]-i[0])>=0&&xr(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Cc(n,e){return n[0]===e[0]&&n[1]===e[1]}function Zs(n,e,i){const o=xr(e[0]-n[0]);return[n[0]+o*i,n[1]+(e[1]-n[1])*i]}function xr(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class ah{constructor(e=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const a=e-1>>1,h=i[a];if(o(u,h)>=0)break;i[e]=h,e=a}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,a=i[e];for(;e<u;){let h=1+(e<<1);const _=h+1;if(_<this.length&&o(i[_],i[h])<0&&(h=_),o(i[h],a)>=0)break;i[e]=i[h],e=h}i[e]=a}}var mt=8192;function uf(n,e){return e.dist-n.dist}const wa=100,Pc=50;function Rc(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Lc(n){return n[1]-n[0]+1}function Hs(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function lh(n,e){if(n[0]>n[1])return[null,null];const i=Lc(n);if(e){if(i===2)return[n,null];const o=Math.floor(i/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}{if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}}function Hn(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Hs(e,n.length))return i;for(let o=e[0];o<=e[1];++o)wl(i,n[o]);return i}function Dc(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let o=0;o<n[i].length;++o)wl(e,n[i][o]);return e}function Ta(n,e,i){if(Rc(n)||Rc(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),i.distance([0,0],[o,u])}function hf(n){return 360*n-180}function df(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Wn(n,e){const i=Math.pow(2,e.z),o=(n.y/mt+e.y)/i;return[hf((n.x/mt+e.x)/i),df(o)]}function ff(n,e){const i=[];for(let o=0;o<n.length;++o)i.push(Wn(n[o],e));return i}function ch(n,e,i){const o=i.pointOnLine(e,n).point;return i.distance(n,o)}function uh(n,e,i,o,u){const a=i.slice(o[0],o[1]+1);let h=1/0;for(let _=e[0];_<=e[1];++_)if((h=Math.min(h,ch(n[_],a,u)))===0)return 0;return h}function zc(n,e,i,o,u){const a=Math.min(u.pointToSegmentDistance(n,i,o),u.pointToSegmentDistance(e,i,o)),h=Math.min(u.pointToSegmentDistance(i,n,e),u.pointToSegmentDistance(o,n,e));return Math.min(a,h)}function pf(n,e,i,o,u){if(!Hs(e,n.length)||!Hs(o,i.length))return NaN;let a=1/0;for(let h=e[0];h<e[1];++h)for(let _=o[0];_<o[1];++_){if(Mc(n[h],n[h+1],i[_],i[_+1]))return 0;a=Math.min(a,zc(n[h],n[h+1],i[_],i[_+1],u))}return a}function mf(n,e,i,o,u){if(!Hs(e,n.length)||!Hs(o,i.length))return NaN;let a=1/0;for(let h=e[0];h<=e[1];++h)for(let _=o[0];_<=o[1];++_)if((a=Math.min(a,u.distance(n[h],i[_])))===0)return a;return a}function _f(n,e,i){if(xa(n,e,!0))return 0;let o=1/0;for(const u of e){const a=u.length;if(a<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[a-1]&&(o=Math.min(o,i.pointToSegmentDistance(n,u[a-1],u[0])))===0||(o=Math.min(o,ch(n,u,i)))===0)return o}return o}function gf(n,e,i,o){if(!Hs(e,n.length))return NaN;for(let a=e[0];a<=e[1];++a)if(xa(n[a],i,!0))return 0;let u=1/0;for(let a=e[0];a<e[1];++a)for(const h of i)for(let _=0,b=h.length,E=b-1;_<b;E=_++){if(Mc(n[a],n[a+1],h[E],h[_]))return 0;u=Math.min(u,zc(n[a],n[a+1],h[E],h[_],o))}return u}function hh(n,e){for(const i of n)for(let o=0;o<=i.length-1;++o)if(xa(i[o],e,!0))return!0;return!1}function yf(n,e,i,o=1/0){const u=Dc(n),a=Dc(e);if(o!==1/0&&Ta(u,a,i)>=o)return o;if(Uo(u,a)){if(hh(n,e))return 0}else if(hh(e,n))return 0;let h=o;for(const _ of n)for(let b=0,E=_.length,p=E-1;b<E;p=b++)for(const x of e)for(let T=0,v=x.length,w=v-1;T<v;w=T++){if(Mc(_[p],_[b],x[w],x[T]))return 0;h=Math.min(h,zc(_[p],_[b],x[w],x[T],i))}return h}function El(n,e,i,o,u,a,h){if(a===null||h===null)return;const _=Ta(Hn(o,a),Hn(u,h),i);_<e&&n.push({dist:_,range1:a,range2:h})}function kc(n,e,i,o,u=1/0){let a=Math.min(o.distance(n[0],i[0][0]),u);if(a===0)return a;const h=new ah([{dist:0,range1:[0,n.length-1],range2:[0,0]}],uf),_=e?Pc:wa,b=Dc(i);for(;h.length;){const E=h.pop();if(E.dist>=a)continue;const p=E.range1;if(Lc(p)<=_){if(!Hs(p,n.length))return NaN;if(e){const x=gf(n,p,i,o);if((a=Math.min(a,x))===0)return a}else for(let x=p[0];x<=p[1];++x){const T=_f(n[x],i,o);if((a=Math.min(a,T))===0)return a}}else{const x=lh(p,e);if(x[0]!==null){const T=Ta(Hn(n,x[0]),b,o);T<a&&h.push({dist:T,range1:x[0],range2:[0,0]})}if(x[1]!==null){const T=Ta(Hn(n,x[1]),b,o);T<a&&h.push({dist:T,range1:x[1],range2:[0,0]})}}}return a}function Sl(n,e,i,o,u,a=1/0){let h=Math.min(a,u.distance(n[0],i[0]));if(h===0)return h;const _=new ah([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],uf),b=e?Pc:wa,E=o?Pc:wa;for(;_.length;){const p=_.pop();if(p.dist>=h)continue;const x=p.range1,T=p.range2;if(Lc(x)<=b&&Lc(T)<=E){if(!Hs(x,n.length)||!Hs(T,i.length))return NaN;if(e&&o?h=Math.min(h,pf(n,x,i,T,u)):e||o?e&&!o?h=Math.min(h,uh(i,T,n,x,u)):!e&&o&&(h=Math.min(h,uh(n,x,i,T,u))):h=Math.min(h,mf(n,x,i,T,u)),h===0)return h}else{const v=lh(x,e),w=lh(T,o);El(_,h,u,n,i,v[0],w[0]),El(_,h,u,n,i,v[0],w[1]),El(_,h,u,n,i,v[1],w[0]),El(_,h,u,n,i,v[1],w[1])}}return h}function Ea(n,e,i,o,u=1/0){let a=u;const h=Hn(n,[0,n.length-1]);for(const _ of i)if(!(a!==1/0&&Ta(h,Hn(_,[0,_.length-1]),o)>=a)&&(a=Math.min(a,Sl(n,e,_,!0,o,a)),a===0))return a;return a}function Ml(n,e,i,o,u=1/0){let a=u;const h=Hn(n,[0,n.length-1]);for(const _ of i){if(a!==1/0&&Ta(h,Dc(_),o)>=a)continue;const b=kc(n,e,_,o,a);if(isNaN(b))return b;if((a=Math.min(a,b))===0)return a}return a}function Oc(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class mo{constructor(e,i){this.type=Ct,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(fo(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let u=0;u<o.features.length;++u)if(Oc(o.features[u].geometry.type))return new mo(o,o.features[u].geometry)}else if(o.type==="Feature"){if(Oc(o.geometry.type))return new mo(o,o.geometry)}else if(Oc(o.type))return new mo(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(u,a,h){const _=[];for(const E of u)for(const p of E)_.push(Wn(p,a));const b=new ba(_[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?Sl(_,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",b):h.type==="MultiLineString"?Ea(_,!1,h.coordinates,b):h.type==="Polygon"||h.type==="MultiPolygon"?Ml(_,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,b):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(u,a,h){const _=[];for(const E of u){const p=[];for(const x of E)p.push(Wn(x,a));_.push(p)}const b=new ba(_[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Ea(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",_,b);if(h.type==="MultiLineString"){let E=1/0;for(let p=0;p<h.coordinates.length;p++){const x=Ea(h.coordinates[p],!0,_,b,E);if(isNaN(x))return x;if((E=Math.min(E,x))===0)return E}return E}if(h.type==="Polygon"||h.type==="MultiPolygon"){let E=1/0;for(let p=0;p<_.length;p++){const x=Ml(_[p],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,b,E);if(isNaN(x))return x;if((E=Math.min(E,x))===0)return E}return E}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(u,a,h){const _=[];for(const E of function(p,x){const T=p.length;if(T<=1)return[p];const v=[];let w,A;for(let C=0;C<T;C++){const D=Bm(p[C]);D!==0&&(p[C].area=Math.abs(D),A===void 0&&(A=D<0),A===D<0?(w&&v.push(w),w=[p[C]]):w.push(p[C]))}return w&&v.push(w),v}(u)){const p=[];for(let x=0;x<E.length;++x)p.push(ff(E[x],a));_.push(p)}const b=new ba(_[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Ml(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",_,b);if(h.type==="MultiLineString"){let E=1/0;for(let p=0;p<h.coordinates.length;p++){const x=Ml(h.coordinates[p],!0,_,b,E);if(isNaN(x))return x;if((E=Math.min(E,x))===0)return E}return E}return h.type==="Polygon"||h.type==="MultiPolygon"?function(E,p,x){let T=1/0;for(const v of E)for(const w of p){const A=yf(v,w,x,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}(h.type==="Polygon"?[h.coordinates]:h.coordinates,_,b):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function _o(n,e){switch(n){case"string":return wn(e);case"number":return+e;case"boolean":return!!e;case"color":return qi.parse(e);case"formatted":return _n.fromString(wn(e));case"resolvedImage":return bn.fromString(wn(e))}return e}function Ci(n,e,i,o){return o!==void 0&&(n=o*Math.round(n/o)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Sa{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Ri),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof _s))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const a=i.parse(e[2],2);return a instanceof _s?new Sa(o,wn(u.value),wn(a.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Sa(o,wn(u.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:u,value:a,values:h,minValue:_,maxValue:b,stepValue:E}=o,p=o.default.evaluate(e);let x=p;if(a){const T=e.scope;e.scope=(T||"").split("").slice(1).join(""),x=a.evaluate(e),e.scope=T}return u&&(x=_o(u,x)),x===void 0||_===void 0&&b===void 0&&E===void 0||(typeof x=="number"?x=Ci(x,_,b,E):Array.isArray(x)&&(x=x.map(T=>typeof T=="number"?Ci(T,_,b,E):T))),a!==void 0&&x!==void 0&&h&&!h.includes(x)&&(x=p,u&&(x=_o(u,x))),(u&&u!==this.type||x!==void 0&&Br(x)!==this.type)&&(x=_o(this.type.kind,x)),x}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Al(n){if(n instanceof Dn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof po||n instanceof mo)return!1;let e=!0;return n.eachChild(i=>{e&&!Al(i)&&(e=!1)}),e}function Bc(n){if(n instanceof Dn&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Bc(i)&&(e=!1)}),e}function Fc(n){if(n instanceof Sa)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...Fc(i)])}),e}function Il(n,e){if(n instanceof Dn&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(o=>{i&&!Il(o,e)&&(i=!1)}),i}class Qi{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Qi(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class dh{constructor(e,i=[],o,u=new bc,a=[],h,_){this.registry=e,this.path=i,this.key=i.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=u,this.errors=a,this.expectedType=o,this._scope=h,this.options=_}parse(e,i,o,u,a={}){return i||o?this.concat(i,null,o,u)._parse(e,a):this._parse(e,a)}parseObjectValue(e,i,o,u,a,h={}){return this.concat(i,o,u,a)._parse(e,h)}_parse(e,i){function o(u,a,h){return h==="assert"?new gs(a,[u]):h==="coerce"?new $s(a,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let a=u.parse(e,this);if(!a)return null;if(this.expectedType){const h=this.expectedType,_=a.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||_.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(h,_))return null}else a=o(a,h,i.typeAnnotation||"coerce");else a=o(a,h,i.typeAnnotation||"assert")}if(!(a instanceof _s)&&a.type.kind!=="resolvedImage"&&fh(a)){const h=new af(this._scope,this.options);try{a=new _s(a.type,a.evaluate(h))}catch(_){return this.error(_.message),null}}return a}return $s.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,u){let a=typeof e=="number"?this.path.concat(e):this.path;a=typeof i=="string"?a.concat(i):a;const h=u?this.scope.concat(u):this.scope;return new dh(this.registry,a,o||null,h,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Ds(o,e))}checkSubtype(e,i){const o=pa(e,i);return o&&this.error(o),o}}var xf=dh;function fh(n){if(n instanceof Qi)return fh(n.boundExpression);if(n instanceof Dn&&n.name==="error"||n instanceof Sc||n instanceof po||n instanceof mo||n instanceof Sa)return!1;const e=n instanceof $s||n instanceof gs;let i=!0;return n.eachChild(o=>{i=e?i&&fh(o):i&&o instanceof _s}),!!i&&Al(n)&&Il(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Nc(n,e){const i=n.length-1;let o,u,a=0,h=i,_=0;for(;a<=h;)if(_=Math.floor((a+h)/2),o=n[_],u=n[_+1],o<=e){if(_===i||e<u)return _;a=_+1}else{if(!(o>e))throw new Jr("Input is not a number.");h=_-1}return 0}class Cl{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,a]of o)this.labels.push(u),this.outputs.push(a)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Ct);if(!o)return null;const u=[];let a=null;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);for(let h=1;h<e.length;h+=2){const _=h===1?-1/0:e[h],b=e[h+1],E=h,p=h+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const x=i.parse(b,p,a);if(!x)return null;a=a||x.type,u.push([_,x])}return new Cl(a,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const a=i.length;return u>=i[a-1]?o[a-1].evaluate(e):o[Nc(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const vf=.95047,bf=1.08883,wf=4/29,Ma=6/29,Tf=3*Ma*Ma,Nm=Ma*Ma*Ma,Vm=Math.PI/180,Um=180/Math.PI;function ph(n){return n>Nm?Math.pow(n,1/3):n/Tf+wf}function mh(n){return n>Ma?n*n*n:Tf*(n-wf)}function _h(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function gh(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ef(n){const e=gh(n.r),i=gh(n.g),o=gh(n.b),u=ph((.4124564*e+.3575761*i+.1804375*o)/vf),a=ph((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*a-16,a:500*(u-a),b:200*(a-ph((.0193339*e+.119192*i+.9503041*o)/bf)),alpha:n.a}}function Sf(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*mh(e),i=vf*mh(i),o=bf*mh(o),new qi(_h(3.2404542*i-1.5371385*e-.4985314*o),_h(-.969266*i+1.8760108*e+.041556*o),_h(.0556434*i-.2040259*e+1.0572252*o),n.alpha)}function jm(n,e,i){const o=e-n;return n+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Pl={forward:Ef,reverse:Sf,interpolate:function(n,e,i){return{l:Yt(n.l,e.l,i),a:Yt(n.a,e.a,i),b:Yt(n.b,e.b,i),alpha:Yt(n.alpha,e.alpha,i)}}},Rl={forward:function(n){const{l:e,a:i,b:o}=Ef(n),u=Math.atan2(o,i)*Um;return{h:u<0?u+360:u,c:Math.sqrt(i*i+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Vm,i=n.c;return Sf({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:jm(n.h,e.h,i),c:Yt(n.c,e.c,i),l:Yt(n.l,e.l,i),alpha:Yt(n.alpha,e.alpha,i)}}};var Mf=Object.freeze({__proto__:null,hcl:Rl,lab:Pl});class Xn{constructor(e,i,o,u,a){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[h,_]of a)this.labels.push(h),this.outputs.push(_)}static interpolationFactor(e,i,o,u){let a=0;if(e.name==="exponential")a=yh(i,e.base,o,u);else if(e.name==="linear")a=yh(i,1,o,u);else if(e.name==="cubic-bezier"){const h=e.controlPoints;a=new Ae(h[0],h[1],h[2],h[3]).solve(yh(i,1,o,u))}return a}static parse(e,i){let[o,u,a,...h]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const E=u[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(E.length!==4||E.some(p=>typeof p!="number"||p<0||p>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(a=i.parse(a,2,Ct),!a)return null;const _=[];let b=null;o==="interpolate-hcl"||o==="interpolate-lab"?b=Ln:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let E=0;E<h.length;E+=2){const p=h[E],x=h[E+1],T=E+3,v=E+4;if(typeof p!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(_.length&&_[_.length-1][0]>=p)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);const w=i.parse(x,v,b);if(!w)return null;b=b||w.type,_.push([p,w])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Xn(b,o,u,a,_):i.error(`Type ${Mr(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const a=i.length;if(u>=i[a-1])return o[a-1].evaluate(e);const h=Nc(i,u),_=Xn.interpolationFactor(this.interpolation,u,i[h],i[h+1]),b=o[h].evaluate(e),E=o[h+1].evaluate(e);return this.operator==="interpolate"?Fo[this.type.kind.toLowerCase()](b,E,_):this.operator==="interpolate-hcl"?Rl.reverse(Rl.interpolate(Rl.forward(b),Rl.forward(E),_)):Pl.reverse(Pl.interpolate(Pl.forward(b),Pl.forward(E),_))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function yh(n,e,i,o){const u=o-i,a=n-i;return u===0?0:e===1?a/u:(Math.pow(e,a)-1)/(Math.pow(e,u)-1)}class Vc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const a=[];for(const _ of e.slice(1)){const b=i.parse(_,1+a.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,a.push(b)}const h=u&&a.some(_=>pa(u,_.type));return new Vc(h?Ri:o,a)}evaluate(e){let i,o=null,u=0;for(const a of this.args){if(u++,o=a.evaluate(e),o&&o instanceof bn&&!o.available&&(i||(i=o),o=null,u===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Uc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let a=1;a<e.length-1;a+=2){const h=e[a];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,a);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",a);const _=i.parse(e[a+1],a+1);if(!_)return null;o.push([h,_])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new Uc(o,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class xh{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ct),u=i.parse(e[2],2,vn(i.expectedType||Ri));return o&&u?new xh(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Jr(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Jr(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Jr(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vh{constructor(e,i){this.type=Ii,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ri),u=i.parse(e[2],2,Ri);return o&&u?ma(o.type,[Ii,Ai,Ct,ms,Ri])?new vh(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!zs(i,["boolean","string","number","null"]))throw new Jr(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(Br(i))} instead.`);if(!zs(o,["string","array"]))throw new Jr(`Expected second argument to be of type array or string, but found ${Mr(Br(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class jc{constructor(e,i,o){this.type=Ct,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ri),u=i.parse(e[2],2,Ri);if(!o||!u)return null;if(!ma(o.type,[Ii,Ai,Ct,ms,Ri]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(o.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,Ct);return a?new jc(o,u,a):null}return new jc(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!zs(i,["boolean","string","number","null"]))throw new Jr(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(Br(i))} instead.`);if(!zs(o,["string","array"]))throw new Jr(`Expected second argument to be of type array or string, but found ${Mr(Br(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return o.indexOf(i,u)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class bh{constructor(e,i,o,u,a,h){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=a,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const a={},h=[];for(let E=2;E<e.length-1;E+=2){let p=e[E];const x=e[E+1];Array.isArray(p)||(p=[p]);const T=i.concat(E);if(p.length===0)return T.error("Expected at least one branch label.");for(const w of p){if(typeof w!="number"&&typeof w!="string")return T.error("Branch labels must be numbers or strings.");if(typeof w=="number"&&Math.abs(w)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof w=="number"&&Math.floor(w)!==w)return T.error("Numeric branch labels must be integer values.");if(o){if(T.checkSubtype(o,Br(w)))return null}else o=Br(w);if(a[String(w)]!==void 0)return T.error("Branch labels must be unique.");a[String(w)]=h.length}const v=i.parse(x,E,u);if(!v)return null;u=u||v.type,h.push(v)}const _=i.parse(e[1],1,Ri);if(!_)return null;const b=i.parse(e[e.length-1],e.length-1,u);return b?_.type.kind!=="value"&&i.concat(1).checkSubtype(o,_.type)?null:new bh(o,u,_,a,h,b):null}evaluate(e){const i=this.input.evaluate(e);return(Br(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],u={};for(const h of i){const _=u[this.cases[h]];_===void 0?(u[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[_][1].push(h)}const a=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,_]of o)e.push(_.length===1?a(_[0]):_.map(a)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class Ll{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let h=1;h<e.length-1;h+=2){const _=i.parse(e[h],h,Ii);if(!_)return null;const b=i.parse(e[h+1],h+1,o);if(!b)return null;u.push([_,b]),o=o||b.type}const a=i.parse(e[e.length-1],e.length-1,o);return a?new Ll(o,u,a):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Gc{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ri),u=i.parse(e[2],2,Ct);if(!o||!u)return null;if(!ma(o.type,[vn(Ri),Ai,Ri]))return i.error(`Expected first argument to be of type array or string, but found ${Mr(o.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,Ct);return a?new Gc(o.type,o,u,a):null}return new Gc(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!zs(i,["string","array"]))throw new Jr(`Expected first argument to be of type array or string, but found ${Mr(Br(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(o,u)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function wh(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Af(n,e,i,o){return o.compare(e,i)===0}function Aa(n,e,i){const o=n!=="=="&&n!=="!=";return class Ww{constructor(a,h,_){this.type=Ii,this.lhs=a,this.rhs=h,this.collator=_,this.hasUntypedArgument=a.type.kind==="value"||h.type.kind==="value"}static parse(a,h){if(a.length!==3&&a.length!==4)return h.error("Expected two or three arguments.");const _=a[0];let b=h.parse(a[1],1,Ri);if(!b)return null;if(!wh(_,b.type))return h.concat(1).error(`"${_}" comparisons are not supported for type '${Mr(b.type)}'.`);let E=h.parse(a[2],2,Ri);if(!E)return null;if(!wh(_,E.type))return h.concat(2).error(`"${_}" comparisons are not supported for type '${Mr(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return h.error(`Cannot compare types '${Mr(b.type)}' and '${Mr(E.type)}'.`);o&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new gs(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new gs(b.type,[E])));let p=null;if(a.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(p=h.parse(a[3],3,wc),!p)return null}return new Ww(b,E,p)}evaluate(a){const h=this.lhs.evaluate(a),_=this.rhs.evaluate(a);if(o&&this.hasUntypedArgument){const b=Br(h),E=Br(_);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new Jr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=Br(h),E=Br(_);if(b.kind!=="string"||E.kind!=="string")return e(a,h,_)}return this.collator?i(a,h,_,this.collator.evaluate(a)):e(a,h,_)}eachChild(a){a(this.lhs),a(this.rhs),this.collator&&a(this.collator)}outputDefined(){return!0}serialize(){const a=[n];return this.eachChild(h=>{a.push(h.serialize())}),a}}}const Gm=Aa("==",function(n,e,i){return e===i},Af),If=Aa("!=",function(n,e,i){return e!==i},function(n,e,i,o){return!Af(0,e,i,o)}),Cf=Aa("<",function(n,e,i){return e<i},function(n,e,i,o){return o.compare(e,i)<0}),Ia=Aa(">",function(n,e,i){return e>i},function(n,e,i,o){return o.compare(e,i)>0}),Pf=Aa("<=",function(n,e,i){return e<=i},function(n,e,i,o){return o.compare(e,i)<=0}),Rf=Aa(">=",function(n,e,i){return e>=i},function(n,e,i,o){return o.compare(e,i)>=0});class Th{constructor(e,i,o,u,a,h){this.type=Ai,this.number=e,this.locale=i,this.currency=o,this.unit=u,this.minFractionDigits=a,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Ct);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let a=null;if(u.locale&&(a=i.parseObjectValue(u.locale,2,"locale",Ai),!a))return null;let h=null;if(u.currency&&(h=i.parseObjectValue(u.currency,2,"currency",Ai),!h))return null;let _=null;if(u.unit&&(_=i.parseObjectValue(u.unit,2,"unit",Ai),!_))return null;let b=null;if(u["min-fraction-digits"]&&(b=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Ct),!b))return null;let E=null;return u["max-fraction-digits"]&&(E=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Ct),!E)?null:new Th(o,a,h,_,b,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Dl{constructor(e){this.type=Ct,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Mr(o.type)} instead.`):new Dl(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Jr(`Expected value to be of type string or array, but found ${Mr(Br(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function qc(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ca={"==":Gm,"!=":If,">":Ia,"<":Cf,">=":Rf,"<=":Pf,array:gs,at:xh,boolean:gs,case:Ll,coalesce:Vc,collator:Sc,format:_a,image:No,in:vh,"index-of":jc,interpolate:Xn,"interpolate-hcl":Xn,"interpolate-lab":Xn,length:Dl,let:Uc,literal:_s,match:bh,number:gs,"number-format":Th,object:gs,slice:Gc,step:Cl,string:gs,"to-boolean":$s,"to-color":$s,"to-number":$s,"to-string":$s,var:Qi,within:po,distance:mo,config:Sa};function Lf(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const a=u?u.evaluate(n):1,h=of(e,i,o,a);if(h)throw new Jr(h);return new qi(e/255*a,i/255*a,o/255*a,a)}function Eh(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const a=u?u.evaluate(n):1,h=function(E,p,x,T){return typeof E=="number"&&E>=0&&E<=360?typeof p=="number"&&p>=0&&p<=100&&typeof x=="number"&&x>=0&&x<=100?T===void 0||typeof T=="number"&&T>=0&&T<=1?null:`Invalid hsla value [${[E,p,x,T].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof T=="number"?[E,p,x,T]:[E,p,x]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof T=="number"?[E,p,x,T]:[E,p,x]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,a);if(h)throw new Jr(h);const _=`hsla(${e}, ${i}%, ${o}%, ${a})`,b=qi.parse(_);if(!b)throw new Jr(`Failed to parse HSLA color: ${_}`);return b}function Sh(n,e){return n in e}function Mh(n,e){const i=e[n];return i===void 0?null:i}function Go(n){return{type:n}}function Df(n){return{result:"success",value:n}}function go(n){return{result:"error",value:n}}function Ah(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function $c(n){return n["property-type"]==="data-driven"}function Ih(n){return Ah(n.expression,"measure-light")}function zf(n){return Ah(n.expression,"zoom")}function Ch(n){return!!n.expression&&n.expression.interpolated}function Zc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function kf(n){return n}function Of(n,e){const i=e.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",u=o||!(o||n.property!==void 0),a=n.type||(Ch(e)?"exponential":"interval");if(i&&((n=ha({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],qi.parse(E[1])])),n.default=qi.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Mf[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let h,_,b;if(a==="exponential")h=Ff;else if(a==="interval")h=Bf;else if(a==="categorical"){h=qm,_=Object.create(null);for(const E of n.stops)_[E[0]]=E[1];b=typeof n.stops[0][0]}else{if(a!=="identity")throw new Error(`Unknown function type "${a}"`);h=$m}if(o){const E={},p=[];for(let v=0;v<n.stops.length;v++){const w=n.stops[v],A=w[0].zoom;E[A]===void 0&&(E[A]={zoom:A,type:n.type,property:n.property,default:n.default,stops:[]},p.push(A)),E[A].stops.push([w[0].value,w[1]])}const x=[];for(const v of p)x.push([E[v].zoom,Of(E[v],e)]);const T={name:"linear"};return{kind:"composite",interpolationType:T,interpolationFactor:Xn.interpolationFactor.bind(void 0,T),zoomStops:x.map(v=>v[0]),evaluate:({zoom:v},w)=>Ff({stops:x,base:n.base},e,v).evaluate(v,w)}}if(u){const E=a==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Xn.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(p=>p[0]),evaluate:({zoom:p})=>h(n,e,p,_,b)}}return{kind:"source",evaluate(E,p){const x=p&&p.properties?p.properties[n.property]:void 0;return x===void 0?zl(n.default,e.default):h(n,e,x,_,b)}}}function zl(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function qm(n,e,i,o,u){return zl(typeof i===u?o[i]:void 0,n.default,e.default)}function Bf(n,e,i){if(Vo(i)!=="number")return zl(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=Nc(n.stops.map(a=>a[0]),i);return n.stops[u][1]}function Ff(n,e,i){const o=n.base!==void 0?n.base:1;if(Vo(i)!=="number")return zl(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const a=Nc(n.stops.map(p=>p[0]),i),h=function(p,x,T,v){const w=v-T,A=p-T;return w===0?0:x===1?A/w:(Math.pow(x,A)-1)/(Math.pow(x,w)-1)}(i,o,n.stops[a][0],n.stops[a+1][0]),_=n.stops[a][1],b=n.stops[a+1][1];let E=Fo[e.type]||kf;if(n.colorSpace&&n.colorSpace!=="rgb"){const p=Mf[n.colorSpace];E=(x,T)=>p.reverse(p.interpolate(p.forward(x),p.forward(T),h))}return typeof _.evaluate=="function"?{evaluate(...p){const x=_.evaluate.apply(void 0,p),T=b.evaluate.apply(void 0,p);if(x!==void 0&&T!==void 0)return E(x,T,h)}}:E(_,b,h)}function $m(n,e,i){return e.type==="color"?i=qi.parse(i):e.type==="formatted"?i=_n.fromString(i.toString()):e.type==="resolvedImage"?i=bn.fromString(i.toString()):Vo(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),zl(i,n.default,e.default)}Dn.register(Ca,{error:[{kind:"error"},[Ai],(n,[e])=>{throw new Jr(e.evaluate(n))}],typeof:[Ai,[Ri],(n,[e])=>Mr(Br(e.evaluate(n)))],"to-rgba":[vn(Ct,4),[Ln],(n,[e])=>e.evaluate(n).toRenderColor(null).toArray()],rgb:[Ln,[Ct,Ct,Ct],Lf],rgba:[Ln,[Ct,Ct,Ct,Ct],Lf],hsl:[Ln,[Ct,Ct,Ct],Eh],hsla:[Ln,[Ct,Ct,Ct,Ct],Eh],has:{type:Ii,overloads:[[[Ai],(n,[e])=>Sh(e.evaluate(n),n.properties())],[[Ai,mn],(n,[e,i])=>Sh(e.evaluate(n),i.evaluate(n))]]},get:{type:Ri,overloads:[[[Ai],(n,[e])=>Mh(e.evaluate(n),n.properties())],[[Ai,mn],(n,[e,i])=>Mh(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Ri,[Ai],(n,[e])=>Mh(e.evaluate(n),n.featureState||{})],properties:[mn,[],n=>n.properties()],"geometry-type":[Ai,[],n=>n.geometryType()],id:[Ri,[],n=>n.id()],zoom:[Ct,[],n=>n.globals.zoom],pitch:[Ct,[],n=>n.globals.pitch||0],"distance-from-center":[Ct,[],n=>n.distanceFromCenter()],"measure-light":[Ct,[Ai],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Ct,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ct,[],n=>n.globals.lineProgress||0],"raster-value":[Ct,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Ct,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ct,[],n=>n.globals.skyRadialProgress||0],accumulated:[Ri,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ct,Go(Ct),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[Ct,Go(Ct),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:Ct,overloads:[[[Ct,Ct],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Ct],(n,[e])=>-e.evaluate(n)]]},"/":[Ct,[Ct,Ct],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Ct,[Ct,Ct],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Ct,[],()=>Math.LN2],pi:[Ct,[],()=>Math.PI],e:[Ct,[],()=>Math.E],"^":[Ct,[Ct,Ct],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Ct,[Ct],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Ct,[Ct],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Ct,[Ct],(n,[e])=>Math.log(e.evaluate(n))],log2:[Ct,[Ct],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Ct,[Ct],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Ct,[Ct],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Ct,[Ct],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Ct,[Ct],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Ct,[Ct],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Ct,[Ct],(n,[e])=>Math.atan(e.evaluate(n))],min:[Ct,Go(Ct),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Ct,Go(Ct),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Ct,[Ct],(n,[e])=>Math.abs(e.evaluate(n))],round:[Ct,[Ct],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ct,[Ct],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Ct,[Ct],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Ii,[Ai,Ri],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Ii,[Ri],(n,[e])=>n.id()===e.value],"filter-type-==":[Ii,[Ai],(n,[e])=>n.geometryType()===e.value],"filter-<":[Ii,[Ai,Ri],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Ii,[Ri],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Ii,[Ai,Ri],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Ii,[Ri],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Ii,[Ai,Ri],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Ii,[Ri],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Ii,[Ai,Ri],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Ii,[Ri],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Ii,[Ri],(n,[e])=>e.value in n.properties()],"filter-has-id":[Ii,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ii,[vn(Ai)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ii,[vn(Ri)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Ii,[Ai,vn(Ri)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Ii,[Ai,vn(Ri)],(n,[e,i])=>function(o,u,a,h){for(;a<=h;){const _=a+h>>1;if(u[_]===o)return!0;u[_]>o?h=_-1:a=_+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ii,overloads:[[[Ii,Ii],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Go(Ii),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Ii,overloads:[[[Ii,Ii],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Go(Ii),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Ii,[Ii],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Ii,[Ai],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Ai,[Ai],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Ai,[Ai],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Ai,Go(Ri),(n,e)=>e.map(i=>wn(i.evaluate(n))).join("")],"resolved-locale":[Ai,[wc],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Ct,[Ct,Ct,Ri],(n,e)=>{const[i,o,u]=e.map(h=>h.evaluate(n));if(i>o||i===o)return i;let a;if(typeof u=="string")a=function(h){let _=0;if(h.length===0)return _;for(let b=0;b<h.length;b++)_=(_<<5)-_+h.charCodeAt(b),_|=0;return _}(u);else{if(typeof u!="number")throw new Jr(`Invalid seed input: ${u}`);a=u}return i+qc(a)()*(o-i)}]});class Hc{constructor(e,i,o,u){this.expression=e,this._warningHistory={},this._evaluator=new af(o,u),this._defaultValue=i?function(a){return a.type==="color"&&(Zc(a.default)||Array.isArray(a.default))?new qi(0,0,0,0):a.type==="color"?qi.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,u,a,h,_,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,a,h,_,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=b||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Jr(`Expected value to be one of ${Object.keys(this._enumValues).map(p=>JSON.stringify(p)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function Wc(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ca}function kl(n,e,i,o){const u=new xf(Ca,[],e?function(h){const _={color:Ln,string:Ai,number:Ct,enum:Ai,boolean:Ii,formatted:da,resolvedImage:fa};return h.type==="array"?vn(_[h.value]||Ri,h.length):_[h.type]}(e):void 0,void 0,void 0,i,o),a=u.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Df(new Hc(a,e,i,o)):go(u.errors)}class Ph{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!Bc(i.expression),this.configDependencies=Fc(i.expression)}evaluateWithoutErrorHandling(e,i,o,u,a,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,a,h)}evaluate(e,i,o,u,a,h){return this._styleExpression.evaluate(e,i,o,u,a,h)}}class ks{constructor(e,i,o,u,a){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Bc(i.expression),this.isLightConstant=a,this.configDependencies=Fc(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,o,u,a,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,a,h)}evaluate(e,i,o,u,a,h){return this._styleExpression.evaluate(e,i,o,u,a,h)}interpolationFactor(e,i,o){return this.interpolationType?Xn.interpolationFactor(this.interpolationType,e,i,o):0}}function Nf(n,e,i,o){if((n=kl(n,e,i,o)).result==="error")return n;const u=n.value.expression,a=Al(u);if(!a&&!$c(e))return go([new Ds("","data expressions not supported")]);const h=Il(u,["zoom","pitch","distance-from-center"]);if(!h&&!zf(e))return go([new Ds("","zoom expressions not supported")]);const _=Il(u,["measure-light"]);if(!_&&!Ih(e))return go([new Ds("","measure-light expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,E=Yc(u);return E||h||b?E instanceof Ds?go([E]):E instanceof Xn&&!Ch(e)?go([new Ds("",'"interpolate" expressions cannot be used with this property')]):Df(E?new ks(a?"camera":"composite",n.value,E.labels,E instanceof Xn?E.interpolation:void 0,_):new Ph(a?"constant":"source",n.value,_)):go([new Ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xc{constructor(e,i){this._parameters=e,this._specification=i,ha(this,Of(this._parameters,this._specification))}static deserialize(e){return new Xc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yc(n){let e=null;if(n instanceof Uc)e=Yc(n.result);else if(n instanceof Vc){for(const i of n.args)if(e=Yc(i),e)break}else(n instanceof Cl||n instanceof Xn)&&n.input instanceof Dn&&n.input.name==="zoom"&&(e=n);return e instanceof Ds||n.eachChild(i=>{const o=Yc(i);o instanceof Ds?e=o:e&&o&&e!==o&&(e=new Ds("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Kc,Rh,Vf=function(){if(Rh)return Kc;Rh=1,Kc=e;var n=3;function e(i,o,u){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(o=h[1])+2*(u=h[2]);for(var _=0;_<this.d*this.d;_++){var b=h[n+_],E=h[n+_+1];a.push(b===E?null:h.subarray(b,E))}var p=h[n+a.length+1];this.keys=h.subarray(h[n+a.length],p),this.bboxes=h.subarray(p),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var x=0;x<this.d*this.d;x++)a.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=u,this.scale=o/i,this.uid=0;var T=u/o*i;this.min=-T,this.max=i+T}return e.prototype.insert=function(i,o,u,a,h){this._forEachCell(o,u,a,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,u,a,h,_){this.cells[h].push(_)},e.prototype.query=function(i,o,u,a,h){var _=this.min,b=this.max;if(i<=_&&o<=_&&b<=u&&b<=a&&!h)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(i,o,u,a,this._queryCell,E,{},h),E},e.prototype._queryCell=function(i,o,u,a,h,_,b,E){var p=this.cells[h];if(p!==null)for(var x=this.keys,T=this.bboxes,v=0;v<p.length;v++){var w=p[v];if(b[w]===void 0){var A=4*w;(E?E(T[A+0],T[A+1],T[A+2],T[A+3]):i<=T[A+2]&&o<=T[A+3]&&u>=T[A+0]&&a>=T[A+1])?(b[w]=!0,_.push(x[w])):b[w]=!1}}},e.prototype._forEachCell=function(i,o,u,a,h,_,b,E){for(var p=this._convertToCellCoord(i),x=this._convertToCellCoord(o),T=this._convertToCellCoord(u),v=this._convertToCellCoord(a),w=p;w<=T;w++)for(var A=x;A<=v;A++){var C=this.d*A+w;if((!E||E(this._convertFromCellCoord(w),this._convertFromCellCoord(A),this._convertFromCellCoord(w+1),this._convertFromCellCoord(A+1)))&&h.call(this,i,o,u,a,C,_,b,E))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=n+this.cells.length+1+1,u=0,a=0;a<this.cells.length;a++)u+=this.cells[a].length;var h=new Int32Array(o+u+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var _=o,b=0;b<i.length;b++){var E=i[b];h[n+b]=_,h.set(E,_),_+=E.length}return h[n+i.length]=_,h.set(this.keys,_),h[n+i.length+1]=_+=this.keys.length,h.set(this.bboxes,_),_+=this.bboxes.length,h.buffer},Kc}(),qo=ce(Vf);const Pa={};function At(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Pa[e]={klass:n,omit:i.omit||[]}}At(Object,"Object"),qo.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},qo.deserialize=function(n){return new qo(n.buffer)},Object.defineProperty(qo,"name",{value:"Grid"}),At(qo,"Grid"),At(qi,"Color"),At(Error,"Error"),At(_n,"Formatted"),At($n,"FormattedSection"),At(Xu,"AJAXError"),At(bn,"ResolvedImage"),At(Xc,"StylePropertyFunction"),At(Hc,"StyleExpression",{omit:["_evaluator"]}),At(ks,"ZoomDependentExpression"),At(Ph,"ZoomConstantExpression"),At(Dn,"CompoundExpression",{omit:["_evaluate"]});for(const n in Ca)Pa[Ca[n]._classRegistryKey]||At(Ca[n],`Expression${n}`);function Lh(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Uf(n){return self.ImageBitmap&&n instanceof ImageBitmap}function zn(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Lh(n)||Uf(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.add(i.buffer),i}if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const o of n)i.push(zn(o,e));return i}if(n instanceof Map){const i={$name:"Map"};for(const[o,u]of n.entries())i[o]=zn(u);return i}if(n instanceof Set){const i={$name:"Set"};let o=0;for(const u of n.values())i[++o]=zn(u);return i}if(typeof n=="object"){const i=n.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const a in n)n.hasOwnProperty(a)&&(Pa[o].omit.indexOf(a)>=0||(u[a]=zn(n[a],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof n)}function $o(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Lh(n)||Uf(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map($o);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const u=new Map;for(const a of Object.keys(n))a!=="$name"&&u.set(a,$o(n[a]));return u}if(e==="Set"){const u=new Set;for(const a of Object.keys(n))a!=="$name"&&u.add($o(n[a]));return u}const{klass:i}=Pa[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n))u!=="$name"&&(o[u]=$o(n[u]));return o}throw new Error("can't deserialize object of type "+typeof n)}const Ot={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Jc(n){for(const e of n)if(eu(e.charCodeAt(0)))return!0;return!1}function Zm(n){for(const e of n)if(!Qc(e.charCodeAt(0)))return!1;return!0}function Qc(n){return!(Ot.Arabic(n)||Ot["Arabic Supplement"](n)||Ot["Arabic Extended-A"](n)||Ot["Arabic Presentation Forms-A"](n)||Ot["Arabic Presentation Forms-B"](n))}function eu(n){return!(n!==746&&n!==747&&(n<4352||!(Ot["Bopomofo Extended"](n)||Ot.Bopomofo(n)||Ot["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ot["CJK Compatibility Ideographs"](n)||Ot["CJK Compatibility"](n)||Ot["CJK Radicals Supplement"](n)||Ot["CJK Strokes"](n)||!(!Ot["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ot["CJK Unified Ideographs Extension A"](n)||Ot["CJK Unified Ideographs"](n)||Ot["Enclosed CJK Letters and Months"](n)||Ot["Hangul Compatibility Jamo"](n)||Ot["Hangul Jamo Extended-A"](n)||Ot["Hangul Jamo Extended-B"](n)||Ot["Hangul Jamo"](n)||Ot["Hangul Syllables"](n)||Ot.Hiragana(n)||Ot["Ideographic Description Characters"](n)||Ot.Kanbun(n)||Ot["Kangxi Radicals"](n)||Ot["Katakana Phonetic Extensions"](n)||Ot.Katakana(n)&&n!==12540||!(!Ot["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ot["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ot["Unified Canadian Aboriginal Syllabics"](n)||Ot["Unified Canadian Aboriginal Syllabics Extended"](n)||Ot["Vertical Forms"](n)||Ot["Yijing Hexagram Symbols"](n)||Ot["Yi Syllables"](n)||Ot["Yi Radicals"](n))))}function Ol(n){return!(eu(n)||function(e){return!!(Ot["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ot["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ot["Letterlike Symbols"](e)||Ot["Number Forms"](e)||Ot["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ot["Control Pictures"](e)&&e!==9251||Ot["Optical Character Recognition"](e)||Ot["Enclosed Alphanumerics"](e)||Ot["Geometric Shapes"](e)||Ot["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ot["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ot["CJK Symbols and Punctuation"](e)||Ot.Katakana(e)||Ot["Private Use Area"](e)||Ot["CJK Compatibility Forms"](e)||Ot["Small Form Variants"](e)||Ot["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Dh(n){return n>=1424&&n<=2303||Ot["Arabic Presentation Forms-A"](n)||Ot["Arabic Presentation Forms-B"](n)}function Hm(n,e){return!(!e&&Dh(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ot.Khmer(n))}function Wm(n){for(const e of n)if(Dh(e.charCodeAt(0)))return!0;return!1}const Bl="deferred",Fl="loading",tu="loaded";let Ra=null,tn="unavailable",yo=null;const jf=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(tn="error"),Ra&&Ra(n)};function zh(){kh.fire(new ho("pluginStateChange",{pluginStatus:tn,pluginURL:yo}))}const kh=new ua,Oh=function(){return tn},Bh=function(){if(tn!==Bl||!yo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");tn=Fl,zh(),yo&&la({url:yo},n=>{n?jf(n):(tn=tu,zh())})},kn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>tn===tu||kn.applyArabicShaping!=null,isLoading:()=>tn===Fl,setState(n){tn=n.pluginStatus,yo=n.pluginURL},isParsed:()=>kn.applyArabicShaping!=null&&kn.processBidirectionalText!=null&&kn.processStyledBidirectionalText!=null,getPluginURL:()=>yo};class br{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const u of i)if(!Hm(u.charCodeAt(0),o))return!1;return!0}(e,kn.isLoaded())}}class iu{constructor(e,i,o,u){this.property=e,this.value=i,this.expression=function(a,h,_,b){if(Zc(a))return new Xc(a,h);if(Wc(a)||Array.isArray(a)&&a.length>0){const E=Nf(a,h,_,b);if(E.result==="error")throw new Error(E.value.map(p=>`${p.key}: ${p.message}`).join(", "));return E.value}{let E=a;return typeof a=="string"&&h.type==="color"&&(E=qi.parse(a)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(i===void 0?e.specification.default:i,e.specification,o,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Fh{constructor(e,i,o){this.property=e,this.value=new iu(e,void 0,i,o)}transitioned(e,i){return new qf(this.property,this.value,i,Mi({},e.transition,this.transition),e.now)}untransitioned(){return new qf(this.property,this.value,null,{},0)}}class Gf{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Or(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Fh(this._values[e].property,this._scope,this._options)),this._values[e].value=new iu(this._values[e].property,i===null?void 0:Or(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const u in e){const a=e[u];if(xn(u,"-transition")){const h=u.slice(0,-11);o[h]&&this.setTransition(h,a)}else o.hasOwnProperty(u)&&this.setValue(u,a)}}getTransition(e){return Or(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Fh(this._values[e].property)),this._values[e].transition=Or(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const o=new $f(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new $f(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class qf{constructor(e,i,o,u,a){const h=u.delay||0,_=u.duration||0;a=a||0,this.property=e,this.value=i,this.begin=a+h,this.end=this.begin+_,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,a=this.value.possiblyEvaluate(e,i,o),h=this.prior;if(h){if(u>this.end)return this.prior=null,a;if(this.value.isDataDriven())return this.prior=null,a;if(u<this.begin)return h.possiblyEvaluate(e,i,o);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,o),a,It(_))}}return a}}class $f{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new Da(this._properties);for(const a of Object.keys(this._values))u._values[a]=this._values[a].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xm{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Or(this._values[e].value)}setValue(e,i){this._values[e]=new iu(this._values[e].property,i===null?void 0:Or(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new Da(this._properties);for(const a of Object.keys(this._values))u._values[a]=this._values[a].possiblyEvaluate(e,i,o);return u}}class La{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class Da{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ut{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const u=Fo[this.specification.type];return u?u(e,i,o):e}}class Bt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new La(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new La(this,{kind:"constant",value:void 0},e.parameters);const u=Fo[this.specification.type];return u?new La(this,{kind:"constant",value:u(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,u,a,h){return e.kind==="constant"?e.value:e.evaluate(i,o,u,a,h)}}class ys{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class pr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new br(0,{});for(const o in e){const u=e[o];u.specification.overridable&&this.overridableProperties.push(o);const a=this.defaultPropertyValues[o]=new iu(u,void 0),h=this.defaultTransitionablePropertyValues[o]=new Fh(u);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=a.possiblyEvaluate(i)}}}At(Bt,"DataDrivenProperty"),At(ut,"DataConstantProperty"),At(ys,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Nl(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function ru(n){if(Array.isArray(n))return n.map(ru);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=ru(n[i]);return e}return Nl(n)}function Nh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Nh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xs(n,e="",i=null,o="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Nh(n)||(n=nu(n));const u=n;let a=!0;try{a=function(x){if(!za(x))return x;let T=ru(x);return Zo(T),T=Vh(T),T}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}const h=Oe[`filter_${o}`],_=kl(a,h,e,i);let b=null;if(_.result==="error")throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));b=(x,T,v)=>_.value.evaluate(x,T,{},v);let E=null,p=null;if(a!==u){const x=kl(u,h,e,i);if(x.result==="error")throw new Error(x.value.map(T=>`${T.key}: ${T.message}`).join(", "));E=(T,v,w,A,C)=>x.value.evaluate(T,v,{},w,void 0,void 0,A,C),p=!Al(x.value.expression)}return{filter:b,dynamicFilter:E||void 0,needGeometry:Zf(a),needFeature:!!p}}function Vh(n){if(!Array.isArray(n))return n;const e=function(i){if(Ym.has(i[0])){for(let o=1;o<i.length;o++)if(za(i[o]))return!0}return i}(n);return e===!0?e:e.map(i=>Vh(i))}function Zo(n){let e=!1;const i=[];if(n[0]==="case"){for(let o=1;o<n.length-1;o+=2)e=e||za(n[o]),i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||za(n[1]);for(let o=2;o<n.length-1;o+=2)i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||za(n[1]);for(let o=1;o<n.length-1;o+=2)i.push(n[o+1])}e&&(n.length=0,n.push("any",...i));for(let o=1;o<n.length;o++)Zo(n[o])}function za(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(za(n[i]))return!0;return!1}const Ym=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Km(n,e){return n<e?-1:n>e?1:0}function Zf(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Zf(n[e]))return!0;return!1}function nu(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?su(n[1],n[2],"=="):e==="!="?Ul(su(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?su(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(nu))):e==="all"?["all"].concat(n.slice(1).map(nu)):e==="none"?["all"].concat(n.slice(1).map(nu).map(Ul)):e==="in"?ou(n[1],n.slice(2)):e==="!in"?Ul(ou(n[1],n.slice(2))):e==="has"?Vl(n[1]):e!=="!has"||Ul(Vl(n[1]));var i}function su(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function ou(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Km)]]:["filter-in-small",n,["literal",e]]}}function Vl(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ul(n){return["!",n]}const ka="";function Hf(n,e){return e?`${n}${ka}${e}`:n}const vs="-transition",Jm=new Set(["fill","line","background","hillshade","raster"]);class gn extends ua{constructor(e,i,o,u,a){if(super(),this.id=e.id,this.fqid=Hf(this.id,o),this.type=e.type,this.scope=o,this.lut=u,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Xm(i.layout,this.scope,a),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint)){this._transitionablePaint=new Gf(i.paint,this.scope,a);for(const h in e.paint)this.setPaintProperty(h,e.paint[h]);for(const h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Da(i.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Jm.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return xn(e,vs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,u=o._properties.properties;if(xn(e,vs)){const x=e.slice(0,-11);return u[x]&&o.setTransition(x,i||void 0),!1}if(!u[e])return!1;const a=o._values[e],h=a.value.isDataDriven(),_=a.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=o._values[e].value,E=b.isDataDriven(),p=xn(e,"pattern")||e==="line-dasharray";return E||h||p||this._handleOverridablePaintPropertyUpdate(e,_,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Kr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof La&&$c(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=xs(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,u,a,h,_,b,E){}queryIntersectsMatchingFeature(e,i,o,u){}}const Qm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jl{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Oi(n,e=1){let i=0,o=0;return{members:n.map(u=>{const a=Qm[u.type].BYTES_PER_ELEMENT,h=i=Wf(i,Math.max(e,a)),_=u.components||1;return o=Math.max(o,a),i+=a*_,{name:u.name,type:u.type,components:_,offset:h}}),size:Wf(i,Math.max(o,e)),alignment:e}}function Wf(n,e){return Math.ceil(n/e)*e}class xo extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}xo.prototype.bytesPerElement=4,At(xo,"StructArrayLayout2i4");class au extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const a=3*e;return this.int16[a+0]=i,this.int16[a+1]=o,this.int16[a+2]=u,e}}au.prototype.bytesPerElement=6,At(au,"StructArrayLayout3i6");class vo extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,u)}emplace(e,i,o,u,a){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=u,this.int16[h+3]=a,e}}vo.prototype.bytesPerElement=8,At(vo,"StructArrayLayout4i8");class lu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,u,a)}emplace(e,i,o,u,a,h){const _=5*e;return this.int16[_+0]=i,this.int16[_+1]=o,this.int16[_+2]=u,this.int16[_+3]=a,this.int16[_+4]=h,e}}lu.prototype.bytesPerElement=10,At(lu,"StructArrayLayout5i10");class Uh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,u,a,h,_)}emplace(e,i,o,u,a,h,_,b){const E=6*e,p=12*e,x=3*e;return this.int16[E+0]=i,this.int16[E+1]=o,this.uint8[p+4]=u,this.uint8[p+5]=a,this.uint8[p+6]=h,this.uint8[p+7]=_,this.float32[x+2]=b,e}}Uh.prototype.bytesPerElement=12,At(Uh,"StructArrayLayout2i4ub1f12");class Ws extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,u)}emplace(e,i,o,u,a){const h=4*e;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=u,this.float32[h+3]=a,e}}Ws.prototype.bytesPerElement=16,At(Ws,"StructArrayLayout4f16");class bo extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const a=3*e;return this.float32[a+0]=i,this.float32[a+1]=o,this.float32[a+2]=u,e}}bo.prototype.bytesPerElement=12,At(bo,"StructArrayLayout3f12");class Xs extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,u,a)}emplace(e,i,o,u,a,h){const _=6*e,b=3*e;return this.uint16[_+0]=i,this.uint16[_+1]=o,this.uint16[_+2]=u,this.uint16[_+3]=a,this.float32[b+2]=h,e}}Xs.prototype.bytesPerElement=12,At(Xs,"StructArrayLayout4ui1f12");class Ho extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,u)}emplace(e,i,o,u,a){const h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=u,this.uint16[h+3]=a,e}}Ho.prototype.bytesPerElement=8,At(Ho,"StructArrayLayout4ui8");class cu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,u,a,h)}emplace(e,i,o,u,a,h,_){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=a,this.int16[b+4]=h,this.int16[b+5]=_,e}}cu.prototype.bytesPerElement=12,At(cu,"StructArrayLayout6i12");class jh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_,b,E,p,x,T){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,u,a,h,_,b,E,p,x,T)}emplace(e,i,o,u,a,h,_,b,E,p,x,T,v){const w=12*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=a,this.uint16[w+4]=h,this.uint16[w+5]=_,this.uint16[w+6]=b,this.uint16[w+7]=E,this.int16[w+8]=p,this.int16[w+9]=x,this.int16[w+10]=T,this.int16[w+11]=v,e}}jh.prototype.bytesPerElement=24,At(jh,"StructArrayLayout4i4ui4i24");class Gh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,u,a,h)}emplace(e,i,o,u,a,h,_){const b=10*e,E=5*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=u,this.float32[E+2]=a,this.float32[E+3]=h,this.float32[E+4]=_,e}}Gh.prototype.bytesPerElement=20,At(Gh,"StructArrayLayout3i3f20");class qh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}qh.prototype.bytesPerElement=4,At(qh,"StructArrayLayout1ul4");class wo extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}wo.prototype.bytesPerElement=4,At(wo,"StructArrayLayout2ui4");class Oa extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_,b,E,p,x,T,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,u,a,h,_,b,E,p,x,T,v)}emplace(e,i,o,u,a,h,_,b,E,p,x,T,v,w){const A=20*e,C=10*e;return this.int16[A+0]=i,this.int16[A+1]=o,this.int16[A+2]=u,this.int16[A+3]=a,this.int16[A+4]=h,this.float32[C+3]=_,this.float32[C+4]=b,this.float32[C+5]=E,this.float32[C+6]=p,this.int16[A+14]=x,this.uint32[C+8]=T,this.uint16[A+18]=v,this.uint16[A+19]=w,e}}Oa.prototype.bytesPerElement=40,At(Oa,"StructArrayLayout5i4f1i1ul2ui40");class Wo extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,u,a,h,_)}emplace(e,i,o,u,a,h,_,b){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=o,this.int16[E+2]=u,this.int16[E+4]=a,this.int16[E+5]=h,this.int16[E+6]=_,this.int16[E+7]=b,e}}Wo.prototype.bytesPerElement=16,At(Wo,"StructArrayLayout3i2i2i16");class Tn extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,u,a)}emplace(e,i,o,u,a,h){const _=4*e,b=8*e;return this.float32[_+0]=i,this.float32[_+1]=o,this.float32[_+2]=u,this.int16[b+6]=a,this.int16[b+7]=h,e}}Tn.prototype.bytesPerElement=16,At(Tn,"StructArrayLayout2f1f2i16");class Ba extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,u,a,h)}emplace(e,i,o,u,a,h,_){const b=20*e,E=5*e;return this.uint8[b+0]=i,this.uint8[b+1]=o,this.float32[E+1]=u,this.float32[E+2]=a,this.float32[E+3]=h,this.float32[E+4]=_,e}}Ba.prototype.bytesPerElement=20,At(Ba,"StructArrayLayout2ub4f20");class ln extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const a=3*e;return this.uint16[a+0]=i,this.uint16[a+1]=o,this.uint16[a+2]=u,e}}ln.prototype.bytesPerElement=6,At(ln,"StructArrayLayout3ui6");class $h extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D,F,V,z,j){const G=this.length;return this.resize(G+1),this.emplace(G,e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D,F,V,z,j)}emplace(e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D,F,V,z,j,G){const Y=30*e,te=15*e,re=60*e;return this.int16[Y+0]=i,this.int16[Y+1]=o,this.int16[Y+2]=u,this.float32[te+2]=a,this.float32[te+3]=h,this.uint16[Y+8]=_,this.uint16[Y+9]=b,this.uint32[te+5]=E,this.uint32[te+6]=p,this.uint32[te+7]=x,this.uint16[Y+16]=T,this.uint16[Y+17]=v,this.uint16[Y+18]=w,this.float32[te+10]=A,this.float32[te+11]=C,this.uint8[re+48]=D,this.uint8[re+49]=F,this.uint8[re+50]=V,this.uint32[te+13]=z,this.int16[Y+28]=j,this.uint8[re+58]=G,e}}$h.prototype.bytesPerElement=60,At($h,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Zh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D,F,V,z,j,G,Y,te,re,Q,ue,se,de,we,Ee,Me){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D,F,V,z,j,G,Y,te,re,Q,ue,se,de,we,Ee,Me)}emplace(e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D,F,V,z,j,G,Y,te,re,Q,ue,se,de,we,Ee,Me,Ie){const Be=20*e,Pe=40*e,Ze=80*e;return this.float32[Be+0]=i,this.float32[Be+1]=o,this.int16[Pe+4]=u,this.int16[Pe+5]=a,this.int16[Pe+6]=h,this.int16[Pe+7]=_,this.int16[Pe+8]=b,this.int16[Pe+9]=E,this.int16[Pe+10]=p,this.int16[Pe+11]=x,this.int16[Pe+12]=T,this.uint16[Pe+13]=v,this.uint16[Pe+14]=w,this.uint16[Pe+15]=A,this.uint16[Pe+16]=C,this.uint16[Pe+17]=D,this.uint16[Pe+18]=F,this.uint16[Pe+19]=V,this.uint16[Pe+20]=z,this.uint16[Pe+21]=j,this.uint16[Pe+22]=G,this.uint16[Pe+23]=Y,this.uint16[Pe+24]=te,this.uint16[Pe+25]=re,this.uint16[Pe+26]=Q,this.uint16[Pe+27]=ue,this.uint32[Be+14]=se,this.float32[Be+15]=de,this.float32[Be+16]=we,this.float32[Be+17]=Ee,this.float32[Be+18]=Me,this.uint8[Ze+76]=Ie,e}}Zh.prototype.bytesPerElement=80,At(Zh,"StructArrayLayout2f9i15ui1ul4f1ub80");class Fa extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Fa.prototype.bytesPerElement=4,At(Fa,"StructArrayLayout1f4");class Ys extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,u,a)}emplace(e,i,o,u,a,h){const _=5*e;return this.float32[_+0]=i,this.float32[_+1]=o,this.float32[_+2]=u,this.float32[_+3]=a,this.float32[_+4]=h,e}}Ys.prototype.bytesPerElement=20,At(Ys,"StructArrayLayout5f20");class Hh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,u,a,h,_)}emplace(e,i,o,u,a,h,_,b){const E=7*e;return this.float32[E+0]=i,this.float32[E+1]=o,this.float32[E+2]=u,this.float32[E+3]=a,this.float32[E+4]=h,this.float32[E+5]=_,this.float32[E+6]=b,e}}Hh.prototype.bytesPerElement=28,At(Hh,"StructArrayLayout7f28");class Gl extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,u)}emplace(e,i,o,u,a){const h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=u,this.uint16[h+4]=a,e}}Gl.prototype.bytesPerElement=12,At(Gl,"StructArrayLayout1ul3ui12");class Wh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Wh.prototype.bytesPerElement=2,At(Wh,"StructArrayLayout1ui2");class ql extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}ql.prototype.bytesPerElement=8,At(ql,"StructArrayLayout2f8");class $l extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C)}emplace(e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D){const F=16*e;return this.float32[F+0]=i,this.float32[F+1]=o,this.float32[F+2]=u,this.float32[F+3]=a,this.float32[F+4]=h,this.float32[F+5]=_,this.float32[F+6]=b,this.float32[F+7]=E,this.float32[F+8]=p,this.float32[F+9]=x,this.float32[F+10]=T,this.float32[F+11]=v,this.float32[F+12]=w,this.float32[F+13]=A,this.float32[F+14]=C,this.float32[F+15]=D,e}}$l.prototype.bytesPerElement=64,At($l,"StructArrayLayout16f64");class uu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,a,h,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,u,a,h,_)}emplace(e,i,o,u,a,h,_,b){const E=10*e,p=5*e;return this.uint16[E+0]=i,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=a,this.float32[p+2]=h,this.float32[p+3]=_,this.float32[p+4]=b,e}}uu.prototype.bytesPerElement=20,At(uu,"StructArrayLayout4ui3f20");class hu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}hu.prototype.bytesPerElement=2,At(hu,"StructArrayLayout1i2");class du extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}du.prototype.bytesPerElement=1,At(du,"StructArrayLayout1ub1");class Xf extends jl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xf.prototype.size=40;class fu extends Oa{get(e){return new Xf(this,e)}}At(fu,"CollisionBoxArray");class Zl extends jl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Zl.prototype.size=60;class Xh extends $h{get(e){return new Zl(this,e)}}At(Xh,"PlacedSymbolArray");class Yf extends jl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Yf.prototype.size=80;class Yh extends Zh{get(e){return new Yf(this,e)}}At(Yh,"SymbolInstanceArray");class Kf extends Fa{getoffsetX(e){return this.float32[1*e+0]}}At(Kf,"GlyphOffsetArray");class pu extends xo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}At(pu,"SymbolLineVertexArray");class Jf extends jl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Jf.prototype.size=12;class Qf extends Gl{get(e){return new Jf(this,e)}}At(Qf,"FeatureIndexArray");class ep extends wo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}At(ep,"FillExtrusionCentroidArray");class tp extends jl{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}tp.prototype.size=6;class Kh extends au{get(e){return new tp(this,e)}}At(Kh,"FillExtrusionWallArray");const e_=Oi([{name:"a_pos",components:2,type:"Int16"}],4),t_=Oi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class wr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,u){let a=this.segments[this.segments.length-1];return e>wr.MAX_VERTEX_ARRAY_LENGTH&&zi(`Max vertices per segment is ${wr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!a||a.vertexLength+e>wr.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==u)&&(a={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},u!==void 0&&(a.sortKey=u),this.segments.push(a)),a}prepareSegment(e,i,o,u){return this._prepareSegment(e,i.length,o.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new wr([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function ip(n,e){return 256*(n=gt(Math.floor(n),0,255))+gt(Math.floor(e),0,255)}wr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,At(wr,"SegmentVector");const i_=Oi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),r_=Oi([{name:"a_dash",components:4,type:"Uint16"}]);class Hl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(rp(e)),this.positions.push(i,o,u)}eachPosition(e,i){const o=rp(e);let u=0,a=this.ids.length-1;for(;u<a;){const h=u+a>>1;this.ids[h]>=o?a=h:u=h+1}for(;this.ids[u]===o;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Na(o,u,0,o.length-1),i&&(i.add(o.buffer),i.add(u.buffer)),{ids:o,positions:u}}static deserialize(e){const i=new Hl;let o;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==o&&i.uniqueIds.push(u),o=u;return i.indexed=!0,i}}function rp(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Rn(String(n))}function Na(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let a=i-1,h=o+1;for(;;){do a++;while(n[a]<u);do h--;while(n[h]>u);if(a>=h)break;mu(n,a,h),mu(e,3*a,3*h),mu(e,3*a+1,3*h+1),mu(e,3*a+2,3*h+2)}h-i<o-h?(Na(n,e,i,h),i=h+1):(Na(n,e,h+1,o),o=h)}}function mu(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}At(Hl,"FeaturePositionMap");class Ks{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Xo extends Ks{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class yn extends Ks{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Os extends Ks{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Jh extends Ks{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class _u extends Ks{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Qh extends Ks{constructor(e){super(e),this.current=qi.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const np=new Float32Array(16);class Wl extends Ks{constructor(e){super(e),this.current=np}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let u=1;u<16;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const n_=new Float32Array(9),s_=new Float32Array(4);class ed extends Ks{constructor(e){super(e),this.current=s_}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function td(n){return[ip(255*n.r,255*n.g),ip(255*n.b,255*n.a)]}class Xl{constructor(e,i,o,u){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=o,this.context=u}setUniform(e,i,o,u,a){const h=u.constantOr(this.value);i.set(e,a,h instanceof qi?h.toRenderColor(this.context.lut):h)}getBinding(e,i){return this.type==="color"?new Qh(e):new yn(e)}}class Va{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,u,a){const h=a==="u_pattern"||a==="u_dash"?this.pattern:a==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(e,a,h)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new _u(e):new yn(e)}}class Bs{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(a=>({name:`a_${a}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,o,u,a,h,_){const b=this.paintVertexArray.length,E=this.expression.evaluate(new br(0,{brightness:h}),i,{},a,u,_);this.paintVertexArray.resize(e),this._setPaintValue(b,e,E,this.context)}updatePaintArray(e,i,o,u,a,h,_){const b=this.expression.evaluate({zoom:0,brightness:_},o,u,void 0,a);this._setPaintValue(e,i,b,this.context)}_setPaintValue(e,i,o,u){if(this.type==="color"){const a=td(o.toRenderColor(u.lut));for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yn{constructor(e,i,o,u,a,h){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=u,this.context=a,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,o,u,a,h,_){const b=this.expression.evaluate(new br(this.context.zoom,{brightness:h}),i,{},a,u,_),E=this.expression.evaluate(new br(this.context.zoom+1,{brightness:h}),i,{},a,u,_),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,b,E,this.context)}updatePaintArray(e,i,o,u,a,h,_){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:_},o,u,void 0,a),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},o,u,void 0,a);this._setPaintValue(e,i,b,E,this.context)}_setPaintValue(e,i,o,u,a){if(this.type==="color"){const h=td(o.toRenderColor(a.lut)),_=td(o.toRenderColor(a.lut));for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,h[0],h[1],_[0],_[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,u,a){const h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,_=gt(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);i.set(e,a,_)}getBinding(e,i){return new yn(e)}}class Fs{constructor(e,i,o,u,a){this.expression=e,this.layerId=a,this.paintVertexAttributes=(o==="array"?r_:i_).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new u}populatePaintArray(e,i,o,u){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,u,a,h,_){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,i,o,u){if(!u||!o)return;const a=u[o];if(!a)return;const{tl:h,br:_,pixelRatio:b}=a;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,h[0],h[1],_[0],_[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yo{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const u=[];for(const a in e.paint._values){const h=e.paint.get(a);if(!o(a)||!(h instanceof La&&$c(h.property.specification)))continue;const _=a_(a,e.type),b=h.value,E=h.property.specification.type,p=!!h.property.useIntegerZoom,x=a==="line-dasharray"||a.endsWith("pattern"),T=a==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||T)if(b.kind==="source"||T||x){const v=l(a,E,"source");this.binders[a]=x?new Fs(b,_,E,v,e.id):new Bs(b,_,E,v),u.push(`/a_${a}`)}else{const v=l(a,E,"composite");this.binders[a]=new Yn(b,_,E,p,i,v),u.push(`/z_${a}`)}else this.binders[a]=x?new Va(b.value,_):new Xl(b.value,_,E,i),u.push(`/u_${a}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Bs||i instanceof Yn?i.maxValue:0}populatePaintArrays(e,i,o,u,a,h,_){for(const b in this.binders){const E=this.binders[b];E.context=this.context,(E instanceof Bs||E instanceof Yn||E instanceof Fs)&&E.populatePaintArray(e,i,o,u,a,h,_)}}setConstantPatternPositions(e){for(const i in this.binders){const o=this.binders[i];o instanceof Va&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,u,a,h,_,b){let E=!1;const p=Object.keys(e),x=p.length!==0,T=x?p:i.uniqueIds;this.context.lut=a.lut;for(const v in this.binders){const w=this.binders[v];if(w.context=this.context,(w instanceof Bs||w instanceof Yn||w instanceof Fs)&&(w.expression.isStateDependent===!0||w.expression.isLightConstant===!1)){const A=a.paint.get(v);w.expression=A.value;for(const C of T){const D=e[C.toString()];i.eachPosition(C,(F,V,z)=>{const j=u.feature(F);w.updatePaintArray(V,z,j,D,h,_,b)})}if(!x)for(const C of o.uniqueIds){const D=e[C.toString()];o.eachPosition(C,(F,V,z)=>{const j=u.feature(F);w.updatePaintArray(V,z,j,D,h,_,b)})}E=!0}}return E}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Xl||o instanceof Va)&&e.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Bs||o instanceof Yn||o instanceof Fs)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Xl||o instanceof Va||o instanceof Yn)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Xl||u instanceof Va||u instanceof Yn)for(const a of u.uniformNames)i.push({name:a,property:o,binding:u.getBinding(e,a)})}return i}setUniforms(e,i,o,u,a){for(const{name:h,property:_,binding:b}of o)this.binders[_].setUniform(e,b,a,u.get(_),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Bs||i instanceof Yn||i instanceof Fs)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Bs||o instanceof Yn||o instanceof Fs)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Bs||i instanceof Yn||i instanceof Fs)&&i.destroy()}}}class To{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Yo(u,i,o);this.needsUpload=!1,this._featureMap=new Hl,this._featureMapWithoutIds=new Hl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,u,a,h,_,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,i,u,a,h,_,b);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u,a,h){for(const _ of o)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,_,u,a,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const o_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function a_(n,e){return o_[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const l_={"line-pattern":{source:Xs,composite:Xs},"fill-pattern":{source:Xs,composite:Xs},"fill-extrusion-pattern":{source:Xs,composite:Xs},"line-dasharray":{source:Ho,composite:Ho}},sp={color:{source:ql,composite:Ws},number:{source:Fa,composite:ql}};function l(n,e,i){const o=l_[n];return o&&o[i]||sp[e][i]}At(Xl,"ConstantBinder"),At(Va,"PatternConstantBinder"),At(Bs,"SourceExpressionBinder"),At(Fs,"PatternCompositeBinder"),At(Yn,"CompositeExpressionBinder"),At(Yo,"ProgramConfiguration",{omit:["_buffers"]}),At(To,"ProgramConfigurationSet");const t=mt/Math.PI/2,r=5,c=6,f=16383,m=64,y=[m,32,16],S=-t,I=t;function P(n,e,i,o=t){return i=dt(i),[n*Math.sin(i)*o,-e*o,n*Math.cos(i)*o]}function L(n,e,i){return P(Math.cos(dt(n)),Math.sin(dt(n)),e,i)}const k=63710088e-1,B=2*Math.PI*k;class N{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new N(Di(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,a=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return k*Math.acos(Math.min(a,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new q({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return L(this.lat,this.lng,t+e*t/k)}static convert(e){if(e instanceof N)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new N(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new N(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class q{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof N?new N(e.lng,e.lat):N.convert(e),this}setSouthWest(e){return this._sw=e instanceof N?new N(e.lng,e.lat):N.convert(e),this}extend(e){const i=this._sw,o=this._ne;let u,a;if(e instanceof N)u=e,a=e;else{if(!(e instanceof q))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(q.convert(e)):this.extend(N.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(N.convert(e)):this;if(u=e._sw,a=e._ne,!u||!a)return this}return i||o?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),o.lng=Math.max(a.lng,o.lng),o.lat=Math.max(a.lat,o.lat)):(this._sw=new N(u.lng,u.lat),this._ne=new N(a.lng,a.lat)),this}getCenter(){return new N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new N(this.getWest(),this.getNorth())}getSouthEast(){return new N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=N.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&u}static convert(e){if(e)return e instanceof q?e:new q(e)}}const Z=0,H=25.5;function W(n){return B*Math.cos(n*Math.PI/180)}function ie(n){return(180+n)/360}function ne(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ee(n,e){return n/W(e)}function ae(n){return 360*n-180}function oe(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function fe(n,e){return n*W(oe(e))}const he=85.051129;function _e(n){return Math.cos(dt(gt(n,-he,he)))}function Te(n,e){const i=gt(e,Z,H),o=Math.pow(2,i);return _e(n)*B/(512*o)}function be(n){return 1/Math.cos(n*Math.PI/180)}function xe(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/mt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/mt/(1<<n.z)}class Re{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=N.convert(e);return new Re(ie(o.lng),ne(o.lat),ee(i,o.lat))}toLngLat(){return new N(ae(this.x),oe(this.y))}toAltitude(){return fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/B*be(oe(this.y))}}function Ge(n,e,i,o,u,a,h,_,b){const E=(e+o)/2,p=(i+u)/2,x=new Se(E,p);_(x),function(T,v,w,A,C,D){const F=w-C,V=A-D;return Math.abs((A-v)*F-(w-T)*V)/Math.hypot(F,V)}(x.x,x.y,a.x,a.y,h.x,h.y)>=b?(Ge(n,e,i,E,p,a,x,_,b),Ge(n,E,p,o,u,x,h,_,b)):n.push(h)}function Ke(n,e,i){let o=n[0],u=o.x,a=o.y;e(o);const h=[o];for(let _=1;_<n.length;_++){const b=n[_],{x:E,y:p}=b;e(b),Ge(h,u,a,E,p,o,b,e,i),u=E,a=p,o=b}return h}function je(n,e,i,o){if(o(e,i)){const u=e.add(i)._mult(.5);je(n,e,u,o),je(n,u,i,o)}else n.push(i)}function rt(n,e){let i=n[0];const o=[i];for(let u=1;u<n.length;u++){const a=n[u];je(o,i,a,e),i=a}return o}const Le=Math.pow(2,14)-1,Xe=-Le-1;function He(n,e){const i=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=gt(i,Xe,Le),n.y=gt(o,Xe,Le),(i<n.x||i>n.x+1||o<n.y||o>n.y+1)&&zi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function st(n,e,i){const o=n.loadGeometry(),u=n.extent,a=mt/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:_,x:b,y:E,projection:p}=i,x=T=>{const v=ae((e.x+T.x/u)/h),w=oe((e.y+T.y/u)/h),A=p.project(v,w);T.x=(A.x*_-b)*u,T.y=(A.y*_-E)*u};for(let T=0;T<o.length;T++)if(n.type!==1)o[T]=Ke(o[T],x,1);else{const v=[];for(const w of o[T])w.x<0||w.x>=u||w.y<0||w.y>=u||(x(w),v.push(w));o[T]=v}}for(const h of o)for(const _ of h)He(_,a);return o}function at(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?st(n):[]}}function Ye(n,e,i,o,u){n.emplaceBack(2*e+(o+1)/2,2*i+(u+1)/2)}function Qe(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Ft{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new xo,this.indexArray=new ln,this.segments=new wr,this.programConfigurations=new To(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,u){const a=this.layers[0],h=[];let _=null;a.type==="circle"&&(_=a.layout.get("circle-sort-key"));for(const{feature:E,id:p,index:x,sourceLayerIndex:T}of e){const v=this.layers[0]._featureFilter.needGeometry,w=at(E,v);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),w,o))continue;const A=_?_.evaluate(w,{},o):void 0,C={id:p,properties:E.properties,type:E.type,sourceLayerIndex:T,index:x,geometry:v?w.geometry:st(E,o,u),patterns:{},sortKey:A};h.push(C)}_&&h.sort((E,p)=>E.sortKey-p.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new cu,b=u.projection);for(const E of h){const{geometry:p,index:x,sourceLayerIndex:T}=E,v=e[x].feature;this.addFeature(E,p,x,i.availableImages,o,b,i.brightness),i.featureIndex.insert(v,p,x,T,this.index)}}update(e,i,o,u,a){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,u,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,e_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,t_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,u,a,h,_){for(const b of i)for(const E of b){const p=E.x,x=E.y;if(p<0||p>=mt||x<0||x>=mt)continue;if(h){const w=h.projectTilePoint(p,x,a),A=h.upVector(a,p,x),C=this.globeExtVertexArray;Qe(C,w,A),Qe(C,w,A),Qe(C,w,A),Qe(C,w,A)}const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),v=T.vertexLength;Ye(this.layoutVertexArray,p,x,-1,-1),Ye(this.layoutVertexArray,p,x,1,-1),Ye(this.layoutVertexArray,p,x,1,1),Ye(this.layoutVertexArray,p,x,-1,1),this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v,v+2,v+3),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},u,a,_)}}function ft(n,e){for(let i=0;i<n.length;i++)if(cr(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(cr(n,e[i]))return!0;return!!Zt(n,e)}function Tt(n,e,i){return!!cr(n,e)||!!fi(e,n,i)}function Kt(n,e){if(n.length===1)return er(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(cr(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(er(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Zt(n,e[i]))return!0;return!1}function Lt(n,e,i){if(n.length>1){if(Zt(n,e))return!0;for(let o=0;o<e.length;o++)if(fi(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(fi(n[o],e,i))return!0;return!1}function Zt(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let a=0;a<e.length-1;a++)if(_i(o,u,e[a],e[a+1]))return!0}return!1}function _i(n,e,i,o){return Ps(n,i,o)!==Ps(e,i,o)&&Ps(n,e,i)!==Ps(n,e,o)}function fi(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(Xi(n,e[u-1],e[u])<o)return!0;return!1}function Xi(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function er(n,e){let i,o,u,a=!1;for(let h=0;h<n.length;h++){i=n[h];for(let _=0,b=i.length-1;_<i.length;b=_++)o=i[_],u=i[b],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(a=!a)}return a}function cr(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const a=n[o],h=n[u];a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(i=!i)}return i}function rs(n,e,i,o,u){for(const h of n)if(e<=h.x&&i<=h.y&&o>=h.x&&u>=h.y)return!0;const a=[new Se(e,i),new Se(e,u),new Se(o,u),new Se(o,i)];if(n.length>2){for(const h of a)if(cr(n,h))return!0}for(let h=0;h<n.length-1;h++)if(Rr(n[h],n[h+1],a))return!0;return!1}function Rr(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const a=Ps(n,e,i[0]);return a!==Ps(n,e,i[1])||a!==Ps(n,e,i[2])||a!==Ps(n,e,i[3])}function wi(n,e,i,o,u,a){let h=e.y-n.y,_=n.x-e.x;if(a=a||0){const b=h*h+_*_;if(b===0)return!0;const E=Math.sqrt(b);h/=E,_/=E}return!((i.x-n.x)*h+(i.y-n.y)*_-a<0||(o.x-n.x)*h+(o.y-n.y)*_-a<0||(u.x-n.x)*h+(u.y-n.y)*_-a<0)}function Ji(n,e,i,o,u,a,h){return!(wi(n,e,o,u,a,h)||wi(e,i,o,u,a,h)||wi(i,n,o,u,a,h)||wi(o,u,n,e,i,h)||wi(u,a,n,e,i,h)||wi(a,o,n,e,i,h))}function mr(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Ki(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function pi(n,e,i,o,u){if(!e[0]&&!e[1])return n;const a=Se.convert(e)._mult(u);i==="viewport"&&a._rotate(-o);const h=[];for(let _=0;_<n.length;_++)h.push(n[_].sub(a));return h}function Bi(n,e,i,o){const u=Se.convert(n)._mult(o);return e==="viewport"&&u._rotate(-i),u}let $i,Tr;At(Ft,"CircleBucket",{omit:["layers"]});var Lr,Pi={exports:{}},Zr=(Lr||(Lr=1,function(n,e){(function(i){function o(a,h,_){var b=u(256*a,256*(h=Math.pow(2,_)-h-1),_),E=u(256*(a+1),256*(h+1),_);return b[0]+","+b[1]+","+E[0]+","+E[1]}function u(a,h,_){var b=2*Math.PI*6378137/256/Math.pow(2,_);return[a*b-2*Math.PI*6378137/2,h*b-2*Math.PI*6378137/2]}i.getURL=function(a,h,_,b,E,p){return p=p||{},a+"?"+["bbox="+o(_,b,E),"format="+(p.format||"image/png"),"service="+(p.service||"WMS"),"version="+(p.version||"1.1.1"),"request="+(p.request||"GetMap"),"srs="+(p.srs||"EPSG:3857"),"width="+(p.width||256),"height="+(p.height||256),"layers="+h].join("&")},i.getTileBBox=o,i.getMercCoords=u,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Pi.exports)),Pi.exports);class Qr{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=En(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=Zr.getTileBBox(this.x,this.y,this.z),u=function(a,h,_){let b,E="";for(let p=a;p>0;p--)b=1<<p-1,E+=(h&b?1:0)+(_&b?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hr{constructor(e,i){this.wrap=e,this.canonical=i,this.key=En(e,i.z,i.z,i.x,i.y)}}class sr{constructor(e,i,o,u,a){this.overscaledZ=e,this.wrap=i,this.canonical=new Qr(o,+u,+a),this.key=i===0&&e===o?this.canonical.key:En(i,e,o,u,a)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new sr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return En(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return En(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new sr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new sr(i,this.wrap,i,o,u),new sr(i,this.wrap,i,o+1,u),new sr(i,this.wrap,i,o,u+1),new sr(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new sr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new sr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function En(n,e,i,o,u){const a=1<<Math.min(i,22);let h=a*(u%a)+o%a;return n&&i<22&&(h+=a*a*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}const Sn=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new sr(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new sr(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new sr(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new sr(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];At(Qr,"CanonicalTileID"),At(sr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ns=Oi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Kn}=ns,On=Oi([{name:"a_pos_3",components:3,type:"Int16"}]);var ss=Oi([{name:"a_pos",type:"Int16",components:2}]);class Js{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const u=ge.vec3.dot(i,this.dir);if(Math.abs(u)<1e-6)return!1;const a=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return o[0]=this.pos[0]+this.dir[0]*a,o[1]=this.pos[1]+this.dir[1]*a,o[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(e,i,o){if(ge.vec3.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[u,a,h]=this.dir,_=this.pos[0]-e[0],b=this.pos[1]-e[1],E=this.pos[2]-e[2],p=u*u+a*a+h*h,x=2*(_*u+b*a+E*h),T=x*x-4*p*(_*_+b*b+E*E-i*i);if(T<0){const v=Math.max(-x/2,0),w=_+u*v,A=b+a*v,C=E+h*v,D=Math.hypot(w,A,C);return o[0]=w*i/D,o[1]=A*i/D,o[2]=C*i/D,!1}{const v=(-x-Math.sqrt(T))/(2*p);if(v<0){const w=Math.hypot(_,b,E);return o[0]=_*i/w,o[1]=b*i/w,o[2]=E*i/w,!1}return o[0]=_+u*v,o[1]=b+a*v,o[2]=E+h*v,!0}}}class Eo{constructor(e,i,o,u,a){this.TL=e,this.TR=i,this.BR=o,this.BL=u,this.horizon=a}static fromInvProjectionMatrix(e,i,o){const u=[-1,1,1],a=[1,1,1],h=[1,-1,1],_=[-1,-1,1],b=ge.vec3.transformMat4(u,u,e),E=ge.vec3.transformMat4(a,a,e),p=ge.vec3.transformMat4(h,h,e),x=ge.vec3.transformMat4(_,_,e);return new Eo(b,E,p,x,i/o)}}function Ns(n,e,i){let o=1/0,u=-1/0;const a=[];for(const h of n){ge.vec3.sub(a,h,e);const _=ge.vec3.dot(a,i);o=Math.min(o,_),u=Math.max(u,_)}return[o,u]}function Ua(n,e){let i=!0;for(let o=0;o<n.planes.length;o++){const u=n.planes[o];let a=0;for(let h=0;h<e.length;h++)a+=ge.vec3.dot(u,e[h])+u[3]>=0;if(a===0)return 0;a!==e.length&&(i=!1)}return i?2:1}function ja(n,e){for(const i of n.projections){const o=Ns(e,n.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function gu(n,e){let i=0;const o=[0,0,0,0];for(let u=0;u<n.length;u++)o[0]=n[u][0],o[1]=n[u][1],o[2]=n[u][2],o[3]=1,ge.vec4.dot(o,e)>=0&&i++;return i}class Ga{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=or.fromPoints(this.points),this.projections=[],this.frustumEdges=[ge.vec3.sub([],this.points[2],this.points[3]),ge.vec3.sub([],this.points[0],this.points[3]),ge.vec3.sub([],this.points[4],this.points[0]),ge.vec3.sub([],this.points[5],this.points[1]),ge.vec3.sub([],this.points[6],this.points[2]),ge.vec3.sub([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const u=[0,-o[2],o[1]],a=[o[2],0,-o[0]];this.projections.push({axis:u,projection:Ns(this.points,this.points[0],u)}),this.projections.push({axis:a,projection:Ns(this.points,this.points[0],a)})}}static fromInvProjectionMatrix(e,i,o,u){const a=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const p=ge.vec4.transformMat4([],E,e),x=1/p[3]/i*a;return ge.vec4.mul(p,p,[x,x,u?1/p[3]:x,x])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const p=ge.vec3.sub([],h[E[0]],h[E[1]]),x=ge.vec3.sub([],h[E[2]],h[E[1]]),T=ge.vec3.normalize([],ge.vec3.cross([],p,x)),v=-ge.vec3.dot(T,h[E[1]]);return T.concat(v)}),b=[];for(let E=0;E<h.length;E++)b.push([h[E][0],h[E][1],h[E][2]]);return new Ga(b,_)}intersectsPrecise(e,i,o){for(let u=0;u<i.length;u++)if(!gu(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!gu(e,this.planes[u]))return 0;for(const u of o)for(const a of this.frustumEdges){const h=ge.vec3.cross([],u,a),_=ge.vec3.length(h);if(_===0)continue;ge.vec3.scale(h,h,1/_);const b=Ns(this.points,this.points[0],h),E=Ns(e,this.points[0],h);if(b[0]>E[1]||E[0]>b[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(ge.vec3.dot([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class or{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const u of e)ge.vec3.min(i,i,u),ge.vec3.max(o,o,u);return new or(i,o)}static fromTileIdAndHeight(e,i,o){const u=1<<e.canonical.z,a=e.canonical.x,h=e.canonical.y;return new or([a/u,h/u,i],[(a+1)/u,(h+1)/u,o])}static applyTransform(e,i){const o=e.getCorners();for(let u=0;u<o.length;++u)ge.vec3.transformMat4(o[u],o[u],i);return or.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],u=[...o];for(let a=0;a<3;a++)for(let h=0;h<3;h++){const _=i[4*h+a],b=_*e.min[h],E=_*e.max[h];o[a]+=Math.min(b,E),u[a]+=Math.max(b,E)}return new or(o,u)}static projectAabbCorners(e,i){const o=e.getCorners();for(let u=0;u<o.length;++u)ge.vec3.transformMat4(o[u],o[u],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=ge.vec3.scale([],ge.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=ge.vec3.clone(this.min),u=ge.vec3.clone(this.max);for(let a=0;a<i.length;a++)o[a]=i[a]?this.min[a]:this.center[a],u[a]=i[a]?this.center[a]:this.max[a];return u[2]=this.max[2],new or(o,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ua(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ua(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?ja(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?ja(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Ko(n){return n*t/k}At(or,"Aabb");const c_=[new or([S,S,S],[I,I,I]),new or([S,S,S],[0,0,I]),new or([0,S,S],[I,0,I]),new or([S,0,S],[0,I,I]),new or([0,0,S],[I,I,I])];function op(n,e,i,o=!0){const u=ge.vec3.scale([],n._camera.position,n.worldSize),a=[e,i,1,1];ge.vec4.transformMat4(a,a,n.pixelMatrixInverse),ge.vec4.scale(a,a,1/a[3]);const h=ge.vec3.sub([],a,u),_=ge.vec3.normalize([],h),b=n.globeMatrix,E=[b[12],b[13],b[14]],p=ge.vec3.sub([],E,u),x=ge.vec3.length(p),T=ge.vec3.normalize([],p),v=n.worldSize/(2*Math.PI),w=ge.vec3.dot(T,_),A=Math.asin(v/x);if(A<Math.acos(w)){if(!o)return null;const ue=[],se=[];ge.vec3.scale(ue,_,x/w),ge.vec3.normalize(se,ge.vec3.sub(se,ue,p)),ge.vec3.normalize(_,ge.vec3.add(_,p,ge.vec3.scale(_,se,Math.tan(A)*x)))}const C=[];new Js(u,_).closestPointOnSphere(E,v,C);const D=ge.vec3.normalize([],Bo(b,0)),F=ge.vec3.normalize([],Bo(b,1)),V=ge.vec3.normalize([],Bo(b,2)),z=ge.vec3.dot(D,C),j=ge.vec3.dot(F,C),G=ge.vec3.dot(V,C),Y=Pt(Math.asin(-j/v));let te=Pt(Math.atan2(z,G));te=n.center.lng+function(ue,se){const de=(se-ue+180)%360-180;return de<-180?de+360:de}(n.center.lng,te);const re=ie(te),Q=gt(ne(Y),0,1);return new Re(re,Q)}class RT{constructor(e,i,o){this.a=ge.vec3.sub([],e,o),this.b=ge.vec3.sub([],i,o),this.center=o;const u=ge.vec3.normalize([],this.a),a=ge.vec3.normalize([],this.b);this.angle=Math.acos(ge.vec3.dot(u,a))}}function u_(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(o,u,a,h){const _=Math.sin(a);return o*(Math.sin((1-h)*a)/_)+u*(Math.sin(h*a)/_)}(n.a[e],n.b[e],n.angle,gt(i,0,1))+n.center[e]}function So(n){if(n.z<=1)return c_[n.z+2*n.y+n.x];const e=h_(ap(n));return or.fromPoints(e)}function Jo(n,e,i){return ge.vec3.scale(n,n,1-i),ge.vec3.scaleAndAdd(n,n,e,i)}function jy(n,e,i){for(const o of n)ge.vec3.transformMat4(o,o,e),ge.vec3.scale(o,o,i)}function Gy(n,e,i,o){const u=e/n.worldSize,a=n.globeMatrix;if(i.z<=1){const re=So(i).getCorners();return jy(re,a,u),or.fromPoints(re)}const h=ap(i,o),_=h_(h,t+Ko(n._tileCoverLift));jy(_,a,u);const b=Number.MAX_VALUE,E=[-b,-b,-b],p=[b,b,b];if(h.contains(n.center)){for(const ue of _)ge.vec3.min(p,p,ue),ge.vec3.max(E,E,ue);E[2]=0;const re=n.point,Q=[re.x*u,re.y*u,0];return ge.vec3.min(p,p,Q),ge.vec3.max(E,E,Q),new or(p,E)}if(n._tileCoverLift>0){for(const re of _)ge.vec3.min(p,p,re),ge.vec3.max(E,E,re);return new or(p,E)}const x=[a[12]*u,a[13]*u,a[14]*u],T=h.getCenter(),v=gt(n.center.lat,-he,he),w=gt(T.lat,-he,he),A=ie(n.center.lng),C=ne(v);let D=A-ie(T.lng);const F=C-ne(w);D>.5?D-=1:D<-.5&&(D+=1);let V=0;if(Math.abs(D)>Math.abs(F))V=D>=0?1:3;else{V=F>=0?0:2;const re=[a[4]*u,a[5]*u,a[6]*u],Q=-Math.sin(dt(F>=0?h.getSouth():h.getNorth()))*t;ge.vec3.scaleAndAdd(x,x,re,Q)}const z=_[V],j=_[(V+1)%4],G=new RT(z,j,x),Y=[u_(G,0)||z[0],u_(G,1)||z[1],u_(G,2)||z[2]],te=qa(n.zoom);if(te>0){const re=function({x:ue,y:se,z:de},we,Ee,Me,Ie){const Be=1/(1<<de);let Pe=ue*Be,Ze=Pe+Be,Je=se*Be,Ue=Je+Be,xt=0;const pt=(Pe+Ze)/2-Me;return pt>.5?xt=-1:pt<-.5&&(xt=1),Pe=((Pe+xt)*we-(Me*=we))*Ee+Me,Ze=((Ze+xt)*we-Me)*Ee+Me,Je=(Je*we-(Ie*=we))*Ee+Ie,Ue=(Ue*we-Ie)*Ee+Ie,[[Pe,Ue,0],[Ze,Ue,0],[Ze,Je,0],[Pe,Je,0]]}(i,e,n._pixelsPerMercatorPixel,A,C);for(let ue=0;ue<_.length;ue++)Jo(_[ue],re[ue],te);const Q=ge.vec3.add([],re[V],re[(V+1)%4]);ge.vec3.scale(Q,Q,.5),Jo(Y,Q,te)}for(const re of _)ge.vec3.min(p,p,re),ge.vec3.max(E,E,re);return p[2]=Math.min(z[2],j[2]),ge.vec3.min(p,p,Y),ge.vec3.max(E,E,Y),new or(p,E)}function ap({x:n,y:e,z:i},o=!1){const u=1/(1<<i),a=new N(ae(n*u),e===(1<<i)-1&&o?-90:oe((e+1)*u)),h=new N(ae((n+1)*u),e===0&&o?90:oe(e*u));return new q(a,h)}function h_(n,e=t){const i=dt(n.getNorth()),o=dt(n.getSouth()),u=Math.cos(i),a=Math.cos(o),h=Math.sin(i),_=Math.sin(o),b=n.getWest(),E=n.getEast();return[P(a,_,b,e),P(a,_,E,e),P(u,h,E,e),P(u,h,b,e)]}function id(n,e,i,o){const u=1<<i.z,a=(n/mt+i.x)/u;return L(oe((e/mt+i.y)/u),ae(a),o)}function lp({min:n,max:e}){return f/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const qy=new Float64Array(16);function cp(n){const e=lp(n),i=ge.mat4.fromScaling(qy,[e,e,e]);return ge.mat4.translate(i,i,ge.vec3.negate([],n.min))}function d_(n){const e=ge.mat4.fromTranslation(qy,n.min),i=1/lp(n);return ge.mat4.scale(e,e,[i,i,i])}function f_(n){const e=mt/(2*Math.PI);return n/(2*Math.PI)/e}function $y(n,e){return mt/(512*Math.pow(2,n))*lp(So(e))}function Zy(n,e,i,o,u){const a=f_(i),h=[n,e,-i/(2*Math.PI)],_=ge.mat4.identity(new Float64Array(16));return ge.mat4.translate(_,_,h),ge.mat4.scale(_,_,[a,a,a]),ge.mat4.rotateX(_,_,dt(-u)),ge.mat4.rotateY(_,_,dt(-o)),_}function qa(n){return vi(r,c,n)}function Hy(n,e){const i=L(e.lat,e.lng),o=function(a){const h=L(a._center.lat,a._center.lng),_=ge.vec3.fromValues(0,1,0);let b=ge.vec3.cross([],_,h);const E=ge.mat4.fromRotation([],-a.angle,h);b=ge.vec3.transformMat4(b,b,E),ge.mat4.fromRotation(E,-a._pitch,b);const p=ge.vec3.normalize([],h);return ge.vec3.scale(p,p,Ko(a.cameraToCenterDistance/a.pixelsPerMeter)),ge.vec3.transformMat4(p,p,E),ge.vec3.add([],h,p)}(n),u=ge.vec3.subtract([],o,i);return ge.vec3.angle(u,i)}function p_(n,e){return Hy(n,e)>Math.PI/2*1.01}const Wy=dt(85),LT=Math.cos(Wy),DT=Math.sin(Wy),zT=ge.mat4.create(),Xy=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Yy(n,e,i,o,u,a,h,_,b){if(a&&n.queryGeometry.isAboveHorizon)return!1;a&&(b*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,p=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const x of e)for(const T of x){const v=T.add(_),w=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(v.x,v.y,!0):0,A=i.projection.projectTilePoint(v.x,v.y,E);if(w>0){const V=i.projection.upVector(E,v.x,v.y);A.x+=V[0]*p*w,A.y+=V[1]*p*w,A.z+=V[2]*p*w}const C=a?v:kT(A.x,A.y,A.z,o),D=a?n.tilespaceRays.map(V=>BT(V,w)):n.queryGeometry.screenGeometry,F=ge.vec4.transformMat4([],[A.x,A.y,A.z,1],o);if(!h&&a?b*=F[3]/i.cameraToCenterDistance:h&&!a&&(b*=i.cameraToCenterDistance/F[3]),a){const V=oe((T.y/mt+E.y)/(1<<E.z));b/=i.projection.pixelsPerMeter(V,1)/ee(1,V)}if(Tt(D,C,b))return!0}return!1}function kT(n,e,i,o){const u=ge.vec4.transformMat4([],[n,e,i,1],o);return new Se(u[0]/u[3],u[1]/u[3])}const Ky=ge.vec3.fromValues(0,0,0),OT=ge.vec3.fromValues(0,0,1);function BT(n,e){const i=ge.vec3.create();return Ky[2]=e,n.intersectsPlane(Ky,OT,i),new Se(i[0],i[1])}class Jy extends Ft{}let Qy,e0,t0,i0;function r0(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function n0(n,e,i){const{width:o,height:u}=e;o===n.width&&u===n.height||(m_(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,u)},i,null),n.width=o,n.height=u,n.data=e.data)}function m_(n,e,i,o,u,a,h,_){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=n.data,E=e.data,p=a===4&&_;for(let x=0;x<u.height;x++){const T=((i.y+x)*n.width+i.x)*a,v=((o.y+x)*e.width+o.x)*a;if(p)for(let w=0;w<u.width;w++){const A=T+w*a+3,C=v+w*a;E[C+0]=255,E[C+1]=255,E[C+2]=255,E[C+3]=b[A]}else if(h)for(let w=0;w<u.width;w++){const A=T+w*a,C=v+w*a,D=b[A+3],F=new qi(b[A+0]/255*D,b[A+1]/255*D,b[A+2]/255*D,D).toRenderColor(h).toArray();E[C+0]=F[0],E[C+1]=F[1],E[C+2]=F[2],E[C+3]=F[3]}else for(let w=0;w<u.width*a;w++)E[v+w]=b[T+w]}return e}At(Jy,"HeatmapBucket",{omit:["layers"]});class $a{constructor(e,i){r0(this,e,1,i)}resize(e){n0(this,new $a(e),1)}clone(){return new $a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,a){m_(e,i,o,u,a,1,null)}}class Mn{constructor(e,i){r0(this,e,4,i)}resize(e){n0(this,new Mn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Mn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,a,h,_){m_(e,i,o,u,a,4,h,_)}}class s0{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function rd(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new Mn({width:i,height:o}),a=(h,_,b)=>{e[n.evaluationKey]=b;const E=n.expression.evaluate(e);E&&(u.data[h+_+0]=Math.floor(255*E.r/E.a),u.data[h+_+1]=Math.floor(255*E.g/E.a),u.data[h+_+2]=Math.floor(255*E.b/E.a),u.data[h+_+3]=Math.floor(255*E.a))};if(n.clips)for(let h=0,_=0;h<o;++h,_+=4*i)for(let b=0,E=0;b<i;b++,E+=4){const p=b/(i-1),{start:x,end:T}=n.clips[h];a(_,E,x*(1-p)+T*p)}else for(let h=0,_=0;h<i;h++,_+=4)a(0,_,h/(i-1));return u}At($a,"AlphaImage"),At(Mn,"RGBAImage");const FT=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:NT}=FT;function nd(n,e,i=2){const o=e&&e.length,u=o?e[0]*i:n.length;let a=o0(n,0,u,i,!0);const h=[];if(!a||a.next===a.prev)return h;let _,b,E;if(o&&(a=function(p,x,T,v){const w=[];for(let A=0,C=x.length;A<C;A++){const D=o0(p,x[A]*v,A<C-1?x[A+1]*v:p.length,v,!1);D===D.next&&(D.steiner=!0),w.push(HT(D))}w.sort(qT);for(let A=0;A<w.length;A++)T=$T(w[A],T);return T}(n,e,a,i)),n.length>80*i){_=1/0,b=1/0;let p=-1/0,x=-1/0;for(let T=i;T<u;T+=i){const v=n[T],w=n[T+1];v<_&&(_=v),w<b&&(b=w),v>p&&(p=v),w>x&&(x=w)}E=Math.max(p-_,x-b),E=E!==0?32767/E:0}return sd(a,h,i,_,b,E,0),h}function o0(n,e,i,o,u){let a;if(u===function(h,_,b,E){let p=0;for(let x=_,T=b-E;x<b;x+=E)p+=(h[T]-h[x])*(h[x+1]+h[T+1]),T=x;return p}(n,e,i,o)>0)for(let h=e;h<i;h+=o)a=c0(h/o|0,n[h],n[h+1],a);else for(let h=i-o;h>=e;h-=o)a=c0(h/o|0,n[h],n[h+1],a);return a&&up(a,a.next)&&(ad(a),a=a.next),a}function Yl(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!up(o,o.next)&&Wr(o.prev,o,o.next)!==0)o=o.next;else{if(ad(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function sd(n,e,i,o,u,a,h){if(!n)return;!h&&a&&function(b,E,p,x){let T=b;do T.z===0&&(T.z=__(T.x,T.y,E,p,x)),T.prevZ=T.prev,T.nextZ=T.next,T=T.next;while(T!==b);T.prevZ.nextZ=null,T.prevZ=null,function(v){let w,A=1;do{let C,D=v;v=null;let F=null;for(w=0;D;){w++;let V=D,z=0;for(let G=0;G<A&&(z++,V=V.nextZ,V);G++);let j=A;for(;z>0||j>0&&V;)z!==0&&(j===0||!V||D.z<=V.z)?(C=D,D=D.nextZ,z--):(C=V,V=V.nextZ,j--),F?F.nextZ=C:v=C,C.prevZ=F,F=C;D=V}F.nextZ=null,A*=2}while(w>1)}(T)}(n,o,u,a);let _=n;for(;n.prev!==n.next;){const b=n.prev,E=n.next;if(a?UT(n,o,u,a):VT(n))e.push(b.i,n.i,E.i),ad(n),n=E.next,_=E.next;else if((n=E)===_){h?h===1?sd(n=jT(Yl(n),e),e,i,o,u,a,2):h===2&&GT(n,e,i,o,u,a):sd(Yl(n),e,i,o,u,a,1);break}}}function VT(n){const e=n.prev,i=n,o=n.next;if(Wr(e,i,o)>=0)return!1;const u=e.x,a=i.x,h=o.x,_=e.y,b=i.y,E=o.y,p=u<a?u<h?u:h:a<h?a:h,x=_<b?_<E?_:E:b<E?b:E,T=u>a?u>h?u:h:a>h?a:h,v=_>b?_>E?_:E:b>E?b:E;let w=o.next;for(;w!==e;){if(w.x>=p&&w.x<=T&&w.y>=x&&w.y<=v&&yu(u,_,a,b,h,E,w.x,w.y)&&Wr(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function UT(n,e,i,o){const u=n.prev,a=n,h=n.next;if(Wr(u,a,h)>=0)return!1;const _=u.x,b=a.x,E=h.x,p=u.y,x=a.y,T=h.y,v=_<b?_<E?_:E:b<E?b:E,w=p<x?p<T?p:T:x<T?x:T,A=_>b?_>E?_:E:b>E?b:E,C=p>x?p>T?p:T:x>T?x:T,D=__(v,w,e,i,o),F=__(A,C,e,i,o);let V=n.prevZ,z=n.nextZ;for(;V&&V.z>=D&&z&&z.z<=F;){if(V.x>=v&&V.x<=A&&V.y>=w&&V.y<=C&&V!==u&&V!==h&&yu(_,p,b,x,E,T,V.x,V.y)&&Wr(V.prev,V,V.next)>=0||(V=V.prevZ,z.x>=v&&z.x<=A&&z.y>=w&&z.y<=C&&z!==u&&z!==h&&yu(_,p,b,x,E,T,z.x,z.y)&&Wr(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;V&&V.z>=D;){if(V.x>=v&&V.x<=A&&V.y>=w&&V.y<=C&&V!==u&&V!==h&&yu(_,p,b,x,E,T,V.x,V.y)&&Wr(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;z&&z.z<=F;){if(z.x>=v&&z.x<=A&&z.y>=w&&z.y<=C&&z!==u&&z!==h&&yu(_,p,b,x,E,T,z.x,z.y)&&Wr(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function jT(n,e){let i=n;do{const o=i.prev,u=i.next.next;!up(o,u)&&a0(o,i,i.next,u)&&od(o,u)&&od(u,o)&&(e.push(o.i,i.i,u.i),ad(i),ad(i.next),i=n=u),i=i.next}while(i!==n);return Yl(i)}function GT(n,e,i,o,u,a){let h=n;do{let _=h.next.next;for(;_!==h.prev;){if(h.i!==_.i&&WT(h,_)){let b=l0(h,_);return h=Yl(h,h.next),b=Yl(b,b.next),sd(h,e,i,o,u,a,0),void sd(b,e,i,o,u,a,0)}_=_.next}h=h.next}while(h!==n)}function qT(n,e){return n.x-e.x}function $T(n,e){const i=function(u,a){let h=a;const _=u.x,b=u.y;let E,p=-1/0;do{if(b<=h.y&&b>=h.next.y&&h.next.y!==h.y){const A=h.x+(b-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(A<=_&&A>p&&(p=A,E=h.x<h.next.x?h:h.next,A===_))return E}h=h.next}while(h!==a);if(!E)return null;const x=E,T=E.x,v=E.y;let w=1/0;h=E;do{if(_>=h.x&&h.x>=T&&_!==h.x&&yu(b<v?_:p,b,T,v,b<v?p:_,b,h.x,h.y)){const A=Math.abs(b-h.y)/(_-h.x);od(h,u)&&(A<w||A===w&&(h.x>E.x||h.x===E.x&&ZT(E,h)))&&(E=h,w=A)}h=h.next}while(h!==x);return E}(n,e);if(!i)return e;const o=l0(i,n);return Yl(o,o.next),Yl(i,i.next)}function ZT(n,e){return Wr(n.prev,n,e.prev)<0&&Wr(e.next,n,n.next)<0}function __(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function HT(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function yu(n,e,i,o,u,a,h,_){return(u-h)*(e-_)>=(n-h)*(a-_)&&(n-h)*(o-_)>=(i-h)*(e-_)&&(i-h)*(a-_)>=(u-h)*(o-_)}function WT(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,o){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&a0(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(od(n,e)&&od(e,n)&&function(i,o){let u=i,a=!1;const h=(i.x+o.x)/2,_=(i.y+o.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&h<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(a=!a),u=u.next;while(u!==i);return a}(n,e)&&(Wr(n.prev,n,e.prev)||Wr(n,e.prev,e))||up(n,e)&&Wr(n.prev,n,n.next)>0&&Wr(e.prev,e,e.next)>0)}function Wr(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function up(n,e){return n.x===e.x&&n.y===e.y}function a0(n,e,i,o){const u=dp(Wr(n,e,i)),a=dp(Wr(n,e,o)),h=dp(Wr(i,o,n)),_=dp(Wr(i,o,e));return u!==a&&h!==_||!(u!==0||!hp(n,i,e))||!(a!==0||!hp(n,o,e))||!(h!==0||!hp(i,n,o))||!(_!==0||!hp(i,e,o))}function hp(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function dp(n){return n>0?1:n<0?-1:0}function od(n,e){return Wr(n.prev,n,n.next)<0?Wr(n,e,n.next)>=0&&Wr(n,n.prev,e)>=0:Wr(n,e,n.prev)<0||Wr(n,n.next,e)<0}function l0(n,e){const i=g_(n.i,n.x,n.y),o=g_(e.i,e.x,e.y),u=n.next,a=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,a.next=o,o.prev=a,o}function c0(n,e,i,o){const u=g_(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ad(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function g_(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function fp(n,e){const i=n.length;if(i<=1)return[n];const o=[];let u,a;for(let h=0;h<i;h++){const _=gc(n[h]);_!==0&&(n[h].area=Math.abs(_),a===void 0&&(a=_<0),a===_<0?(u&&o.push(u),u=[n[h]]):u.push(n[h]))}if(u&&o.push(u),e>1)for(let h=0;h<o.length;h++)o[h].length<=e||(lf(o[h],e,1,o[h].length-1,XT),o[h]=o[h].slice(0,e));return o}function XT(n,e){return e.area-n.area}function y_(n,e,i){const o=i.patternDependencies;let u=!1;for(const a of e){const h=a.paint.get(`${n}-pattern`);h.isConstant()||(u=!0);const _=h.constantOr(null);_&&(u=!0,o[_]=!0)}return u}function x_(n,e,i,o,u){const a=u.patternDependencies;for(const h of e){const _=h.paint.get(`${n}-pattern`).value;if(_.kind!=="constant"){let b=_.evaluate({zoom:o},i,{},u.availableImages);b=b&&b.name?b.name:b,a[b]=!0,i.patterns[h.id]=b}}return i}class v_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xo,this.indexArray=new ln,this.indexArray2=new wo,this.programConfigurations=new To(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new wr,this.segments2=new wr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,o,u){this.hasPattern=y_("fill",this.layers,i);const a=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:_,id:b,index:E,sourceLayerIndex:p}of e){const x=this.layers[0]._featureFilter.needGeometry,T=at(_,x);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),T,o))continue;const v=a?a.evaluate(T,{},o,i.availableImages):void 0,w={id:b,properties:_.properties,type:_.type,sourceLayerIndex:p,index:E,geometry:x?T.geometry:st(_,o,u),patterns:{},sortKey:v};h.push(w)}a&&h.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of h){const{geometry:b,index:E,sourceLayerIndex:p}=_;if(this.hasPattern){const x=x_("fill",this.layers,_,this.zoom,i);this.patternFeatures.push(x)}else this.addFeature(_,b,E,o,{},i.availableImages,i.brightness);i.featureIndex.insert(e[E].feature,b,E,p,this.index)}}update(e,i,o,u,a){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,u,a)}addFeatures(e,i,o,u,a,h){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,o,u,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,a,h=[],_){for(const b of fp(i,500)){let E=0;for(const A of b)E+=A.length;const p=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),x=p.vertexLength,T=[],v=[];for(const A of b){if(A.length===0)continue;A!==b[0]&&v.push(T.length/2);const C=this.segments2.prepareSegment(A.length,this.layoutVertexArray,this.indexArray2),D=C.vertexLength;this.layoutVertexArray.emplaceBack(A[0].x,A[0].y),this.indexArray2.emplaceBack(D+A.length-1,D),T.push(A[0].x),T.push(A[0].y);for(let F=1;F<A.length;F++)this.layoutVertexArray.emplaceBack(A[F].x,A[F].y),this.indexArray2.emplaceBack(D+F-1,D+F),T.push(A[F].x),T.push(A[F].y);C.vertexLength+=A.length,C.primitiveLength+=A.length}const w=nd(T,v);for(let A=0;A<w.length;A+=3)this.indexArray.emplaceBack(x+w[A],x+w[A+1],x+w[A+2]);p.vertexLength+=E,p.primitiveLength+=w.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,h,u,_)}}let u0,h0,d0,f0;At(v_,"FillBucket",{omit:["layers","patternFeatures"]});class b_{constructor(e,i,o,u){if(this.triangleCount=i.length/3,this.min=new Se(0,0),this.max=new Se(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[a,h]=[e[0].clone(),e[0].clone()];for(let x=1;x<e.length;++x){const T=e[x];a.x=Math.min(a.x,T.x),a.y=Math.min(a.y,T.y),h.x=Math.max(h.x,T.x),h.y=Math.max(h.y,T.y)}if(u){const x=Math.ceil(Math.max(h.x-a.x,h.y-a.y)/u);o=Math.max(o,x)}if(o===0)return;this.min=a,this.max=h;const _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);const b=Math.max(_.x,_.y)/o;this.cellsX=Math.max(1,Math.ceil(_.x/b)),this.cellsY=Math.max(1,Math.ceil(_.y/b)),this.xScale=1/b,this.yScale=1/b;const E=[];for(let x=0;x<this.triangleCount;x++){const T=e[i[3*x+0]].sub(this.min),v=e[i[3*x+1]].sub(this.min),w=e[i[3*x+2]].sub(this.min),A=Mo(Math.floor(Math.min(T.x,v.x,w.x)),this.xScale,this.cellsX),C=Mo(Math.floor(Math.max(T.x,v.x,w.x)),this.xScale,this.cellsX),D=Mo(Math.floor(Math.min(T.y,v.y,w.y)),this.yScale,this.cellsY),F=Mo(Math.floor(Math.max(T.y,v.y,w.y)),this.yScale,this.cellsY),V=new Se(0,0),z=new Se(0,0),j=new Se(0,0),G=new Se(0,0);for(let Y=D;Y<=F;++Y){V.y=z.y=Y*b,j.y=G.y=(Y+1)*b;for(let te=A;te<=C;++te)V.x=j.x=te*b,z.x=G.x=(te+1)*b,(Ji(T,v,w,V,z,G)||Ji(T,v,w,V,G,j))&&E.push({cellIdx:Y*this.cellsX+te,triIdx:x})}}if(E.length===0)return;E.sort((x,T)=>x.cellIdx-T.cellIdx||x.triIdx-T.triIdx);let p=0;for(;p<E.length;){const x=E[p].cellIdx,T={start:this.payload.length,len:0};for(;p<E.length&&E[p].cellIdx===x;)++T.len,this.payload.push(E[p++].triIdx);this.cells[x]=T}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=Mo(e.x-this.min.x,this.xScale,this.cellsX),u=Mo(e.y-this.min.y,this.yScale,this.cellsY),a=this.cells[u*this.cellsX+o];if(a){this._lazyInitLookup();for(let h=0;h<a.len;h++){const _=this.payload[a.start+h],b=Math.floor(_/8),E=1<<_%8;if(!(this.lookup[b]&E)&&(this.lookup[b]|=E,i.push(_),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=Mo(e.x-this.min.x,this.xScale,this.cellsX),a=Mo(i.x-this.min.x,this.xScale,this.cellsX),h=Mo(e.y-this.min.y,this.yScale,this.cellsY),_=Mo(i.y-this.min.y,this.yScale,this.cellsY);for(let b=h;b<=_;b++)for(let E=u;E<=a;E++){const p=this.cells[b*this.cellsX+E];if(p)for(let x=0;x<p.len;x++){const T=this.payload[p.start+x],v=Math.floor(T/8),w=1<<T%8;if(!(this.lookup[v]&w)&&(this.lookup[v]|=w,o.push(T),o.length===this.triangleCount))return}}}}function Mo(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}At(b_,"TriangleGridIndex");class p0{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,u){const a=[];for(const{feature:h,id:_,index:b,sourceLayerIndex:E}of e){const p=this.layers[0]._featureFilter.needGeometry,x=at(h,p);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),x,o))continue;const T={id:_,properties:h.properties,type:h.type,sourceLayerIndex:E,index:b,geometry:p?x.geometry:st(h,o,u),patterns:{}};a.push(T)}for(const h of a){const{geometry:_,index:b,sourceLayerIndex:E}=h;this.addFeature(h,_,b,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[b].feature,_,b,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,u,a){}destroy(){}addFeature(e,i,o,u,a,h=[],_){for(const b of fp(i,2)){const E=[],p=[],x=[],T=new Se(1/0,1/0),v=new Se(-1/0,-1/0);for(const C of b)if(C.length!==0){C!==b[0]&&x.push(p.length/2);for(let D=0;D<C.length;D++)p.push(C[D].x),p.push(C[D].y),E.push(C[D]),T.x=Math.min(T.x,C[D].x),T.y=Math.min(T.y,C[D].y),v.x=Math.max(v.x,C[D].x),v.y=Math.max(v.y,C[D].y)}const w=nd(p,x),A=new b_(E,w,8,256);this.footprints.push({vertices:E,indices:w,grid:A,min:T,max:v})}}}At(p0,"ClipBucket",{omit:["layers"]});const YT=Oi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),KT=Oi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),JT=Oi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),QT=Oi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),eE=Oi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),tE=Oi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:iE}=YT;var w_,m0,T_,_0,E_,g0,y0,pp={};function x0(){if(m0)return w_;m0=1;var n=ze();function e(u,a,h,_,b){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=_,this._values=b,u.readFields(i,this,a)}function i(u,a,h){u==1?a.id=h.readVarint():u==2?function(_,b){for(var E=_.readVarint()+_.pos;_.pos<E;){var p=b._keys[_.readVarint()],x=b._values[_.readVarint()];b.properties[p]=x}}(h,a):u==3?a.type=h.readVarint():u==4&&(a._geometry=h.pos)}function o(u){for(var a,h,_=0,b=0,E=u.length,p=E-1;b<E;p=b++)_+=((h=u[p]).x-(a=u[b]).x)*(a.y+h.y);return _}return w_=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var a,h=u.readVarint()+u.pos,_=1,b=0,E=0,p=0,x=[];u.pos<h;){if(b<=0){var T=u.readVarint();_=7&T,b=T>>3}if(b--,_===1||_===2)E+=u.readSVarint(),p+=u.readSVarint(),_===1&&(a&&x.push(a),a=[]),a.push(new n(E,p));else{if(_!==7)throw new Error("unknown command "+_);a&&a.push(a[0].clone())}}return a&&x.push(a),x},e.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var a=u.readVarint()+u.pos,h=1,_=0,b=0,E=0,p=1/0,x=-1/0,T=1/0,v=-1/0;u.pos<a;){if(_<=0){var w=u.readVarint();h=7&w,_=w>>3}if(_--,h===1||h===2)(b+=u.readSVarint())<p&&(p=b),b>x&&(x=b),(E+=u.readSVarint())<T&&(T=E),E>v&&(v=E);else if(h!==7)throw new Error("unknown command "+h)}return[p,T,x,v]},e.prototype.toGeoJSON=function(u,a,h){var _,b,E=this.extent*Math.pow(2,h),p=this.extent*u,x=this.extent*a,T=this.loadGeometry(),v=e.types[this.type];function w(D){for(var F=0;F<D.length;F++){var V=D[F];D[F]=[360*(V.x+p)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+x)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(_=0;_<T.length;_++)A[_]=T[_][0];w(T=A);break;case 2:for(_=0;_<T.length;_++)w(T[_]);break;case 3:for(T=function(D){var F=D.length;if(F<=1)return[D];for(var V,z,j=[],G=0;G<F;G++){var Y=o(D[G]);Y!==0&&(z===void 0&&(z=Y<0),z===Y<0?(V&&j.push(V),V=[D[G]]):V.push(D[G]))}return V&&j.push(V),j}(T),_=0;_<T.length;_++)for(b=0;b<T[_].length;b++)w(T[_][b])}T.length===1?T=T[0]:v="Multi"+v;var C={type:"Feature",geometry:{type:v,coordinates:T},properties:this.properties};return"id"in this&&(C.id=this.id),C},w_}function v0(){if(_0)return T_;_0=1;var n=x0();function e(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,u),this.length=this._features.length}function i(o,u,a){o===15?u.version=a.readVarint():o===1?u.name=a.readString():o===5?u.extent=a.readVarint():o===2?u._features.push(a.pos):o===3?u._keys.push(a.readString()):o===4&&u._values.push(function(h){for(var _=null,b=h.readVarint()+h.pos;h.pos<b;){var E=h.readVarint()>>3;_=E===1?h.readString():E===2?h.readFloat():E===3?h.readDouble():E===4?h.readVarint64():E===5?h.readVarint():E===6?h.readSVarint():E===7?h.readBoolean():null}return _}(a))}return T_=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,u,this.extent,this._keys,this._values)},T_}function b0(){return y0||(y0=1,pp.VectorTile=function(){if(g0)return E_;g0=1;var n=v0();function e(i,o,u){if(i===3){var a=new n(u,u.readVarint()+u.pos);a.length&&(o[a.name]=a)}}return E_=function(i,o){this.layers=i.readFields(e,{},o)},E_}(),pp.VectorTileFeature=x0(),pp.VectorTileLayer=v0()),pp}var xu=b0();class Kl extends Se{constructor(e,i,o){super(e,i),this.z=o}}class w0 extends Kl{constructor(e,i,o,u){super(e,i,o),this.w=u}}function mp(n,e,i,o){const u=[],a=o===0?(h,_,b,E,p,x)=>{h.push(new Se(x,b+(x-_)/(E-_)*(p-b)))}:(h,_,b,E,p,x)=>{h.push(new Se(_+(x-b)/(p-b)*(E-_),x))};for(const h of n){const _=[];for(const b of h){if(b.length<=2)continue;const E=[];for(let T=0;T<b.length-1;T++){const v=b[T].x,w=b[T].y,A=b[T+1].x,C=b[T+1].y,D=o===0?v:w,F=o===0?A:C;D<e?F>e&&a(E,v,w,A,C,e):D>i?F<i&&a(E,v,w,A,C,i):E.push(b[T]),F<e&&D>=e&&a(E,v,w,A,C,e),F>i&&D<=i&&a(E,v,w,A,C,i)}let p=b[b.length-1];const x=o===0?p.x:p.y;x>=e&&x<=i&&E.push(p),E.length&&(p=E[E.length-1],E[0].x===p.x&&E[0].y===p.y||E.push(E[0]),_.push(E))}_.length&&u.push(_)}return u}function T0(n,e,i,o){const u=i==="x"?"y":"x",a=(o-n[i])/(e[i]-n[i]);n[u]=n[u]+(e[u]-n[u])*a,n[i]=o,n.hasOwnProperty("z")&&(n.z=Yt(n.z,e.z,a)),n.hasOwnProperty("w")&&(n.w=Yt(n.w,e.w,a))}function E0(n,e,i,o){const u=i,a=o;for(const h of["x","y"]){let _=n,b=e;_[h]>=b[h]&&(_=e,b=n),_[h]<u&&b[h]>u&&T0(_,b,h,u),_[h]<a&&b[h]>a&&T0(b,_,h,a)}}const _p=Number.MAX_SAFE_INTEGER;function S0(n,e,i,o){return n.order<e||n.order===_p||!(n.clipMask&i)||function(u,a){return a.length!==0&&a.find(h=>h===u)===void 0}(o,n.clipScope)}function gp(n,e){return n.x-e.x||n.y-e.y}function M0(n,e){return gp(n.min,e.min)===0&&gp(n.max,e.max)===0}function S_(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function M_(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!M0(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!wt(n[i].clipScope,e[i].clipScope))return!1;return!0}function A0(n,e,i){const o=1/mt,u=1/(1<<i.canonical.z),a=(e.x*o+i.canonical.x)*u+i.wrap,h=(e.y*o+i.canonical.y)*u;return{min:new Se((n.x*o+i.canonical.x)*u+i.wrap,(n.y*o+i.canonical.y)*u),max:new Se(a,h)}}function rE(n,e,i){const o=1<<i.canonical.z,u=((e.x-i.wrap)*o-i.canonical.x)*mt,a=(e.y*o-i.canonical.y)*mt;return{min:new Se(((n.x-i.wrap)*o-i.canonical.x)*mt,(n.y*o-i.canonical.y)*mt),max:new Se(u,a)}}function I0(n,e,i,o,u,a,h){const _=n.indices,b=n.vertices,E=[];for(let p=o;p<o+u;p+=3){const x=e[i[p+0]+a],T=e[i[p+1]+a],v=e[i[p+2]+a],w=Math.min(x.x,T.x,v.x),A=Math.max(x.x,T.x,v.x),C=Math.min(x.y,T.y,v.y),D=Math.max(x.y,T.y,v.y);E.length=0,n.grid.query(new Se(w,C),new Se(A,D),E);for(let F=0;F<E.length;F++){const V=E[F];if(Ji(b[_[3*V+0]],b[_[3*V+1]],b[_[3*V+2]],x,T,v,h))return!0}}return!1}function C0(n,e,i,o){if(!n||!i)return!1;let u=n.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<n.vertices.length)return C0(i,o,n,e);const a=e.canonical,h=o.canonical,_=Math.pow(2,h.z-a.z);u=n.vertices.map(b=>new Se((b.x+a.x*mt)*_-h.x*mt,(b.y+a.y*mt)*_-h.y*mt))}return I0(i,u,n.indices,0,n.indices.length,0,0)}function P0(n,e,i,o){const u=Math.pow(2,o.z-i.z);return new Se((n+i.x*mt)*u-o.x*mt,(e+i.y*mt)*u-o.y*mt)}function R0(n,e){const i=[];e.grid.queryPoint(n,i);const o=e.indices,u=e.vertices;for(let a=0;a<i.length;a++){const h=i[a];if(cr([u[o[3*h+0]],u[o[3*h+1]],u[o[3*h+2]]],n))return!0}return!1}const A_=[new Se(0,0),new Se(mt,0),new Se(mt,mt),new Se(0,mt)];function L0(n,e){const i=[];let o=[];if(!e||n.length<2)return[n];if(n.length===2)return Rr(n[0],n[1],A_)?[n]:[];for(let u=0;u<n.length+2;u++){const a=n[u%n.length],h=n[(u+1)%n.length],_=Rr(u===0?n[n.length-1]:n[(u-1)%n.length],a,A_),b=Rr(a,h,A_),E=_||b;E&&o.push(a),E&&b||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const I_=xu.VectorTileFeature.types,nE=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],sE=["fill-extrusion-flood-light-ground-radius"],oE=Math.pow(2,13),aE=Math.pow(2,15)-1,D0=new Se(0,1),Za=2147483648;function ld(n,e,i,o,u,a,h,_){n.emplaceBack((e<<1)+h,(i<<1)+a,(Math.floor(o*oE)<<1)+u,Math.round(_))}function cd(n,e,i){n.emplaceBack(e.x*mt,e.y*mt,i?1:0)}function yp(n,e,i,o,u,a){n.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+u,a)}function ud(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class z0{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class k0{constructor(){this.centroidXY=new Se(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Se(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Se(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}}class O0{constructor(){this.acc=new Se(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===mt)&&i.x===o.x)!=((i.y===0||i.y===mt)&&i.y===o.y)&&this.processBorderOverlap(i,o),u&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Yt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>mt!=e.x>mt&&this.addBorderIntersection(1,Yt(i.y,e.y,(mt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Yt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>mt!=e.y>mt&&this.addBorderIntersection(3,Yt(i.x,e.x,(mt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Se(0,0):new Se(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function B0(n,e){const i=n.add(e)._unit(),o=gt(n.x*i.x+n.y*i.y,-1,1);var u,a,h;return h=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(h)))/4*aE*((u=n).x*(a=e).y-u.y*a.x<0?-1:1)}const lE=[n=>n.x<0,n=>n.x>mt,n=>n.y<0,n=>n.y>mt];function cE(n,e,i,o){const u=[4];if(o===0)return u;i._mult(o);const a=n.sub(i),h=e.sub(i),_=[n,e,a,h];for(let b=0;b<4;b++)for(const E of _)if(lE[b](E)){u.push(b);break}return u}class F0{constructor(e){this.vertexArray=new lu,this.indexArray=new ln,this.programConfigurations=new To(e.layers,{zoom:e.zoom,lut:e.lut},i=>sE.includes(i)),this._segments=new wr,this.hiddenByLandmarkVertexArray=new du,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new wr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,u=!1){const a=e.length;if(a>2){let h=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*a,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let b;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const E=e[0],p=e[1];b=B0(E.sub(e[a-1])._perp()._unit(),p.sub(E)._perp()._unit())}for(let E=0;E<a;E++){const p=E===a-1?0:E+1,x=e[E],T=e[p],v=e[p===a-1?0:p+1],w=T.sub(x)._perp()._unit(),A=B0(w,v.sub(T)._perp()._unit()),C=b,D=A;if(C_(x,T,i)||u&&U0(x,i)&&U0(T,i)){b=A;continue}const F=_.vertexLength;yp(this.vertexArray,x,T,1,1,C),yp(this.vertexArray,x,T,1,0,C),yp(this.vertexArray,x,T,0,1,D),yp(this.vertexArray,x,T,0,0,D),_.vertexLength+=4;const V=cE(x,T,w,o);for(const z of V)this._segmentToGroundQuads[h].push({id:F,region:z}),this._segmentToRegionTriCounts[h][z]+=2,_.primitiveLength+=2;b=A}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((u,a)=>u.region-a.region);for(let o=0;o<i;o++){const u=this._segmentToGroundQuads[o],a=e[o],h=this._segmentToRegionTriCounts[o];h.reduce((b,E)=>b+E,0);let _=0;for(let b=0;b<=4;b++){const E=h[b];if(E!==0){let p=this.regionSegments[b];p||(p=this.regionSegments[b]=new wr);const x={vertexOffset:a.vertexOffset,primitiveOffset:a.primitiveOffset+_,vertexLength:a.vertexLength,primitiveLength:E};p.get().push(x)}_+=E}for(let b=0;b<u.length;b++){const E=u[b].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,u,a,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,u,a,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,KT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,u,a,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,u,a,h)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Za?1:0;for(let u=e.groundVertexArrayOffset;u<i;++u)this.hiddenByLandmarkVertexArray.emplace(u,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,eE.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class xp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ln,this.footprintVertices=new xo,this.footprintSegments=[],this.layoutVertexArray=new vo,this.centroidVertexArray=new ep,this.wallVertexArray=new Kh,this.indexArray=new ln,this.programConfigurations=new To(e.layers,{zoom:e.zoom,lut:e.lut},i=>nE.includes(i)),this.segments=new wr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new F0(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,u){this.features=[],this.hasPattern=y_("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=xe(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:a,id:h,index:_,sourceLayerIndex:b}of e){const E=this.layers[0]._featureFilter.needGeometry,p=at(a,E);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),p,o))continue;const x={id:h,sourceLayerIndex:b,index:_,geometry:E?p.geometry:st(a,o,u),properties:a.properties,type:a.type,patterns:{}},T=this.layoutVertexArray.length,v=I_[x.type]==="Polygon";if(this.hasPattern)this.features.push(x_("fill-extrusion",this.layers,x,this.zoom,i));else if(this.wallMode)for(const w of x.geometry)for(const A of L0(w,v))this.addFeature(x,[A],_,o,{},i.availableImages,u,i.brightness);else this.addFeature(x,x.geometry,_,o,{},i.availableImages,u,i.brightness);i.featureIndex.insert(a,x.geometry,_,b,this.index,T)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,u,a,h){for(const _ of this.features){const b=I_[_.type]==="Polygon",{geometry:E}=_;if(this.wallMode)for(const p of E)for(const x of L0(p,b))this.addFeature(_,[x],_.index,i,o,u,a,h);else this.addFeature(_,E,_.index,i,o,u,a,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,u,a){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const _=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,_,o,u,a),this.groundEffect.update(e,i,_,o,u,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,QT.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tE.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,JT.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,a,h,_,b){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,p=[new Se(0,0),new Se(mt,mt)],x=_.projection,T=x.name==="globe",v=this.wallMode||I_[e.type]==="Polygon",w=new O0;w.centroidDataIndex=this.centroidData.length;const A=new k0,C=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,D=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);let F;if(A.height=D,A.vertexArrayOffset=this.layoutVertexArray.length,A.groundVertexArrayOffset=this.groundEffect.vertexArray.length,T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new cu),this.wallMode){if(T)return void zi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;F=function(Q){const ue=Q[0].x===Q[Q.length-1].x&&Q[0].y===Q[Q.length-1].y;(function(ot){let tt=0;const Nt=ot.length;for(let yt=0;yt<Nt;yt++)tt+=(ot[(yt+1)%Nt].x-ot[yt].x)*(ot[(yt+1)%Nt].y+ot[yt].y);return tt>=0})(Q)||(Q=Q.reverse());const de={geometry:[],joinNormals:[],indices:[]},we=[],Ee=[],Me=[];let Ie=Q.length;if(Ie<(ue?3:2))return de;for(;Ie>=2&&Q[Ie-1].equals(Q[Ie-2]);)Ie--;let Be,Pe,Ze,Je,Ue,xt=0;for(;xt<Ie-1&&Q[xt].equals(Q[xt+1]);)xt++;ue&&(Be=Q[Ie-2],Ue=Q[xt].sub(Be)._unit()._perp());for(let ot=xt;ot<Ie;ot++){if(Ze=ot===Ie-1?ue?Q[xt+1]:void 0:Q[ot+1],Ze&&Q[ot].equals(Ze))continue;Ue&&(Je=Ue),Be&&(Pe=Be),Be=Q[ot],Ue=Ze?Ze.sub(Be)._unit()._perp():Je,Je=Je||Ue;let tt=Je.add(Ue);tt.x===0&&tt.y===0||tt._unit();const Nt=tt.x*Ue.x+tt.y*Ue.y,yt=Nt!==0?1/Nt:1/0,Mt=Je.x*Ue.y-Je.y*Ue.x>0;let ti="miter";const mi=2;ti==="miter"&&yt>mi&&(ti="bevel"),ti==="bevel"&&(yt>100&&(ti="flipbevel"),yt<mi&&(ti="miter"));const ci=(ui,gi,xi,tr)=>{const Zi=new Se(ui.x,ui.y),ri=new Se(ui.x,ui.y);Zi.x+=gi.x*tr,Zi.y+=gi.y*tr,ri.x-=gi.x*Math.max(xi,1),ri.y-=gi.y*Math.max(xi,1),Me.push(gi),we.push(Zi),Ee.push(ri)};if(ti==="miter")tt._mult(yt),ci(Be,tt,0,0);else if(ti==="flipbevel")tt=Ue.mult(-1),ci(Be,tt,0,0),ci(Be,tt.mult(-1),0,0);else{const ui=-Math.sqrt(yt*yt-1),gi=Mt?ui:0,xi=Mt?0:ui;Pe&&ci(Be,Je,gi,xi),Ze&&ci(Be,Ue,gi,xi)}}de.geometry=[...we,...Ee.reverse(),we[0]],de.joinNormals=[...Me,...Me.reverse(),Me[Me.length-1]];const pt=de.geometry.length-1;for(let ot=0;ot<pt/2;ot++)if(ot+1<pt/2){let tt=ot,Nt=ot+1,yt=pt-1-ot,Mt=pt-2-ot;tt=tt===0?pt-1:tt-1,Nt=Nt===0?pt-1:Nt-1,yt=yt===0?pt-1:yt-1,Mt=Mt===0?pt-1:Mt-1,de.indices.push(yt),de.indices.push(Nt),de.indices.push(tt),de.indices.push(yt),de.indices.push(Mt),de.indices.push(Nt)}return de}(i[0]),i=[F.geometry]}const V=(Q,ue)=>Q<(ue.length-1)/2||Q===ue.length-1,z=this.wallMode?[i]:fp(i,500);for(let Q=z.length-1;Q>=0;Q--){const ue=z[Q];(ue.length===0||(j=ue[0]).every(se=>se.x<=0)||j.every(se=>se.x>=mt)||j.every(se=>se.y<=0)||j.every(se=>se.y>=mt))&&z.splice(Q,1)}var j;let G;if(T)G=$0(z,p,u);else{G=[];for(const Q of z)G.push({polygon:Q,bounds:p})}const Y=v?this.edgeRadius:0,te=Y>0&&this.zoom<17,re=(Q,ue)=>{if(Q.length===0)return!1;const se=Q[Q.length-1];return ue.x===se.x&&ue.y===se.y};for(const{polygon:Q,bounds:ue}of G){let se=0,de=0;for(const Ie of Q)v&&!Ie[0].equals(Ie[Ie.length-1])&&Ie.push(Ie[0]),de+=v?Ie.length-1:Ie.length;const we=this.segments.prepareSegment((v?5:4)*de,this.layoutVertexArray,this.indexArray);A.footprintSegIdx<0&&(A.footprintSegIdx=this.footprintSegments.length),A.polygonSegIdx<0&&(A.polygonSegIdx=this.polygonSegments.length);const Ee={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Me=new z0;if(Me.vertexOffset=this.footprintVertices.length,Me.indexOffset=3*this.footprintIndices.length,Me.ringIndices=[],v){const Ie=[],Be=[];se=we.vertexLength;for(let Ze=0;Ze<Q.length;Ze++){const Je=Q[Ze];Je.length&&Ze!==0&&Be.push(Ie.length/2);const Ue=[];let xt,pt;xt=Je[1].sub(Je[0])._perp()._unit(),Me.ringIndices.push(Je.length-1);for(let ot=1;ot<Je.length;ot++){const tt=Je[ot],Nt=Je[ot===Je.length-1?1:ot+1],yt=tt.clone();if(Y){pt=Nt.sub(tt)._perp()._unit();const Mt=xt.add(pt)._unit(),ti=Y*Math.min(4,1/(xt.x*Mt.x+xt.y*Mt.y));yt.x+=ti*Mt.x,yt.y+=ti*Mt.y,yt.x=Math.round(yt.x),yt.y=Math.round(yt.y),xt=pt}if(!C||Y!==0&&!te||re(Ue,yt)||Ue.push(yt),ld(this.layoutVertexArray,yt.x,yt.y,0,0,1,1,0),this.wallMode){const Mt=V(ot,Je);cd(this.wallVertexArray,F.joinNormals[ot],!Mt)}we.vertexLength++,this.footprintVertices.emplaceBack(tt.x,tt.y),Ie.push(tt.x,tt.y),T&&ud(this.layoutVertexExtArray,x.projectTilePoint(yt.x,yt.y,u),x.upVector(u,yt.x,yt.y))}C&&(Y===0||te)&&(Ue.length!==0&&re(Ue,Ue[0])&&Ue.pop(),this.groundEffect.addData(Ue,ue,E))}const Pe=this.wallMode?F.indices:nd(Ie,Be);for(let Ze=0;Ze<Pe.length;Ze+=3)this.footprintIndices.emplaceBack(Me.vertexOffset+Pe[Ze+0],Me.vertexOffset+Pe[Ze+1],Me.vertexOffset+Pe[Ze+2]),this.indexArray.emplaceBack(se+Pe[Ze],se+Pe[Ze+2],se+Pe[Ze+1]),we.primitiveLength++;Me.indexCount+=Pe.length,Me.vertexCount+=this.footprintVertices.length-Me.vertexOffset}for(let Ie=0;Ie<Q.length;Ie++){const Be=Q[Ie];w.startRing(A,Be[0]);let Pe=Be.length>4&&j0(Be[Be.length-2],Be[0],Be[1]),Ze=Y?uE(Be[Be.length-2],Be[0],Be[1],Y):0;const Je=[];let Ue,xt,pt;xt=Be[1].sub(Be[0])._perp()._unit();let ot=!0;for(let tt=1,Nt=0;tt<Be.length;tt++){let yt=Be[tt-1],Mt=Be[tt];const ti=Be[tt===Be.length-1?1:tt+1];if(w.appendEdge(A,Mt,yt),C_(Mt,yt,ue)){Y&&(xt=ti.sub(Mt)._perp()._unit(),ot=!ot);continue}const mi=Mt.sub(yt)._perp(),ci=mi.x/(Math.abs(mi.x)+Math.abs(mi.y)),ui=mi.y>0?1:0,gi=yt.dist(Mt);if(Nt+gi>32768&&(Nt=0),Y){pt=ti.sub(Mt)._perp()._unit();let ri=V0(yt,Mt,ti,N0(xt,pt),Y);isNaN(ri)&&(ri=0);const Ni=Mt.sub(yt)._unit();yt=yt.add(Ni.mult(Ze))._round(),Mt=Mt.add(Ni.mult(-ri))._round(),Ze=ri,xt=pt,C&&this.zoom>=17&&(re(Je,yt)||Je.push(yt),re(Je,Mt)||Je.push(Mt))}const xi=we.vertexLength,tr=Be.length>4&&j0(yt,Mt,ti);let Zi=G0(Nt,Pe,ot);if(ld(this.layoutVertexArray,yt.x,yt.y,ci,ui,0,0,Zi),ld(this.layoutVertexArray,yt.x,yt.y,ci,ui,0,1,Zi),this.wallMode){const ri=V(tt-1,Be),Ni=F.joinNormals[tt-1];cd(this.wallVertexArray,Ni,ri),cd(this.wallVertexArray,Ni,ri)}if(Nt+=gi,Zi=G0(Nt,tr,!ot),Pe=tr,ld(this.layoutVertexArray,Mt.x,Mt.y,ci,ui,0,0,Zi),ld(this.layoutVertexArray,Mt.x,Mt.y,ci,ui,0,1,Zi),this.wallMode){const ri=V(tt,Be),Ni=F.joinNormals[tt];cd(this.wallVertexArray,Ni,ri),cd(this.wallVertexArray,Ni,ri)}if(we.vertexLength+=4,this.indexArray.emplaceBack(xi+0,xi+1,xi+2),this.indexArray.emplaceBack(xi+1,xi+3,xi+2),we.primitiveLength+=2,Y){const ri=se+(tt===1?Be.length-2:tt-2),Ni=tt===1?se:ri+1;if(this.indexArray.emplaceBack(xi+1,ri,xi+3),this.indexArray.emplaceBack(ri,Ni,xi+3),we.primitiveLength+=2,Ue===void 0&&(Ue=xi),!C_(ti,Be[tt],ue)){const Ui=tt===Be.length-1?Ue:we.vertexLength;this.indexArray.emplaceBack(xi+2,xi+3,Ui),this.indexArray.emplaceBack(xi+3,Ui+1,Ui),this.indexArray.emplaceBack(xi+3,Ni,Ui+1),we.primitiveLength+=3}ot=!ot}if(T){const ri=this.layoutVertexExtArray,Ni=x.projectTilePoint(yt.x,yt.y,u),Ui=x.projectTilePoint(Mt.x,Mt.y,u),ur=x.upVector(u,yt.x,yt.y),Ar=x.upVector(u,Mt.x,Mt.y);ud(ri,Ni,ur),ud(ri,Ni,ur),ud(ri,Ui,Ar),ud(ri,Ui,Ar)}}v&&(se+=Be.length-1),C&&Y&&this.zoom>=17&&(Je.length!==0&&re(Je,Je[0])&&Je.pop(),this.groundEffect.addData(Je,ue,E,Y>0))}this.footprintSegments.push(Me),Ee.triangleCount=this.indexArray.length-Ee.triangleArrayOffset,this.polygonSegments.push(Ee),++A.footprintSegLen,++A.polygonSegLen}if(A.vertexCount=this.layoutVertexArray.length-A.vertexArrayOffset,A.groundVertexCount=this.groundEffect.vertexArray.length-A.groundVertexArrayOffset,A.vertexCount!==0){if(A.centroidXY=w.borders?D0:this.encodeCentroid(w,A),this.centroidData.push(A),w.borders){this.featuresOnBorder.push(w);const Q=this.featuresOnBorder.length-1;for(let ue=0;ue<w.borders.length;ue++)w.borders[ue][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ue].push(Q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,h,u,b),this.groundEffect.addPaintPropertiesData(e,o,a,h,u,b),this.maxHeight=Math.max(this.maxHeight,D)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const b=this.centroidData[_],E=+(b.min.y+b.max.y>mt),p=2*E+(+(b.min.x+b.max.x>mt)^E);for(let x=0;x<b.polygonSegLen;x++){const T=b.polygonSegIdx+x;e.push({centroidIdx:_,subtile:p,polygonSegmentIdx:T,triangleSegmentIdx:this.polygonSegments[T].triangleSegIdx})}}const i=new ln;e.sort((_,b)=>_.triangleSegmentIdx===b.triangleSegmentIdx?_.subtile-b.subtile:_.triangleSegmentIdx-b.triangleSegmentIdx);let o=0,u=0,a=0;for(const _ of e){if(_.triangleSegmentIdx!==o)break;a++}const h=e.length;for(;u!==e.length;){o=e[u].triangleSegmentIdx;let _=0,b=u,E=u;for(let p=b;p<a&&e[p].subtile===_;p++)E++;for(;b!==a;){const p=e[b];_=p.subtile;const x=this.centroidData[p.centroidIdx].min.clone(),T=this.centroidData[p.centroidIdx].max.clone(),v={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let w=b;w<E;w++){const A=e[w],C=this.polygonSegments[A.polygonSegmentIdx],D=this.centroidData[A.centroidIdx].min,F=this.centroidData[A.centroidIdx].max,V=this.indexArray.uint16;for(let z=C.triangleArrayOffset;z<C.triangleArrayOffset+C.triangleCount;z++)i.emplaceBack(V[3*z],V[3*z+1],V[3*z+2]);v.primitiveLength+=C.triangleCount,x.x=Math.min(x.x,D.x),x.y=Math.min(x.y,D.y),T.x=Math.max(T.x,F.x),T.y=Math.max(T.y,F.y)}v.primitiveLength>0&&this.triangleSubSegments.push({segment:v,min:x,max:T}),b=E;for(let w=b;w<a&&e[w].subtile===e[b].subtile;w++)E++}u=a;for(let p=u;p<h&&e[p].triangleSegmentIdx===e[u].triangleSegmentIdx;p++)a++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const u=new wr;if(this.wallMode){for(const A of this.triangleSubSegments)u.segments.push(A.segment);return u}let a=0,h=0;const _=1<<e.canonical.z;if(i){const A=i.getMinMaxForTile(e);A&&(a=A.min,h=A.max)}h+=this.maxHeight;const b=e.toUnwrapped();let E;const p=[b.canonical.x/_+b.wrap,b.canonical.y/_],x=[(b.canonical.x+1)/_+b.wrap,(b.canonical.y+1)/_],T=(A,C,D)=>[A[0]*(1-D[0])+C[0]*D[0],A[1]*(1-D[1])+C[1]*D[1]],v=[],w=[];for(const A of this.triangleSubSegments){v[0]=A.min.x/mt,v[1]=A.min.y/mt,w[0]=A.max.x/mt,w[1]=A.max.y/mt;const C=T(p,x,v),D=T(p,x,w);if(new or([C[0],C[1],a],[D[0],D[1],h]).intersectsPrecise(o)===0){E&&(u.segments.push(E),E=void 0);continue}const F=A.segment;E&&E.vertexOffset!==F.vertexOffset&&(u.segments.push(E),E=void 0),E?(E.vertexLength+=F.vertexLength,E.primitiveLength+=F.primitiveLength):E={vertexOffset:F.vertexOffset,primitiveLength:F.primitiveLength,vertexLength:F.vertexLength,primitiveOffset:F.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&u.segments.push(E),u}encodeCentroid(e,i){const o=e.centroid(),u=i.span(),a=Math.min(7,Math.round(u.x*this.tileToMeter/10)),h=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Se(gt(o.x,1,mt-1)<<3|a,gt(o.y,1,mt-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new Se(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const u=i[0][0]!==o?0:1;return new Se(6|(i[0][0]!==o?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==o?2:3;return new Se((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Za,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,u=e.flags&Za?D0:e.centroidXY,a=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||a!==u.x){for(let h=i;h<o;++h)this.centroidVertexArray.emplace(h,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(M_(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const h of this.centroidData)h.flags&=2147483647;const a=[];for(const h of this.activeReplacements){if(h.order<o)continue;const _=Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z);for(const b of this.centroidData)if(!(b.flags&Za||h.min.x>b.max.x||b.min.x>h.max.x||h.min.y>b.max.y||b.min.y>h.max.y))for(let E=0;E<b.footprintSegLen;E++){const p=this.footprintSegments[b.footprintSegIdx+E];if(a.length=0,hE(this.footprintVertices,p.vertexOffset,p.vertexCount,h.footprintTileId.canonical,e.canonical,a),I0(h.footprint,a,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-_)){b.flags|=Za;break}}}for(const h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let u=!1;for(let a=0;a<o.footprintSegLen;a++){const h=this.footprintSegments[o.footprintSegIdx+a];let _=0;for(const b of h.ringIndices){for(let E=_,p=b+_-1;E<b+_;p=E++){const x=this.footprintVertices.int16[2*(E+h.vertexOffset)+0],T=this.footprintVertices.int16[2*(E+h.vertexOffset)+1],v=this.footprintVertices.int16[2*(p+h.vertexOffset)+1];T>i!=v>i&&e<(this.footprintVertices.int16[2*(p+h.vertexOffset)+0]-x)*(i-T)/(v-T)+x&&(u=!u)}_=b}}return u}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,u=!0;const a=4*(e+mt)*mt+(i+mt);if(this.partLookup.hasOwnProperty(a)){const h=this.partLookup[a];return h?{height:h.height,hidden:!!(h.flags&Za)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||i>h.max.y||h.min.y>i||this.footprintContainsPoint(e,i,h)&&h&&h.height>o&&(o=h.height,this.partLookup[a]=h,u=!!(h.flags&Za));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:u};this.partLookup[a]=void 0}}function N0(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function uE(n,e,i,o){const u=e.sub(n)._perp()._unit(),a=i.sub(e)._perp()._unit();return V0(n,e,i,N0(u,a),o)}function V0(n,e,i,o,u){const a=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(i)/3,u*a/o)}function C_(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function U0(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function j0(n,e,i){if(n.x<0||n.x>=mt||e.x<0||e.x>=mt||i.x<0||i.x>=mt)return!1;const o=i.sub(e),u=o.perp(),a=n.sub(e);return(o.x*a.x+o.y*a.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(a.x*a.x+a.y*a.y))>-.866&&u.x*a.x+u.y*a.y<0}function G0(n,e,i){const o=e?2|n:-3&n;return i?1|o:-2&o}function q0(){const n=Math.PI/32,e=Math.tan(n),i=k;return i*Math.sqrt(1+2*e*e)-i}function $0(n,e,i){const o=1<<i.z,u=ae(i.x/o),a=ae((i.x+1)/o),h=oe(i.y/o),_=oe((i.y+1)/o);return function(b,E,p,x,T=0,v){const w=[];if(!b.length||!p||!x)return w;const A=(G,Y)=>{for(const te of G)w.push({polygon:te,bounds:Y})},C=Math.ceil(Math.log2(p)),D=Math.ceil(Math.log2(x)),F=C-D,V=[];for(let G=0;G<Math.abs(F);G++)V.push(F>0?0:1);for(let G=0;G<Math.min(C,D);G++)V.push(0),V.push(1);let z=b;if(z=mp(z,E[0].y-T,E[1].y+T,1),z=mp(z,E[0].x-T,E[1].x+T,0),!z.length)return w;const j=[];for(V.length?j.push({polygons:z,bounds:E,depth:0}):A(z,E);j.length;){const G=j.pop(),Y=G.depth,te=V[Y],re=G.bounds[0],Q=G.bounds[1],ue=te===0?re.x:re.y,se=te===0?Q.x:Q.y,de=v?v(te,ue,se):.5*(ue+se),we=mp(G.polygons,ue-T,de+T,te),Ee=mp(G.polygons,de-T,se+T,te);if(we.length){const Me=[re,new Se(te===0?de:Q.x,te===1?de:Q.y)];V.length>Y+1?j.push({polygons:we,bounds:Me,depth:Y+1}):A(we,Me)}if(Ee.length){const Me=[new Se(te===0?de:re.x,te===1?de:re.y),Q];V.length>Y+1?j.push({polygons:Ee,bounds:Me,depth:Y+1}):A(Ee,Me)}}return w}(n,e,Math.ceil((a-u)/11.25),Math.ceil((h-_)/11.25),1,(b,E,p)=>{if(b===0)return .5*(E+p);{const x=oe((i.y+E/mt)/o);return(ne(.5*(oe((i.y+p/mt)/o)+x))*o-i.y)*mt}})}function hE(n,e,i,o,u,a){const h=Math.pow(2,o.z-u.z);for(let _=0;_<i;_++){let b=n.int16[2*(_+e)+0],E=n.int16[2*(_+e)+1];b=(b+u.x*mt)*h-o.x*mt,E=(E+u.y*mt)*h-o.y*mt,a.push(new Se(b,E))}}let Z0,H0;function hd(n,e){return n.x*e.x+n.y*e.y}function W0(n,e){if(n.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const a=e[i],h=n[0],_=u.sub(o),b=a.sub(o),E=h.sub(o),p=hd(_,_),x=hd(_,b),T=hd(b,b),v=hd(E,_),w=hd(E,b),A=p*T-x*x,C=(T*v-x*w)/A,D=(p*w-x*v)/A,F=o.z*(1-C-D)+u.z*C+a.z*D;if(isFinite(F))return F}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function X0(n,e,i,o,u,a,h,_){const b=h*u.getElevationAt(n,e,!0,!0),E=a[0]!==0,p=E?a[1]===0?h*(a[0]/7-450):h*function(x,T,v){const w=Math.floor(T[0]/8),A=Math.floor(T[1]/8),C=10*(T[0]-8*w),D=10*(T[1]-8*A),F=x.getElevationAt(w,A,!0,!0),V=x.getMeterToDEM(v),z=Math.floor(.5*(C*V-1)),j=Math.floor(.5*(D*V-1)),G=x.tileCoordToPixel(w,A),Y=2*z+1,te=2*j+1,re=function(Ee,Me,Ie,Be,Pe){return[Ee.getElevationAtPixel(Me,Ie,!0),Ee.getElevationAtPixel(Me+Pe,Ie,!0),Ee.getElevationAtPixel(Me,Ie+Pe,!0),Ee.getElevationAtPixel(Me+Be,Ie+Pe,!0)]}(x,G.x-z,G.y-j,Y,te),Q=Math.abs(re[0]-re[1]),ue=Math.abs(re[2]-re[3]),se=Math.abs(re[0]-re[2])+Math.abs(re[1]-re[3]),de=Math.min(.25,.5*V*(Q+ue)/Y),we=Math.min(.25,.5*V*se/te);return F+Math.max(de*C,we*D)}(u,a,_):b;return{base:b+(i===0)?-1:i,top:E?Math.max(p+o,b+i+2):b+o}}At(xp,"FillExtrusionBucket",{omit:["layers","features"]}),At(k0,"PartData"),At(z0,"FootprintSegment"),At(O0,"BorderCentroidData"),At(F0,"GroundEffect");const dE=Oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),fE=Oi([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:pE}=dE,mE=Oi([{name:"a_packed",components:4,type:"Float32"}]),{members:_E}=mE,gE=Oi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:yE}=gE;class Y0{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new $a({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=cn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const u=[];let a=e.length%2==1?-e[e.length-1]*o:0,h=e[0]*o,_=!0;u.push({left:a,right:h,isDash:_,zeroLength:e[0]===0});let b=e[0];for(let E=1;E<e.length;E++){_=!_;const p=e[E];a=b*o,b+=p,h=b*o,u.push({left:a,right:h,isDash:_,zeroLength:p===0})}return u}addRoundDash(e,i,o){const u=i/2;for(let a=-o;a<=o;a++){const h=this.width*(this.nextRow+o+a);let _=0,b=e[_];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++_]);const p=Math.abs(E-b.left),x=Math.abs(E-b.right),T=Math.min(p,x);let v;const w=a/o*(u+1);if(b.isDash){const A=u-Math.abs(w);v=Math.sqrt(T*T+A*A)}else v=u-Math.sqrt(T*T+w*w);this.image.data[h+E]=Math.max(0,Math.min(255,v+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const E=e[b],p=e[b+1];E.zeroLength?e.splice(b,1):p&&p.isDash===E.isDash&&(p.left=E.left,e.splice(b,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const a=this.width*this.nextRow;let h=0,_=e[h];for(let b=0;b<this.width;b++){b/_.right>1&&(_=e[++h]);const E=Math.abs(b-_.left),p=Math.abs(b-_.right),x=Math.min(E,p);this.image.data[a+b]=Math.max(0,Math.min(255,(_.isDash?x:-x)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const u=i==="round",a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return zi("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let p=0;p<e.length;p++)e[p]<0&&(zi("Negative value is found in line dasharray, replacing values with 0"),e[p]=0),_+=e[p];if(_!==0){const p=this.width/_,x=this.getDashRanges(e,this.width,p);u?this.addRoundDash(x,p,a):this.addRegularDash(x,i==="square"?.5*p:0)}const b=this.nextRow+a;this.nextRow+=h;const E={tl:[b,a],br:[_,0]};return this.positions[o]=E,E}}At(Y0,"LineAtlas");const xE=xu.VectorTileFeature.types,vE=Math.cos(Math.PI/180*37.5),bE=Math.cos(Math.PI/180*5);class P_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Uh,this.layoutVertexArray2=new Ws,this.patternVertexArray=new bo,this.indexArray=new ln,this.programConfigurations=new To(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new wr,this.maxLineLength=0,this.zOffsetVertexArray=new Fa,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:mt/64}updateFootprints(e,i){}populate(e,i,o,u){this.hasPattern=y_("line",this.layers,i);const a=this.layers[0].layout.get("line-sort-key"),h=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!h.isConstant()||!!h.constantOr(0);const _=[];for(const{feature:x,id:T,index:v,sourceLayerIndex:w}of e){const A=this.layers[0]._featureFilter.needGeometry,C=at(x,A);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),C,o))continue;const D=a?a.evaluate(C,{},o):void 0,F={id:T,properties:x.properties,type:x.type,sourceLayerIndex:w,index:v,geometry:A?C.geometry:st(x,o,u),patterns:{},sortKey:D};_.push(F)}a&&_.sort((x,T)=>x.sortKey-T.sortKey);const{lineAtlas:b,featureIndex:E}=i,p=this.addConstantDashes(b);for(const x of _){const{geometry:T,index:v,sourceLayerIndex:w}=x;if(p&&this.addFeatureDashes(x,b),this.hasPattern){const A=x_("line",this.layers,x,this.zoom,i);this.patternFeatures.push(A)}else this.addFeature(x,T,v,o,b.positions,i.availableImages,i.brightness);E.insert(e[v].feature,T,v,w,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const u=o.paint.get("line-dasharray").value,a=o.layout.get("line-cap").value;if(u.kind!=="constant"||a.kind!=="constant")i=!0;else{const h=a.value,_=u.value;if(!_)continue;e.addDash(_,h)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const u of this.layers){const a=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(a.kind==="constant"&&h.kind==="constant")continue;let _,b;if(a.kind==="constant"){if(_=a.value,!_)continue}else _=a.evaluate({zoom:o},e);b=h.kind==="constant"?h.value:h.evaluate({zoom:o},e),i.addDash(_,b),e.patterns[u.id]=i.getKey(_,b)}}update(e,i,o,u,a){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,u,a)}addFeatures(e,i,o,u,a,h){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,o,u,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,_E)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,yE)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,fE.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pE),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,a,h,_){const b=this.layers[0].layout,E=b.get("line-join").evaluate(e,{}),p=b.get("line-cap").evaluate(e,{}),x=b.get("line-miter-limit"),T=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const v of i)this.addLine(v,e,u,E,p,x,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,h,u,_)}addLine(e,i,o,u,a,h,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const b={zoom:this.zoom,lineProgress:void 0},E=this.layers[0].layout,p=u==="none";if(this.patternJoinNone=this.hasPattern&&p,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=xE[i.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let v=0;for(;v<T-1&&e[v].equals(e[v+1]);)v++;if(T<(x?3:2))return;u==="bevel"&&(h=1.05);const w=this.overscaling<=16?15*mt/(512*this.overscaling):0,A=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let C,D,F,V,z,j;this.e1=this.e2=-1,x&&(C=e[T-2],z=e[v].sub(C)._unit()._perp());for(let G=v;G<T;G++){if(F=G===T-1?x?e[v+1]:void 0:e[G+1],F&&e[G].equals(F))continue;if(z&&(V=z),C&&(D=C),C=e[G],this.hasZOffset){const Me=E.get("line-z-offset").value;if(Me.kind==="constant")j=Me.value;else{if(this.lineClips){const Ie=this.totalDistance/(this.lineClips.end-this.lineClips.start);b.lineProgress=(Ie*this.lineClips.start+this.distance+(D?D.dist(C):0))/Ie}else zi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),b.lineProgress=0;j=Me.evaluate(b,i)}j=j||0}z=F?F.sub(C)._unit()._perp():V,V=V||z;const Y=D&&F;let te=Y?u:x||p?"butt":a;const re=V.x*z.x+V.y*z.y;if(p){const Me=function(Ie){if(Ie.patternJoinNone){const Be=Ie.segmentPoints.length/2,Pe=Ie.lineSoFar-Ie.segmentStart;for(let Ze=0;Ze<Be;++Ze){const Je=Ie.segmentPoints[2*Ze+1],Ue=Math.round(Ie.segmentPoints[2*Ze])+.5+.25*Je;Ie.patternVertexArray.emplaceBack(Ue,Pe,Ie.segmentStart),Ie.patternVertexArray.emplaceBack(Ue,Pe,Ie.segmentStart)}Ie.segmentPoints.length=0}Ie.e1=Ie.e2=-1};if(Y&&re<bE){this.updateDistance(D,C),this.addCurrentVertex(C,V,1,1,A,j),Me(this),this.addCurrentVertex(C,z,-1,-1,A,j);continue}if(D){if(!F){this.updateDistance(D,C),this.addCurrentVertex(C,V,1,1,A,j),Me(this);continue}te="miter"}}let Q=V.add(z);Q.x===0&&Q.y===0||Q._unit();const ue=Q.x*z.x+Q.y*z.y,se=ue!==0?1/ue:1/0,de=2*Math.sqrt(2-2*ue),we=ue<vE&&D&&F,Ee=V.x*z.y-V.y*z.x>0;if(we&&G>v){const Me=C.dist(D);if(Me>2*w){const Ie=C.sub(C.sub(D)._mult(w/Me)._round());this.updateDistance(D,Ie),this.addCurrentVertex(Ie,V,0,0,A,j),D=Ie}}if(Y&&te==="round"&&(se<_?te="miter":se<=2&&(te="fakeround")),te==="miter"&&se>h&&(te="bevel"),te==="bevel"&&(se>2&&(te="flipbevel"),se<h&&(te="miter")),D&&this.updateDistance(D,C),te==="miter")Q._mult(se),this.addCurrentVertex(C,Q,0,0,A,j);else if(te==="flipbevel"){if(se>100)Q=z.mult(-1);else{const Me=se*V.add(z).mag()/V.sub(z).mag();Q._perp()._mult(Me*(Ee?-1:1))}this.addCurrentVertex(C,Q,0,0,A,j),this.addCurrentVertex(C,Q.mult(-1),0,0,A,j)}else if(te==="bevel"||te==="fakeround"){const Me=-Math.sqrt(se*se-1),Ie=Ee?Me:0,Be=Ee?0:Me;if(D&&this.addCurrentVertex(C,V,Ie,Be,A,j),te==="fakeround"){const Pe=Math.round(180*de/Math.PI/20);for(let Ze=1;Ze<Pe;Ze++){let Je=Ze/Pe;if(Je!==.5){const xt=Je-.5;Je+=Je*xt*(Je-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*xt*xt+(.848013+re*(.215638*re-1.06021)))}const Ue=z.sub(V)._mult(Je)._add(V)._unit()._mult(Ee?-1:1);this.addHalfVertex(C,Ue.x,Ue.y,!1,Ee,0,A,j)}}F&&this.addCurrentVertex(C,z,-Ie,-Be,A,j)}else te==="butt"?this.addCurrentVertex(C,Q,0,0,A,j):te==="square"?(D||this.addCurrentVertex(C,Q,-1,-1,A,j),this.addCurrentVertex(C,Q,0,0,A,j),D&&this.addCurrentVertex(C,Q,1,1,A,j)):te==="round"&&(D&&(this.addCurrentVertex(C,V,0,0,A,j),this.addCurrentVertex(C,V,1,1,A,j,!0)),F&&(this.addCurrentVertex(C,z,-1,-1,A,j,!0),this.addCurrentVertex(C,z,0,0,A,j)));if(we&&G<T-1){const Me=C.dist(F);if(Me>2*w){const Ie=C.add(F.sub(C)._mult(w/Me)._round());this.updateDistance(C,Ie),this.addCurrentVertex(Ie,z,0,0,A,j),C=Ie}}}}addVerticesTo(e,i,o,u,a,h,_,b,E,p){const x=(i.w-e.w)/this.tessellationStep|0;if(x>1){this.lineSoFar=e.w;const T=(i.x-e.x)/x,v=(i.y-e.y)/x,w=(i.z-e.z)/x,A=(i.w-e.w)/x;for(let C=1;C<x;++C)e.x+=T,e.y+=v,e.z+=w,this.lineSoFar+=A,this.addHalfVertex(e,o,u,p,!1,_,E,e.z),this.addHalfVertex(e,a,h,p,!0,-b,E,e.z)}this.lineSoFar=i.w,this.addHalfVertex(i,o,u,p,!1,_,E,i.z),this.addHalfVertex(i,a,h,p,!0,-b,E,i.z)}addCurrentVertex(e,i,o,u,a,h,_=!1){const b=i.x+i.y*o,E=i.y-i.x*o,p=i.y*u-i.x,x=-i.y-i.x*u;if(h!=null){const v=mt+10,w=h,A=new w0(e.x,e.y,w,this.lineSoFar),C=K0(e,-10,v),D=this.lineSoFar;if(this.currentVertex)if(C){const F=this.currentVertexIsOutside,V=this.currentVertex,z=new w0(e.x,e.y,w,this.lineSoFar);E0(V,z,-10,v),K0(z,-10,v)||(F&&(this.e1=this.e2=-1,this.lineSoFar=V.w,this.addHalfVertex(V,b,E,_,!1,o,a,V.z),this.addHalfVertex(V,p,x,_,!0,-u,a,V.z)),this.addVerticesTo(V,z,b,E,p,x,o,u,a,_))}else{const F=this.currentVertex;this.currentVertexIsOutside&&(E0(F,A,-10,v),this.e1=this.e2=-1,this.lineSoFar=F.w,this.addHalfVertex(F,b,E,_,!1,o,a,F.z),this.addHalfVertex(F,p,x,_,!0,-u,a,F.z)),this.addVerticesTo(F,A,b,E,p,x,o,u,a,_)}else C||(this.addHalfVertex(e,b,E,_,!1,o,a,h),this.addHalfVertex(e,p,x,_,!0,-u,a,h));this.currentVertex=A,this.currentVertexIsOutside=C,this.lineSoFar=D}else this.addHalfVertex(e,b,E,_,!1,o,a,h),this.addHalfVertex(e,p,x,_,!0,-u,a,h)}addHalfVertex({x:e,y:i},o,u,a,h,_,b,E){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(a?1:0),(i<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const p=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),b.primitiveLength++),h?this.e2=p:this.e1=p,E!=null&&this.zOffsetVertexArray.emplaceBack(E)}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}function K0(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let J0,Q0;function ex(n,e,i){return e*(mt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function tx(n,e){return 1/ex(n,1,e.tileZoom)}function ix(n,e,i,o){return n.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}At(P_,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const rx=n=>{const e=[];nx(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=n.layout.get("line-join").constantOr("miter")==="none",u=!!n.paint.get("line-pattern").constantOr(1);return o&&u&&e.push("LINE_JOIN_NONE"),e};function nx(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let R_;const sx=()=>R_||(R_={layout:J0||(J0=new pr({"line-cap":new Bt(Oe.layout_line["line-cap"]),"line-join":new Bt(Oe.layout_line["line-join"]),"line-miter-limit":new ut(Oe.layout_line["line-miter-limit"]),"line-round-limit":new ut(Oe.layout_line["line-round-limit"]),"line-sort-key":new Bt(Oe.layout_line["line-sort-key"]),"line-z-offset":new Bt(Oe.layout_line["line-z-offset"]),visibility:new ut(Oe.layout_line.visibility)})),paint:Q0||(Q0=new pr({"line-opacity":new Bt(Oe.paint_line["line-opacity"]),"line-color":new Bt(Oe.paint_line["line-color"]),"line-translate":new ut(Oe.paint_line["line-translate"]),"line-translate-anchor":new ut(Oe.paint_line["line-translate-anchor"]),"line-width":new Bt(Oe.paint_line["line-width"]),"line-gap-width":new Bt(Oe.paint_line["line-gap-width"]),"line-offset":new Bt(Oe.paint_line["line-offset"]),"line-blur":new Bt(Oe.paint_line["line-blur"]),"line-dasharray":new Bt(Oe.paint_line["line-dasharray"]),"line-pattern":new Bt(Oe.paint_line["line-pattern"]),"line-gradient":new ys(Oe.paint_line["line-gradient"]),"line-trim-offset":new ut(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new ut(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new ut(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new ut(Oe.paint_line["line-emissive-strength"]),"line-border-width":new Bt(Oe.paint_line["line-border-width"]),"line-border-color":new Bt(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new ut(Oe.paint_line["line-occlusion-opacity"])}))},R_);class wE extends Bt{possiblyEvaluate(e,i){return i=new br(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=Mi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let dd;function ox(n,e){return e>0?e+2*n:n}const TE=Oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),EE=Oi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),SE=Oi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ME=Oi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),AE=Oi([{name:"a_texb",components:2,type:"Uint16"}]),IE=Oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),CE=Oi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ax=Oi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),PE=Oi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Oi([{name:"triangle",components:3,type:"Uint16"}]),Oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Oi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Oi([{type:"Float32",name:"offsetX"}]),Oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var hn=24;const Qs=128;function L_(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new br(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let a=0;for(;a<o.length&&o[a]<=n;)a++;a=Math.max(0,a-1);let h=a;for(;h<o.length&&o[h]<n+1;)h++;h=Math.min(o.length-1,h);const _=o[a],b=o[h];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:b,minSize:i.evaluate(new br(_)),maxSize:i.evaluate(new br(b)),interpolationType:u}}}function vp(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Qs:n.kind==="composite"?Yt(o/Qs,u/Qs,i):e}function vu(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:a,maxZoom:h}=n,_=u?gt(Xn.interpolationFactor(u,e,a,h),0,1):0;n.kind==="camera"?o=Yt(n.minSize,n.maxSize,_):i=_}return{uSizeT:i,uSize:o}}var RE=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Qs,evaluateSizeForFeature:vp,evaluateSizeForZoom:vu,getSizeData:L_});function LE(n,e,i){return n.sections.forEach(o=>{o.text=function(u,a,h){const _=a.layout.get("text-transform").evaluate(h,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),kn.applyArabicShaping&&(u=kn.applyArabicShaping(u)),u}(o.text,e,i)}),n}const fd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function DE(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function zE(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var lx,D_,cx,z_={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function kE(){return lx||(lx=1,z_.read=function(n,e,i,o,u){var a,h,_=8*u-o-1,b=(1<<_)-1,E=b>>1,p=-7,x=i?u-1:0,T=i?-1:1,v=n[e+x];for(x+=T,a=v&(1<<-p)-1,v>>=-p,p+=_;p>0;a=256*a+n[e+x],x+=T,p-=8);for(h=a&(1<<-p)-1,a>>=-p,p+=o;p>0;h=256*h+n[e+x],x+=T,p-=8);if(a===0)a=1-E;else{if(a===b)return h?NaN:1/0*(v?-1:1);h+=Math.pow(2,o),a-=E}return(v?-1:1)*h*Math.pow(2,a-o)},z_.write=function(n,e,i,o,u,a){var h,_,b,E=8*a-u-1,p=(1<<E)-1,x=p>>1,T=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=o?0:a-1,w=o?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,h=p):(h=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-h))<1&&(h--,b*=2),(e+=h+x>=1?T/b:T*Math.pow(2,1-x))*b>=2&&(h++,b/=2),h+x>=p?(_=0,h=p):h+x>=1?(_=(e*b-1)*Math.pow(2,u),h+=x):(_=e*Math.pow(2,x-1)*Math.pow(2,u),h=0));u>=8;n[i+v]=255&_,v+=w,_/=256,u-=8);for(h=h<<u|_,E+=u;E>0;n[i+v]=255&h,v+=w,h/=256,E-=8);n[i+v-w]|=128*A}),z_}function ux(){if(cx)return D_;cx=1,D_=e;var n=kE();function e(z){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(z)?z:new Uint8Array(z||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,u=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function a(z){return z.type===e.Bytes?z.readVarint()+z.pos:z.pos+1}function h(z,j,G){return G?4294967296*j+(z>>>0):4294967296*(j>>>0)+(z>>>0)}function _(z,j,G){var Y=j<=16383?1:j<=2097151?2:j<=268435455?3:Math.floor(Math.log(j)/(7*Math.LN2));G.realloc(Y);for(var te=G.pos-1;te>=z;te--)G.buf[te+Y]=G.buf[te]}function b(z,j){for(var G=0;G<z.length;G++)j.writeVarint(z[G])}function E(z,j){for(var G=0;G<z.length;G++)j.writeSVarint(z[G])}function p(z,j){for(var G=0;G<z.length;G++)j.writeFloat(z[G])}function x(z,j){for(var G=0;G<z.length;G++)j.writeDouble(z[G])}function T(z,j){for(var G=0;G<z.length;G++)j.writeBoolean(z[G])}function v(z,j){for(var G=0;G<z.length;G++)j.writeFixed32(z[G])}function w(z,j){for(var G=0;G<z.length;G++)j.writeSFixed32(z[G])}function A(z,j){for(var G=0;G<z.length;G++)j.writeFixed64(z[G])}function C(z,j){for(var G=0;G<z.length;G++)j.writeSFixed64(z[G])}function D(z,j){return(z[j]|z[j+1]<<8|z[j+2]<<16)+16777216*z[j+3]}function F(z,j,G){z[G]=j,z[G+1]=j>>>8,z[G+2]=j>>>16,z[G+3]=j>>>24}function V(z,j){return(z[j]|z[j+1]<<8|z[j+2]<<16)+(z[j+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(z,j,G){for(G=G||this.length;this.pos<G;){var Y=this.readVarint(),te=Y>>3,re=this.pos;this.type=7&Y,z(te,j,this),this.pos===re&&this.skip(Y)}return j},readMessage:function(z,j){return this.readFields(z,j,this.readVarint()+this.pos)},readFixed32:function(){var z=D(this.buf,this.pos);return this.pos+=4,z},readSFixed32:function(){var z=V(this.buf,this.pos);return this.pos+=4,z},readFixed64:function(){var z=D(this.buf,this.pos)+D(this.buf,this.pos+4)*i;return this.pos+=8,z},readSFixed64:function(){var z=D(this.buf,this.pos)+V(this.buf,this.pos+4)*i;return this.pos+=8,z},readFloat:function(){var z=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,z},readDouble:function(){var z=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,z},readVarint:function(z){var j,G,Y=this.buf;return j=127&(G=Y[this.pos++]),G<128?j:(j|=(127&(G=Y[this.pos++]))<<7,G<128?j:(j|=(127&(G=Y[this.pos++]))<<14,G<128?j:(j|=(127&(G=Y[this.pos++]))<<21,G<128?j:function(te,re,Q){var ue,se,de=Q.buf;if(ue=(112&(se=de[Q.pos++]))>>4,se<128||(ue|=(127&(se=de[Q.pos++]))<<3,se<128)||(ue|=(127&(se=de[Q.pos++]))<<10,se<128)||(ue|=(127&(se=de[Q.pos++]))<<17,se<128)||(ue|=(127&(se=de[Q.pos++]))<<24,se<128)||(ue|=(1&(se=de[Q.pos++]))<<31,se<128))return h(te,ue,re);throw new Error("Expected varint not more than 10 bytes")}(j|=(15&(G=Y[this.pos]))<<28,z,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var z=this.readVarint();return z%2==1?(z+1)/-2:z/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var z=this.readVarint()+this.pos,j=this.pos;return this.pos=z,z-j>=12&&u?function(G,Y,te){return u.decode(G.subarray(Y,te))}(this.buf,j,z):function(G,Y,te){for(var re="",Q=Y;Q<te;){var ue,se,de,we=G[Q],Ee=null,Me=we>239?4:we>223?3:we>191?2:1;if(Q+Me>te)break;Me===1?we<128&&(Ee=we):Me===2?(192&(ue=G[Q+1]))==128&&(Ee=(31&we)<<6|63&ue)<=127&&(Ee=null):Me===3?(se=G[Q+2],(192&(ue=G[Q+1]))==128&&(192&se)==128&&((Ee=(15&we)<<12|(63&ue)<<6|63&se)<=2047||Ee>=55296&&Ee<=57343)&&(Ee=null)):Me===4&&(se=G[Q+2],de=G[Q+3],(192&(ue=G[Q+1]))==128&&(192&se)==128&&(192&de)==128&&((Ee=(15&we)<<18|(63&ue)<<12|(63&se)<<6|63&de)<=65535||Ee>=1114112)&&(Ee=null)),Ee===null?(Ee=65533,Me=1):Ee>65535&&(Ee-=65536,re+=String.fromCharCode(Ee>>>10&1023|55296),Ee=56320|1023&Ee),re+=String.fromCharCode(Ee),Q+=Me}return re}(this.buf,j,z)},readBytes:function(){var z=this.readVarint()+this.pos,j=this.buf.subarray(this.pos,z);return this.pos=z,j},readPackedVarint:function(z,j){if(this.type!==e.Bytes)return z.push(this.readVarint(j));var G=a(this);for(z=z||[];this.pos<G;)z.push(this.readVarint(j));return z},readPackedSVarint:function(z){if(this.type!==e.Bytes)return z.push(this.readSVarint());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readSVarint());return z},readPackedBoolean:function(z){if(this.type!==e.Bytes)return z.push(this.readBoolean());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readBoolean());return z},readPackedFloat:function(z){if(this.type!==e.Bytes)return z.push(this.readFloat());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readFloat());return z},readPackedDouble:function(z){if(this.type!==e.Bytes)return z.push(this.readDouble());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readDouble());return z},readPackedFixed32:function(z){if(this.type!==e.Bytes)return z.push(this.readFixed32());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readFixed32());return z},readPackedSFixed32:function(z){if(this.type!==e.Bytes)return z.push(this.readSFixed32());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readSFixed32());return z},readPackedFixed64:function(z){if(this.type!==e.Bytes)return z.push(this.readFixed64());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readFixed64());return z},readPackedSFixed64:function(z){if(this.type!==e.Bytes)return z.push(this.readSFixed64());var j=a(this);for(z=z||[];this.pos<j;)z.push(this.readSFixed64());return z},skip:function(z){var j=7&z;if(j===e.Varint)for(;this.buf[this.pos++]>127;);else if(j===e.Bytes)this.pos=this.readVarint()+this.pos;else if(j===e.Fixed32)this.pos+=4;else{if(j!==e.Fixed64)throw new Error("Unimplemented type: "+j);this.pos+=8}},writeTag:function(z,j){this.writeVarint(z<<3|j)},realloc:function(z){for(var j=this.length||16;j<this.pos+z;)j*=2;if(j!==this.length){var G=new Uint8Array(j);G.set(this.buf),this.buf=G,this.length=j}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(z){this.realloc(4),F(this.buf,z,this.pos),this.pos+=4},writeSFixed32:function(z){this.realloc(4),F(this.buf,z,this.pos),this.pos+=4},writeFixed64:function(z){this.realloc(8),F(this.buf,-1&z,this.pos),F(this.buf,Math.floor(z*o),this.pos+4),this.pos+=8},writeSFixed64:function(z){this.realloc(8),F(this.buf,-1&z,this.pos),F(this.buf,Math.floor(z*o),this.pos+4),this.pos+=8},writeVarint:function(z){(z=+z||0)>268435455||z<0?function(j,G){var Y,te;if(j>=0?(Y=j%4294967296|0,te=j/4294967296|0):(te=~(-j/4294967296),4294967295^(Y=~(-j%4294967296))?Y=Y+1|0:(Y=0,te=te+1|0)),j>=18446744073709552e3||j<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");G.realloc(10),function(re,Q,ue){ue.buf[ue.pos++]=127&re|128,re>>>=7,ue.buf[ue.pos++]=127&re|128,re>>>=7,ue.buf[ue.pos++]=127&re|128,re>>>=7,ue.buf[ue.pos++]=127&re|128,ue.buf[ue.pos]=127&(re>>>=7)}(Y,0,G),function(re,Q){var ue=(7&re)<<4;Q.buf[Q.pos++]|=ue|((re>>>=3)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re)))))}(te,G)}(z,this):(this.realloc(4),this.buf[this.pos++]=127&z|(z>127?128:0),z<=127||(this.buf[this.pos++]=127&(z>>>=7)|(z>127?128:0),z<=127||(this.buf[this.pos++]=127&(z>>>=7)|(z>127?128:0),z<=127||(this.buf[this.pos++]=z>>>7&127))))},writeSVarint:function(z){this.writeVarint(z<0?2*-z-1:2*z)},writeBoolean:function(z){this.writeVarint(!!z)},writeString:function(z){z=String(z),this.realloc(4*z.length),this.pos++;var j=this.pos;this.pos=function(Y,te,re){for(var Q,ue,se=0;se<te.length;se++){if((Q=te.charCodeAt(se))>55295&&Q<57344){if(!ue){Q>56319||se+1===te.length?(Y[re++]=239,Y[re++]=191,Y[re++]=189):ue=Q;continue}if(Q<56320){Y[re++]=239,Y[re++]=191,Y[re++]=189,ue=Q;continue}Q=ue-55296<<10|Q-56320|65536,ue=null}else ue&&(Y[re++]=239,Y[re++]=191,Y[re++]=189,ue=null);Q<128?Y[re++]=Q:(Q<2048?Y[re++]=Q>>6|192:(Q<65536?Y[re++]=Q>>12|224:(Y[re++]=Q>>18|240,Y[re++]=Q>>12&63|128),Y[re++]=Q>>6&63|128),Y[re++]=63&Q|128)}return re}(this.buf,z,this.pos);var G=this.pos-j;G>=128&&_(j,G,this),this.pos=j-1,this.writeVarint(G),this.pos+=G},writeFloat:function(z){this.realloc(4),n.write(this.buf,z,this.pos,!0,23,4),this.pos+=4},writeDouble:function(z){this.realloc(8),n.write(this.buf,z,this.pos,!0,52,8),this.pos+=8},writeBytes:function(z){var j=z.length;this.writeVarint(j),this.realloc(j);for(var G=0;G<j;G++)this.buf[this.pos++]=z[G]},writeRawMessage:function(z,j){this.pos++;var G=this.pos;z(j,this);var Y=this.pos-G;Y>=128&&_(G,Y,this),this.pos=G-1,this.writeVarint(Y),this.pos+=Y},writeMessage:function(z,j,G){this.writeTag(z,e.Bytes),this.writeRawMessage(j,G)},writePackedVarint:function(z,j){j.length&&this.writeMessage(z,b,j)},writePackedSVarint:function(z,j){j.length&&this.writeMessage(z,E,j)},writePackedBoolean:function(z,j){j.length&&this.writeMessage(z,T,j)},writePackedFloat:function(z,j){j.length&&this.writeMessage(z,p,j)},writePackedDouble:function(z,j){j.length&&this.writeMessage(z,x,j)},writePackedFixed32:function(z,j){j.length&&this.writeMessage(z,v,j)},writePackedSFixed32:function(z,j){j.length&&this.writeMessage(z,w,j)},writePackedFixed64:function(z,j){j.length&&this.writeMessage(z,A,j)},writePackedSFixed64:function(z,j){j.length&&this.writeMessage(z,C,j)},writeBytesField:function(z,j){this.writeTag(z,e.Bytes),this.writeBytes(j)},writeFixed32Field:function(z,j){this.writeTag(z,e.Fixed32),this.writeFixed32(j)},writeSFixed32Field:function(z,j){this.writeTag(z,e.Fixed32),this.writeSFixed32(j)},writeFixed64Field:function(z,j){this.writeTag(z,e.Fixed64),this.writeFixed64(j)},writeSFixed64Field:function(z,j){this.writeTag(z,e.Fixed64),this.writeSFixed64(j)},writeVarintField:function(z,j){this.writeTag(z,e.Varint),this.writeVarint(j)},writeSVarintField:function(z,j){this.writeTag(z,e.Varint),this.writeSVarint(j)},writeStringField:function(z,j){this.writeTag(z,e.Bytes),this.writeString(j)},writeFloatField:function(z,j){this.writeTag(z,e.Fixed32),this.writeFloat(j)},writeDoubleField:function(z,j){this.writeTag(z,e.Fixed64),this.writeDouble(j)},writeBooleanField:function(z,j){this.writeVarintField(z,!!j)}},D_}var bp=ce(ux());const k_=3;function OE(n,e,i){e.glyphs=[],n===1&&i.readMessage(BE,e)}function BE(n,e,i){if(n===3){const{id:o,bitmap:u,width:a,height:h,left:_,top:b,advance:E}=i.readMessage(FE,{});e.glyphs.push({id:o,bitmap:new $a({width:a+2*k_,height:h+2*k_},u),metrics:{width:a,height:h,left:_,top:b,advance:E}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function FE(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const hx=k_,bs={horizontal:1,vertical:2,horizontalOnly:3};class pd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new pd;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new pd;return i.imageName=e,i}}class bu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new bu;for(let u=0;u<e.sections.length;u++){const a=e.sections[u];a.image?o.addImageSection(a):o.addTextSection(a,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let u="";for(let a=0;a<i.length;a++){const h=i.charCodeAt(a+1)||null,_=i.charCodeAt(a-1)||null;u+=!o&&(h&&Ol(h)&&!fd[i[a+1]]||_&&Ol(_)&&!fd[i[a-1]])||!fd[i[a]]?i[a]:fd[i[a]]}return u}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&wp[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&wp[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new bu;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(pd.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void zi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(pd.forImage(i)),this.sectionIndex.push(this.sections.length-1)):zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function O_(n,e,i,o,u,a,h,_,b,E,p,x,T,v,w){const A=bu.fromFeature(n,u);x===bs.vertical&&A.verticalizePunctuation(T);let C=[];const D=function(G,Y,te,re,Q,ue){if(!G)return[];const se=[],de=function(Ie,Be,Pe,Ze,Je,Ue){let xt=0;for(let pt=0;pt<Ie.length();pt++){const ot=Ie.getSection(pt);xt+=dx(Ie.getCodePoint(pt),ot,Ze,Je,Be,Ue)}return xt/Math.max(1,Math.ceil(xt/Pe))}(G,Y,te,re,Q,ue),we=G.text.indexOf("​")>=0;let Ee=0;for(let Ie=0;Ie<G.length();Ie++){const Be=G.getSection(Ie),Pe=G.getCodePoint(Ie);if(wp[Pe]||(Ee+=dx(Pe,Be,re,Q,Y,ue)),Ie<G.length()-1){const Ze=!((Me=Pe)<11904||!(Ot["Bopomofo Extended"](Me)||Ot.Bopomofo(Me)||Ot["CJK Compatibility Forms"](Me)||Ot["CJK Compatibility Ideographs"](Me)||Ot["CJK Compatibility"](Me)||Ot["CJK Radicals Supplement"](Me)||Ot["CJK Strokes"](Me)||Ot["CJK Symbols and Punctuation"](Me)||Ot["CJK Unified Ideographs Extension A"](Me)||Ot["CJK Unified Ideographs"](Me)||Ot["Enclosed CJK Letters and Months"](Me)||Ot["Halfwidth and Fullwidth Forms"](Me)||Ot.Hiragana(Me)||Ot["Ideographic Description Characters"](Me)||Ot["Kangxi Radicals"](Me)||Ot["Katakana Phonetic Extensions"](Me)||Ot.Katakana(Me)||Ot["Vertical Forms"](Me)||Ot["Yi Radicals"](Me)||Ot["Yi Syllables"](Me)));(NE[Pe]||Ze||Be.imageName)&&se.push(px(Ie+1,Ee,de,se,VE(Pe,G.getCodePoint(Ie+1),Ze&&we),!1))}}var Me;return mx(px(G.length(),Ee,de,se,0,!0))}(A,E,a,e,o,v),{processBidirectionalText:F,processStyledBidirectionalText:V}=kn;if(F&&A.sections.length===1){const G=F(A.toString(),D);for(const Y of G){const te=new bu;te.text=Y,te.sections=A.sections;for(let re=0;re<Y.length;re++)te.sectionIndex.push(0);C.push(te)}}else if(V){const G=V(A.text,A.sectionIndex,D);for(const Y of G){const te=new bu;te.text=Y[0],te.sectionIndex=Y[1],te.sections=A.sections,C.push(te)}}else C=function(G,Y){const te=[],re=G.text;let Q=0;for(const ue of Y)te.push(G.substring(Q,ue)),Q=ue;return Q<re.length&&te.push(G.substring(Q,re.length)),te}(A,D);const z=[],j={positionedLines:z,text:A.toString(),top:p[1],bottom:p[1],left:p[0],right:p[0],writingMode:x,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(G,Y,te,re,Q,ue,se,de,we,Ee,Me,Ie){let Be=0,Pe=0,Ze=0;const Je=de==="right"?1:de==="left"?0:.5;let Ue=!1;for(const yt of Q){const Mt=yt.getSections();for(const ti of Mt){if(ti.imageName)continue;const mi=Y[ti.fontStack];if(mi&&(Ue=mi.ascender!==void 0&&mi.descender!==void 0,!Ue))break}if(!Ue)break}let xt=0;for(const yt of Q){yt.trim();const Mt=yt.getMaxScale(),ti=(Mt-1)*hn,mi={positionedGlyphs:[],lineOffset:0};G.positionedLines[xt]=mi;const ci=mi.positionedGlyphs;let ui=0;if(!yt.length()){Pe+=ue,++xt;continue}let gi=0,xi=0;for(let Zi=0;Zi<yt.length();Zi++){const ri=yt.getSection(Zi),Ni=yt.getSectionIndex(Zi),Ui=yt.getCodePoint(Zi);let ur=ri.scale,Ar=null,Nr=null,Ir=null,vr=hn,rn=0;const jr=!(we===bs.horizontal||!Me&&!eu(Ui)||Me&&(wp[Ui]||(pt=Ui,Ot.Arabic(pt)||Ot["Arabic Supplement"](pt)||Ot["Arabic Extended-A"](pt)||Ot["Arabic Presentation Forms-A"](pt)||Ot["Arabic Presentation Forms-B"](pt))));if(ri.imageName){const dn=re[ri.imageName];if(!dn)continue;Ir=ri.imageName,G.iconsInText=G.iconsInText||!0,Nr=dn.paddedRect;const ar=dn.displaySize;ur=ur*hn/Ie,Ar={width:ar[0],height:ar[1],left:0,top:-hx,advance:jr?ar[1]:ar[0],localGlyph:!1},rn=Ue?-Ar.height*ur:Mt*hn-17-ar[1]*ur,vr=Ar.advance;const Jn=(jr?ar[0]:ar[1])*ur-hn*Mt;Jn>0&&Jn>ui&&(ui=Jn)}else{const dn=te[ri.fontStack];if(!dn)continue;dn[Ui]&&(Nr=dn[Ui]);const ar=Y[ri.fontStack];if(!ar)continue;const Jn=ar.glyphs[Ui];if(!Jn)continue;if(Ar=Jn.metrics,vr=Ui!==8203?hn:0,Ue){const no=ar.ascender!==void 0?Math.abs(ar.ascender):0,Us=ar.descender!==void 0?Math.abs(ar.descender):0,js=(no+Us)*ur;gi<js&&(gi=js,xi=(no-Us)/2*ur),rn=-no*ur}else rn=(Mt-ur)*hn-17}jr?(G.verticalizable=!0,ci.push({glyph:Ui,imageName:Ir,x:Be,y:Pe+rn,vertical:jr,scale:ur,localGlyph:Ar.localGlyph,fontStack:ri.fontStack,sectionIndex:Ni,metrics:Ar,rect:Nr}),Be+=vr*ur+Ee):(ci.push({glyph:Ui,imageName:Ir,x:Be,y:Pe+rn,vertical:jr,scale:ur,localGlyph:Ar.localGlyph,fontStack:ri.fontStack,sectionIndex:Ni,metrics:Ar,rect:Nr}),Be+=Ar.advance*ur+Ee)}ci.length!==0&&(Ze=Math.max(Be-Ee,Ze),Ue?_x(ci,Je,ui,xi,ue*Mt/2):_x(ci,Je,ui,0,ue/2)),Be=0;const tr=ue*Mt+ui;mi.lineOffset=Math.max(ui,ti),Pe+=tr,++xt}var pt;const ot=Pe,{horizontalAlign:tt,verticalAlign:Nt}=B_(se);(function(yt,Mt,ti,mi,ci,ui){const gi=(Mt-ti)*ci,xi=-ui*mi;for(const tr of yt)for(const Zi of tr.positionedGlyphs)Zi.x+=gi,Zi.y+=xi})(G.positionedLines,Je,tt,Nt,Ze,ot),G.top+=-Nt*ot,G.bottom=G.top+ot,G.left+=-tt*Ze,G.right=G.left+Ze,G.hasBaseline=Ue}(j,e,i,o,C,h,_,b,x,E,T,w),!function(G){for(const Y of G)if(Y.positionedGlyphs.length!==0)return!1;return!0}(z)&&j}const wp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},NE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function dx(n,e,i,o,u,a){if(e.imageName){const h=o[e.imageName];return h?h.displaySize[0]*e.scale*hn/a+u:0}{const h=i[e.fontStack],_=h&&h.glyphs[n];return _?_.metrics.advance*e.scale+u:0}}function fx(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function VE(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function px(n,e,i,o,u,a){let h=null,_=fx(e,i,u,a);for(const b of o){const E=fx(e-b.x,i,u,a)+b.badness;E<=_&&(h=b,_=E)}return{index:n,x:e,priorBreak:h,badness:_}}function mx(n){return n?mx(n.priorBreak).concat(n.index):[]}function B_(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function _x(n,e,i,o,u){if(!(e||i||o||u))return;const a=n.length-1,h=n[a],_=(h.x+h.metrics.advance*h.scale)*e;for(let b=0;b<=a;b++)n[b].x-=_,n[b].y+=i+o+u}function UE(n,e,i,o){const{horizontalAlign:u,verticalAlign:a}=B_(o),h=i[0]-n.displaySize[0]*u,_=i[1]-n.displaySize[1]*a;return{imagePrimary:n,imageSecondary:e,top:_,bottom:_+n.displaySize[1],left:h,right:h+n.displaySize[0]}}function gx(n,e,i,o,u,a){const h=n.imagePrimary;let _;if(h.content){const C=h.content,D=h.pixelRatio||1;_=[C[0]/D,C[1]/D,h.displaySize[0]-C[2]/D,h.displaySize[1]-C[3]/D]}const b=e.left*a,E=e.right*a;let p,x,T,v;i==="width"||i==="both"?(v=u[0]+b-o[3],x=u[0]+E+o[1]):(v=u[0]+(b+E-h.displaySize[0])/2,x=v+h.displaySize[0]);const w=e.top*a,A=e.bottom*a;return i==="height"||i==="both"?(p=u[1]+w-o[0],T=u[1]+A+o[2]):(p=u[1]+(w+A-h.displaySize[1])/2,T=p+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:p,right:x,bottom:T,left:v,collisionPadding:_}}class Qo extends Se{constructor(e,i,o,u,a){super(e,i),this.angle=u,this.z=o,a!==void 0&&(this.segment=a)}clone(){return new Qo(this.x,this.y,this.z,this.angle,this.segment)}}function yx(n,e,i,o,u){if(e.segment===void 0)return!0;let a=e,h=e.segment+1,_=0;for(;_>-i/2;){if(h--,h<0)return!1;_-=n[h].dist(a),a=n[h]}_+=n[h].dist(n[h+1]),h++;const b=[];let E=0;for(;_<i/2;){const p=n[h],x=n[h+1];if(!x)return!1;let T=n[h-1].angleTo(p)-p.angleTo(x);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:_,angleDelta:T}),E+=T;_-b[0].distance>o;)E-=b.shift().angleDelta;if(E>u)return!1;h++,_+=p.dist(x)}return!0}function xx(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function vx(n,e,i){return n?.6*e*i:0}function bx(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function jE(n,e,i,o,u,a){const h=vx(i,u,a),_=bx(i,o)*a;let b=0;const E=xx(n)/2;for(let p=0;p<n.length-1;p++){const x=n[p],T=n[p+1],v=x.dist(T);if(b+v>E){const w=(E-b)/v,A=Yt(x.x,T.x,w),C=Yt(x.y,T.y,w),D=new Qo(A,C,0,T.angleTo(x),p);return!h||yx(n,D,_,h,e)?D:void 0}b+=v}}function GE(n,e,i,o,u,a,h,_,b){const E=vx(o,a,h),p=bx(o,u),x=p*h,T=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return e-x<e/4&&(e=x+e/4),wx(n,T?e/2*_%e:(p/2+2*a)*h*_%e,e,E,i,x,T,!1,b)}function wx(n,e,i,o,u,a,h,_,b){const E=a/2,p=xx(n);let x=0,T=e-i,v=[];for(let w=0;w<n.length-1;w++){const A=n[w],C=n[w+1],D=A.dist(C),F=C.angleTo(A);for(;T+i<x+D;){T+=i;const V=(T-x)/D,z=Yt(A.x,C.x,V),j=Yt(A.y,C.y,V);if(z>=0&&z<b&&j>=0&&j<b&&T-E>=0&&T+E<=p){const G=new Qo(z,j,0,F,w);o&&!yx(n,G,a,o,u)||v.push(G)}}x+=D}return _||v.length||h||(v=wx(n,x/2,i,o,u,a,h,!0,b)),v}function Tx(n,e,i,o,u){const a=[];for(let h=0;h<n.length;h++){const _=n[h];let b;for(let E=0;E<_.length-1;E++){let p=_[E],x=_[E+1];p.x<e&&x.x<e||(p.x<e?p=new Se(e,p.y+(e-p.x)/(x.x-p.x)*(x.y-p.y))._round():x.x<e&&(x=new Se(e,p.y+(e-p.x)/(x.x-p.x)*(x.y-p.y))._round()),p.y<i&&x.y<i||(p.y<i?p=new Se(p.x+(i-p.y)/(x.y-p.y)*(x.x-p.x),i)._round():x.y<i&&(x=new Se(p.x+(i-p.y)/(x.y-p.y)*(x.x-p.x),i)._round()),p.x>=o&&x.x>=o||(p.x>=o?p=new Se(o,p.y+(o-p.x)/(x.x-p.x)*(x.y-p.y))._round():x.x>=o&&(x=new Se(o,p.y+(o-p.x)/(x.x-p.x)*(x.y-p.y))._round()),p.y>=u&&x.y>=u||(p.y>=u?p=new Se(p.x+(u-p.y)/(x.y-p.y)*(x.x-p.x),u)._round():x.y>=u&&(x=new Se(p.x+(u-p.y)/(x.y-p.y)*(x.x-p.x),u)._round()),b&&p.equals(b[b.length-1])||(b=[p],a.push(b)),b.push(x)))))}}return a}function Ex(n){let e=0,i=0;for(const h of n)e+=h.w*h.h,i=Math.max(i,h.w);n.sort((h,_)=>_.h-h.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,a=0;for(const h of n)for(let _=o.length-1;_>=0;_--){const b=o[_];if(!(h.w>b.w||h.h>b.h)){if(h.x=b.x,h.y=b.y,a=Math.max(a,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===b.w&&h.h===b.h){const E=o.pop();_<o.length&&(o[_]=E)}else h.h===b.h?(b.x+=h.w,b.w-=h.w):h.w===b.w?(b.y+=h.h,b.h-=h.h):(o.push({x:b.x+h.w,y:b.y,w:b.w-h.w,h:h.h}),b.y+=h.h,b.h-=h.h);break}}return{w:u,h:a,fill:e/(u*a)||0}}At(Qo,"Anchor");const md=1;class F_{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:a,content:h},_){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=a,this.content=h,this.version=o,this.padding=_}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Sx{constructor(e,i,o){const u={},a={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,u,md,h),this.addImages(i,a,2,h);const{w:_,h:b}=Ex(h),E=new Mn({width:_||1,height:b||1});for(const p in e){const x=e[p],T=u[p].paddedRect;Mn.copy(x.data,E,{x:0,y:0},{x:T.x+md,y:T.y+md},x.data,o,x.sdf)}for(const p in i){const x=i[p],T=a[p].paddedRect;let v=a[p].padding;const w=T.x+v,A=T.y+v,C=x.data.width,D=x.data.height;v=v>1?v-1:v,Mn.copy(x.data,E,{x:0,y:0},{x:w,y:A},x.data,o),Mn.copy(x.data,E,{x:0,y:D-v},{x:w,y:A-v},{width:C,height:v},o),Mn.copy(x.data,E,{x:0,y:0},{x:w,y:A+D},{width:C,height:v},o),Mn.copy(x.data,E,{x:C-v,y:0},{x:w-v,y:A},{width:v,height:D},o),Mn.copy(x.data,E,{x:0,y:0},{x:w+C,y:A},{width:v,height:D},o),Mn.copy(x.data,E,{x:C-v,y:D-v},{x:w-v,y:A-v},{width:v,height:v},o),Mn.copy(x.data,E,{x:0,y:D-v},{x:w+C,y:A-v},{width:v,height:v},o),Mn.copy(x.data,E,{x:0,y:0},{x:w+C,y:A+D},{width:v,height:v},o),Mn.copy(x.data,E,{x:C-v,y:0},{x:w-v,y:A+D},{width:v,height:v},o)}this.image=E,this.iconPositions=u,this.patternPositions=a}addImages(e,i,o,u){for(const a in e){const h=e[a],_={x:0,y:0,w:h.data.width+2*o,h:h.data.height+2*o};u.push(_),i[a]=new F_(_,h,o),h.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const u in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,o),i),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,a]=e.tl;o.update(i.data,{position:{x:u,y:a}})}}At(F_,"ImagePosition"),At(Sx,"ImageAtlas");const _d=1e20;function Mx(n,e,i,o,u,a,h,_,b){for(let E=e;E<e+o;E++)Ax(n,i*a+E,a,u,h,_,b);for(let E=i;E<i+u;E++)Ax(n,E*a+e,1,o,h,_,b)}function Ax(n,e,i,o,u,a,h){a[0]=0,h[0]=-_d,h[1]=_d,u[0]=n[e];for(let _=1,b=0,E=0;_<o;_++){u[_]=n[e+_*i];const p=_*_;do{const x=a[b];E=(u[_]-u[x]+p-x*x)/(_-x)/2}while(E<=h[b]&&--b>-1);b++,a[b]=_,h[b]=E,h[b+1]=_d}for(let _=0,b=0;_<o;_++){for(;h[b+1]<_;)b++;const E=a[b],p=_-E;n[e+_*i]=u[E]+p*p}}const eo=2,N_={none:0,ideographs:1,all:2};class wu{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const u=[],a=this.urls[i]||ve.GLYPHS_URL;for(const h in e)for(const _ of e[h])u.push({stack:h,id:_});rr(u,({stack:h,id:_},b)=>{let E=this.entries[h];E||(E=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let p=E.glyphs[_];if(p!==void 0)return void b(null,{stack:h,id:_,glyph:p});if(p=this._tinySDF(E,h,_),p)return E.glyphs[_]=p,void b(null,{stack:h,id:_,glyph:p});const x=Math.floor(_/256);if(256*x>65535)return void b(new Error("glyphs > 65535 not supported"));if(E.ranges[x])return void b(null,{stack:h,id:_,glyph:p});let T=E.requests[x];T||(T=E.requests[x]=[],wu.loadGlyphRange(h,x,a,this.requestManager,(v,w)=>{if(w){E.ascender=w.ascender,E.descender=w.descender;for(const A in w.glyphs)this._doesCharSupportLocalGlyph(+A)||(E.glyphs[+A]=w.glyphs[+A]);E.ranges[x]=!0}for(const A of T)A(v,w);delete E.requests[x]})),T.push((v,w)=>{v?b(v):w&&b(null,{stack:h,id:_,glyph:w.glyphs[_]||null})})},(h,_)=>{if(h)o(h);else if(_){const b={};for(const{stack:E,id:p,glyph:x}of _)b[E]===void 0&&(b[E]={}),b[E].glyphs===void 0&&(b[E].glyphs={}),b[E].glyphs[p]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics},b[E].ascender=this.entries[E].ascender,b[E].descender=this.entries[E].descender;o(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==N_.none&&(this.localGlyphMode===N_.all?!!this.localFontFamily:!!this.localFontFamily&&(Ot["CJK Unified Ideographs"](e)||Ot["Hangul Syllables"](e)||Ot.Hiragana(e)||Ot.Katakana(e)||Ot["CJK Symbols and Punctuation"](e)||Ot["CJK Unified Ideographs Extension A"](e)||Ot["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,o){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(o))return;let a=e.tinySDF;if(!a){let A="400";/bold/i.test(i)?A="900":/medium/i.test(i)?A="500":/light/i.test(i)&&(A="200"),a=e.tinySDF=new wu.TinySDF({fontFamily:u,fontWeight:A,fontSize:24*eo,buffer:3*eo,radius:8*eo}),a.fontWeight=A}if(this.localGlyphs[a.fontWeight][o])return this.localGlyphs[a.fontWeight][o];const h=String.fromCodePoint(o),{data:_,width:b,height:E,glyphWidth:p,glyphHeight:x,glyphLeft:T,glyphTop:v,glyphAdvance:w}=a.draw(h);return this.localGlyphs[a.fontWeight][o]={id:o,bitmap:new $a({width:b,height:E},_),metrics:{width:p/eo,height:x/eo,left:T/eo,top:v/eo-27,advance:w/eo,localGlyph:!0}}}}wu.loadGlyphRange=function(n,e,i,o,u){const a=256*e,h=a+255,_=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${a}-${h}`),aa.Glyphs);la(_,(b,E)=>{if(b)u(b);else if(E){const p={},x=function(T){return new bp(T).readFields(OE,{})}(E);for(const T of x.glyphs)p[T.id]=T;u(null,{glyphs:p,ascender:x.ascender,descender:x.descender})}})},wu.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:u="sans-serif",fontWeight:a="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const _=this.size=n+4*e,b=this._createCanvas(_),E=this.ctx=b.getContext("2d",{willReadFrequently:!0});E.font=`${h} ${a} ${n}px ${u}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:u,actualBoundingBoxRight:a}=this.ctx.measureText(n),h=Math.ceil(i),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-u))),b=Math.min(this.size-this.buffer,h+Math.ceil(o)),E=_+2*this.buffer,p=b+2*this.buffer,x=Math.max(E*p,0),T=new Uint8ClampedArray(x),v={data:T,width:E,height:p,glyphWidth:_,glyphHeight:b,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(_===0||b===0)return v;const{ctx:w,buffer:A,gridInner:C,gridOuter:D}=this;w.clearRect(A,A,_,b),w.fillText(n,A,A+h);const F=w.getImageData(A,A,_,b);D.fill(_d,0,x),C.fill(0,0,x);for(let V=0;V<b;V++)for(let z=0;z<_;z++){const j=F.data[4*(V*_+z)+3]/255;if(j===0)continue;const G=(V+A)*E+z+A;if(j===1)D[G]=0,C[G]=_d;else{const Y=.5-j;D[G]=Y>0?Y*Y:0,C[G]=Y<0?Y*Y:0}}Mx(D,0,0,E,p,E,this.f,this.v,this.z),Mx(C,A,A,_,b,E,this.f,this.v,this.z);for(let V=0;V<x;V++){const z=Math.sqrt(D[V])-Math.sqrt(C[V]);T[V]=Math.round(255-255*(z/this.radius+this.cutoff))}return v}};const Ha=md;function Ix(n,e,i,o){const u=[],a=n.imagePrimary,h=a.pixelRatio,_=a.paddedRect.w-2*Ha,b=a.paddedRect.h-2*Ha,E=n.right-n.left,p=n.bottom-n.top,x=a.stretchX||[[0,_]],T=a.stretchY||[[0,b]],v=(ue,se)=>ue+se[1]-se[0],w=x.reduce(v,0),A=T.reduce(v,0),C=_-w,D=b-A;let F=0,V=w,z=0,j=A,G=0,Y=C,te=0,re=D;if(a.content&&o){const ue=a.content;F=Tp(x,0,ue[0]),z=Tp(T,0,ue[1]),V=Tp(x,ue[0],ue[2]),j=Tp(T,ue[1],ue[3]),G=ue[0]-F,te=ue[1]-z,Y=ue[2]-ue[0]-V,re=ue[3]-ue[1]-j}const Q=(ue,se,de,we)=>{const Ee=Ep(ue.stretch-F,V,E,n.left),Me=Sp(ue.fixed-G,Y,ue.stretch,w),Ie=Ep(se.stretch-z,j,p,n.top),Be=Sp(se.fixed-te,re,se.stretch,A),Pe=Ep(de.stretch-F,V,E,n.left),Ze=Sp(de.fixed-G,Y,de.stretch,w),Je=Ep(we.stretch-z,j,p,n.top),Ue=Sp(we.fixed-te,re,we.stretch,A),xt=new Se(Ee,Ie),pt=new Se(Pe,Ie),ot=new Se(Pe,Je),tt=new Se(Ee,Je),Nt=new Se(Me/h,Be/h),yt=new Se(Ze/h,Ue/h),Mt=e*Math.PI/180;if(Mt){const xi=Math.sin(Mt),tr=Math.cos(Mt),Zi=[tr,-xi,xi,tr];xt._matMult(Zi),pt._matMult(Zi),tt._matMult(Zi),ot._matMult(Zi)}const ti=ue.stretch+ue.fixed,mi=de.stretch+de.fixed,ci=se.stretch+se.fixed,ui=we.stretch+we.fixed,gi=n.imageSecondary;return{tl:xt,tr:pt,bl:tt,br:ot,texPrimary:{x:a.paddedRect.x+Ha+ti,y:a.paddedRect.y+Ha+ci,w:mi-ti,h:ui-ci},texSecondary:gi?{x:gi.paddedRect.x+Ha+ti,y:gi.paddedRect.y+Ha+ci,w:mi-ti,h:ui-ci}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Nt,pixelOffsetBR:yt,minFontScaleX:Y/h/E,minFontScaleY:re/h/p,isSDF:i}};if(o&&(a.stretchX||a.stretchY)){const ue=Cx(x,C,w),se=Cx(T,D,A);for(let de=0;de<ue.length-1;de++){const we=ue[de],Ee=ue[de+1];for(let Me=0;Me<se.length-1;Me++)u.push(Q(we,se[Me],Ee,se[Me+1]))}}else u.push(Q({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:b+1}));return u}function Tp(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function Cx(n,e,i){const o=[{fixed:-Ha,stretch:0}];for(const[u,a]of n){const h=o[o.length-1];o.push({fixed:u-h.stretch,stretch:h.stretch}),o.push({fixed:u-h.stretch,stretch:h.stretch+(a-u)})}return o.push({fixed:e+Ha,stretch:i}),o}function Ep(n,e,i,o){return n/e*i+o}function Sp(n,e,i,o){return n-e*i/o}function qE(n,e,i,o){const u=e+n.positionedLines[o].lineOffset;return o===0?i+u/2:i+(u+(e+n.positionedLines[o-1].lineOffset))/2}function $E(n,e=1,i=!1){let o=1/0,u=1/0,a=-1/0,h=-1/0;const _=n[0];for(let v=0;v<_.length;v++){const w=_[v];(!v||w.x<o)&&(o=w.x),(!v||w.y<u)&&(u=w.y),(!v||w.x>a)&&(a=w.x),(!v||w.y>h)&&(h=w.y)}const b=Math.min(a-o,h-u);let E=b/2;const p=new ah([],ZE);if(b===0)return new Se(o,u);for(let v=o;v<a;v+=b)for(let w=u;w<h;w+=b)p.push(new Tu(v+E,w+E,E,n));let x=function(v){let w=0,A=0,C=0;const D=v[0];for(let F=0,V=D.length,z=V-1;F<V;z=F++){const j=D[F],G=D[z],Y=j.x*G.y-G.x*j.y;A+=(j.x+G.x)*Y,C+=(j.y+G.y)*Y,w+=3*Y}return new Tu(A/w,C/w,0,v)}(n),T=p.length;for(;p.length;){const v=p.pop();(v.d>x.d||!x.d)&&(x=v,i&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,T)),v.max-x.d<=e||(E=v.h/2,p.push(new Tu(v.p.x-E,v.p.y-E,E,n)),p.push(new Tu(v.p.x+E,v.p.y-E,E,n)),p.push(new Tu(v.p.x-E,v.p.y+E,E,n)),p.push(new Tu(v.p.x+E,v.p.y+E,E,n)),T+=4)}return i&&(console.log(`num probes: ${T}`),console.log(`best distance: ${x.d}`)),x.p}function ZE(n,e){return e.max-n.max}class Tu{constructor(e,i,o,u){this.p=new Se(e,i),this.h=o,this.d=function(a,h){let _=!1,b=1/0;for(let E=0;E<h.length;E++){const p=h[E];for(let x=0,T=p.length,v=T-1;x<T;v=x++){const w=p[x],A=p[v];w.y>a.y!=A.y>a.y&&a.x<(A.x-w.x)*(a.y-w.y)/(A.y-w.y)+w.x&&(_=!_),b=Math.min(b,Xi(a,w,A))}}return(_?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const V_=Number.POSITIVE_INFINITY,HE=Math.sqrt(2);function Px(n,[e,i]){let o=0,u=0;if(i===V_){e<0&&(e=0);const a=e/HE;switch(n){case"top-right":case"top-left":u=a-7;break;case"bottom-right":case"bottom-left":u=7-a;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(n){case"top-right":case"bottom-right":o=-a;break;case"top-left":case"bottom-left":o=a;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(n){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,u]}function U_(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function WE(n,e,i,o,u,a,h,_,b,E,p,x,T,v,w){let A=a.textMaxSize.evaluate(e,{},x);A===void 0&&(A=h);const C=n.layers[0].layout,D=C.get("icon-offset").evaluate(e,{},x),F=Lx(i.horizontal)||i.vertical,V=T.name==="globe",z=hn,j=h/z,G=n.tilePixelRatio*A/z,Y=(Ee=n.overscaling,n.zoom>18&&Ee>2&&(Ee>>=1),Math.max(mt/(512*Ee),1)*C.get("symbol-spacing")),te=C.get("text-padding")*n.tilePixelRatio,re=C.get("icon-padding")*n.tilePixelRatio,Q=dt(C.get("text-max-angle")),ue=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",se=C.get("icon-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",de=C.get("symbol-placement"),we=Y/2;var Ee;const Me=C.get("icon-text-fit").evaluate(e,{},x),Ie=C.get("icon-text-fit-padding").evaluate(e,{},x),Be=Me!=="none";let Pe;n.hasAnyIconTextFit===!1&&Be&&(n.hasAnyIconTextFit=!0),o&&Be&&(n.allowVerticalPlacement&&i.vertical&&(Pe=gx(o,i.vertical,Me,Ie,D,j)),F&&(o=gx(o,F,Me,Ie,D,j)));const Ze=(Je,Ue,xt)=>{if(Ue.x<0||Ue.x>=mt||Ue.y<0||Ue.y>=mt)return;let pt=null;if(V){const{x:ot,y:tt,z:Nt}=T.projectTilePoint(Ue.x,Ue.y,xt);pt={anchor:new Qo(ot,tt,Nt,0,void 0),up:T.upVector(xt,Ue.x,Ue.y)}}(function(ot,tt,Nt,yt,Mt,ti,mi,ci,ui,gi,xi,tr,Zi,ri,Ni,Ui,ur,Ar,Nr,Ir,vr,rn,jr,dn,ar,Jn,no){const Us=ot.addToLineVertexArray(tt,yt);let js,tc,Ja,ic,zd,Qv,e1,t1=0,i1=0,r1=0,n1=0,_g=-1,gg=-1;const Ao={};let s1=Rn("");const rc=Nt?Nt.anchor:tt,yg=ui.layout.get("icon-text-fit").evaluate(vr,{},ar)!=="none";let xg=0,vg=0;if(ui._unevaluatedLayout.getValue("text-radial-offset")===void 0?[xg,vg]=ui.layout.get("text-offset").evaluate(vr,{},ar).map(os=>os*hn):(xg=ui.layout.get("text-radial-offset").evaluate(vr,{},ar)*hn,vg=V_),ot.allowVerticalPlacement&&Mt.vertical){const os=Mt.vertical;if(Ni)Qv=j_(os),ci&&(e1=j_(ci));else{const as=ui.layout.get("text-rotate").evaluate(vr,{},ar)+90;Ja=Mp(gi,rc,tt,xi,tr,Zi,os,ri,as,Ui),ci&&(ic=Mp(gi,rc,tt,xi,tr,Zi,ci,Ar,as))}}if(ti){const os=ui.layout.get("icon-rotate").evaluate(vr,{},ar),as=Ix(ti,os,jr,yg),Ru=ci?Ix(ci,os,jr,yg):void 0;tc=Mp(gi,rc,tt,xi,tr,Zi,ti,Ar,os),t1=4*as.length;const o1=ot.iconSizeData;let nc=null;o1.kind==="source"?(nc=[Qs*ui.layout.get("icon-size").evaluate(vr,{},ar)],nc[0]>Wa&&zi(`${ot.layerIds[0]}: Value for "icon-size" is >= ${gd}. Reduce your "icon-size".`)):o1.kind==="composite"&&(nc=[Qs*rn.compositeIconSizes[0].evaluate(vr,{},ar),Qs*rn.compositeIconSizes[1].evaluate(vr,{},ar)],(nc[0]>Wa||nc[1]>Wa)&&zi(`${ot.layerIds[0]}: Value for "icon-size" is >= ${gd}. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,as,nc,Ir,Nr,vr,!1,Nt,tt,Us.lineStartIndex,Us.lineLength,-1,dn,ar,Jn,no),_g=ot.icon.placedSymbolArray.length-1,Ru&&(i1=4*Ru.length,ot.addSymbols(ot.icon,Ru,nc,Ir,Nr,vr,bs.vertical,Nt,tt,Us.lineStartIndex,Us.lineLength,-1,dn,ar,Jn,no),gg=ot.icon.placedSymbolArray.length-1)}for(const os in Mt.horizontal){const as=Mt.horizontal[os];js||(s1=Rn(as.text),Ni?zd=j_(as):js=Mp(gi,rc,tt,xi,tr,Zi,as,ri,ui.layout.get("text-rotate").evaluate(vr,{},ar),Ui));const Ru=as.positionedLines.length===1;if(r1+=Rx(ot,Nt,tt,as,mi,ui,Ni,vr,Ui,Us,Mt.vertical?bs.horizontal:bs.horizontalOnly,Ru?Object.keys(Mt.horizontal):[os],Ao,_g,rn,dn,ar,Jn),Ru)break}Mt.vertical&&(n1+=Rx(ot,Nt,tt,Mt.vertical,mi,ui,Ni,vr,Ui,Us,bs.vertical,["vertical"],Ao,gg,rn,dn,ar,Jn));let Qa=-1;const bg=(os,as)=>os?Math.max(os,as):as;Qa=bg(zd,Qa),Qa=bg(Qv,Qa),Qa=bg(e1,Qa);const cM=Qa>-1?1:0;ot.glyphOffsetArray.length>=65535&&zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vr.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,vr.sortKey),ot.symbolInstances.emplaceBack(tt.x,tt.y,rc.x,rc.y,rc.z,Ao.right>=0?Ao.right:-1,Ao.center>=0?Ao.center:-1,Ao.left>=0?Ao.left:-1,Ao.vertical>=0?Ao.vertical:-1,_g,gg,s1,js!==void 0?js:ot.collisionBoxArray.length,js!==void 0?js+1:ot.collisionBoxArray.length,Ja!==void 0?Ja:ot.collisionBoxArray.length,Ja!==void 0?Ja+1:ot.collisionBoxArray.length,tc!==void 0?tc:ot.collisionBoxArray.length,tc!==void 0?tc+1:ot.collisionBoxArray.length,ic||ot.collisionBoxArray.length,ic?ic+1:ot.collisionBoxArray.length,xi,r1,n1,t1,i1,cM,0,xg,vg,Qa,0,yg?1:0)})(n,Ue,pt,Je,i,o,u,Pe,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,te,ue,b,0,re,se,D,e,a,E,p,x,v,w)};if(de==="line")for(const Je of Tx(e.geometry,0,0,mt,mt)){const Ue=GE(Je,Y,Q,i.vertical||F,o,z,G,n.overscaling,mt);for(const xt of Ue)F&&XE(n,F.text,we,xt)||Ze(Je,xt,x)}else if(de==="line-center"){for(const Je of e.geometry)if(Je.length>1){const Ue=jE(Je,Q,i.vertical||F,o,z,G);Ue&&Ze(Je,Ue,x)}}else if(e.type==="Polygon")for(const Je of fp(e.geometry,0)){const Ue=$E(Je,16);Ze(Je[0],new Qo(Ue.x,Ue.y,0,0,void 0),x)}else if(e.type==="LineString")for(const Je of e.geometry)Ze(Je,new Qo(Je[0].x,Je[0].y,0,0,void 0),x);else if(e.type==="Point")for(const Je of e.geometry)for(const Ue of Je)Ze([Ue],new Qo(Ue.x,Ue.y,0,0,void 0),x)}const gd=255,Wa=gd*Qs;function Rx(n,e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C,D){const F=function(j,G,Y,te,re,Q,ue,se){const de=[];if(G.positionedLines.length===0)return de;const we=te.layout.get("text-rotate").evaluate(Q,{})*Math.PI/180,Ee=function(Ze){const Je=Ze[0],Ue=Ze[1],xt=Je*Ue;return xt>0?[Je,-Ue]:xt<0?[-Je,Ue]:Je===0?[Ue,Je]:[Ue,-Je]}(Y);let Me=Math.abs(G.top-G.bottom);for(const Ze of G.positionedLines)Me-=Ze.lineOffset;const Ie=G.positionedLines.length,Be=Me/Ie;let Pe=G.top-Y[1];for(let Ze=0;Ze<Ie;++Ze){const Je=G.positionedLines[Ze];Pe=qE(G,Be,Pe,Ze);for(const Ue of Je.positionedGlyphs){if(!Ue.rect)continue;const xt=Ue.rect||{};let pt=hx+1,ot=!0,tt=1,Nt=0;if(Ue.imageName){const Ir=ue[Ue.imageName];if(!Ir)continue;if(Ir.sdf){zi("SDF images are not supported in formatted text and will be ignored.");continue}ot=!1,tt=Ir.pixelRatio,pt=md/tt}const yt=(re||se)&&Ue.vertical,Mt=Ue.metrics.advance*Ue.scale/2,ti=Ue.metrics,mi=Ue.rect;if(mi===null)continue;se&&G.verticalizable&&(Nt=Ue.imageName?Mt-Ue.metrics.width*Ue.scale/2:0);const ci=re?[Ue.x+Mt,Ue.y]:[0,0];let ui=[0,0],gi=[0,0],xi=!1;re||(yt?(gi=[Ue.x+Mt+Ee[0],Ue.y+Ee[1]-Nt],xi=!0):ui=[Ue.x+Mt+Y[0],Ue.y+Y[1]-Nt]);const tr=mi.w*Ue.scale/(tt*(Ue.localGlyph?eo:1)),Zi=mi.h*Ue.scale/(tt*(Ue.localGlyph?eo:1));let ri,Ni,Ui,ur;if(yt){const Ir=Ue.y-Pe,vr=new Se(-Mt,Mt-Ir),rn=-Math.PI/2,jr=new Se(...gi);ri=new Se(-Mt+ui[0],ui[1]),ri._rotateAround(rn,vr)._add(jr),ri.x+=-Ir+Mt,ri.y-=(ti.left-pt)*Ue.scale;const dn=Ue.imageName?ti.advance*Ue.scale:hn*Ue.scale,ar=String.fromCodePoint(Ue.glyph);DE(ar)?ri.x+=(1-pt)*Ue.scale:zE(ar)?ri.x+=dn-ti.height*Ue.scale+(-pt-1)*Ue.scale:ri.x+=Ue.imageName||ti.width+2*pt===mi.w&&ti.height+2*pt===mi.h?(dn-Zi)/2:(dn-(ti.height+2*pt)*Ue.scale)/2,Ni=new Se(ri.x,ri.y-tr),Ui=new Se(ri.x+Zi,ri.y),ur=new Se(ri.x+Zi,ri.y-tr)}else{const Ir=(ti.left-pt)*Ue.scale-Mt+ui[0],vr=(-ti.top-pt)*Ue.scale+ui[1],rn=Ir+tr,jr=vr+Zi;ri=new Se(Ir,vr),Ni=new Se(rn,vr),Ui=new Se(Ir,jr),ur=new Se(rn,jr)}if(we){let Ir;Ir=re?new Se(0,0):xi?new Se(Ee[0],Ee[1]):new Se(Y[0],Y[1]),ri._rotateAround(we,Ir),Ni._rotateAround(we,Ir),Ui._rotateAround(we,Ir),ur._rotateAround(we,Ir)}const Ar=new Se(0,0),Nr=new Se(0,0);de.push({tl:ri,tr:Ni,bl:Ui,br:ur,texPrimary:xt,texSecondary:void 0,writingMode:G.writingMode,glyphOffset:ci,sectionIndex:Ue.sectionIndex,isSDF:ot,pixelOffsetTL:Ar,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}}return de}(0,o,b,a,h,_,u,n.allowVerticalPlacement),V=n.textSizeData;let z=null;V.kind==="source"?(z=[Qs*a.layout.get("text-size").evaluate(_,{},C)],z[0]>Wa&&zi(`${n.layerIds[0]}: Value for "text-size" is >= ${gd}. Reduce your "text-size".`)):V.kind==="composite"&&(z=[Qs*w.compositeTextSizes[0].evaluate(_,{},C),Qs*w.compositeTextSizes[1].evaluate(_,{},C)],(z[0]>Wa||z[1]>Wa)&&zi(`${n.layerIds[0]}: Value for "text-size" is >= ${gd}. Reduce your "text-size".`)),n.addSymbols(n.text,F,z,b,h,_,p,e,i,E.lineStartIndex,E.lineLength,v,A,C,D,!1);for(const j of x)T[j]=n.text.placedSymbolArray.length-1;return 4*F.length}function Lx(n){for(const e in n)return n[e];return null}function Mp(n,e,i,o,u,a,h,_,b,E){let p=h.top,x=h.bottom,T=h.left,v=h.right;const w=h.collisionPadding;if(w&&(T-=w[0],p-=w[1],v+=w[2],x+=w[3]),b){const A=new Se(T,p),C=new Se(v,p),D=new Se(T,x),F=new Se(v,x),V=dt(b);let z=new Se(0,0);E&&(z=new Se(E[0],E[1])),A._rotateAround(V,z),C._rotateAround(V,z),D._rotateAround(V,z),F._rotateAround(V,z),T=Math.min(A.x,C.x,D.x,F.x),v=Math.max(A.x,C.x,D.x,F.x),p=Math.min(A.y,C.y,D.y,F.y),x=Math.max(A.y,C.y,D.y,F.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,T,p,v,x,_,o,u,a),n.length-1}function j_(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function XE(n,e,i,o){const u=n.compareText;if(e in u){const a=u[e];for(let h=a.length-1;h>=0;h--)if(o.dist(a[h])<i)return!0}else u[e]=[];return u[e].push(o),!1}function Dx(n,e){const i=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),a=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let h=Math.sin(n._pitch)*a+u;const _=u*(1/n._horizonShift);return n.elevation&&n.elevation.exaggeration()!==0||(h*=1+Math.max(n.zoom-17,0)),Math.min(1.01*h,_)}function yd(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),o=n.x*i,u=(n.x+1)*i,a=n.y*i,h=(n.y+1)*i,_=ae(o),b=ae(u),E=oe(a),p=oe(h),x=e.project(_,E),T=e.project(b,E),v=e.project(b,p),w=e.project(_,p);let A=Math.min(x.x,T.x,v.x,w.x),C=Math.min(x.y,T.y,v.y,w.y),D=Math.max(x.x,T.x,v.x,w.x),F=Math.max(x.y,T.y,v.y,w.y);const V=i/16;function z(G,Y,te,re,Q,ue){const se=(te+Q)/2,de=(re+ue)/2,we=e.project(ae(se),oe(de)),Ee=Math.max(0,A-we.x,C-we.y,we.x-D,we.y-F);A=Math.min(A,we.x),D=Math.max(D,we.x),C=Math.min(C,we.y),F=Math.max(F,we.y),Ee>V&&(z(G,we,te,re,se,de),z(we,Y,se,de,Q,ue))}z(x,T,o,a,u,a),z(T,v,u,a,u,h),z(v,w,u,h,o,h),z(w,x,o,h,o,a),A-=V,C-=V,D+=V,F+=V;const j=1/Math.max(D-A,F-C);return{scale:j,x:A*j,y:C*j,x2:D*j,y2:F*j,projection:e}}function zx(n,{x:e,y:i},o=0){return new Se(((e-o)*n.scale-n.x)*mt,(i*n.scale-n.y)*mt)}const YE=ge.mat4.identity(new Float32Array(16));class Xa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new N(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return ee(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return Dx(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,u){const a=e.horizonLineFromTop(!1),h=new Se(i,Math.max(a,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,u))}pointCoordinate3D(e,i,o){const u=new Se(i,o);if(e.elevation)return e.elevation.pointCoordinate(u);{const a=this.pointCoordinate(e,u.x,u.y,0);return[a.x,a.y,a.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return YE}createTileMatrix(e,i,o){let u,a,h;const _=o.canonical,b=ge.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=yd(_,this);u=1,a=E.x+o.wrap*E.scale,h=E.y,ge.mat4.scale(b,b,[u/E.scale,u/E.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(_.z),a=(_.x+Math.pow(2,_.z)*o.wrap)*u,h=_.y*u;return ge.mat4.translate(b,b,[a,h,0]),ge.mat4.scale(b,b,[u/mt,u/mt,1]),b}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class KE extends Xa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(dt(i));this.n=(u+Math.sin(dt(o)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:u,r0:a}=this,h=dt(e-this.center[0]),_=dt(i),b=Math.sqrt(u-2*o*Math.sin(_))/o;return{x:b*Math.sin(h*o),y:b*Math.cos(h*o)-a,z:0}}unproject(e,i){const{n:o,c:u,r0:a}=this,h=a+i;let _=Math.atan2(e,Math.abs(h))*Math.sign(h);h*o<0&&(_-=Math.PI*Math.sign(e)*Math.sign(h));const b=dt(this.center[0])*o;_=Di(_,-Math.PI-b,Math.PI-b);const E=gt(Pt(_/o)+this.center[0],-180,180),p=Math.asin(gt((u-(e*e+h*h)*o*o)/(2*o),-1,1)),x=gt(Pt(p),-he,he);return new N(E,x)}}const xd=1.340264,vd=-.081106,bd=893e-6,wd=.003796,Ap=Math.sqrt(3)/2;class JE extends Xa{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Ap*Math.sin(i)),u=o*o,a=u*u*u;return{x:.5*(e*Math.cos(o)/(Ap*(xd+3*vd*u+a*(7*bd+9*wd*u)))/Math.PI+.5),y:1-.5*(o*(xd+vd*u+a*(bd+wd*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,u=o*o,a=u*u*u;for(let p,x,T,v=0;v<12&&(x=o*(xd+vd*u+a*(bd+wd*u))-i,T=xd+3*vd*u+a*(7*bd+9*wd*u),p=x/T,o=gt(o-p,-Math.PI/3,Math.PI/3),u=o*o,a=u*u*u,!(Math.abs(p)<1e-12));++v);const h=Ap*e*(xd+3*vd*u+a*(7*bd+9*wd*u))/Math.cos(o),_=Math.asin(Math.sin(o)/Ap),b=gt(180*h/Math.PI,-180,180),E=gt(180*_/Math.PI,-he,he);return new N(b,E)}}class QE extends Xa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),u=gt(360*(.5-i),-he,he);return new N(o,u)}}const Eu=Math.PI/2;function Ip(n){return Math.tan((Eu+n)/2)}class eS extends Xa{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let u=dt(i),a=dt(o);this.southernCenter=u+a<0,this.southernCenter&&(u=-u,a=-a);const h=Math.cos(u),_=Ip(u);this.n=u===a?Math.sin(u):Math.log(h/Math.cos(a))/Math.log(Ip(a)/_),this.f=h*Math.pow(Ip(u),this.n)/this.n}project(e,i){i=dt(i),this.southernCenter&&(i=-i),e=dt(e-this.center[0]);const o=1e-6,{n:u,f:a}=this;a>0?i<-Eu+o&&(i=-Eu+o):i>Eu-o&&(i=Eu-o);const h=a/Math.pow(Ip(i),u);let _=h*Math.sin(u*e),b=a-h*Math.cos(u*e);return _=.5*(_/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:_,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:u}=this,a=u-i,h=Math.sign(a),_=Math.sign(o)*Math.sqrt(e*e+a*a);let b=Math.atan2(e,Math.abs(a))*h;a*o<0&&(b-=Math.PI*Math.sign(e)*h);const E=gt(Pt(b/o)+this.center[0],-180,180),p=gt(Pt(2*Math.atan(Math.pow(u/_,1/o))-Eu),-he,he);return new N(E,this.southernCenter?-p:p)}}class kx extends Xa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ie(e),y:ne(i),z:0}}unproject(e,i){const o=ae(e),u=oe(i);return new N(o,u)}}const Ox=dt(he);class tS extends Xa{project(e,i){const o=(i=dt(i))*i,u=o*o;return{x:.5*((e=dt(e))*(.8707-.131979*o+u*(u*(.003971*o-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+u*(.028874*o-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,u=25,a=0,h=o*o;do{h=o*o;const E=h*h;a=(o*(1.007226+h*(.015085+E*(.028874*h-.044475-.005916*E)))-i)/(1.007226+h*(.045255+E*(.259866*h-.311325-.005916*11*E))),o=gt(o-a,-Ox,Ox)}while(Math.abs(a)>1e-6&&--u>0);h=o*o;const _=gt(Pt(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),b=Pt(o);return new N(_,b)}}const Bx=dt(he);class iS extends Xa{project(e,i){i=dt(i),e=dt(e);const o=Math.cos(i),u=2/Math.PI,a=Math.acos(o*Math.cos(e/2)),h=Math.sin(a)/a,_=.5*(e*u+2*o*Math.sin(e/2)/h)||0,b=.5*(i+Math.sin(i)/h)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,a=25;const h=1e-6;let _=0,b=0;do{const E=Math.cos(u),p=Math.sin(u),x=2*p*E,T=p*p,v=E*E,w=Math.cos(o/2),A=Math.sin(o/2),C=2*w*A,D=A*A,F=1-v*w*w,V=F?1/F:0,z=F?Math.acos(E*w)*Math.sqrt(1/F):0,j=.5*(2*z*E*A+2*o/Math.PI)-e,G=.5*(z*p+u)-i,Y=.5*V*(v*D+z*E*w*T)+1/Math.PI,te=V*(C*x/4-z*p*A),re=.125*V*(x*A-z*p*v*C),Q=.5*V*(T*w+z*D*E)+.5,ue=te*re-Q*Y;_=(G*te-j*Q)/ue,b=(j*re-G*Y)/ue,o=gt(o-_,-Math.PI,Math.PI),u=gt(u-b,-Bx,Bx)}while((Math.abs(_)>h||Math.abs(b)>h)&&--a>0);return new N(Pt(o),Pt(u))}}class Fx extends Xa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(dt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:u}=this;return{x:dt(e)*u*o+.5,y:-Math.sin(dt(i))/u*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:u}=this,a=-(i-.5)/o,h=gt(Pt((e-.5)/o)/u,-180,180),_=Math.asin(gt(a*u,-1,1)),b=gt(Pt(_),-he,he);return new N(h,b)}}class rS extends kx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const u=id(e,i,o),a=cp(So(o));return ge.vec3.transformMat4(u,u,a),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const o=L(i.lat,i.lng),u=ge.vec3.normalize([],o),a=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,h=ee(1,0)*mt*a;ge.vec3.scaleAndAdd(o,o,u,h);const _=ge.mat4.identity(new Float64Array(16));return ge.mat4.multiply(_,e.pixelMatrix,e.globeMatrix),ge.vec3.transformMat4(o,o,_),new Se(o[0],o[1])}pixelsPerMeter(e,i){return ee(1,0)*i}pixelSpaceConversion(e,i,o){const u=ee(1,e)*i,a=Yt(ee(1,45)*i,u,o);return this.pixelsPerMeter(e,i)/a}createTileMatrix(e,i,o){const u=d_(So(o.canonical));return ge.mat4.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:o}=e,u=cp(So(i));return ge.mat4.rotateY(u,u,dt(o.lng)),ge.mat4.rotateX(u,u,dt(o.lat)),ge.mat4.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,o,u){return op(e,i,o,!0)||new Re(0,0)}pointCoordinate3D(e,i,o){const u=this.pointCoordinate(e,i,o,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!op(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,a){const h=u.cameraToCenterDistance,_=u._centerAltitude*a,b=u._camera,E=u._camera.forward(),p=ge.vec3.add([],ge.vec3.scale([],E,-h),[0,0,_]),x=u.worldSize/(2*Math.PI),T=[0,0,-x],v=u.width/u.height,w=Math.tan(u.fovAboveCenter),A=ge.vec3.scale([],b.up(),w),C=ge.vec3.scale([],b.right(),w*v),D=ge.vec3.normalize([],ge.vec3.add([],ge.vec3.add([],E,A),C)),F=[];let V;if(new Js(p,D).closestPointOnSphere(T,x,F)){const z=ge.vec3.add([],F,T),j=ge.vec3.sub([],z,p);V=Math.cos(u.fovAboveCenter)*ge.vec3.length(j)}else{const z=ge.vec3.sub([],p,T),j=ge.vec3.sub([],T,p);ge.vec3.normalize(j,j);const G=ge.vec3.length(z)-x;V=Math.sqrt(G*(G+2*x));const Y=Math.acos(V/(x+G))-Math.acos(ge.vec3.dot(E,j));V*=Math.cos(Y)}return 1.01*V}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=qa(e.zoom);if(o>0){const u=Dx(e,ee(1,e.center.lat)*e.worldSize),a=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Yt(i,u+a*(1-Math.cos(h)),Math.pow(o,10))}return i}upVector(e,i,o){return id(i,o,e,1)}upVectorScale(e){return{metersToTile:Ko(lp(So(e)))}}}function Nx(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new kx(n);case"equirectangular":return new QE(n);case"naturalEarth":return new tS(n);case"equalEarth":return new JE(n);case"winkelTripel":return new iS(n);case"albers":return i?new Fx(n):new KE(n);case"lambertConformalConic":return i?new Fx(n):new eS(n);case"globe":return new rS(n)}throw new Error(`Invalid projection name: ${n.name}`)}const nS=xu.VectorTileFeature.types,sS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cp(n,e,i,o,u,a,h,_,b,E,p,x,T){const v=_?Math.min(Wa,Math.round(_[0])):0,w=_?Math.min(Wa,Math.round(_[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),a,h,(v<<1)+(b?1:0),w,16*E,16*p,256*x,256*T)}function Pp(n,e,i){n.emplaceBack(e,i)}function Rp(n,e,i,o,u,a,h){n.emplaceBack(e,i,o,u,a,h)}function Lp(n,e,i,o,u){n.emplaceBack(e,i,o,u),n.emplaceBack(e,i,o,u),n.emplaceBack(e,i,o,u),n.emplaceBack(e,i,o,u)}function oS(n){for(const e of n.sections)if(Wm(e.text))return!0;return!1}class G_{constructor(e){this.layoutVertexArray=new jh,this.indexArray=new ln,this.programConfigurations=e,this.segments=new wr,this.dynamicLayoutVertexArray=new Ws,this.opacityVertexArray=new qh,this.placedSymbolArray=new Xh,this.iconTransitioningVertexArray=new wo,this.globeExtVertexArray=new Gh,this.zOffsetVertexArray=new Fa}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,u,a){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,TE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,SE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sS,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,AE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,EE.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||a)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ME.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}At(G_,"SymbolBuffers");class q_{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new wr,this.collisionVertexArray=new Ba,this.collisionVertexArrayExt=new Ws}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,IE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,CE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}At(q_,"CollisionBuffers");class Dp{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ge.mat4.identity([]),this.placementViewportMatrix=ge.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=L_(this.zoom,i["text-size"]),this.iconSizeData=L_(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),a=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=a!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(a==="viewport-y"||a==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>bs[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new G_(new To(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new G_(new To(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Kf,this.lineVertexArray=new pu,this.symbolInstances=new Yh}calculateGlyphDependencies(e,i,o,u,a){for(let h=0;h<e.length;h++){const _=e.codePointAt(h);if(_===void 0)break;if(i[_]=!0,u&&a&&_<=65535){const b=fd[e.charAt(h)];b&&(i[b.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!M_(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,u){const a=this.layers[0],h=a.layout,_=this.projection.name==="globe",b=h.get("text-font"),E=h.get("text-field"),p=h.get("icon-image"),x=(E.value.kind!=="constant"||E.value.value instanceof _n&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),T=p.value.kind!=="constant"||!!p.value.value||Object.keys(p.parameters).length>0,v=h.get("symbol-sort-key");if(this.features=[],!x&&!T)return;const w=i.iconDependencies,A=i.glyphDependencies,C=i.availableImages,D=new br(this.zoom);for(const{feature:F,id:V,index:z,sourceLayerIndex:j}of e){const G=a._featureFilter.needGeometry,Y=at(F,G);if(!a._featureFilter.filter(D,Y,o))continue;if(G||(Y.geometry=st(F,o,u)),_&&F.type!==1&&o.z<=5){const ue=Y.geometry,se=.98078528056,de=(we,Ee)=>{const Me=id(we.x,we.y,o,1),Ie=id(Ee.x,Ee.y,o,1);return ge.vec3.dot(Me,Ie)<se};for(let we=0;we<ue.length;we++)ue[we]=rt(ue[we],de)}let te,re;if(x){const ue=a.getValueAndResolveTokens("text-field",Y,o,C),se=_n.factory(ue);oS(se)&&(this.hasRTLText=!0),(!this.hasRTLText||Oh()==="unavailable"||this.hasRTLText&&kn.isParsed())&&(te=LE(se,a,Y))}if(T){const ue=a.getValueAndResolveTokens("icon-image",Y,o,C);re=ue instanceof bn?ue:bn.fromString(ue)}if(!te&&!re)continue;const Q=this.sortFeaturesByKey?v.evaluate(Y,{},o):void 0;if(this.features.push({id:V,text:te,icon:re,index:z,sourceLayerIndex:j,geometry:Y.geometry,properties:F.properties,type:nS[F.type],sortKey:Q}),re&&(w[re.namePrimary]=!0,re.nameSecondary&&(w[re.nameSecondary]=!0)),te){const ue=b.evaluate(Y,{},o).join(","),se=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bs.vertical)>=0;for(const de of te.sections)if(de.image)w[de.image.namePrimary]=!0;else{const we=Jc(te.toString()),Ee=de.fontStack||ue,Me=A[Ee]=A[Ee]||{};this.calculateGlyphDependencies(de.text,Me,se,this.allowVerticalPlacement,we)}}}h.get("symbol-placement")==="line"&&(this.features=function(F){const V={},z={},j=[];let G=0;function Y(ue){j.push(F[ue]),G++}function te(ue,se,de){const we=z[ue];return delete z[ue],z[se]=we,j[we].geometry[0].pop(),j[we].geometry[0]=j[we].geometry[0].concat(de[0]),we}function re(ue,se,de){const we=V[se];return delete V[se],V[ue]=we,j[we].geometry[0].shift(),j[we].geometry[0]=de[0].concat(j[we].geometry[0]),we}function Q(ue,se,de){const we=de?se[0][se[0].length-1]:se[0][0];return`${ue}:${we.x}:${we.y}`}for(let ue=0;ue<F.length;ue++){const se=F[ue],de=se.geometry,we=se.text?se.text.toString():null;if(!we){Y(ue);continue}const Ee=Q(we,de),Me=Q(we,de,!0);if(Ee in z&&Me in V&&z[Ee]!==V[Me]){const Ie=re(Ee,Me,de),Be=te(Ee,Me,j[Ie].geometry);delete V[Ee],delete z[Me],z[Q(we,j[Be].geometry,!0)]=Be,j[Ie].geometry=null}else Ee in z?te(Ee,Me,de):Me in V?re(Ee,Me,de):(Y(ue),V[Ee]=G-1,z[Me]=G-1)}return j.filter(ue=>ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((F,V)=>F.sortKey-V.sortKey)}update(e,i,o,u,a){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const _=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,_,o,u,a),this.icon.programConfigurations.updatePaintArrays(e,i,_,o,u,a)}updateZOffset(){const e=(a,h,_)=>{o+=h,o>a.length&&a.resize(o);for(let b=-h;b<0;b++)a.emplace(b+o,_)},i=(a,h,_)=>{u+=h,u>a.length&&a.resize(u);for(let b=-h;b<0;b++)a.emplace(b+u,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,u=0;for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:b,numIconVertices:E}=h,p=h.zOffset,x=E>0;if((_>0||b>0)&&(e(this.text.zOffsetVertexArray,_,p),e(this.text.zOffsetVertexArray,b,p)),x){const{placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:v}=h;T>=0&&i(this.icon.zOffsetVertexArray,E,p),v>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,p)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Nx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:a}of i)this.lineVertexArray.emplaceBack(u,a);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,a,h,_,b,E,p,x,T,v,w,A,C){const D=e.indexArray,F=e.layoutVertexArray,V=e.globeExtVertexArray,z=e.segments.prepareSegment(4*i.length,F,D,this.canOverlap?h.sortKey:void 0),j=this.glyphOffsetArray.length,G=z.vertexLength,Y=this.allowVerticalPlacement&&_===bs.vertical?Math.PI/2:0,te=h.text&&h.text.sections;for(let Q=0;Q<i.length;Q++){const{tl:ue,tr:se,bl:de,br:we,texPrimary:Ee,texSecondary:Me,pixelOffsetTL:Ie,pixelOffsetBR:Be,minFontScaleX:Pe,minFontScaleY:Ze,glyphOffset:Je,isSDF:Ue,sectionIndex:xt}=i[Q],pt=z.vertexLength,ot=Je[1];if(Cp(F,E.x,E.y,ue.x,ot+ue.y,Ee.x,Ee.y,o,Ue,Ie.x,Ie.y,Pe,Ze),Cp(F,E.x,E.y,se.x,ot+se.y,Ee.x+Ee.w,Ee.y,o,Ue,Be.x,Ie.y,Pe,Ze),Cp(F,E.x,E.y,de.x,ot+de.y,Ee.x,Ee.y+Ee.h,o,Ue,Ie.x,Be.y,Pe,Ze),Cp(F,E.x,E.y,we.x,ot+we.y,Ee.x+Ee.w,Ee.y+Ee.h,o,Ue,Be.x,Be.y,Pe,Ze),b){const{x:tt,y:Nt,z:yt}=b.anchor,[Mt,ti,mi]=b.up;Rp(V,tt,Nt,yt,Mt,ti,mi),Rp(V,tt,Nt,yt,Mt,ti,mi),Rp(V,tt,Nt,yt,Mt,ti,mi),Rp(V,tt,Nt,yt,Mt,ti,mi),Lp(e.dynamicLayoutVertexArray,tt,Nt,yt,Y)}else Lp(e.dynamicLayoutVertexArray,E.x,E.y,E.z,Y);if(C){const tt=Me||Ee;Pp(e.iconTransitioningVertexArray,tt.x,tt.y),Pp(e.iconTransitioningVertexArray,tt.x+tt.w,tt.y),Pp(e.iconTransitioningVertexArray,tt.x,tt.y+tt.h),Pp(e.iconTransitioningVertexArray,tt.x+tt.w,tt.y+tt.h)}D.emplaceBack(pt,pt+1,pt+2),D.emplaceBack(pt+1,pt+2,pt+3),z.vertexLength+=4,z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),Q!==i.length-1&&xt===i[Q+1].sectionIndex||e.programConfigurations.populatePaintArrays(F.length,h,h.index,{},v,w,A,te&&te[xt])}const re=b?b.anchor:E;e.placedSymbolArray.emplaceBack(re.x,re.y,re.z,E.x,E.y,j,this.glyphOffsetArray.length-j,G,p,x,E.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],_,0,!1,0,T,0)}_commitLayoutVertex(e,i,o,u,a,h,_){e.emplaceBack(i,o,u,a,h,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,o,u,a,h,_){const b=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),E=b.vertexLength,p=_.tileAnchorX,x=_.tileAnchorY;for(let v=0;v<4;v++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,_.zOffset),this._commitLayoutVertex(o.layoutVertexArray,u,a,h,p,x,new Se(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,u,a,h,p,x,new Se(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,u,a,h,p,x,new Se(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,u,a,h,p,x,new Se(e.x1,e.y2)),b.vertexLength+=4;const T=o.indexArray;T.emplaceBack(E,E+1),T.emplaceBack(E+1,E+2),T.emplaceBack(E+2,E+3),T.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,u,a,h){for(let _=u;_<a;_++){const b=o.get(_),E=this.getSymbolInstanceTextSize(e,h,i,_);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,o,u,a,h){for(let _=u;_<a;_++){const b=o.get(_),E=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new q_(Wo,ax.members,wo),this.iconCollisionBox=new q_(Wo,ax.members,wo);const o=vu(this.iconSizeData,e),u=vu(this.textSizeData,e);for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this._addTextDebugCollisionBoxes(u,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(u,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,i,o,u){const a=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),h=vp(this.textSizeData,e,a)/hn;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,o){const u=this.icon.placedSymbolArray.get(o),a=vp(this.iconSizeData,e,u);return this.tilePixelRatio*a}_commitDebugCollisionVertexUpdate(e,i,o,u){e.emplaceBack(i,-o,-o,u),e.emplaceBack(i,o,-o,u),e.emplaceBack(i,o,o,u),e.emplaceBack(i,-o,o,u)}_updateTextDebugCollisionBoxes(e,i,o,u,a,h){for(let _=u;_<a;_++){const b=o.get(_),E=this.getSymbolInstanceTextSize(e,h,i,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,b.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,u,a,h){for(let _=u;_<a;_++){const b=o.get(_),E=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding,h.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=vu(this.iconSizeData,e),u=vu(this.textSizeData,e);for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this._updateTextDebugCollisionBoxes(u,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(u,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,u,a,h,_,b,E){const p={};if(i<o){const{x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z,featureIndex:j}=e.get(i);p.textBox={x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z},p.textFeatureIndex=j}if(u<a){const{x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z,featureIndex:j}=e.get(u);p.verticalTextBox={x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z},p.verticalTextFeatureIndex=j}if(h<_){const{x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z,featureIndex:j}=e.get(h);p.iconBox={x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z},p.iconFeatureIndex=j}if(b<E){const{x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z,featureIndex:j}=e.get(b);p.verticalIconBox={x1:x,y1:T,x2:v,y2:w,padding:A,projectedAnchorX:C,projectedAnchorY:D,projectedAnchorZ:F,tileAnchorX:V,tileAnchorY:z},p.verticalIconFeatureIndex=j}return p}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let a=o.vertexStartIndex;a<u;a+=4)e.indexArray.emplaceBack(a,a+1,a+2),e.indexArray.emplaceBack(a+1,a+2,a+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],a=[],h=[];for(let _=0;_<this.symbolInstances.length;++_){h.push(_);const b=this.symbolInstances.get(_);u.push(0|Math.round(i*b.tileAnchorX+o*b.tileAnchorY)),a.push(b.featureIndex)}return h.sort((_,b)=>u[_]-u[b]||a[b]-a[_]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:a,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=o;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),a>=0&&a!==u&&this.addIndicesForPlacedSymbol(this.text,a),h>=0&&h!==a&&h!==u&&this.addIndicesForPlacedSymbol(this.text,h),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Vx,Ux,$_;At(Dp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Dp.addDynamicAttributes=Lp;class jx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ms,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}At(jx,"FormatSectionOverride",{omit:["defaultValue"]});const Z_=()=>$_||($_={layout:Vx||(Vx=new pr({"symbol-placement":new ut(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bt(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ut(Oe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ut(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ut(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bt(Oe.layout_symbol["icon-size"]),"icon-text-fit":new Bt(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bt(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bt(Oe.layout_symbol["icon-image"]),"icon-rotate":new Bt(Oe.layout_symbol["icon-rotate"]),"icon-padding":new ut(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Bt(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Bt(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Bt(Oe.layout_symbol["text-field"]),"text-font":new Bt(Oe.layout_symbol["text-font"]),"text-size":new Bt(Oe.layout_symbol["text-size"]),"text-max-width":new Bt(Oe.layout_symbol["text-max-width"]),"text-line-height":new Bt(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Bt(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Bt(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Bt(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Bt(Oe.layout_symbol["text-anchor"]),"text-max-angle":new ut(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Bt(Oe.layout_symbol["text-rotate"]),"text-padding":new ut(Oe.layout_symbol["text-padding"]),"text-keep-upright":new ut(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Bt(Oe.layout_symbol["text-transform"]),"text-offset":new Bt(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ut(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Oe.layout_symbol["text-optional"]),visibility:new ut(Oe.layout_symbol.visibility)})),paint:Ux||(Ux=new pr({"icon-opacity":new Bt(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Bt(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Bt(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Bt(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new Bt(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Bt(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bt(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bt(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Bt(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Bt(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Bt(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new Bt(Oe.paint_symbol["text-color"],{runtimeType:Ln,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Bt(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Bt(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Bt(Oe.paint_symbol["text-halo-blur"]),"text-translate":new ut(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ut(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ut(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ut(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ut(Oe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Bt(Oe.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new ut(Oe.paint_symbol["symbol-elevation-reference"])}))},$_);class zp extends gn{constructor(e,i,o,u){super(e,Z_(),i,o,u),this._colorAdjustmentMatrix=ge.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const a of o)u.indexOf(a)<0&&u.push(a);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(a,h,_,b){a=le(a),h=J(h);const E=ge.mat4.create(),p=a/3,x=1-2*p,T=[x,p,p,0,p,x,p,0,p,p,x,0,0,0,0,1],v=.5-.5*h,w=b-_;return ge.mat4.multiply(E,[w,0,0,0,0,w,0,0,0,0,w,0,_,_,_,1],[h,0,0,0,0,h,0,0,0,0,h,0,v,v,v,1]),ge.mat4.multiply(E,E,T),E}(e,i,o,u),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,u){const a=this.layout.get(e).evaluate(i,{},o,u),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Wc(h.value)||!a?a:function(_,b){return b.replace(/{([^{}]+)}/g,(E,p)=>p in _?String(_[p]):"")}(i.properties,a)}createBucket(e){return new Dp(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Z_().paint.overridableProperties){if(!zp.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new jx(i),u=new Hc(o,i.property.specification,this.scope,this.options);let a=null;a=i.value.kind==="constant"||i.value.kind==="source"?new Ph("source",u):new ks("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new La(i.property,a,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&zp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=Z_().paint.properties[i];let a=!1;const h=_=>{for(const b of _)if(u.overrides&&u.overrides.hasOverride(b))return void(a=!0)};if(o.value.kind==="constant"&&o.value.value instanceof _n)h(o.value.value.sections);else if(o.value.kind==="source"){const _=E=>{a||(E instanceof _s&&Br(E.value)===da?h(E.value.sections):E instanceof _a?h(E.sections):E.eachChild(_))},b=o.value;b._styleExpression&&_(b._styleExpression.expression)}return a}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new Yo(this,{zoom:i,lut:o}),overrideFog:!1}}}let Gx,qx,$x,Zx;var H_=Oi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function W_(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function X_(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Y_{constructor(e,i,o,u){this.context=e,this.format=o,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:a}=this,{gl:h}=a,{x:_,y:b}=i&&i.position?i.position:{x:0,y:0},E=Math.max(_+o,this.size?this.size[0]:0),p=Math.max(b+u,this.size?this.size[1]:0);!this.size||this.size[0]===E&&this.size[1]===p||(h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(this.texture),this.texture=h.createTexture(),this.size=null),h.bindTexture(h.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA8&&(!i||i.premultiply!==!1));const x=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&E>0&&p>0){const T=this.useMipmap?Math.floor(Math.log2(Math.max(E,p)))+1:1;h.texStorage2D(h.TEXTURE_2D,T,this.format,E,p),this.size=[E,p]}if(this.size)if(x)h.texSubImage2D(h.TEXTURE_2D,0,_,b,W_(this.format),X_(this.format),e);else{const T=e.data;T&&h.texSubImage2D(h.TEXTURE_2D,0,_,b,o,u,W_(this.format),X_(this.format),T)}this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(e,i,o=!1){const{context:u}=this,{gl:a}=u;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,u){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),this.wrapS=o),u!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class kp{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Op(n,e,i,o,u,a,h,_){const b=[n,e,1,i,o,1,u,a,1],E=[h,_,1],p=ge.mat3.adjoint([],b),[x,T,v]=ge.vec3.transformMat3(E,E,p);return ge.mat3.multiply(b,b,[x,0,0,0,T,0,0,0,v])}function Hx(n,e,i,o,u,a,h,_){const b=function(E,p,x,T,v,w,A,C){const D=Op(0,0,1,0,1,1,0,1),F=Op(E,p,x,T,v,w,A,C),V=ge.mat3.adjoint([],D);return ge.mat3.multiply(F,F,V)}(n,e,i,o,u,a,h,_);return[b[2]/b[8]/mt,b[5]/b[8]/mt]}function Bp(n){return[n[0],Math.min(Math.max(n[1],-he),he)]}class Wx extends ua{constructor(e,i,o,u){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new ho("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Rs(this.map._requestManager.transformRequest(this.url,aa.Image),(o,u)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new vl(o)):u&&(this.image=u instanceof HTMLImageElement?bt.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new kp(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ho("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof kp||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const a of e)a[1]>o&&(o=a[1]),a[1]<i&&(i=a[1]);const u=(o+i)/2;if(u>he?this.onNorthPole=!0:u<-he&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const a=e.map(Re.fromLngLat);this.tileID=function(h){let _=1/0,b=1/0,E=-1/0,p=-1/0;for(const A of h)_=Math.min(_,A.x),b=Math.min(b,A.y),E=Math.max(E,A.x),p=Math.max(p,A.y);const x=Math.max(E-_,p-b),T=Math.max(0,Math.floor(-Math.log(x)/Math.LN2)),v=Math.pow(2,T);let w=Math.floor((_+E)/2*v);return w>1&&(w-=1),new Qr(T,w,Math.floor((b+p)/2*v))}(a),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ho("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const D in this.tiles){const F=this.tiles[D];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=yd(new Qr(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(D){const F=D[1].x-D[0].x,V=D[1].y-D[0].y,z=D[2].x-D[1].x,j=D[2].y-D[1].y,G=D[3].x-D[2].x,Y=D[3].y-D[2].y,te=D[0].x-D[3].x,re=D[0].y-D[3].y,Q=F*j-z*V,ue=z*Y-G*j,se=G*re-te*Y,de=te*V-F*re;return Q>0&&ue>0&&se>0&&de>0||Q<0&&ue<0&&se<0&&de<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=yd(this.tileID,this.map.transform.projection),[a,h,_,b]=this.coordinates.map(D=>{const F=u.projection.project(D[0],D[1]);return zx(u,F)._round()});this.perspectiveTransform=Hx(a.x,a.y,h.x,h.y,_.x,_.y,b.x,b.y);const E=this._boundsArray=new vo;E.emplaceBack(a.x,a.y,0,0),E.emplaceBack(h.x,h.y,mt,0),E.emplaceBack(b.x,b.y,0,mt),E.emplaceBack(_.x,_.y,mt,mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(E,H_.members),this.boundsSegments=wr.simpleSegment(0,0,4,2);const p=[],x=[Bp((T=this.coordinates)[0]),Bp(T[1]),Bp(T[2]),Bp(T[3])];var T;const[v,w,A,C]=function(D){let F=D[0][0],V=F,z=D[0][1],j=z;for(let G=1;G<D.length;G++)D[G][0]<F?F=D[G][0]:D[G][0]>V&&(V=D[G][0]),D[G][1]<z?z=D[G][1]:D[G][1]>j&&(j=D[G][1]);return[F,z,V-F,j-z]}(x);{const D=new vo,[F,V,z,j]=function(Ie){let Be=Ie[0].x,Pe=Be,Ze=Ie[0].y,Je=Ze;for(let Ue=1;Ue<Ie.length;Ue++)Ie[Ue].x<Be?Be=Ie[Ue].x:Ie[Ue].x>Pe&&(Pe=Ie[Ue].x),Ie[Ue].y<Ze?Ze=Ie[Ue].y:Ie[Ue].y>Je&&(Je=Ie[Ue].y);return[Be,Ze,Pe-Be,Je-Ze]}(o),G=Ie=>[(Ie.x-F)/z,(Ie.y-V)/j],[Y,te,re,Q]=o.map(G),ue=function(Ie,Be,Pe,Ze,Je,Ue,xt,pt){const ot=Op(0,0,1,0,1,1,0,1),tt=Op(Ie,Be,Pe,Ze,Je,Ue,xt,pt),Nt=ge.mat3.adjoint([],tt);return ge.mat3.multiply(ot,ot,Nt)}(Y[0],Y[1],te[0],te[1],re[0],re[1],Q[0],Q[1]);this.elevatedGlobePerspectiveTransform=Hx(Y[0],Y[1],te[0],te[1],re[0],re[1],Q[0],Q[1]);const se=(Ie,Be)=>{p.push(Ie.lng);const Pe=Math.round((Ie.lng-v)/A*mt),Ze=Math.round((Ie.lat-w)/C*mt),Je=G(Be),Ue=ge.vec3.transformMat3([],[Je[0],Je[1],1],ue),xt=Math.round(Ue[0]/Ue[2]*mt),pt=Math.round(Ue[1]/Ue[2]*mt);D.emplaceBack(Pe,Ze,xt,pt)},de=o[3].x-o[0].x,we=o[3].y-o[0].y,Ee=o[2].x-o[1].x,Me=o[2].y-o[1].y;for(let Ie=0;Ie<65;Ie++){const Be=Ie/64,Pe=[o[0].x+Be*de,o[0].y+Be*we],Ze=[o[1].x+Be*Ee,o[1].y+Be*Me],Je=Ze[0]-Pe[0],Ue=Ze[1]-Pe[1];for(let xt=0;xt<65;xt++){const pt=xt/64,ot={x:Pe[0]+Je*pt,y:Pe[1]+Ue*pt,z:0};se(i.projection.unproject(ot.x,ot.y),ot)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(D,H_.members)}{this.maxLongitudeTriangleSize=0;let D=[],F=new ln;const V=(z,j,G)=>{F.emplaceBack(z,j,G);const Y=p[z],te=p[j],re=p[G],Q=Math.min(Math.min(Y,te),re),ue=Math.max(Math.max(Y,te),re)-Q;ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ue),D.push(Q+ue/2)};for(let z=0;z<64;z++)for(let j=0;j<64;j++){const G=65*z+j,Y=G+1,te=G+65,re=te+1;V(G,te,Y),V(Y,te,re)}[D,F]=function(z,j){const G=Array.from({length:z.length},(re,Q)=>Q);G.sort((re,Q)=>z[re]-z[Q]);const Y=[],te=new ln;for(let re=0;re<G.length;re++){const Q=G[re];Y.push(z[Q]);const ue=3*Q,se=ue+1;te.emplaceBack(j.uint16[ue],j.uint16[se],j.uint16[se+1])}return[Y,te]}(D,F),this.elevatedGlobeTrianglesCenterLongitudes=D,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(F)}this.elevatedGlobeSegments=wr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,A/mt,0,C/mt,0,0,w,v,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof kp||(this.texture?this.texture.update(this.image):(this.texture=new Y_(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let u=(a=e+180)+360*Math.round((o[0]-a)/360);var a;const h=new wr,_=(x,T)=>{h.segments.push({vertexOffset:0,primitiveOffset:x,vertexLength:i.segments[0].vertexLength,primitiveLength:T,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-u)<=b){const x=X(o,0,o.length,u+b);return x===o.length||_(x,Ve(o,x+1,o.length,u+360-b)-x),h}u<o[0]&&(u+=360);const E=Ve(o,0,o.length,u-b);if(E===o.length)return _(0,o.length),h;_(0,E-0);const p=X(o,E+1,o.length,u+b);return p!==o.length&&_(p,o.length-p),h}}const aS=(Math.pow(256,2)-1)/16907520;class Xx extends gn{constructor(e,i,o,u){super(e,{layout:$x||($x=new pr({visibility:new ut(Oe.layout_raster.visibility)})),paint:Zx||(Zx=new pr({"raster-opacity":new ut(Oe.paint_raster["raster-opacity"]),"raster-color":new ys(Oe.paint_raster["raster-color"]),"raster-color-mix":new ut(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new ut(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new ut(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Oe.paint_raster["raster-saturation"]),"raster-contrast":new ut(Oe.paint_raster["raster-contrast"]),"raster-resampling":new ut(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ut(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new ut(Oe.paint_raster["raster-array-band"]),"raster-elevation":new ut(Oe.paint_raster["raster-elevation"])}))},i,o,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Wx&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(u)||o===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=rd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,u])}}let Yx,Kx,Jx,Qx,ev;class tv extends gn{constructor(e,i,o,u){super(e,{layout:Yx||(Yx=new pr({visibility:new ut(Oe["layout_raster-particle"].visibility)})),paint:Kx||(Kx=new pr({"raster-particle-array-band":new ut(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ut(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ys(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ut(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ut(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ut(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ut(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ut(Oe["paint_raster-particle"]["raster-particle-elevation"])}))},i,o,u),this._updateColorRamp(),this.lastInvalidatedAt=bt.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=rd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=bt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class lS extends gn{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function K_(n,e,i){const o=[0,0,1],u=ge.quat.identity([]);return ge.quat.rotateY(u,u,i?-dt(n)+Math.PI:dt(n)),ge.quat.rotateX(u,u,-dt(e)),ge.vec3.transformQuat(o,o,u),ge.vec3.normalize(o,o)}function iv(n,e){const i=Fp(n.projection,n.zoom,n.width,n.height),o=function(a,h,_,b,E){const p=new N(_.lng-180*Ya,_.lat),x=new N(_.lng+180*Ya,_.lat),T=a.project(p.lng,p.lat),v=a.project(x.lng,x.lat),w=-Math.atan2(v.y-T.y,v.x-T.x),A=Re.fromLngLat(_);A.y=gt(A.y,-1+Ya,1-Ya);const C=A.toLngLat(),D=a.project(C.lng,C.lat),F=Re.fromLngLat(C);F.x+=Ya;const V=F.toLngLat(),z=a.project(V.lng,V.lat),j=nv(z.x-D.x,z.y-D.y,w),G=Re.fromLngLat(C);G.y+=Ya;const Y=G.toLngLat(),te=a.project(Y.lng,Y.lat),re=nv(te.x-D.x,te.y-D.y,w),Q=Math.abs(j.x)/Math.abs(re.y),ue=ge.mat4.identity([]);ge.mat4.rotateZ(ue,ue,-w*(1-(E?0:b)));const se=ge.mat4.identity([]);return ge.mat4.scale(se,se,[1,1-(1-Q)*b,1]),se[4]=-re.x/re.y*b,ge.mat4.rotateZ(se,se,w),ge.mat4.multiply(se,ue,se),se}(n.projection,0,n.center,i,e),u=rv(n);return ge.mat4.scale(o,o,[u,u,1]),o}function rv(n){const e=n.projection,i=Fp(n.projection,n.zoom,n.width,n.height),o=J_(e,n.center),u=J_(e,N.convert(e.center));return Math.pow(2,o*i+(1-i)*u)}function Fp(n,e,i,o,u=1/0){const a=n.range;if(!a)return 0;const h=Math.min(u,Math.max(i,o)),_=Math.log(h/1024)/Math.LN2;return vi(a[0]+_,a[1]+_,e)}const Ya=1/4e4;function J_(n,e){const i=gt(e.lat,-he,he),o=new N(e.lng-180*Ya,i),u=new N(e.lng+180*Ya,i),a=n.project(o.lng,i),h=n.project(u.lng,i),_=Re.fromLngLat(o),b=Re.fromLngLat(u),E=h.x-a.x,p=h.y-a.y,x=b.x-_.x,T=b.y-_.y,v=Math.sqrt((x*x+T*T)/(E*E+p*p));return Math.log(v)/Math.LN2}function nv(n,e,i){const o=Math.cos(i),u=Math.sin(i);return{x:n*o-e*u,y:n*u+e*o}}function sv(n,e,i){ge.mat4.identity(n),ge.mat4.rotateZ(n,n,dt(e[2])),ge.mat4.rotateX(n,n,dt(e[0])),ge.mat4.rotateY(n,n,dt(e[1])),ge.mat4.scale(n,n,i),ge.mat4.multiply(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Np(n,e,i,o,u,a,h,_){const b=[i[0]-e[0],i[1]-e[1],0],E=[o[0]-e[0],o[1]-e[1],0];if(ge.vec3.length(b)<1e-12||ge.vec3.length(E)<1e-12)return ge.quat.identity(n);const p=ge.vec3.cross([],b,E);ge.vec3.normalize(p,p),ge.vec3.subtract(E,o,e),b[2]=(a-u)*_,E[2]=(h-u)*_;const x=b;return ge.vec3.cross(x,b,E),ge.vec3.normalize(x,x),ge.quat.rotationTo(n,p,x)}function Q_(n,e,i=!1){const o=qa(e.zoom),u=function(a,h,_){const b=h.worldSize,E=[a[12],a[13],a[14]],p=oe(E[1]/b),x=ae(E[0]/b),T=ge.mat4.identity([]),v=ee(1,p)*b,w=ee(1,0)*b*Te(p,h.zoom),A=1/f_(b);let C=w*A;if(_){const z=Fp(h.projection,h.zoom,h.width,h.height,1024);C=A*h.projection.pixelSpaceConversion(h.center.lat,b,z)}const D=L(p,x);ge.vec3.add(D,D,ge.vec3.scale([],ge.vec3.normalize([],D),v*C*E[2]));const F=function(z){const j=[z[0],z[1],z[2]];let G=[0,1,0];const Y=ge.vec3.cross([],G,j);return ge.vec3.cross(G,j,Y),ge.vec3.squaredLength(G)===0&&(G=[0,1,0],ge.vec3.cross(Y,j,G)),ge.vec3.normalize(Y,Y),ge.vec3.normalize(G,G),ge.vec3.normalize(j,j),[Y[0],Y[1],Y[2],0,G[0],G[1],G[2],0,j[0],j[1],j[2],0,z[0],z[1],z[2],1]}(D);ge.mat4.scale(T,T,[C,C,C*v]),ge.mat4.translate(T,T,[-E[0],-E[1],-E[2]]);const V=ge.mat4.multiply([],h.globeMatrix,F);return ge.mat4.multiply(V,V,T),ge.mat4.multiply(V,V,a),V}(n,e,i);if(o>0){const a=function(h,_){const b=_.worldSize,E=ee(1,0)*b*Te(_.center.lat,_.zoom)/f_(b),p=ee(1,_.center.lat)*b,x=ge.mat4.identity([]);return ge.mat4.rotateY(x,x,dt(_.center.lng)),ge.mat4.rotateX(x,x,dt(_.center.lat)),ge.mat4.translate(x,x,[0,0,t]),ge.mat4.scale(x,x,[E,E,E*p]),ge.mat4.translate(x,x,[_.point.x-.5*b,_.point.y-.5*b,0]),ge.mat4.multiply(x,x,h),ge.mat4.multiply(x,_.globeMatrix,x)}(n,e);return function(h,_,b){const E=(w,A,C)=>{const D=ge.vec3.length(w),F=ge.vec3.length(A),V=Jo(w,A,C);return ge.vec3.scale(V,V,1/ge.vec3.length(V)*Yt(D,F,C))},p=E([h[0],h[1],h[2]],[_[0],_[1],_[2]],b),x=E([h[4],h[5],h[6]],[_[4],_[5],_[6]],b),T=E([h[8],h[9],h[10]],[_[8],_[9],_[10]],b),v=Jo([h[12],h[13],h[14]],[_[12],_[13],_[14]],b);return[p[0],p[1],p[2],0,x[0],x[1],x[2],0,T[0],T[1],T[2],0,v[0],v[1],v[2],1]}(u,a,o)}return u}function ov(n,e,i,o){const u=or.projectAabbCorners(o,i);let a=Number.MAX_VALUE,h=-1;for(let E=0;E<u.length;++E){const p=u[E];p[0]=(.5*p[0]+.5)*e.width,p[1]=(.5-.5*p[1])*e.height,p[2]<a&&(h=E,a=p[2])}const _=E=>new Se(u[E][0],u[E][1]);let b;switch(h){case 0:case 6:b=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:b=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:b=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:b=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(ft(n,b))return a}const cS=Oi([{name:"a_pos_3f",components:3,type:"Float32"}]),uS=Oi([{name:"a_color_3f",components:3,type:"Float32"}]),hS=Oi([{name:"a_color_4f",components:4,type:"Float32"}]),dS=Oi([{name:"a_uv_2f",components:2,type:"Float32"}]),fS=Oi([{name:"a_normal_3f",components:3,type:"Float32"}]),pS=Oi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),mS=Oi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),av={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Vp{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function lv(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class cv{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class uv{constructor(){this.instancedDataArray=new $l,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class eg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,o,u){this.tileToMeter=xe(o);const a=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:_,index:b,sourceLayerIndex:E}of e){const p=_??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),x=at(h,a);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),x,o))continue;const T={id:p,sourceLayerIndex:E,index:b,geometry:a?x.geometry:st(h,o,u),properties:h.properties,type:h.type,patterns:{}},v=this.addFeature(T,T.geometry,x);v&&i.featureIndex.insert(h,T.geometry,b,E,this.index,this.instancesPerModel[v].instancedDataArray.length,mt/32)}this.lookup=null}update(e,i,o,u){for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];for(const _ in e)h.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(h.features[h.idToFeaturesIndex[_]],e[_],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const u of o.features){const a=this.layers[0],h=u.feature,_=this.canonical,b=a.paint.get("model-rotation").evaluate(h,{},_),E=a.paint.get("model-scale").evaluate(h,{},_),p=a.paint.get("model-translation").evaluate(h,{},_);ge.vec3.exactEquals(u.rotation,b)&&ge.vec3.exactEquals(u.scale,E)&&ge.vec3.exactEquals(u.translation,p)||(this.evaluate(u,u.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(M_(this.activeReplacements,a))return!1;this.activeReplacements=a;let h=!1;for(const _ in this.instancesPerModel){const b=this.instancesPerModel[_],E=b.instancedDataArray;for(const p of b.features){const x=p.instancedDataOffset,T=p.instancedDataCount;for(let v=0;v<T;v++){const w=16*(v+x);let A=E.float32[w+0];const C=A>mt;A=C?A-mt:A;const D=Math.floor(A),F=E.float32[w+1];let V=!1;for(const z of this.activeReplacements)if(!S0(z,o,av.Model,u)&&!(z.min.x>D||D>z.max.x||z.min.y>F||F>z.max.y)&&(V=R0(P0(D,F,e.canonical,z.footprintTileId.canonical),z.footprint),V))break;E.float32[w]=V?A+mt:A,h=h||V!==C}}}return h}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,pS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){const u=this.layers[0],a=u.layout.get("model-id").evaluate(o,{},this.canonical);if(!a)return zi(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),a;lv(a,!1)&&(this.modelUris.includes(a)||this.modelUris.push(a)),this.instancesPerModel[a]||(this.instancesPerModel[a]=new uv);const h=this.instancesPerModel[a],_=h.instancedDataArray,b=new cv(o,_.length);for(const E of i)for(const p of E){if(p.x<0||p.x>=mt||p.y<0||p.y>=mt)continue;const x=(this.lookupDim-1)/mt,T=this.lookupDim*(p.y*x|0)+p.x*x|0;if(this.lookup){if(this.lookup[T]!==0)continue;this.lookup[T]=1}this.instanceCount++;const v=_.length;_.resize(v+1),h.instancesEvaluatedElevation.push(0),_.float32[16*v]=p.x,_.float32[16*v+1]=p.y}return b.instancedDataCount=h.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(b),this.evaluate(b,{},h,!1)),a}getModelUris(){return this.modelUris}evaluate(e,i,o,u){const a=this.layers[0],h=e.feature,_=this.canonical,b=e.rotation=a.paint.get("model-rotation").evaluate(h,i,_),E=e.scale=a.paint.get("model-scale").evaluate(h,i,_),p=e.translation=a.paint.get("model-translation").evaluate(h,i,_),x=a.paint.get("model-color").evaluate(h,i,_);x.a=a.paint.get("model-color-mix-intensity").evaluate(h,i,_);const T=[];this.maxVerticalOffset<p[2]&&(this.maxVerticalOffset=p[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),sv(T,b,E);const v=Math.round(100*x.a)+x.b/1.05;for(let w=0;w<e.instancedDataCount;++w){const A=e.instancedDataOffset+w,C=16*A,D=o.instancedDataArray.float32;let F=0;u&&(F=D[C+6]-o.instancesEvaluatedElevation[A]);const V=0|D[C+1];D[C]=(0|D[C])+x.r/1.05,D[C+1]=V+x.g/1.05,D[C+2]=v,D[C+3]=1/(_.z>10?this.tileToMeter:xe(_,V)),D[C+4]=p[0],D[C+5]=p[1],D[C+6]=p[2]+F,D[C+7]=T[0],D[C+8]=T[1],D[C+9]=T[2],D[C+10]=T[4],D[C+11]=T[5],D[C+12]=T[6],D[C+13]=T[8],D[C+14]=T[9],D[C+15]=T[10],o.instancesEvaluatedElevation[A]=p[2]}}}let hv,dv;At(eg,"ModelBucket",{omit:["layers"]}),At(uv,"PerModelAttributes"),At(cv,"ModelFeature");const Jl=64,Su={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function fv(n,e,i,o,u,a,h,_,b,E=!1){const p=i.zoom,x=i.project(o),T=Te(o.lat,p),v=1/T;ge.mat4.identity(n),ge.mat4.translate(n,n,[x.x+h[0]*v,x.y+h[1]*v,h[2]]);let w=1,A=1;const C=i.worldSize;if(E){if(i.projection.name==="mercator"){let z=0;i.elevation&&(z=i.elevation.getAtPointOrZero(new Re(x.x/C,x.y/C),0));const j=ge.vec4.transformMat4([],[x.x,x.y,z,1],i.projMatrix)[3]/i.cameraToCenterDistance;w=j,A=j*Te(i.center.lat,p)}else if(i.projection.name==="globe"){const z=Q_(n,i),j=ge.mat4.multiply([],i.projMatrix,z),G=[0,0,0,1];ge.vec4.transformMat4(G,G,j);const Y=G[3]/i.cameraToCenterDistance,te=qa(p),re=i.projection.pixelsPerMeter(o.lat,C)*Te(o.lat,p),Q=i.projection.pixelsPerMeter(i.center.lat,C)*Te(i.center.lat,p);w=Y/Yt(re,_e(i.center.lat),te),A=Y*T/re,w*=Q,A*=Q}}else w=v;ge.mat4.scale(n,n,[w,w,A]);const D=[...n],F=e.orientation,V=[];if(sv(V,[F[0]+u[0],F[1]+u[1],F[2]+u[2]],a),ge.mat4.multiply(n,D,V),_&&i.elevation){let z=0;const j=[];if(b&&i.elevation){z=function(te,re,Q,ue,se){const de=re.elevation;if(!de)return 0;const we=or.projectAabbCorners(Q,ue),Ee=ee(1,se.lat)*re.worldSize,Me=function(Nt,yt){const Mt=[0,0,1],ti=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const mi of ti){const ci=Nt[mi.corners[0]],ui=Nt[mi.corners[1]],gi=Nt[mi.corners[2]],xi=[ui[0]-ci[0],ui[1]-ci[1],yt*(ui[2]-ci[2])],tr=ge.vec3.cross(xi,xi,[gi[0]-ci[0],gi[1]-ci[1],yt*(gi[2]-ci[2])]);ge.vec3.normalize(tr,tr),mi.dotProductWithUp=ge.vec3.dot(tr,Mt)}return ti.sort((mi,ci)=>mi.dotProductWithUp-ci.dotProductWithUp),ti[0].corners}(we,Ee),Ie=we[Me[0]],Be=we[Me[1]],Pe=we[Me[2]],Ze=we[Me[3]],Je=de.getAtPointOrZero(new Re(Ie[0]/re.worldSize,Ie[1]/re.worldSize),0),Ue=de.getAtPointOrZero(new Re(Be[0]/re.worldSize,Be[1]/re.worldSize),0),xt=de.getAtPointOrZero(new Re(Pe[0]/re.worldSize,Pe[1]/re.worldSize),0),pt=de.getAtPointOrZero(new Re(Ze[0]/re.worldSize,Ze[1]/re.worldSize),0),ot=(Je+pt)/2,tt=(Ue+xt)/2;return ot>tt?Ue<xt?Np(te,Be,Ze,Ie,Ue,pt,Je,Ee):Np(te,Pe,Ie,Ze,xt,Je,pt,Ee):Je<pt?Np(te,Ie,Be,Pe,Je,Ue,xt,Ee):Np(te,Ze,Pe,Be,pt,xt,Ue,Ee),Math.max(ot,tt)}(j,i,e.aabb,n,o);const G=ge.mat4.fromQuat([],j),Y=ge.mat4.multiply([],G,V);ge.mat4.multiply(n,D,Y)}else z=i.elevation.getAtPointOrZero(new Re(x.x/C,x.y/C),0);z!==0&&(n[14]+=z)}}function Td(n,e,i=!1){n.uploaded||(n.gfxTexture=new Y_(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function _S(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,cS.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,fS.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,dS.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?uS:hS).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,mS.members,!0)),n.segments=wr.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const o=n.material;o.pbrMetallicRoughness.baseColorTexture&&Td(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Td(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Td(o.normalTexture,e),o.occlusionTexture&&Td(o.occlusionTexture,e,i),o.emissionTexture&&Td(o.emissionTexture,e)}function tg(n,e,i){if(n.meshes)for(const o of n.meshes)_S(o,e,i);if(n.children)for(const o of n.children)tg(o,e,i)}function Up(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)Up(e)}function ig(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)ig(i)}class Mu{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const u=o||e.findDEMTileFor(i);if(!u||!u.dem)return;const a=u.dem,h=u.tileID,_=1<<i.canonical.z-h.canonical.z;return new Mu(u,a.dim/mt/_,[(i.canonical.x/_-h.canonical.x)*a.dim,(i.canonical.y/_-h.canonical.y)*a.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),a=Math.floor(o);return new Se(u,a)}getElevationAt(e,i,o,u){const a=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],_=Math.floor(a),b=Math.floor(h),E=this._dem;return u=!!u,o?Yt(Yt(E.get(_,b,u),E.get(_,b+1,u),h-b),Yt(E.get(_+1,b,u),E.get(_+1,b+1,u),h-b),a-_):E.get(_,b,u)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ee(1,e)*this._dem.stride}}const rg=new Float32Array(262144),Ql=new Uint8Array(262144);function pv(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,pv(i));return e}function mv(n,e,i){if(n.meshes)for(const o of n.meshes)o.aabb.min[0]!==1/0&&i.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(n.children)for(const o of n.children)mv(o,e,i)}const _v=["","wall","door","roof","window","lamp","logo"];class gv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:pv(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=or.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class jp{constructor(e,i,o,u,a,h){this.id=i,this.modelTraits|=Su.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=Su.HasMapboxMeshFeatures),u&&(this.modelTraits|=Su.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const _ of e)this.nodesInfo.push(new gv(_)),mv(_,h.featureIndexArray.length,h.grid),h.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,h.bucketLayerIDs.length-1,0)}updateFootprints(e,i){for(const o of this.getNodesInfo()){const u=o.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const u=o.node;this.uploaded?this.updatePbrBuffer(u):tg(u,e,!0)}for(const o of i)Up(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const u=e.transform.projectionOptions,a=e.style.getBrightness(),h=this.brightness!==a;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||Ed(o.paint.get("model-color").value,h)||Ed(o.paint.get("model-color-mix-intensity").value,h)||Ed(o.paint.get("model-roughness").value,h)||Ed(o.paint.get("model-emissive-strength").value,h)||Ed(o.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=u,this.brightness=a,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),u=this.id.canonical;for(const a of o){const h=a.feature;a.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},u)}}evaluate(e){const i=this.getNodesInfo();for(const o of i){if(!o.node.meshes)continue;const u=o.feature,a=o.node.meshes&&o.node.meshes[0].featureData,h=o.evaluatedColor[2],_=o.evaluatedRMEA[2],b=this.id.canonical;if(o.hasTranslucentParts=!1,a){for(let E=0;E<_v.length;E++){const p=_v[E];p.length&&(u.properties.part=p);const x=e.paint.get("model-color").evaluate(u,{},b).toRenderColor(null),T=e.paint.get("model-color-mix-intensity").evaluate(u,{},b);o.evaluatedColor[E]=[x.r,x.g,x.b,T],o.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(u,{},b),o.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b),o.evaluatedRMEA[E][3]=x.a,o.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},b),!o.hasTranslucentParts&&x.a<1&&(o.hasTranslucentParts=!0)}delete u.properties.part,yS(o,h!==o.evaluatedColor[2]||_!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b);o.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},b),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,u){const a=e.findDEMTileFor(o);if(a&&(a.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(a.dem&&a.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=a.tileID.overscaledZ;const h=Mu.create(e,o,a);if(!h)return;this.modelTraits&Su.HasMapboxMeshFeatures&&this.updateDEM(e,h,o,u);for(const _ of this.getNodesInfo()){const b=_.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const E=b.footprint.vertices;let p=h.getElevationAt(E[0].x,E[0].y,!0,!0);for(let x=1;x<E.length;x++)p=Math.min(p,h.getElevationAt(E[x].x,E[x].y,!0,!0));b.elevation=p}}this.terrainTile=a.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,u){let a=i._dem._modifiedForSources[u];if(a===void 0&&(i._dem._modifiedForSources[u]=[],a=i._dem._modifiedForSources[u]),a.includes(o.canonical))return;const h=i._dem.dim;a.push(o.canonical);let _=!1;for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.grid)continue;const p=E.footprint.grid,x=i.tileCoordToPixel(p.min.x,p.min.y),T=i.tileCoordToPixel(p.max.x,p.max.y),v=Math.min(Math.min(h-T.y,x.x),Math.min(x.y,h-T.x));if(v<0)continue;const w=gt(v,2,5);let A=Math.max(0,x.x-w),C=Math.max(0,x.y-w),D=Math.min(T.x+w,h-1),F=Math.min(T.y+w,h-1);for(let G=C;G<=F;++G)for(let Y=A;Y<=D;++Y)Ql[G*h+Y]=255;let V=0,z=0;for(let G=0;G<p.cellsY;++G)for(let Y=0;Y<p.cellsX;++Y){if(!p.cells[G*p.cellsX+Y])continue;const te=i.tileCoordToPixel(p.min.x+Y/p.xScale,p.min.y+G/p.yScale),re=i.tileCoordToPixel(p.min.x+(Y+1)/p.xScale,p.min.y+(G+1)/p.yScale);for(let Q=te.y;Q<=Math.min(re.y+1,h-1);++Q)for(let ue=te.x;ue<=Math.min(re.x+1,h-1);++ue)Ql[Q*h+ue]===255&&(Ql[Q*h+ue]=0,V+=i.getElevationAtPixel(ue,Q),z++)}const j=V/z;A=Math.max(1,x.x-w),C=Math.max(1,x.y-w),D=Math.min(T.x+w,h-2),F=Math.min(T.y+w,h-2),_=!0;for(let G=C;G<=F;++G)for(let Y=A;Y<=D;++Y)Ql[G*h+Y]===0&&(rg[G*h+Y]=i._dem.set(Y,G,j));for(let G=1;G<w;++G){A=Math.max(1,x.x-G),C=Math.max(1,x.y-G),D=Math.min(T.x+G,h-2),F=Math.min(T.y+G,h-2);for(let Y=C;Y<=F;++Y)for(let te=A;te<=D;++te){const re=Y*h+te;if(Ql[re]===255){let Q=0,ue=0,se=-1,de=-1;for(let we=-1;we<=1;++we)for(let Ee=-1;Ee<=1;++Ee){const Me=(Y+we)*h+te+Ee;if(Ql[Me]>=G)continue;const Ie=rg[Me],Be=Math.abs(Ie);Be>ue&&(Q=Ie,ue=Be,se=Ee,de=we)}if(ue>.1){const we=1-(G+.5*Math.abs(se*de))/w;let Ee=i._dem.get(te,Y)+Q*we;const Me=i._dem.get(te+se,Y+de),Ie=i._dem.get(te-se,Y-de,!0);(Ee-Me)*(Ee-Ie)>0&&(Ee=(Me+Ie)/2),rg[re]=i._dem.set(te,Y,Ee),Ql[re]=G}}}}}_&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=bt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Up(i.node),ig(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let a=0;a<this.nodesInfo.length;a++){const h=u[a].node;u[a].hiddenByReplacement=!!h.footprint&&!o.find(_=>_.footprint===h.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),u=[],a=[0,0,0],h=ge.mat4.identity([]);for(let _=0;_<this.nodesInfo.length;_++){const b=o[_],E=b.node.meshes[0],p=E.transformedAabb;if(e<p.min[0]||i<p.min[1]||e>p.max[0]||i>p.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};ge.mat4.invert(h,b.node.matrix),a[0]=e,a[1]=i,ge.vec3.transformMat4(a,a,h);const x=(a[0]-E.aabb.min[0])/(E.aabb.max[0]-E.aabb.min[0])*Jl|0,T=Math.min(63,(a[1]-E.aabb.min[1])/(E.aabb.max[1]-E.aabb.min[1])*Jl|0)*Jl+Math.min(63,x),v=E.heightmap[T];if(!(v<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:v,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Se(e,i),new Se(e,i),u),u.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Ed(n,e){return!n.isLightConstant&&e}function gS(n,e,i,o,u,a,h,_){let b=(61440&e|(61440&e)>>4)>>8,E=(3840&e|(3840&e)>>4)>>4,p=240&e|(240&e)>>4;i[3]>0&&(b=Yt(b,255*i[0],i[3]),E=Yt(E,255*i[1],i[3]),p=Yt(p,255*i[2],i[3]));const x=b<<8|E,T=p<<8|Math.floor(255*o[3]),v=function(G){const Y=gt(G,0,2);return Math.min(Math.round(.5*Y*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],w=gt(u[0],0,1),A=gt(u[1],0,1),C=gt(u[2],0,1),D=gt(u[3],0,1);let F,V,z,j;if(w!==A&&h!==a&&A!==w){const G=h-a;V=1/(G*(A-w)),z=-(a+G*w)/(G*(A-w));const Y=gt(u[4],-1,1);j=Math.pow(10,Y),F=255*C<<8|255*D}else F=65535,V=0,z=1,j=1;if(n.emplaceBack(x,T,v,F,V,z,j),_){const G=_.length;_.clear();for(let Y=0;Y<G;Y++)_.emplaceBack(x,T,v,F,V,z,j)}}function yS(n,e,i){const o=n.node;let u=0;const a=i&Su.HasMeshoptCompression;for(const h of o.meshes){if(o.lights&&o.lightMeshIndex===u||!h.featureData)continue;h.featureArray=new uu,h.featureArray.reserve(h.featureData.length);let _=e;for(const b of h.featureData){const E=a?65535&b:b>>16&65535,p=a?b>>16&65535:65535&b,x=(15&p)<8?15&p:0,T=n.evaluatedRMEA[x],v=n.evaluatedColor[x],w=n.emissionHeightBasedParams[x];let A;if(_&&x===2&&o.lights&&(A=new uu,A.resize(10*o.lights.length)),gS(h.featureArray,E,v,T,w,h.aabb.min[2],h.aabb.max[2],A),A&&_){_=!1;const C=o.meshes[o.lightMeshIndex];C.featureArray=A,C.featureArray._trim()}}h.featureArray._trim(),u++}}function yv(n,e,i,o){const u=1<<n.z;e.lat=oe((o/mt+n.y)/u),e.lng=ae((i/mt+n.x)/u)}At(jp,"Tiled3dModelBucket",{omit:["layers"]}),At(gv,"Tiled3dModelFeature");const xS={circle:class extends gn{constructor(n,e,i,o){super(n,{layout:$i||($i=new pr({"circle-sort-key":new Bt(Oe.layout_circle["circle-sort-key"]),visibility:new ut(Oe.layout_circle.visibility)})),paint:Tr||(Tr=new pr({"circle-radius":new Bt(Oe.paint_circle["circle-radius"]),"circle-color":new Bt(Oe.paint_circle["circle-color"]),"circle-blur":new Bt(Oe.paint_circle["circle-blur"]),"circle-opacity":new Bt(Oe.paint_circle["circle-opacity"]),"circle-translate":new ut(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bt(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bt(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bt(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ut(Oe.paint_circle["circle-emissive-strength"])}))},e,i,o)}createBucket(n){return new Ft(n)}queryRadius(n){const e=n;return mr("circle-radius",this,e)+mr("circle-stroke-width",this,e)+Ki(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,o,u,a,h,_){const b=Bi(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Yy(n,o,a,h,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const o=Xy(this);return{config:new Yo(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}},heatmap:class extends gn{createBucket(n){return new Jy(n)}constructor(n,e,i,o){super(n,{layout:Qy||(Qy=new pr({visibility:new ut(Oe.layout_heatmap.visibility)})),paint:e0||(e0=new pr({"heatmap-radius":new Bt(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bt(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ys(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Oe.paint_heatmap["heatmap-opacity"])}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return mr("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,o,u,a,h,_){const b=this.paint.get("heatmap-radius").evaluate(e,i);return Yy(n,o,a,h,_,!0,!0,new Se(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Yo(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends gn{constructor(n,e,i,o){super(n,{layout:t0||(t0=new pr({visibility:new ut(Oe.layout_hillshade.visibility)})),paint:i0||(i0=new pr({"hillshade-illumination-direction":new ut(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ut(Oe.paint_hillshade["hillshade-emissive-strength"])}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends gn{constructor(n,e,i,o){super(n,{layout:u0||(u0=new pr({"fill-sort-key":new Bt(Oe.layout_fill["fill-sort-key"]),visibility:new ut(Oe.layout_fill.visibility)})),paint:h0||(h0=new pr({"fill-antialias":new ut(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Bt(Oe.paint_fill["fill-opacity"]),"fill-color":new Bt(Oe.paint_fill["fill-color"]),"fill-outline-color":new Bt(Oe.paint_fill["fill-outline-color"]),"fill-translate":new ut(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bt(Oe.paint_fill["fill-pattern"]),"fill-emissive-strength":new ut(Oe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Bt(Oe.paint_fill["fill-z-offset"])}))},e,i,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Yo(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new v_(n)}queryRadius(){return Ki(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,o,u,a){return!n.queryGeometry.isAboveHorizon&&Kt(pi(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends gn{constructor(n,e,i,o){super(n,{layout:Z0||(Z0=new pr({visibility:new ut(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ut(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:H0||(H0=new pr({"fill-extrusion-opacity":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ut(Oe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new xp(n)}queryRadius(){return Ki(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,o,u,a,h,_,b){const E=Bi(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,n.pixelToTileUnitsFactor),p=this.paint.get("fill-extrusion-height").evaluate(e,i),x=this.paint.get("fill-extrusion-base").evaluate(e,i),T=[0,0],v=_&&a.elevation,w=a.elevation?a.elevation.exaggeration():1,A=n.tile.getBucket(this);if(v&&A instanceof xp){const z=A.centroidVertexArray,j=b+1;j<z.length&&(T[0]=z.geta_centroid_pos0(j),T[1]=z.geta_centroid_pos1(j))}if(T[0]===0&&T[1]===1)return!1;a.projection.name==="globe"&&(o=$0([o],[new Se(0,0),new Se(mt,mt)],n.tileID.canonical).map(z=>z.polygon).flat());const C=v?_:null,[D,F]=function(z,j,G,Y,te,re,Q,ue,se,de,we){return z.projection.name==="globe"?function(Ee,Me,Ie,Be,Pe,Ze,Je,Ue,xt,pt,ot){const tt=[],Nt=[],yt=Ee.projection.upVectorScale(ot,Ee.center.lat,Ee.worldSize).metersToTile,Mt=[0,0,0,1],ti=[0,0,0,1],mi=(ui,gi,xi,tr)=>{ui[0]=gi,ui[1]=xi,ui[2]=tr,ui[3]=1},ci=q0();Ie>0&&(Ie+=ci),Be+=ci;for(const ui of Me){const gi=[],xi=[];for(const tr of ui){const Zi=tr.x+Pe.x,ri=tr.y+Pe.y,Ni=Ee.projection.projectTilePoint(Zi,ri,ot),Ui=Ee.projection.upVector(ot,tr.x,tr.y);let ur=Ie,Ar=Be;if(Je){const Nr=X0(Zi,ri,Ie,Be,Je,Ue,xt,pt);ur+=Nr.base,Ar+=Nr.top}Ie!==0?mi(Mt,Ni.x+Ui[0]*yt*ur,Ni.y+Ui[1]*yt*ur,Ni.z+Ui[2]*yt*ur):mi(Mt,Ni.x,Ni.y,Ni.z),mi(ti,Ni.x+Ui[0]*yt*Ar,Ni.y+Ui[1]*yt*Ar,Ni.z+Ui[2]*yt*Ar),ge.vec3.transformMat4(Mt,Mt,Ze),ge.vec3.transformMat4(ti,ti,Ze),gi.push(new Kl(Mt[0],Mt[1],Mt[2])),xi.push(new Kl(ti[0],ti[1],ti[2]))}tt.push(gi),Nt.push(xi)}return[tt,Nt]}(z,j,G,Y,te,re,Q,ue,se,de,we):Q?function(Ee,Me,Ie,Be,Pe,Ze,Je,Ue,xt){const pt=[],ot=[],tt=[0,0,0,1];for(const Nt of Ee){const yt=[],Mt=[];for(const ti of Nt){const mi=ti.x+Be.x,ci=ti.y+Be.y,ui=X0(mi,ci,Me,Ie,Ze,Je,Ue,xt);tt[0]=mi,tt[1]=ci,tt[2]=ui.base,tt[3]=1,ge.vec4.transformMat4(tt,tt,Pe),tt[3]=Math.max(tt[3],1e-5);const gi=new Kl(tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]);tt[0]=mi,tt[1]=ci,tt[2]=ui.top,tt[3]=1,ge.vec4.transformMat4(tt,tt,Pe),tt[3]=Math.max(tt[3],1e-5);const xi=new Kl(tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]);yt.push(gi),Mt.push(xi)}pt.push(yt),ot.push(Mt)}return[pt,ot]}(j,G,Y,te,re,Q,ue,se,de):function(Ee,Me,Ie,Be,Pe){const Ze=[],Je=[],Ue=Pe[8]*Me,xt=Pe[9]*Me,pt=Pe[10]*Me,ot=Pe[11]*Me,tt=Pe[8]*Ie,Nt=Pe[9]*Ie,yt=Pe[10]*Ie,Mt=Pe[11]*Ie;for(const ti of Ee){const mi=[],ci=[];for(const ui of ti){const gi=ui.x+Be.x,xi=ui.y+Be.y,tr=Pe[0]*gi+Pe[4]*xi+Pe[12],Zi=Pe[1]*gi+Pe[5]*xi+Pe[13],ri=Pe[2]*gi+Pe[6]*xi+Pe[14],Ni=Pe[3]*gi+Pe[7]*xi+Pe[15],Ui=tr+Ue,ur=Zi+xt,Ar=ri+pt,Nr=Math.max(Ni+ot,1e-5),Ir=tr+tt,vr=Zi+Nt,rn=ri+yt,jr=Math.max(Ni+Mt,1e-5);mi.push(new Kl(Ui/Nr,ur/Nr,Ar/Nr)),ci.push(new Kl(Ir/jr,vr/jr,rn/jr))}Ze.push(mi),Je.push(ci)}return[Ze,Je]}(j,G,Y,te,re)}(a,o,x,p,E,h,C,T,w,a.center.lat,n.tileID.canonical),V=n.queryGeometry;return function(z,j,G){let Y=1/0;Kt(G,j)&&(Y=W0(G,j[0]));for(let te=0;te<j.length;te++){const re=j[te],Q=z[te];for(let ue=0;ue<re.length-1;ue++){const se=re[ue],de=[se,re[ue+1],Q[ue+1],Q[ue],se];ft(G,de)&&(Y=Math.min(Y,W0(G,de)))}}return Y!==1/0&&Y}(D,F,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends gn{constructor(n,e,i,o){const u=sx();super(n,u,e,i,o),u.layout&&(this.layout=new Da(u.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Cl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(dd)return dd;const i=sx();return dd=new wE(i.paint.properties["line-width"].specification),dd.useIntegerZoom=!0,dd})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new P_(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const o=rx(this);return{config:new Yo(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(n){const e=n,i=ox(mr("line-width",this,e),mr("line-gap-width",this,e)),o=mr("line-offset",this,e);return i/2+Math.abs(o)+Ki(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,o,u,a){if(n.queryGeometry.isAboveHorizon)return!1;const h=pi(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,n.pixelToTileUnitsFactor),_=n.pixelToTileUnitsFactor/2*ox(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(o=function(E,p){const x=[],T=new Se(0,0);for(let v=0;v<E.length;v++){const w=E[v],A=[];for(let C=0;C<w.length;C++){const D=w[C],F=w[C+1],V=C===0?T:D.sub(w[C-1])._unit()._perp(),z=C===w.length-1?T:F.sub(D)._unit()._perp(),j=V._add(z)._unit();j._mult(1/(j.x*z.x+j.y*z.y)),A.push(j._mult(p)._add(D))}x.push(A)}return x}(o,b*n.pixelToTileUnitsFactor)),function(E,p,x){for(let T=0;T<p.length;T++){const v=p[T];if(E.length>=3){for(let w=0;w<v.length;w++)if(cr(E,v[w]))return!0}if(Lt(E,v,x))return!0}return!1}(h,o,_)}isTileClipped(){return!0}isDraped(n){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:zp,background:class extends gn{constructor(n,e,i,o){super(n,{layout:Gx||(Gx=new pr({visibility:new ut(Oe.layout_background.visibility)})),paint:qx||(qx=new pr({"background-pitch-alignment":new ut(Oe.paint_background["background-pitch-alignment"]),"background-color":new ut(Oe.paint_background["background-color"]),"background-pattern":new ut(Oe.paint_background["background-pattern"]),"background-opacity":new ut(Oe.paint_background["background-opacity"]),"background-emissive-strength":new ut(Oe.paint_background["background-emissive-strength"])}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Xx,"raster-particle":tv,sky:class extends gn{constructor(n,e,i,o){super(n,{layout:Jx||(Jx=new pr({visibility:new ut(Oe.layout_sky.visibility)})),paint:Qx||(Qx=new pr({"sky-type":new ut(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new ut(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ut(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ut(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ut(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ys(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ut(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ut(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ut(Oe.paint_sky["sky-opacity"])}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),u=!o,a=n.style.light,h=a.properties.get("position");return u&&a.properties.get("anchor")==="viewport"&&zi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?K_(h.azimuthal,90-h.polar,e):K_(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return K_(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends gn{constructor(n,e,i,o){super(n,{paint:ev||(ev=new pr({}))},e,null)}},model:class extends gn{constructor(n,e,i,o){super(n,{layout:hv||(hv=new pr({visibility:new ut(Oe.layout_model.visibility),"model-id":new Bt(Oe.layout_model["model-id"])})),paint:dv||(dv=new pr({"model-opacity":new ut(Oe.paint_model["model-opacity"]),"model-rotation":new Bt(Oe.paint_model["model-rotation"]),"model-scale":new Bt(Oe.paint_model["model-scale"]),"model-translation":new Bt(Oe.paint_model["model-translation"]),"model-color":new Bt(Oe.paint_model["model-color"]),"model-color-mix-intensity":new Bt(Oe.paint_model["model-color-mix-intensity"]),"model-type":new ut(Oe.paint_model["model-type"]),"model-cast-shadows":new ut(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new ut(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ut(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Bt(Oe.paint_model["model-emissive-strength"]),"model-roughness":new Bt(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Bt(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ut(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ut(Oe.paint_model["model-front-cutoff"])}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new eg(n)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof jp?mt-1:0}queryIntersectsFeature(n,e,i,o,u,a){if(!this.modelManager)return!1;const h=this.modelManager,_=n.tile.getBucket(this);if(!(_&&_ instanceof eg))return!1;const b=_;for(const E in b.instancesPerModel){const p=b.instancesPerModel[E],x=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(p.idToFeaturesIndex.hasOwnProperty(x)){const T=p.features[p.idToFeaturesIndex[x]],v=h.getModel(E,this.scope);if(!v)return!1;let w=ge.mat4.create();const A=new N(0,0),C=b.canonical;let D=Number.MAX_VALUE;for(let F=0;F<T.instancedDataCount;++F){const V=16*(T.instancedDataOffset+F),z=p.instancedDataArray.float32,j=[z[V+4],z[V+5],z[V+6]];yv(C,A,z[V],0|z[V+1]),fv(w,v,a,A,T.rotation,T.scale,j,!1,!1,!1),a.projection.name==="globe"&&(w=Q_(w,a));const G=ge.mat4.multiply([],a.projMatrix,w),Y=n.queryGeometry,te=ov(Y.isPointQuery()?Y.screenBounds:Y.screenGeometry,a,G,v.aabb);te!=null&&(D=Math.min(te,D))}return D!==Number.MAX_VALUE&&D}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ks}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(n,e,i,o){const u=n.tile,a=u.getBucket(this);let h=null,_=Number.MAX_VALUE;if(!(a&&a instanceof jp))return{queryFeature:h,intersectionZ:_};const b=a.getNodesInfo()[e];if(b.hiddenByReplacement||!b.node.meshes||!i.filter(new br(u.tileID.overscaledZ),b.feature,u.tileID.canonical))return{queryFeature:h,intersectionZ:_};const E=b.node,p=o.calculatePosMatrix(u.tileID.toUnwrapped(),o.worldSize),x=b.evaluatedScale;let T=0;o.elevation&&E.elevation&&(T=E.elevation*o.elevation.exaggeration()),ge.mat4.translate(p,p,[(E.anchor?E.anchor[0]:0)*(x[0]-1),(E.anchor?E.anchor[1]:0)*(x[1]-1),T]),ge.mat4.scale(p,p,x),ge.mat4.multiply(p,p,E.matrix);const v=n.queryGeometry,w=v.isPointQuery()?v.screenBounds:v.screenGeometry,A=function(D){const F=ge.mat4.multiply([],p,D.matrix),V=ge.mat4.multiply(F,o.expandedFarZProjMatrix,F);for(let z=0;z<D.meshes.length;++z){const j=D.meshes[z];if(z===D.lightMeshIndex)continue;const G=ov(w,o,V,j.aabb);G!=null&&(_=Math.min(G,_))}if(D.children)for(const z of D.children)A(z)};if(A(E),_===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:_};const C=new N(0,0);return yv(u.tileID.canonical,C,b.node.anchor[0],b.node.anchor[1]),h={type:"Feature",geometry:{type:"Point",coordinates:[C.lng,C.lat]},properties:b.feature.properties,id:b.feature.id,state:{},layer:this.serialize()},{queryFeature:h,intersectionZ:_}}},clip:class extends gn{constructor(n,e,i,o){super(n,{layout:d0||(d0=new pr({"clip-layer-types":new ut(Oe.layout_clip["clip-layer-types"]),"clip-layer-scope":new ut(Oe.layout_clip["clip-layer-scope"])})),paint:f0||(f0=new pr({}))},e,i,o)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new p0(n)}isTileClipped(){return!0}is3D(){return!0}}};class vS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class bS{constructor(){this.tasks={},this.taskQueue=[],Yr(["process"],this),this.invoker=new vS(this.process),this.nextId=0}add(e,i){const o=this.nextId++,u=function({type:a,isSymbolTile:h,zoom:_}){return _=_||0,a==="message"?0:a!=="maybePrepare"||h?a!=="parseTile"||h?a==="parseTile"&&h?300-_:a==="maybePrepare"&&h?400-_:500:200-_:100-_}(i);if(u===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:u,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const a=this.tasks[this.taskQueue[u]];a.priority<i&&(i=a.priority,e=u)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class xv{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Yr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new bS}send(e,i,o,u,a=!1,h){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[_]=o);const b=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!o,targetMapId:u,mustQueue:a,sourceMapId:this.mapId,data:zn(i,b)},b),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[o];delete this.cancelCallbacks[o],u&&u.cancel()}else if(i.mustQueue||Oo()){const u=this.callbacks[o],a=this.scheduler.add(()=>this.processTask(o,i),u&&u.metadata||{type:"message"});a&&(this.cancelCallbacks[o]=a)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o($o(i.error)):o(null,$o(i.data)))}else{const o=new Set,u=i.hasCallback?(h,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?zn(h):null,data:zn(_,o)},o)}:h=>{},a=$o(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,a,u);else if(this.parent.getWorkerSource){const h=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,h[0],a.source,a.scope)[h[1]](a,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Au{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Vr();const o=this.workerPool.acquire(this.id);for(let u=0;u<o.length;u++){const a=new Au.Actor(o[u],i,this.id);a.name=`Worker ${u}`,this.actors.push(a)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){rr(this.actors,(u,a)=>{u.send(e,i,a)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Au.Actor=xv;class vv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function bv(n,e,i,o){let u=0,a=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(i[h]<n[h]||i[h]>e[h])return null}else{const _=1/o[h];let b=(n[h]-i[h])*_,E=(e[h]-i[h])*_;if(b>E){const p=b;b=E,E=p}if(b>u&&(u=b),E<a&&(a=E),u>a)return null}return u}function wv(n,e,i,o,u,a,h,_,b,E,p){const x=o-n,T=u-e,v=a-i,w=h-n,A=_-e,C=b-i,D=p[1]*C-p[2]*A,F=p[2]*w-p[0]*C,V=p[0]*A-p[1]*w,z=x*D+T*F+v*V;if(Math.abs(z)<1e-15)return null;const j=1/z,G=E[0]-n,Y=E[1]-e,te=E[2]-i,re=(G*D+Y*F+te*V)*j;if(re<0||re>1)return null;const Q=Y*v-te*T,ue=te*x-G*v,se=G*T-Y*x,de=(p[0]*Q+p[1]*ue+p[2]*se)*j;return de<0||re+de>1?null:(w*Q+A*ue+C*se)*j}function Tv(n,e,i){return(n-e)/(i-e)}function Ev(n,e,i,o,u,a,h,_,b){const E=1<<i,p=a-o,x=h-u,T=(n+1)/E*p+o,v=(e+0)/E*x+u,w=(e+1)/E*x+u;_[0]=(n+0)/E*p+o,_[1]=v,b[0]=T,b[1]=w}class Sv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(a){const h=Math.ceil(Math.log2(a.dim/8)),_=[];let b=Math.ceil(Math.pow(2,h));const E=1/b,p=(v,w,A,C,D)=>{const F=C?1:0,V=(v+1)*A-F,z=w*A,j=(w+1)*A-F;D[0]=v*A,D[1]=z,D[2]=V,D[3]=j};let x=new vv(b);const T=[];for(let v=0;v<b*b;v++){p(v%b,Math.floor(v/b),E,!1,T);const w=Ka(T[0],T[1],a),A=Ka(T[2],T[1],a),C=Ka(T[2],T[3],a),D=Ka(T[0],T[3],a);x.minimums.push(Math.min(w,A,C,D)),x.maximums.push(Math.max(w,A,C,D)),x.leaves.push(1)}for(_.push(x),b/=2;b>=1;b/=2){const v=_[_.length-1];x=new vv(b);for(let w=0;w<b*b;w++){p(w%b,Math.floor(w/b),2,!0,T);const A=v.getElevation(T[0],T[1]),C=v.getElevation(T[2],T[1]),D=v.getElevation(T[2],T[3]),F=v.getElevation(T[0],T[3]),V=v.isLeaf(T[0],T[1]),z=v.isLeaf(T[2],T[1]),j=v.isLeaf(T[2],T[3]),G=v.isLeaf(T[0],T[3]),Y=Math.min(A.min,C.min,D.min,F.min),te=Math.max(A.max,C.max,D.max,F.max),re=V&&z&&j&&G;x.maximums.push(te),x.minimums.push(Y),x.leaves.push(te-Y<=5&&re?1:0)}_.push(x)}return _}(this.dem),o=i.length-1,u=i[o];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,u,a,h,_=1){return bv([e,i,-100],[o,u,this.maximums[0]*_],a,h)}raycast(e,i,o,u,a,h,_=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,o,u,a,h,_);if(b==null)return null;const E=[],p=[],x=[],T=[],v=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;v.length>0;){const{idx:w,t:A,nodex:C,nodey:D,depth:F}=v.pop();if(this.leaves[w]){Ev(C,D,F,e,i,o,u,x,T);const z=1<<F,j=(C+0)/z,G=(C+1)/z,Y=(D+0)/z,te=(D+1)/z,re=Ka(j,Y,this.dem)*_,Q=Ka(G,Y,this.dem)*_,ue=Ka(G,te,this.dem)*_,se=Ka(j,te,this.dem)*_,de=wv(x[0],x[1],re,T[0],x[1],Q,T[0],T[1],ue,a,h),we=wv(T[0],T[1],ue,x[0],T[1],se,x[0],x[1],re,a,h),Ee=Math.min(de!==null?de:Number.MAX_VALUE,we!==null?we:Number.MAX_VALUE);if(Ee!==Number.MAX_VALUE)return Ee;{const Me=ge.vec3.scaleAndAdd([],a,h,A);if(Mv(re,Q,se,ue,Tv(Me[0],x[0],T[0]),Tv(Me[1],x[1],T[1]))>=Me[2])return A}continue}let V=0;for(let z=0;z<this._siblingOffset.length;z++){Ev((C<<1)+this._siblingOffset[z][0],(D<<1)+this._siblingOffset[z][1],F+1,e,i,o,u,x,T),x[2]=-100,T[2]=this.maximums[this.childOffsets[w]+z]*_;const j=bv(x,T,a,h);if(j!=null){const G=j;E[z]=G;let Y=!1;for(let te=0;te<V&&!Y;te++)G>=E[p[te]]&&(p.splice(te,0,z),Y=!0);Y||(p[V]=z),V++}}for(let z=0;z<V;z++){const j=p[z];v.push({idx:this.childOffsets[w]+j,t:E[j],nodex:(C<<1)+this._siblingOffset[j][0],nodey:(D<<1)+this._siblingOffset[j][1],depth:F+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,u,a){if(e[u].isLeaf(i,o)===1)return;this.childOffsets[a]||(this.childOffsets[a]=this.nodeCount);const h=u-1,_=e[h];let b=0,E=0;for(let p=0;p<this._siblingOffset.length;p++){const x=2*i+this._siblingOffset[p][0],T=2*o+this._siblingOffset[p][1],v=_.getElevation(x,T),w=_.isLeaf(x,T),A=this._addNode(v.min,v.max,w);w&&(b|=1<<p),E||(E=A)}for(let p=0;p<this._siblingOffset.length;p++)b&1<<p||this._construct(e,2*i+this._siblingOffset[p][0],2*o+this._siblingOffset[p][1],h,E+p)}}function Mv(n,e,i,o,u,a){return Yt(Yt(n,i,a),Yt(e,o,a),u)}function Ka(n,e,i){const o=i.dim,u=gt(n*o-.5,0,o-1),a=gt(e*o-.5,0,o-1),h=Math.floor(u),_=Math.floor(a),b=Math.min(h+1,o-1),E=Math.min(_+1,o-1);return Mv(i.get(h,_),i.get(b,_),i.get(h,E),i.get(b,E),u-h,a-_)}const wS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function TS(n,e,i){return(256*n*256+256*e+i)/10-1e4}function ES(n,e,i){return 256*n+e+i/256-32768}class Gp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void zi(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const a=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<a;b++)h[this._idx(-1,b)]=h[this._idx(0,b)],h[this._idx(a,b)]=h[this._idx(a-1,b)],h[this._idx(b,-1)]=h[this._idx(b,0)],h[this._idx(b,a)]=h[this._idx(b,a-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(a,-1)]=h[this._idx(a-1,0)],h[this._idx(-1,a)]=h[this._idx(0,a-1)],h[this._idx(a,a)]=h[this._idx(a-1,a-1)]}const _=o==="terrarium"?ES:TS;for(let b=0;b<h.length;++b){const E=4*b;this.floatView[b]=_(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=bt.now()}_buildQuadTree(){this._tree=new Sv(this)}get(e,i,o=!1){o&&(e=gt(e,-1,this.dim),i=gt(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,o){const u=this._idx(e,i),a=this.floatView[u];return this.floatView[u]=o,o-a}static getUnpackVector(e){return wS[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],u=Gp.getUnpackVector(i);let a=Math.floor((e+u[3])/u[2]);return o[2]=a%256,a=Math.floor(a/256),o[1]=a%256,a=Math.floor(a/256),o[0]=a,o}getPixels(){return new s0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,a=i*this.dim+this.dim,h=o*this.dim,_=o*this.dim+this.dim;switch(i){case-1:u=a-1;break;case 1:a=u+1}switch(o){case-1:h=_-1;break;case 1:_=h+1}const b=-i*this.dim,E=-o*this.dim;for(let p=h;p<_;p++)for(let x=u;x<a;x++){const T=4*this._idx(x,p),v=4*this._idx(x+b,p+E);this.pixels[T+0]=e.pixels[v+0],this.pixels[T+1]=e.pixels[v+1],this.pixels[T+2]=e.pixels[v+2],this.pixels[T+3]=e.pixels[v+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function SS(n,e,i){n===1?e.header_length=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(o,u){return o.readFields(PS,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},u)}(i,i.readVarint()+i.pos))}function MS(n,e,i){n===1?(e.delta_filter=function(o,u){return o.readFields(AS,{block_size:0},u)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function AS(n,e,i){n===1&&(e.block_size=i.readVarint())}function IS(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function CS(n,e,i){n===1?e.first_byte=i.readFixed64():n===2?e.last_byte=i.readFixed64():n===3?e.filters.push(function(o,u){return o.readFields(MS,{},u)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(o,u){return o.readFields(IS,{},u)}(i,i.readVarint()+i.pos):n===5?e.deprecated_offset=i.readFloat():n===6?e.deprecated_scale=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble())}function PS(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tilesize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixel_format=i.readVarint():n===7&&e.data_index.push(function(o,u){return o.readFields(CS,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},u)}(i,i.readVarint()+i.pos))}function RS(n,e,i){if(n===2)(function(o,u,a){o.readFields(LS,a,u)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function LS(n,e,i){if(n===1){let o=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[o++]=i.readVarint()}}At(Gp,"DEMData"),At(Sv,"DemMinMaxQuadTree",{omit:["dem"]});class DS{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}}function zS(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const u=o===1?1:0,a=o===2?1:0;for(let h=0;h<e[0];h++){const _=e[1]*h;for(let b=u;b<e[1];b++){const E=e[2]*(b+_);for(let p=a;p<e[2];p++){const x=e[3]*(p+E);for(let T=0;T<e[3];T++){const v=x+T;n[v]+=n[v-i]}}}}i*=e[o]}return n}function kS(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function OS(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const o=n[i],u=n[i+1];n[i]=(240&o)>>4|(61440&o)>>8|(240&u)<<4|61440&u,n[i+1]=15&o|(3840&o)>>4|(15&u)<<8|(3840&u)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const o=n[i],u=n[i+1],a=n[i+2],h=n[i+3];n[i+0]=(192&o)>>6|(192&u)>>4|(192&a)>>2|192&h,n[i+1]=(48&o)>>4|(48&u)>>2|48&a|(48&h)<<2,n[i+2]=(12&o)>>2|12&u|(12&a)<<2|(12&h)<<4,n[i+3]=3&o|(3&u)<<2|(3&a)<<4|(3&h)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}var ws=Uint8Array,Sd=Uint16Array,BS=Int32Array,Av=new ws([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Iv=new ws([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),FS=new ws([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cv=function(n,e){for(var i=new Sd(31),o=0;o<31;++o)i[o]=e+=1<<n[o-1];var u=new BS(i[30]);for(o=1;o<30;++o)for(var a=i[o];a<i[o+1];++a)u[a]=a-i[o]<<5|o;return{b:i,r:u}},Pv=Cv(Av,2),Rv=Pv.b,NS=Pv.r;Rv[28]=258,NS[258]=28;for(var VS=Cv(Iv,0).b,Lv=new Sd(32768),Fr=0;Fr<32768;++Fr){var Iu=(43690&Fr)>>1|(21845&Fr)<<1;Lv[Fr]=((65280&(Iu=(61680&(Iu=(52428&Iu)>>2|(13107&Iu)<<2))>>4|(3855&Iu)<<4))>>8|(255&Iu)<<8)>>1}var Md=function(n,e,i){for(var o=n.length,u=0,a=new Sd(e);u<o;++u)n[u]&&++a[n[u]-1];var h,_=new Sd(e);for(u=1;u<e;++u)_[u]=_[u-1]+a[u-1]<<1;h=new Sd(1<<e);var b=15-e;for(u=0;u<o;++u)if(n[u])for(var E=u<<4|n[u],p=e-n[u],x=_[n[u]-1]++<<p,T=x|(1<<p)-1;x<=T;++x)h[Lv[x]>>b]=E;return h},Ad=new ws(288);for(Fr=0;Fr<144;++Fr)Ad[Fr]=8;for(Fr=144;Fr<256;++Fr)Ad[Fr]=9;for(Fr=256;Fr<280;++Fr)Ad[Fr]=7;for(Fr=280;Fr<288;++Fr)Ad[Fr]=8;var Dv=new ws(32);for(Fr=0;Fr<32;++Fr)Dv[Fr]=5;var US=Md(Ad,9),jS=Md(Dv,5),ng=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},to=function(n,e,i){var o=e/8|0;return(n[o]|n[o+1]<<8)>>(7&e)&i},sg=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},GS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],io=function(n,e,i){var o=new Error(e||GS[n]);if(o.code=n,Error.captureStackTrace&&Error.captureStackTrace(o,io),!i)throw o;return o},qS=new ws(0),$S=typeof TextDecoder<"u"&&new TextDecoder;try{$S.decode(qS,{stream:!0})}catch{}const ZS={gzip_data:"gzip"};class Vs extends Error{constructor(e){super(e),this.name="MRTError"}}const HS={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},zv={uint32:1,uint16:2,uint8:4},WS={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let og;class ag{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Vs(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Vs("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Vs(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const u=function(a,h){return a.readFields(SS,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new og(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Vs(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const a of u.layers)this.layers[a.name]=new XS(a,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let u of e.blockIndices){const a=o.dataIndex[u],h=a.first_byte-e.firstByte,_=a.last_byte-e.firstByte;if(o._blocksInProgress.has(u))continue;const b={layerName:o.name,firstByte:h,lastByte:_,pixelFormat:o.pixelFormat,blockIndex:u,blockShape:[a.bands.length].concat(o.bandShape),buffer:o.buffer,codec:a.codec.codec,filters:a.filters.map(E=>E.filter)};o._blocksInProgress.add(u),i.push(b)}return new kv(i,()=>{i.forEach(u=>o._blocksInProgress.delete(u.blockIndex))},(u,a)=>{if(i.forEach(h=>o._blocksInProgress.delete(h.blockIndex)),u)throw u;a.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class XS{constructor({version:e,name:i,units:o,tilesize:u,pixel_format:a,buffer:h,data_index:_},b){if(this.version=e,this.version!==1)throw new Vs(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=u,this.buffer=h,this.pixelFormat=HS[a],this.dataIndex=_,this.bandShape=[u+2*h,u+2*h,zv[this.pixelFormat]],this._decodedBlocks=new DS(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return zv[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,u]of this.dataIndex.entries()){for(const[a,h]of u.bands.entries())if(h===e)return{bandIndex:i+a,blockIndex:o,blockBandIndex:a};i+=u.bands.length}break;case"number":for(const[o,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new Vs(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Vs(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0;const u=[],a=new Set;for(const h of e){const{blockIndex:_}=this.getBlockForBand(h);if(_<0)throw new Vs(`Invalid band: ${JSON.stringify(h)}`);const b=this.dataIndex[_];u.includes(_)||u.push(_),a.add(_),i=Math.min(i,b.first_byte),o=Math.max(o,b.last_byte)}if(a.size>this.cacheSize)throw new Vs(`Number of blocks to decode (${a.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),u=this._decodedBlocks.get(i.toString());if(!u)throw new Vs(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const a=this.dataIndex[i],h=this.bandShape.reduce((E,p)=>E*p,1),_=o*h,b=u.subarray(_,_+h);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:a.offset!==0?a.offset:a.deprecated_offset,scale:a.scale!==0?a.scale:a.deprecated_scale}}}ag.setPbf=function(n){og=n};class kv{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}ag.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(o=>{const{layerName:u,firstByte:a,lastByte:h,pixelFormat:_,blockShape:b,blockIndex:E,filters:p,codec:x}=o,T=i.subarray(a,h+1),v=new Uint32Array(b[0]*b[1]*b[2]);let w;if(x!=="gzip_data")throw new Vs(`Unhandled codec: ${x}`);return w=function(A,C){if(!globalThis.DecompressionStream&&C==="gzip_data")return Promise.resolve(((z=function(Y){Y[0]==31&&Y[1]==139&&Y[2]==8||io(6,"invalid gzip data");var te=Y[3],re=10;4&te&&(re+=2+(Y[10]|Y[11]<<8));for(var Q=(te>>3&1)+(te>>4&1);Q>0;Q-=!Y[re++]);return re+(2&te)}(V=A))+8>V.length&&io(6,"invalid gzip data"),function(Y,te,re,Q){var ue=Y.length;if(!ue||te.f&&!te.l)return re||new ws(0);var se=!re,de=se||te.i!=2,we=te.i;se&&(re=new ws(3*ue));var Ee,Me,Ie=function(Ja){var ic=re.length;if(Ja>ic){var zd=new ws(Math.max(2*ic,Ja));zd.set(re),re=zd}},Be=te.f||0,Pe=te.p||0,Ze=te.b||0,Je=te.l,Ue=te.d,xt=te.m,pt=te.n,ot=8*ue;do{if(!Je){Be=to(Y,Pe,1);var tt=to(Y,Pe+1,3);if(Pe+=3,!tt){var Nt=Y[(ri=4+((Pe+7)/8|0))-4]|Y[ri-3]<<8,yt=ri+Nt;if(yt>ue){we&&io(0);break}de&&Ie(Ze+Nt),re.set(Y.subarray(ri,yt),Ze),te.b=Ze+=Nt,te.p=Pe=8*yt,te.f=Be;continue}if(tt==1)Je=US,Ue=jS,xt=9,pt=5;else if(tt==2){var Mt=to(Y,Pe,31)+257,ti=to(Y,Pe+10,15)+4,mi=Mt+to(Y,Pe+5,31)+1;Pe+=14;for(var ci=new ws(mi),ui=new ws(19),gi=0;gi<ti;++gi)ui[FS[gi]]=to(Y,Pe+3*gi,7);Pe+=3*ti;var xi=ng(ui),tr=(1<<xi)-1,Zi=Md(ui,xi);for(gi=0;gi<mi;){var ri,Ni=Zi[to(Y,Pe,tr)];if(Pe+=15&Ni,(ri=Ni>>4)<16)ci[gi++]=ri;else{var Ui=0,ur=0;for(ri==16?(ur=3+to(Y,Pe,3),Pe+=2,Ui=ci[gi-1]):ri==17?(ur=3+to(Y,Pe,7),Pe+=3):ri==18&&(ur=11+to(Y,Pe,127),Pe+=7);ur--;)ci[gi++]=Ui}}var Ar=ci.subarray(0,Mt),Nr=ci.subarray(Mt);xt=ng(Ar),pt=ng(Nr),Je=Md(Ar,xt),Ue=Md(Nr,pt)}else io(1);if(Pe>ot){we&&io(0);break}}de&&Ie(Ze+131072);for(var Ir=(1<<xt)-1,vr=(1<<pt)-1,rn=Pe;;rn=Pe){var jr=(Ui=Je[sg(Y,Pe)&Ir])>>4;if((Pe+=15&Ui)>ot){we&&io(0);break}if(Ui||io(2),jr<256)re[Ze++]=jr;else{if(jr==256){rn=Pe,Je=null;break}var dn=jr-254;jr>264&&(dn=to(Y,Pe,(1<<(no=Av[gi=jr-257]))-1)+Rv[gi],Pe+=no);var ar=Ue[sg(Y,Pe)&vr],Jn=ar>>4;if(ar||io(3),Pe+=15&ar,Nr=VS[Jn],Jn>3){var no=Iv[Jn];Nr+=sg(Y,Pe)&(1<<no)-1,Pe+=no}if(Pe>ot){we&&io(0);break}de&&Ie(Ze+131072);var Us=Ze+dn;if(Ze<Nr){var js=0-Nr,tc=Math.min(Nr,Us);for(js+Ze<0&&io(3);Ze<tc;++Ze)re[Ze]=(void 0)[js+Ze]}for(;Ze<Us;++Ze)re[Ze]=re[Ze-Nr]}}te.l=Je,te.p=rn,te.b=Ze,te.f=Be,Je&&(Be=1,te.m=xt,te.d=Ue,te.n=pt)}while(!Be);return Ze!=re.length&&se?(Ee=re,((Me=Ze)==null||Me>Ee.length)&&(Me=Ee.length),new ws(Ee.subarray(0,Me))):re.subarray(0,Ze)}(V.subarray(z,-8),{i:2},new ws(((D=V)[(F=D.length)-4]|D[F-3]<<8|D[F-2]<<16|D[F-1]<<24)>>>0))));var D,F,V,z;const j=ZS[C];if(!j)throw new Error(`Unhandled codec: ${C}`);const G=new globalThis.DecompressionStream(j);return new Response(new Blob([A]).stream().pipeThrough(G)).arrayBuffer().then(Y=>new Uint8Array(Y))}(T,x).then(A=>(function(C,D){C.readFields(RS,D)}(new og(A),v),new WS[_](v.buffer))),w.then(A=>{for(let C=p.length-1;C>=0;C--)switch(p[C]){case"delta_filter":zS(A,b);break;case"zigzag_filter":kS(A);break;case"bitshuffle_filter":OS(A,_);break;default:throw new Vs(`Unhandled filter "${p[C]}"`)}return{layerName:u,blockIndex:E,data:A}}).catch(A=>{throw A})}))},At(kv,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var Id={workerUrl:"",workerClass:null,workerParams:void 0};const lg="mapboxgl_preloaded_worker_pool";class Cd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Cd.workerCount;)this.workers.push(Id.workerClass!=null?new Id.workerClass:new self.Worker(Id.workerUrl,Id.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lg]}numActive(){return Object.keys(this.active).length}}let Pd;function qp(){return Pd||(Pd=new Cd),Pd}Cd.workerCount=2;let Rd,cg,ro,Cu,ug,Pu=null;function Ov(){return Oo()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:cg||ve.DRACO_URL}function Bv(){if(Oo()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Cu)return Cu;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Cu=WebAssembly.validate(n)?ve.MESHOPT_SIMD_URL:ve.MESHOPT_URL,Cu}const $p={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},YS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ld={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Fv(n,e,i){const o=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:u,byteLength:n.byteLength},i.buffers[u]=n}const hg="KHR_draco_mesh_compression";function KS(n,e){const i=n.extensions&&n.extensions[hg];if(!i)return;const o=new ro.Decoder,u=jv(e,i.bufferView),a=new ro.Mesh;if(!o.DecodeArrayToMesh(u,u.byteLength,a))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[n.indices],_=$p[h.componentType],b=h.count*_.BYTES_PER_ELEMENT,E=ro._malloc(b);_===Uint16Array?o.GetTrianglesUInt16Array(a,b,E):o.GetTrianglesUInt32Array(a,b,E),Fv(ro.memory.buffer.slice(E,E+b),h,e),ro._free(E);for(const p of Object.keys(i.attributes)){const x=o.GetAttributeByUniqueId(a,i.attributes[p]),T=e.json.accessors[n.attributes[p]],v=YS[T.componentType],w=T.count*Ld[T.type]*$p[T.componentType].BYTES_PER_ELEMENT,A=ro._malloc(w);o.GetAttributeDataArrayForAllPoints(a,x,ro[v],w,A),Fv(ro.memory.buffer.slice(A,A+w),T,e),ro._free(A)}o.destroy(),a.destroy(),delete n.extensions[hg]}const Zp="EXT_meshopt_compression";function JS(n,e){if(!n.extensions||!n.extensions[Zp])return;const i=n.extensions[Zp],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);ug.decodeGltfBuffer(u,i.count,i.byteStride,o,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=u.buffer,delete n.extensions[Zp]}const Nv=1179937895,Vv=new TextDecoder("utf8");function Uv(n,e){return new URL(n,e).href}function QS(n,e,i,o){return fetch(Uv(n.uri,o)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[i]=u})}function jv(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function eM(n,e,i,o){if(n.uri){const u=Uv(n.uri,o);return fetch(u).then(a=>a.blob()).then(a=>createImageBitmap(a)).then(a=>{e.images[i]=a})}if(n.bufferView!==void 0){const u=jv(e,n.bufferView),a=new Blob([u],{type:n.mimeType});return createImageBitmap(a).then(h=>{e.images[i]=h})}}function Gv(n,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===Nv){const p=new Uint32Array(n,e);let x=2;const T=(p[x++]>>2)-3,v=p[x++]>>2;if(x++,o.json=JSON.parse(Vv.decode(p.subarray(x,x+v))),x+=v,x<T){const w=p[x++];x++;const A=e+(x<<2);o.buffers[0]=n.slice(A,A+w)}}else o.json=JSON.parse(Vv.decode(new Uint8Array(n,e)));const{buffers:u,images:a,meshes:h,extensionsUsed:_,bufferViews:b}=o.json;let E=Promise.resolve();if(u){const p=[];for(let x=0;x<u.length;x++){const T=u[x];T.uri?p.push(QS(T,o,x,i)):o.buffers[x]||(o.buffers[x]=null)}E=Promise.all(p)}return E.then(()=>{const p=[],x=_&&_.includes(hg),T=_&&_.includes(Zp);if(x&&p.push(function(){if(!ro)return Rd??(Rd=function(v){let w,A=null;function C(){w=new Uint8Array(A.buffer)}function D(){throw new Error("Unexpected Draco error.")}const F={a:{a:D,d:function(V,z,j){return w.copyWithin(V,z,z+j)},c:function(V){const z=w.length,j=Math.max(V>>>0,Math.ceil(1.2*z)),G=Math.ceil((j-z)/65536);try{return A.grow(G),C(),!0}catch{return!1}},b:D}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(v,F):v.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,F))).then(V=>{const{Rb:z,Qb:j,P:G,T:Y,X:te,Ja:re,La:Q,Qa:ue,Va:se,Wa:de,eb:we,jb:Ee,f:Me,e:Ie,yb:Be,zb:Pe,Ab:Ze,Bb:Je,Db:Ue,Gb:xt}=V.instance.exports;A=Ie;const pt=(()=>{let ot=0,tt=0,Nt=0,yt=0;return Mt=>{Nt&&(z(yt),z(ot),tt+=Nt,Nt=ot=0),ot||(tt+=128,ot=j(tt));const ti=Mt.length+7&-8;let mi=ot;ti>=tt&&(Nt=ti,mi=yt=j(ti));for(let ci=0;ci<Mt.length;ci++)w[mi+ci]=Mt[ci];return mi}})();return C(),Me(),{memory:Ie,_free:z,_malloc:j,Mesh:class{constructor(){this.ptr=G()}destroy(){Y(this.ptr)}},Decoder:class{constructor(){this.ptr=re()}destroy(){Ee(this.ptr)}DecodeArrayToMesh(ot,tt,Nt){const yt=pt(ot),Mt=Q(this.ptr,yt,tt,Nt.ptr);return!!te(Mt)}GetAttributeByUniqueId(ot,tt){return{ptr:ue(this.ptr,ot.ptr,tt)}}GetTrianglesUInt16Array(ot,tt,Nt){se(this.ptr,ot.ptr,tt,Nt)}GetTrianglesUInt32Array(ot,tt,Nt){de(this.ptr,ot.ptr,tt,Nt)}GetAttributeDataArrayForAllPoints(ot,tt,Nt,yt,Mt){we(this.ptr,ot.ptr,tt.ptr,Nt,yt,Mt)}},DT_INT8:Be(),DT_UINT8:Pe(),DT_INT16:Ze(),DT_UINT16:Je(),DT_UINT32:Ue(),DT_FLOAT32:xt()}})}(fetch(Ov())),Rd.then(v=>{ro=v,Rd=void 0}))}()),T&&p.push(function(){if(ug)return;const v=function(w){let A;const C=WebAssembly.instantiateStreaming(w,{}).then(V=>{A=V.instance,A.exports.__wasm_call_ctors()}),D={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},F={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:C,supported:!0,decodeGltfBuffer(V,z,j,G,Y,te){(function(re,Q,ue,se,de,we,Ee){const Me=re.exports.sbrk,Ie=se+3&-4,Be=Me(Ie*de),Pe=Me(we.length),Ze=new Uint8Array(re.exports.memory.buffer);Ze.set(we,Pe);const Je=Q(Be,se,de,Pe,we.length);if(Je===0&&Ee&&Ee(Be,Ie,de),ue.set(Ze.subarray(Be,Be+se*de)),Me(Be-Me(0)),Je!==0)throw new Error(`Malformed buffer data: ${Je}`)})(A,A.exports[F[Y]],V,z,j,G,A.exports[D[te]])}}}(fetch(Bv()));return v.ready.then(()=>{ug=v})}()),a)for(let v=0;v<a.length;v++)p.push(eM(a[v],o,v,i));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(x&&h)for(const{primitives:v}of h)for(const w of v)KS(w,o);if(T&&h&&b)for(const v of b)JS(v,o);return o})})}function ec(n,e){const i=n.json.bufferViews[e.bufferView],o=$p[e.componentType];return new o(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Ld[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Ld[e.type]))}function dg(n,e,i,o){const u=$p[e.componentType],a=function(p){switch(p){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),h=n.json.bufferViews[e.bufferView],_=h.byteStride?h.byteStride/u.BYTES_PER_ELEMENT:Ld[e.type],b=i.float32,E=b.length/i.capacity;for(let p=0,x=0;p<e.count*_;p+=_,x+=E)for(let T=0;T<E;T++)b[x+T]=o[p+T]*a;i._trim()}function tM(n,e,i){const o=n.indices,u=n.attributes,a={};a.indexArray=new ln;const h=e.json.accessors[o],_=h.count/3;a.indexArray.reserve(_);const b=ec(e,h);for(let T=0;T<_;T++)a.indexArray.emplaceBack(b[3*T],b[3*T+1],b[3*T+2]);a.indexArray._trim(),a.vertexArray=new bo;const E=e.json.accessors[u.POSITION];a.vertexArray.reserve(E.count);const p=ec(e,E);for(let T=0;T<E.count;T++)a.vertexArray.emplaceBack(p[3*T],p[3*T+1],p[3*T+2]);if(a.vertexArray._trim(),a.aabb=new or(E.min,E.max),a.centroid=function(T,v){const w=[0,0,0],A=T.length;if(A>0){for(let C=0;C<A;C++){const D=3*T[C];w[0]+=v[D],w[1]+=v[D+1],w[2]+=v[D+2]}w[0]/=A,w[1]/=A,w[2]/=A}return w}(b,p),u.COLOR_0!==void 0){const T=e.json.accessors[u.COLOR_0],v=Ld[T.type],w=ec(e,T);a.colorArray=v===3?new bo:new Ws,a.colorArray.resize(T.count),dg(e,T,a.colorArray,w)}if(u.NORMAL!==void 0){a.normalArray=new bo;const T=e.json.accessors[u.NORMAL];a.normalArray.resize(T.count);const v=ec(e,T);dg(e,T,a.normalArray,v)}if(u.TEXCOORD_0!==void 0&&i.length>0){a.texcoordArray=new ql;const T=e.json.accessors[u.TEXCOORD_0];a.texcoordArray.resize(T.count);const v=ec(e,T);dg(e,T,a.texcoordArray,v)}if(u._FEATURE_ID_RGBA4444!==void 0){const T=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(a.featureData=ec(e,T))}u._FEATURE_RGBA4444!==void 0&&(a.featureData=new Uint32Array(ec(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const x=n.material;return a.material=function(T,v){const{emissiveFactor:w=[0,0,0],alphaMode:A="OPAQUE",alphaCutoff:C=.5,normalTexture:D,occlusionTexture:F,emissiveTexture:V,doubleSided:z}=T,{baseColorFactor:j=[1,1,1,1],metallicFactor:G=1,roughnessFactor:Y=1,baseColorTexture:te,metallicRoughnessTexture:re}=T.pbrMetallicRoughness||{},Q=F?v[F.index]:void 0;if(F&&F.extensions&&F.extensions.KHR_texture_transform&&Q){const ue=F.extensions.KHR_texture_transform;Q.offsetScale=[ue.offset[0],ue.offset[1],ue.scale[0],ue.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new qi(...j),metallicFactor:G,roughnessFactor:Y,baseColorTexture:te?v[te.index]:void 0,metallicRoughnessTexture:re?v[re.index]:void 0},doubleSided:z,emissiveFactor:w,alphaMode:A,alphaCutoff:C,normalTexture:D?v[D.index]:void 0,occlusionTexture:Q,emissionTexture:V?v[V.index]:void 0,defined:T.defined===void 0}}(x!==void 0?e.json.materials[x]:{defined:!1},i),a}function qv(n,e,i){const{matrix:o,rotation:u,translation:a,scale:h,mesh:_,extras:b,children:E}=n,p={};if(p.matrix=o||ge.mat4.fromRotationTranslationScale([],u||[0,0,0,1],a||[0,0,0],h||[1,1,1]),_!==void 0){p.meshes=i[_];const x=p.anchor=[0,0];for(const T of p.meshes){const{min:v,max:w}=T.aabb;x[0]+=v[0]+w[0],x[1]+=v[1]+w[1]}x[0]=Math.floor(x[0]/p.meshes.length/2),x[1]=Math.floor(x[1]/p.meshes.length/2)}if(b&&(b.id&&(p.id=b.id),b.lights&&(p.lights=function(x){if(!x.length)return[];const T=function(D){const F=atob(D),V=new Uint8Array(F.length);for(let z=0;z<F.length;z++)V[z]=F.codePointAt(z);return V}(x),v=[],w=T.length/24,A=new Uint16Array(T.buffer),C=new Float32Array(T.buffer);for(let D=0;D<w;D++){const F=A[2*D*6]/30,V=A[2*D*6+1]/30,z=A[2*D*6+10]/100,j=C[6*D+1],G=C[6*D+2],Y=C[6*D+3],te=C[6*D+4],re=Y-j,Q=te-G,ue=Math.hypot(re,Q);v.push({pos:[j+.5*re,G+.5*Q,V],normal:[Q/ue,-re/ue,0],width:ue,height:F,depth:z,points:[j,G,Y,te]})}return v}(b.lights))),E){const x=[];for(const T of E)x.push(qv(e.json.nodes[T],e,i));p.children=x}return p}function iM(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new b_(n.vertices,n.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:o}}function rM(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const h of i){if(!Array.isArray(h)||h.length!==2)continue;const _=h[0],b=h[1];typeof _=="number"&&typeof b=="number"&&o.push(new Se(_,b))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let u=0;for(let h=0;h<o.length;h++){const _=o[h],b=o[(h+1)%o.length],E=o[(h+2)%o.length];u+=(_.x-b.x)*(E.y-b.y)-(E.x-b.x)*(_.y-b.y)}u>0&&o.reverse();const a=nd(o.flatMap(h=>[h.x,h.y]),[]);return a.length===0?null:{vertices:o,indices:a}}function nM(n,e){const i=[],o=[];let u=0;const a=[];for(const h of n){u=i.length;const _=h.vertexArray.float32,b=h.indexArray.uint16;for(let E=0;E<h.vertexArray.length;E++)a[0]=_[3*E+0],a[1]=_[3*E+1],a[2]=_[3*E+2],ge.vec3.transformMat4(a,a,e),i.push(new Se(a[0],a[1]));for(let E=0;E<3*h.indexArray.length;E++)o.push(b[E]+u)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){const _=i[o[h+0]],b=i[o[h+1]],E=i[o[h+2]];(_.x-b.x)*(E.y-b.y)-(E.x-b.x)*(_.y-b.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:i,indices:o}}function $v(n){const e=function(b,E){const p=[],x=WebGL2RenderingContext;if(b.json.textures)for(const T of b.json.textures){const v={magFilter:x.LINEAR,minFilter:x.NEAREST,wrapS:x.REPEAT,wrapT:x.REPEAT};T.sampler!==void 0&&Object.assign(v,b.json.samplers[T.sampler]),p.push({image:E[T.source],sampler:v,uploaded:!1})}return p}(n,n.images),i=function(b,E){const p=[];for(const x of b.json.meshes){const T=[];for(const v of x.primitives)T.push(tM(v,b,E));p.push(T)}return p}(n,e),{scenes:o,scene:u,nodes:a}=n.json,h=o?o[u||0].nodes:a,_=[];for(const b of h)_.push(qv(a[b],n,i));return function(b,E,p){const x={},T=new Set;for(let v=0;v<b.length;v++){const w=p[E[v]];if(!w.extras)continue;const A=w.extras["mapbox:footprint:version"],C=w.extras["mapbox:footprint:id"];(A||C)&&T.add(v),A==="1.0.0"&&C&&(x[C]=v)}for(let v=0;v<b.length;v++){if(T.has(v))continue;const w=b[v],A=p[E[v]];if(!A.extras)continue;let C=null;w.id in x&&(C=nM(b[x[w.id]].meshes,w.matrix)),C||(C=rM(A)),C&&(w.footprint=iM(C))}if(T.size>0){const v=Array.from(T.values()).sort((w,A)=>w-A);for(let w=v.length-1;w>=0;w--)b.splice(v[w],1)}}(_,h,n.json.nodes),_}function sM(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,o=n.aabb.min[1]-1,u=Jl/(n.aabb.max[0]-i+2),a=Jl/(n.aabb.max[1]-o+2);for(let h=0;h<e.length;h+=3){const _=e[h+2],b=(e[h+0]-i)*u|0,E=(e[h+1]-o)*a|0;_>n.heightmap[E*Jl+b]&&(n.heightmap[E*Jl+b]=_)}}function oM(n,e){const i={};i.indexArray=new ln,i.indexArray.reserve(4*n.length),i.vertexArray=new bo,i.vertexArray.reserve(10*n.length),i.colorArray=new Ws,i.vertexArray.reserve(10*n.length);let o=0;for(const h of n){const _=Math.min(10,Math.max(4,1.3*h.height))*e,b=[-h.normal[1],h.normal[0],0],E=Math.min(.29,.1*h.width/h.depth),p=h.width-2*h.depth*e*(E+.01),x=ge.vec3.scaleAndAdd([],h.pos,b,p/2),T=ge.vec3.scaleAndAdd([],h.pos,b,-p/2),v=[x[0],x[1],x[2]+h.height],w=[T[0],T[1],T[2]+h.height],A=ge.vec3.scaleAndAdd([],h.normal,b,E);ge.vec3.scale(A,A,_);const C=ge.vec3.scaleAndAdd([],h.normal,b,-E);ge.vec3.scale(C,C,_),ge.vec3.add(A,x,A),ge.vec3.add(C,T,C),x[2]+=.1,T[2]+=.1,i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(v[0],v[1],v[2]),i.vertexArray.emplaceBack(w[0],w[1],w[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]);const D=p/_/2;i.colorArray.emplaceBack(-D-E,-1,D,.8),i.colorArray.emplaceBack(D+E,-1,D,.8),i.colorArray.emplaceBack(-D,0,D,1.3),i.colorArray.emplaceBack(D,0,D,1.3),i.colorArray.emplaceBack(D+E,-.8,D,.7),i.colorArray.emplaceBack(D+E,-.8,D,.7),i.colorArray.emplaceBack(0,0,D,1.3),i.colorArray.emplaceBack(0,0,D,1.3),i.colorArray.emplaceBack(D+E,-1.2,D,.8),i.colorArray.emplaceBack(D+E,-1.2,D,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const u={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=qi.white,u.pbrMetallicRoughness=a,i.material=u,i.aabb=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class Zv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const aM=["id","tile","layer","source","sourceLayer","state"];class Hv{constructor(e,i,o,u,a){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=u,this.properties=e.properties,this.id=a}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of aM)this[i]!==void 0&&(e[i]=this[i]);return e}}class Wv{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qo(mt,16,0),this.featureIndexArray=new Qf,this.promoteId=i,this.is3DTile=!1}insert(e,i,o,u,a,h=0,_=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,a,h);const E=this.grid;for(let p=0;p<i.length;p++){const x=i[p],T=[1/0,1/0,-1/0,-1/0];for(let v=0;v<x.length;v++){const w=x[v];T[0]=Math.min(T[0],w.x),T[1]=Math.min(T[1],w.y),T[2]=Math.max(T[2],w.x),T[3]=Math.max(T[3],w.y)}_!==0&&(T[0]-=_,T[1]-=_,T[2]+=_,T[3]+=_),T[0]<mt&&T[1]<mt&&T[2]>=0&&T[3]>=0&&E.insert(b,T[0],T[1],T[2],T[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xu.VectorTile(new bp(this.rawTileData)).layers,this.sourceLayerCoder=new Zv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,u){this.loadVTLayers();const a=e.params||{},h=xs(a.filter),_=e.tileResult,b=e.transform,E=_.bufferedTilespaceBounds,p=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(w,A,C,D)=>rs(_.bufferedTilespaceGeometry,w,A,C,D));p.sort(lM);let x=null;b.elevation&&p.length>0&&(x=Mu.create(b.elevation,this.tileID));const T={};let v;for(let w=0;w<p.length;w++){const A=p[w];if(A===v)continue;v=A;const C=this.featureIndexArray.get(A);let D=null;if(this.is3DTile){const F=this.bucketLayerIDs[0][0],V=i[F];if(V.type!=="model")continue;const{queryFeature:z,intersectionZ:j}=V.queryIntersectsMatchingFeature(_,C.featureIndex,h,b);z&&this.appendToResult(T,F,C.featureIndex,z,j)}else this.loadMatchingFeature(T,C,h,a.layers,a.availableImages,i,o,u,(F,V,z,j=0)=>(D||(D=st(F,this.tileID.canonical,e.tileTransform)),V.queryIntersectsFeature(_,F,z,D,this.z,e.transform,e.pixelPosMatrix,x,j)))}return T}loadMatchingFeature(e,i,o,u,a,h,_,b,E){const{featureIndex:p,bucketIndex:x,sourceLayerIndex:T,layoutVertexArrayOffset:v}=i,w=this.bucketLayerIDs[x];if(u&&!function(F,V){for(let z=0;z<F.length;z++)if(V.indexOf(F[z])>=0)return!0;return!1}(u,w))return;const A=this.sourceLayerCoder.decode(T),C=this.vtLayers[A].feature(p);if(o.needGeometry){const F=at(C,!0);if(!o.filter(new br(this.tileID.overscaledZ),F,this.tileID.canonical))return}else if(!o.filter(new br(this.tileID.overscaledZ),C))return;const D=this.getId(C,A);for(let F=0;F<w.length;F++){const V=w[F];if(u&&u.indexOf(V)<0)continue;const z=h[V];if(!z)continue;let j={};D!==void 0&&b&&(j=b.getState(z.sourceLayer||"_geojsonTileLayer",D));const G=!E||E(C,z,j,v);if(!G)continue;const Y=new Hv(C,this.z,this.x,this.y,D),te=Mi({},_[V]);te.paint=Xv(te.paint,z.paint,C,j,a),te.layout=Xv(te.layout,z.layout,C,j,a),Y.layer=te,this.appendToResult(e,V,p,Y,G)}}appendToResult(e,i,o,u,a){let h=e[i];h===void 0&&(h=e[i]=[]),h.push({featureIndex:o,feature:u,intersectionZ:a})}lookupSymbolFeatures(e,i,o,u,a,h,_,b){const E={};this.loadVTLayers();const p=xs(a);for(const x of e)this.loadMatchingFeature(E,{bucketIndex:o,sourceLayerIndex:u,featureIndex:x,layoutVertexArrayOffset:0},p,h,_,b,i);return E}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(o),a=this.vtFeatures[u];if(a[i])return a[i];const h=this.vtLayers[u].feature(i);return a[i]=h,h}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(o=e.properties[u]),typeof o=="boolean"&&(o=Number(o))}return o}}function Xv(n,e,i,o,u){return Cs(n,(a,h)=>{const _=e instanceof Da?e.get(h):null;return _&&_.evaluate?_.evaluate(i,o,u):_})}function lM(n,e){return e-n}At(Wv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Yv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class fg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const a=Yv[15&o];if(!a)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new fg(_,h,a,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const a=Yv.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-_%8)%8;if(a<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+_+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+a]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return pg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:h,nodeSize:_}=this,b=[0,a.length-1,0],E=[];for(;b.length;){const p=b.pop()||0,x=b.pop()||0,T=b.pop()||0;if(x-T<=_){for(let C=T;C<=x;C++){const D=h[2*C],F=h[2*C+1];D>=e&&D<=o&&F>=i&&F<=u&&E.push(a[C])}continue}const v=T+x>>1,w=h[2*v],A=h[2*v+1];w>=e&&w<=o&&A>=i&&A<=u&&E.push(a[v]),(p===0?e<=w:i<=A)&&(b.push(T),b.push(v-1),b.push(1-p)),(p===0?o>=w:u>=A)&&(b.push(v+1),b.push(x),b.push(1-p))}return E}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:a,nodeSize:h}=this,_=[0,u.length-1,0],b=[],E=o*o;for(;_.length;){const p=_.pop()||0,x=_.pop()||0,T=_.pop()||0;if(x-T<=h){for(let C=T;C<=x;C++)Jv(a[2*C],a[2*C+1],e,i)<=E&&b.push(u[C]);continue}const v=T+x>>1,w=a[2*v],A=a[2*v+1];Jv(w,A,e,i)<=E&&b.push(u[v]),(p===0?e-o<=w:i-o<=A)&&(_.push(T),_.push(v-1),_.push(1-p)),(p===0?e+o>=w:i+o>=A)&&(_.push(v+1),_.push(x),_.push(1-p))}return b}}function pg(n,e,i,o,u,a){if(u-o<=i)return;const h=o+u>>1;Kv(n,e,h,o,u,a),pg(n,e,i,o,h-1,1-a),pg(n,e,i,h+1,u,1-a)}function Kv(n,e,i,o,u,a){for(;u>o;){if(u-o>600){const E=u-o+1,p=i-o+1,x=Math.log(E),T=.5*Math.exp(2*x/3),v=.5*Math.sqrt(x*T*(E-T)/E)*(p-E/2<0?-1:1);Kv(n,e,i,Math.max(o,Math.floor(i-p*T/E+v)),Math.min(u,Math.floor(i+(E-p)*T/E+v)),a)}const h=e[2*i+a];let _=o,b=u;for(Dd(n,e,o,i),e[2*u+a]>h&&Dd(n,e,o,u);_<b;){for(Dd(n,e,_,b),_++,b--;e[2*_+a]<h;)_++;for(;e[2*b+a]>h;)b--}e[2*o+a]===h?Dd(n,e,o,b):(b++,Dd(n,e,b,u)),b<=i&&(o=b+1),i<=b&&(u=b-1)}}function Dd(n,e,i,o){mg(n,i,o),mg(e,2*i,2*o),mg(e,2*i+1,2*o+1)}function mg(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Jv(n,e,i,o){const u=n-i,a=e-o;return u*u+a*a}s.$=Gf,s.A=class extends Vp{},s.B=Vo,s.C=ha,s.D=Nl,s.E=ua,s.F=Ch,s.G=$c,s.H=zf,s.I=F_,s.J=Wc,s.K=ru,s.L=Nf,s.M=kl,s.N=Bc,s.O=Il,s.P=Se,s.Q=Al,s.R=aa,s.S=Dn,s.T=Y_,s.U=th,s.V=Vp,s.W=Nh,s.X=Zc,s.Y=Ih,s.Z=function(n){const e=n.value;let i=[];if(!e)return i;const o=Vo(e);return o!=="string"?(i=i.concat([new Vp(n.key,e,`string expected, "${o}" found`)]),i):(lv(e,!0)||(i=i.concat([new Vp(n.key,e,`invalid url "${e}"`)])),i)},s._=Oe,s.a=function(n){return ve.API_CDN_URL_REGEX.test(n)},s.a$=Wh,s.a0=pr,s.a1=ut,s.a2=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return qn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Yt(n.x,e.x,i),y:Yt(n.y,e.y,i),z:Yt(n.z,e.z,i),azimuthal:Yt(n.azimuthal,e.azimuthal,i),polar:Yt(n.polar,e.polar,i)}}},s.a3=br,s.a4=ks,s.a5=Re,s.a6=ge,s.a7=vi,s.a8=Da,s.a9=qa,s.aA=sr,s.aB=Xx,s.aC=tv,s.aD=Wx,s.aE=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<n.length;o++){const u=document.createElement("source");is(n[o])||(i.crossOrigin="Anonymous"),u.src=n[o],i.appendChild(u)}return{cancel:()=>{}}},s.aF=kp,s.aG=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>Gv(e,0,n))},s.aH=$v,s.aI=class{constructor(n,e,i,o){this.id=n,this.position=e!=null?new N(e[0],e[1]):new N(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(ge.mat4.multiply(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const o=or.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(o)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=ge.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,o,u,a,h=!1){fv(this.matrix,this,n.transform,this.position,e,i,o,u,a,h)}upload(n){if(!this.uploaded){for(const e of this.nodes)tg(e,n);for(const e of this.nodes)Up(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)ig(n)}},s.aJ=Yr,s.aK=yd,s.aL=ae,s.aM=oe,s.aN=vo,s.aO=ln,s.aP=Vr,s.aQ=fu,s.aR=Dp,s.aS=function(){kn.isLoading()||kn.isLoaded()||Oh()!=="deferred"||Bh()},s.aT=xs,s.aU=at,s.aV=Hv,s.aW=ml,s.aX=P_,s.aY=v_,s.aZ=st,s.a_=xo,s.aa=Yt,s.ab=mt,s.ac=bl,s.ad=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,o]){const u=qn([1,i,o]);return{x:u.x,y:u.y,z:u.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Yt(n.x,e.x,i),y:Yt(n.y,e.y,i),z:Yt(n.z,e.z,i)}}},s.ae=function(n,e,i=0,o=!0){const u=new Se(i,i),a=n.sub(u),h=e.add(u),_=[a,new Se(h.x,a.y),h,new Se(a.x,h.y)];return o&&_.push(a.clone()),_},s.af=function(n,e){const i=[];for(let o=0;o<n.length;o++){const u=Di(o-1,-1,n.length-1),a=Di(o+1,-1,n.length-1),h=n[o],_=n[a],b=n[u].sub(h).unit(),E=_.sub(h).unit(),p=E.angleWithSep(b.x,b.y),x=b.add(E).unit().mult(-1*e/Math.sin(p/2));i.push(h.add(x))}return i},s.ag=zx,s.ah=rs,s.ai=function(n,e,i=0){return ge.vec3.fromValues(((e.x-i)*n.scale-n.x)*mt,(e.y*n.scale-n.y)*mt,fe(e.z,e.y))},s.aj=Js,s.ak=ex,s.al=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const a of n)e=Math.min(e,a.x),i=Math.min(i,a.y),o=Math.max(o,a.x),u=Math.max(u,a.y);return{min:new Se(e,i),max:new Se(o,u)}},s.am=ie,s.an=cr,s.ao=Ke,s.ap=gt,s.aq=t,s.ar=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},s.as=q,s.at=ne,s.au=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,o){const u=this.entries[n]=this.entries[n]||{callbacks:[]};if(u.result){const[a,h]=u.result;return this.scheduler?this.scheduler.add(()=>{o(a,h)},e):o(a,h),()=>{}}return u.callbacks.push(o),u.cancel||(u.cancel=i((a,h)=>{u.result=[a,h];for(const _ of u.callbacks)this.scheduler?this.scheduler.add(()=>{_(a,h)},e):_(a,h);setTimeout(()=>delete this.entries[n],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(a=>a!==o),u.callbacks.length||(u.cancel(),delete this.entries[n]))}}},s.av=Hf,s.aw=function(n,e,i){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const a=la(n.request,(h,_,b,E)=>{h?u(h):_&&u(null,{vectorTile:i?void 0:new xu.VectorTile(new bp(_)),rawData:_,cacheControl:b,expires:E})});return()=>{a.cancel(),u()}},e)},s.ax=function(n){$r++,$r>Gi&&(n.getActor().send("enforceCacheSizeLimit",oi),$r=0)},s.ay=vt,s.az=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},s.b=function(n){return ve.API_FONTS_REGEX.test(n)},s.b$=function(n){const{x:e,y:i}=n.point,{lng:o,lat:u}=n._center;return Zy(e,i,n.worldSize,o,u)},s.b0=ss,s.b1=wr,s.b2=nd,s.b3=H_,s.b4=function(n,e){const i=qa(e.zoom);if(i===0)return So(n);const o=ap(n),u=h_(o),a=ie(o.getWest())*e.worldSize,h=ie(o.getEast())*e.worldSize,_=ne(o.getNorth())*e.worldSize,b=ne(o.getSouth())*e.worldSize,E=[a,_,0],p=[h,_,0],x=[a,b,0],T=[h,b,0],v=ge.mat4.invert([],e.globeMatrix);return ge.vec3.transformMat4(E,E,v),ge.vec3.transformMat4(p,p,v),ge.vec3.transformMat4(x,x,v),ge.vec3.transformMat4(T,T,v),u[0]=Jo(u[0],x,i),u[1]=Jo(u[1],T,i),u[2]=Jo(u[2],p,i),u[3]=Jo(u[3],E,i),or.fromPoints(u)},s.b5=cp,s.b6=id,s.b7=Jo,s.b8=au,s.b9=On,s.bA=Di,s.bB=dt,s.bC=Bo,s.bD=ee,s.bE=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},s.bF=Wl,s.bG=Os,s.bH=Jh,s.bI=yn,s.bJ=Xo,s.bK=N,s.bL=Nx,s.bM=Hr,s.bN=Ga,s.bO=rv,s.bP=Qr,s.bQ=Gy,s.bR=function(n,e,i,o,u,a,h,_,b){if(b.name==="globe")return Gy(n,e,new Qr(i,o,u),!1);const E=yd({z:i,x:o,y:u},b);return new or([(a+E.x/E.scale)*e,e*(E.y/E.scale),h],[(a+E.x2/E.scale)*e,e*(E.y2/E.scale),_])},s.bS=function(n,e,i){let o=0;for(let u=0;u<2;++u)n[u]>0&&(o+=(n[u]-0)*(n[u]-0)),e[u]<0&&(o+=(0-e[u])*(0-e[u]));return o},s.bT=he,s.bU=c,s.bV=function(n){const e=ge.mat4.identity(new Float64Array(16));ge.mat4.multiply(e,n.pixelMatrix,n.globeMatrix);const i=[0,S,0],o=[0,I,0];return ge.vec3.transformMat4(i,i,e),ge.vec3.transformMat4(o,o,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!p_(n,new N(n.center.lat,90)),o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!p_(n,new N(n.center.lat,-90))]},s.bW=function(n,e){const{scale:i}=n.tileTransform,o=i*mt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return ge.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},s.bX=Fp,s.bY=iv,s.bZ=function(n){const e=iv(n,!0);return ge.mat2.invert([],[e[0],e[1],e[4],e[5]])},s.b_=Eo,s.ba=ag,s.bb=bp,s.bc=la,s.bd=function(n){const e=[];for(const i in n)e.push(n[i]);return e},s.be=function(n,e){const i=[];for(const o in n)o in e||i.push(o);return i},s.bf=rr,s.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bh=wt,s.bi=function(n,e){const{x:i,y:o}=n.point,u=Zy(i,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return ge.mat4.multiply(u,u,d_(So(e)))},s.bj=vu,s.bk=bs,s.bl=vp,s.bm=function(n,e,i,o,u){const a=5*e+2;n.float32[a+0]=i,n.float32[a+1]=o,n.float32[a+2]=u},s.bn=Lp,s.bo=Tx,s.bp=ft,s.bq=hn,s.br=S0,s.bs=av,s.bt=P0,s.bu=R0,s.bv=U_,s.bw=Px,s.bx=B_,s.by=fg,s.bz=qi,s.c=Ce,s.c$=Sn,s.c0=Pt,s.c1=En,s.c2=r,s.c3=function(n){const e=Math.round((n+45+360)%360/90)%4;return Dt[e]},s.c4=45,s.c5=W,s.c6=_u,s.c7=function(n,e,i){const o=Math.sqrt(n*n+e*e+i*i),u=o>0?Math.acos(i/o)*Et:0;let a=n!==0||e!==0?Math.atan2(-e,-n)*Et+90:0;return a<0&&(a+=360),[o,a,u]},s.c8=xe,s.c9=or,s.cA=function(n){const e=he-5;n=gt(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(dt(n))),3);return Math.round(i*(y.length-1))},s.cB=function(n,e,i,o){const u=e.getNorth(),a=e.getSouth(),h=e.getWest(),_=e.getEast(),b=1<<n.z,E=_-h,p=u-a,x=E/m,T=-p/y[i],v=[0,x,0,T,0,0,u,h,0];if(n.z>0){const w=180/o;ge.mat3.multiply(v,v,[w/E+1,0,0,0,w/p+1,0,-.5*w/x,.5*w/T,1])}return v[2]=b,v[5]=n.x,v[8]=n.y,v},s.cC=So,s.cD=function(n,e,i){const o=ge.mat4.identity(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return ge.mat4.rotateY(o,i.globeMatrix,u),Float32Array.from(o)},s.cE=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,u=Math.floor(n.x),a=Math.floor((n.x-u)*o),h=Math.floor(n.y*o),_=this.findDEMTileFor(new sr(i,u,i,a,h));return!(!_||!_.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const u=o.getSource().maxzoom,a=1<<u,h=Math.floor(n.x),_=n.x-h,b=new sr(u,h,u,Math.floor(_*a),Math.floor(n.y*a)),E=this.findDEMTileFor(b);if(!E||!E.dem)return e;const p=E.dem,x=1<<E.tileID.canonical.z,T=(_*x-E.tileID.canonical.x)*p.dim,v=(n.y*x-E.tileID.canonical.y)*p.dim,w=Math.floor(T),A=Math.floor(v);return(i?this.exaggeration():1)*Yt(Yt(p.get(w,A),p.get(w,A+1),v-A),Yt(p.get(w+1,A),p.get(w+1,A+1),v-A),T-w)}getAtTileOffset(n,e,i){const o=1<<n.canonical.z;return this.getAtPointOrZero(new Re(n.wrap+(n.canonical.x+e/mt)/o,(n.canonical.y+i/mt)/o))}getAtTileOffsetFunc(n,e,i,o){return u=>{const a=this.getAtTileOffset(n,u.x,u.y),h=o.upVector(n.canonical,u.x,u.y),_=o.upVectorScale(n.canonical,e,i).metersToTile;return ge.vec3.scale(h,h,a*_),h}}getForTilePoints(n,e,i,o){if(this.isUsingMockSource())return!1;const u=Mu.create(this,n,o);return!!u&&(e.forEach(a=>{a[2]=this.exaggeration()*u.getElevationAt(a[0],a[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,u=1<<n.canonical.z-o.canonical.z;let a=n.canonical.x/u-o.canonical.x,h=n.canonical.y/u-o.canonical.y,_=0;for(let b=0;b<n.canonical.z-o.canonical.z&&!i.leaves[_];b++){a*=2,h*=2;const E=2*Math.floor(h)+Math.floor(a);_=i.childOffsets[_]+E,a%=1,h%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const u of n){const a=this.getMinMaxForTile(u.tileID);a&&(i=Math.min(i,a.min),o=Math.max(o,a.max),e=!0)}return e?{min:i,max:o}:null}},s.cF=s0,s.cG=Ko,s.cH=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},s.cI=$y,s.cJ=le,s.cK=J,s.cL=256,s.cM=function(n,e){const i=[0,0,0],o=cp(So(e.canonical));return ge.vec3.transformMat4(i,i,o),ge.vec3.transformMat4(i,i,n),i},s.cN=n=>({u_camera_to_center_distance:new yn(n),u_extrude_scale:new ed(n),u_device_pixel_ratio:new yn(n),u_matrix:new Wl(n),u_inv_rot_matrix:new Wl(n),u_merc_center:new Os(n),u_tile_id:new Jh(n),u_zoom_transition:new yn(n),u_up_dir:new Jh(n),u_emissive_strength:new yn(n)}),s.cO=n=>({u_matrix:new Wl(n),u_pixels_to_tile_units:new ed(n),u_device_pixel_ratio:new yn(n),u_units_to_pixels:new Os(n),u_dash_image:new Xo(n),u_gradient_image:new Xo(n),u_image_height:new yn(n),u_texsize:new Os(n),u_tile_units_to_pixels:new yn(n),u_alpha_discard_threshold:new yn(n),u_trim_offset:new Os(n),u_trim_fade_range:new Os(n),u_trim_color:new _u(n),u_emissive_strength:new yn(n)}),s.cP=n=>({u_matrix:new Wl(n),u_texsize:new Os(n),u_pixels_to_tile_units:new ed(n),u_device_pixel_ratio:new yn(n),u_image:new Xo(n),u_units_to_pixels:new Os(n),u_tile_units_to_pixels:new yn(n),u_alpha_discard_threshold:new yn(n),u_trim_offset:new Os(n)}),s.cQ=Tn,s.cR=PE,s.cS=RE,s.cT=Xy,s.cU=(n,e,i,o,u,a)=>{const h=n.transform,_=h.projection.name==="globe";let b;if(a.paint.get("circle-pitch-alignment")==="map")if(_){const p=$y(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;b=Float32Array.from([p,0,0,p])}else b=h.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(h.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:bt.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:zT,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(_){E.u_inv_rot_matrix=o,E.u_merc_center=u,E.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],E.u_zoom_transition=qa(h.zoom);const p=u[0]*mt,x=u[1]*mt;E.u_up_dir=h.projection.upVector(new Qr(0,0,0),p,x)}return E},s.cV=rx,s.cW=(n,e,i,o,u,a)=>{const h=n.transform;return{u_matrix:ix(n,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:tx(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a}},s.cX=(n,e,i,o,u,a,h)=>{const _=n.transform,b=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:ix(n,e,i,o),u_pixels_to_tile_units:b,u_device_pixel_ratio:a,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:nx(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:tx(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength")}},s.cY=cn,s.cZ=rd,s.c_=q0,s.ca=qn,s.cb=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},s.cc=function(n){return n({pluginStatus:tn,pluginURL:yo}),kh.on("pluginStateChange",n),n},s.cd=Au,s.ce=qp,s.cf=wu,s.cg=N_,s.ch=Yu,s.ci=jf,s.cj=si,s.ck=Rn,s.cl=Or,s.cm=function(n){const e=n.indexOf(ka);return e>=0?n.slice(0,e):n},s.cn=function(n){return n.indexOf(ka)>=0},s.co=function(n){const e=n.indexOf(ka);return e>=0?n.slice(e+1):""},s.cp=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cq=function(n,e,i,o){return n.type==="custom"?new lS(n,e):new xS[n.type](n,e,i,o)},s.cr=Kr,s.cs=kh,s.ct=yl,s.cu=Qh,s.cv=class extends Ks{constructor(n){super(n),this.current=n_}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.cw=It,s.cx=function(n,e,i){const o=qa(i.zoom),u=n.style.map._antialias,a=e.options.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return o===0&&!u&&!a},s.cy=function(n){const e=n.pixelsPerMeter,i=e/ee(1,n.center.lat),o=ge.mat4.identity(new Float64Array(16));return ge.mat4.translate(o,o,[n.point.x,n.point.y,0]),ge.mat4.scale(o,o,[i,i,e]),Float32Array.from(o)},s.cz=ap,s.d=function(n){return ve.API_TILEJSON_REGEX.test(n)},s.d$=ce,s.d0=xp,s.d1=Za,s.d2=450,s.d3=7,s.d4=aS,s.d5=Oi,s.d6=hu,s.d7=256,s.d8=d_,s.d9=bo,s.dA=Hy,s.dB=function(n){const e=[0,0,0],i=ge.mat4.identity(new Float64Array(16));return ge.mat4.multiply(i,n.pixelMatrix,n.globeMatrix),ge.vec3.transformMat4(e,e,i),new Se(e[0],e[1])},s.dC=function(n,e,i=!1){if(tn===Bl||tn===Fl||tn===tu)throw new Error("setRTLTextPlugin cannot be called multiple times.");yo=bt.resolveURL(n),tn=Bl,Ra=e,zh(),i||Bh()},s.dD=Oh,s.dE=function(){qp().acquire(lg)},s.dF=function(){const n=Pd;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(lg),Pd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dG=Cd,s.dH=function(n){const e=_r();if(!e)return;const i=e.delete(ai);n&&i.catch(n).then(()=>n())},s.dI=Id,s.dJ=Ov,s.dK=function(n){cg=bt.resolveURL(n),Pu||(Pu=new Au(qp(),new ua)),Pu.broadcast("setDracoUrl",cg)},s.dL=Bv,s.dM=function(n){Cu=bt.resolveURL(n),Pu||(Pu=new Au(qp(),new ua)),Pu.broadcast("setMeshoptUrl",Cu)},s.dN=At,s.dO=$a,s.dP=eo,s.dQ=Zv,s.dR=Wv,s.dS=Y0,s.dT=Cs,s.dU=Sx,s.dV=function(n,e,i,o,u,a,h,_,b,E,p){n.createArrays(),n.tilePixelRatio=mt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const x=n.layers[0].layout,T=n.layers[0]._unevaluatedLayout._values,v={};if(n.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:F}=n.textSizeData;v.compositeTextSizes=[T["text-size"].possiblyEvaluate(new br(D),_),T["text-size"].possiblyEvaluate(new br(F),_)]}if(n.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:F}=n.iconSizeData;v.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new br(D),_),T["icon-size"].possiblyEvaluate(new br(F),_)]}v.layoutTextSize=T["text-size"].possiblyEvaluate(new br(b+1),_),v.layoutIconSize=T["icon-size"].possiblyEvaluate(new br(b+1),_),v.textMaxSize=T["text-size"].possiblyEvaluate(new br(18),_);const w=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point",A=x.get("text-size");let C=!1;for(const D of n.features)if(D.icon&&D.icon.nameSecondary){C=!0;break}for(const D of n.features){const F=x.get("text-font").evaluate(D,{},_).join(","),V=A.evaluate(D,{},_),z=v.layoutTextSize.evaluate(D,{},_),j=(v.layoutIconSize.evaluate(D,{},_),{horizontal:{},vertical:void 0}),G=D.text;let Y,te=[0,0];if(G){const ue=G.toString(),se=x.get("text-letter-spacing").evaluate(D,{},_)*hn,de=x.get("text-line-height").evaluate(D,{},_)*hn,we=Zm(ue)?se:0,Ee=x.get("text-anchor").evaluate(D,{},_),Me=x.get("text-variable-anchor");if(!Me){const Je=x.get("text-radial-offset").evaluate(D,{},_);te=Je?Px(Ee,[Je*hn,V_]):x.get("text-offset").evaluate(D,{},_).map(Ue=>Ue*hn)}let Ie=w?"center":x.get("text-justify").evaluate(D,{},_);const Be=x.get("symbol-placement")==="point",Pe=Be?x.get("text-max-width").evaluate(D,{},_)*hn:1/0,Ze=Je=>{n.allowVerticalPlacement&&Jc(ue)&&(j.vertical=O_(G,e,i,u,F,Pe,de,Ee,Je,we,te,bs.vertical,!0,z,V))};if(!w&&Me){const Je=Ie==="auto"?Me.map(xt=>U_(xt)):[Ie];let Ue=!1;for(let xt=0;xt<Je.length;xt++){const pt=Je[xt];if(!j.horizontal[pt])if(Ue)j.horizontal[pt]=j.horizontal[0];else{const ot=O_(G,e,i,u,F,Pe,de,"center",pt,we,te,bs.horizontal,!1,z,V);ot&&(j.horizontal[pt]=ot,Ue=ot.positionedLines.length===1)}}Ze("left")}else{if(Ie==="auto"&&(Ie=U_(Ee)),Be||x.get("text-writing-mode").indexOf("horizontal")>=0||!Jc(ue)){const Je=O_(G,e,i,u,F,Pe,de,Ee,Ie,we,te,bs.horizontal,!1,z,V);Je&&(j.horizontal[Ie]=Je)}Ze(Be?"left":Ie)}}let re=!1;if(D.icon&&D.icon.namePrimary){const ue=o[D.icon.namePrimary];ue&&(Y=UE(u[D.icon.namePrimary],D.icon.nameSecondary?u[D.icon.nameSecondary]:void 0,x.get("icon-offset").evaluate(D,{},_),x.get("icon-anchor").evaluate(D,{},_)),re=ue.sdf,n.sdfIcons===void 0?n.sdfIcons=ue.sdf:n.sdfIcons!==ue.sdf&&zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==n.pixelRatio||x.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Q=Lx(j.horizontal)||j.vertical;n.iconsInText||(n.iconsInText=!!Q&&Q.iconsInText),(Q||Y)&&WE(n,D,j,Y,o,v,z,0,te,re,h,_,E,p,C)}a&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)},s.dW=xu,s.dX=Gp,s.dY=ze,s.dZ=b0,s.d_=ux,s.da=Ys,s.db=Hh,s.dc=function(n,e,i,o,u){return gt((n-e)/(i-e)*(u-o)+o,o,u)},s.dd=qc,s.de=Te,s.df=class{constructor(n,e,i,o){this.context=n,this.format=o,this.size=i,this.texture=n.gl.createTexture();const[u,a,h]=this.size,{gl:_}=n;_.bindTexture(_.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),_.texImage3D(_.TEXTURE_3D,0,this.format,u,a,h,0,W_(this.format),X_(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),n!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},s.dg=Q_,s.dh=[1,1,1],s.di=Mu,s.dj=Su,s.dk=wo,s.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Se(1/0,1/0),max:new Se(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=A0(new Se(0,0),new Se(mt,mt),n),o=[];if(e&&!S_(i,this._globalClipBounds))return o;for(const u of this._activeRegions){if(u.hiddenByOverlap||!S_(i,u))continue;const a=rE(u.min,u.max,n);o.push({min:a.min,max:a.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return o}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(o).buckets[e.layer];u&&u.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),o=n.getClipMask(),u=n.getClipScope();for(const a of e){if(!a.footprint)continue;const h=A0(a.footprint.min,a.footprint.max,a.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:a.id,footprint:a.footprint,order:i,clipMask:o,clipScope:u})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||gp(e.min,i.min)||gp(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,u){const a=(h,_)=>h+_;return o.length-u.length||o.reduce(a,"").localeCompare(u.reduce(a,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];n=i.priority!==o.priority||!M0(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!wt(i.clipScope,o.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==_p&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const u=o[i].priority;for(;i<o.length&&o[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let u=i;const a=i;for(;u!==o;){const h=this._activeRegions[u];h.hiddenByOverlap=!1;for(let _=0;_<a;_++){const b=this._activeRegions[_];if(!b.hiddenByOverlap&&h.order===_p&&S_(h,b)&&(h.hiddenByOverlap=C0(h.footprint,h.tileId,b.footprint,b.tileId),h.hiddenByOverlap))break}++u}i=o,o=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},s.dm=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new xo,o=new ln,u=[],a=n+1+2,h=e[0]+1,_=e[0]+1+(1+e.length),b=(E,p,x)=>{let T=E===a-1?E-2:E===0?E:E-1;return T+=x?24575:0,[T,p]};for(let E=0;E<a;++E)i.emplaceBack(...b(E,0,!0));for(let E=0;E<h;++E)for(let p=0;p<a;++p)i.emplaceBack(...b(p,E,(p===0||p===a-1)&&!0));for(let E=0;E<e.length;++E){const p=e[E];for(let x=0;x<a;++x)i.emplaceBack(...b(x,p,!0))}for(let E=0;E<e.length;++E){const p=o.length,x=e[E]+1+2,T=new ln;for(let A=0;A<x-1;A++){const C=A===x-2,D=C?a*(_-e.length+E-A):a;for(let F=0;F<a-1;F++){const V=A*a+F;A===0||C||F===0||F===a-2?(T.emplaceBack(V+1,V,V+D),T.emplaceBack(V+D,V+D+1,V+1)):(o.emplaceBack(V+1,V,V+D),o.emplaceBack(V+D,V+D+1,V+1))}}const v=wr.simpleSegment(0,p,i.length,o.length-p);for(let A=0;A<T.uint16.length;A+=3)o.emplaceBack(T.uint16[A],T.uint16[A+1],T.uint16[A+2]);const w=wr.simpleSegment(0,p,i.length,o.length-p);u.push({withoutSkirts:v,withSkirts:w})}return{vertices:i,indices:o,segments:u}}_createGrid(n){const e=this._fillGridMeshWithLods(m,y);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,ss.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new ln;for(let h=0;h<=m;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Ys,o=new Ys,u=new Ys,a=new Ys;this._poleSegments=[];for(let h=0,_=0;h<r;h++){const b=360/(1<<h);i.emplaceBack(0,-t,0,.5,0),o.emplaceBack(0,-t,0,.5,1),u.emplaceBack(0,-t,0,.5,.5),a.emplaceBack(0,-t,0,.5,.5);for(let E=0;E<=m;E++){let p=E/m,x=0;const T=Yt(0,b,p),[v,w,A]=P(LT,DT,T,t);i.emplaceBack(v,w,A,p,x),o.emplaceBack(v,w,A,p,1-x);const C=dt(T);p=.5+.5*Math.sin(C),x=.5+.5*Math.cos(C),u.emplaceBack(v,w,A,p,x),a.emplaceBack(v,w,A,p,1-x)}this._poleSegments.push(wr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Kn,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,Kn,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(u,Kn,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(a,Kn,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},s.dn=_p,s.dp=hi,s.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dr=$t,s.ds=be,s.dt=L,s.du=function([n,e,i]){const o=Math.hypot(n,e,i),u=Math.atan2(n,i),a=.5*Math.PI-Math.acos(-e/o);return new N(Pt(u),Pt(a))},s.dv=J_,s.dw=k,s.dx=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(_l==null){const o=i.navigator?i.navigator.userAgent:null;_l=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return _l}(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dy=function(n,e){oi=n,Gi=e},s.dz=p_,s.e=ve,s.e0=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==Nv){const i=new Uint32Array(n,0,7),[,,o,u,a,h]=i;e=i.byteLength+u+a+h+a,(o!==n.byteLength||e>=n.byteLength)&&zi("Invalid b3dm header information.")}return Gv(n,e)},s.e1=function(n,e){const i=$v(n);for(const o of i){for(const u of o.meshes)sM(u);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(oM(o.lights,e)))}return i},s.e2=jp,s.e3=xv,s.e4=kn,s.e5=function(n){Ur(),di!=null&&di.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-n;o++)e.delete(i[o])})})},s.f=function(n){return n.indexOf("mapbox:")===0},s.g=function(n,e){return yl(Mi(n,{method:"GET"}),e)},s.h=ye,s.i=function(n){return ve.API_STYLE_REGEX.test(n)&&!Ce(n)},s.j=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.l=Mi,s.m=an,s.n=function(n,e){return yl(Mi(n,{type:"json"}),e)},s.o=Rs,s.p=function(n,e){return yl(Mi(n,{method:"POST"}),e)},s.q=bt,s.r=Mn,s.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=vl,s.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},s.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},s.w=zi,s.x=ho,s.y=2,s.z=Ex}),$(["./shared"],function(s){function ce(Ve){const X=Ve?Ve.url.toString():void 0;return X?performance.getEntriesByName(X):[]}function pe(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let J="[";for(const le of Ve)J+=`${pe(le)},`;return`${J}]`}let X="{";for(const J of Object.keys(Ve).sort())X+=`${J}:${pe(Ve[J])},`;return`${X}}`}function me(Ve){let X="";for(const J of s.bg)X+=`/${pe(Ve[J])}`;return X}class ke{constructor(X){this.keyCache={},this._layers={},this._layerConfigs={},X&&this.replace(X)}replace(X,J){this._layerConfigs={},this._layers={},this.update(X,[],J)}update(X,J,le){this._options=le;for(const ye of X)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=s.cq(ye,this.scope,null,this._options)).compileFilter(le),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of J)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ve=function(ye,Ce){const Fe={};for(let Ne=0;Ne<ye.length;Ne++){const We=Ce&&Ce[ye[Ne].id]||me(ye[Ne]);Ce&&(Ce[ye[Ne].id]=We);let $e=Fe[We];$e||($e=Fe[We]=[]),$e.push(ye[Ne])}const De=[];for(const Ne in Fe)De.push(Fe[Ne]);return De}(s.bd(this._layerConfigs),this.keyCache);for(const ye of ve){const Ce=ye.map(nt=>this._layers[nt.id]),Fe=Ce[0];if(Fe.visibility==="none")continue;const De=Fe.source||"";let Ne=this.familiesBySource[De];Ne||(Ne=this.familiesBySource[De]={});const We=Fe.sourceLayer||"_geojsonTileLayer";let $e=Ne[We];$e||($e=Ne[We]=[]),$e.push(Ce)}}}const qe=1*s.dP;class it{constructor(X){const J={},le=[];for(const Fe in X){const De=X[Fe],Ne=J[Fe]={};for(const We in De.glyphs){const $e=De.glyphs[+We];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const nt=$e.metrics.localGlyph?qe:1,vt={x:0,y:0,w:$e.bitmap.width+2*nt,h:$e.bitmap.height+2*nt};le.push(vt),Ne[We]=vt}}const{w:ve,h:ye}=s.z(le),Ce=new s.dO({width:ve||1,height:ye||1});for(const Fe in X){const De=X[Fe];for(const Ne in De.glyphs){const We=De.glyphs[+Ne];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const $e=J[Fe][Ne],nt=We.metrics.localGlyph?qe:1;s.dO.copy(We.bitmap,Ce,{x:0,y:0},{x:$e.x+nt,y:$e.y+nt},We.bitmap)}}this.image=Ce,this.positions=J}}s.dN(it,"GlyphAtlas");class et{constructor(X){this.tileID=new s.aA(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.lut=X.lut,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.scope=X.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.promoteId=X.promoteId,this.isSymbolTile=X.isSymbolTile,this.tileTransform=s.aK(X.tileID.canonical,X.projection),this.projection=X.projection,this.brightness=X.brightness,this.extraShadowCaster=!!X.extraShadowCaster,this.tessellationStep=X.tessellationStep}parse(X,J,le,ve,ye){this.status="parsing",this.data=X,this.collisionBoxArray=new s.aQ;const Ce=new s.dQ(Object.keys(X.layers).sort()),Fe=new s.dR(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const De={},Ne=new s.dS(256,256),We={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ne,availableImages:le,brightness:this.brightness},$e=J.familiesBySource[this.source];for(const oi in $e){const Gi=X.layers[oi];if(!Gi)continue;let Yi=!1,di=!1,Wi=!1;for(const $r of $e[oi])$r[0].type==="symbol"?Yi=!0:di=!0,$r[0].is3D()&&$r[0].type!=="model"&&(Wi=!0);if(this.extraShadowCaster&&!Wi||this.isSymbolTile===!0&&!Yi||this.isSymbolTile===!1&&!di)continue;Gi.version===1&&s.w(`Vector tile source "${this.source}" layer "${oi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _r=Ce.encode(oi),Ur=[];for(let $r=0;$r<Gi.length;$r++){const an=Gi.feature($r),ds=Fe.getId(an,oi);Ur.push({feature:an,id:ds,index:$r,sourceLayerIndex:_r})}for(const $r of $e[oi]){const an=$r[0];(!this.extraShadowCaster||an.is3D()&&an.type!=="model")&&(this.isSymbolTile!==void 0&&an.type==="symbol"!==this.isSymbolTile||an.minzoom&&this.zoom<Math.floor(an.minzoom)||an.maxzoom&&this.zoom>=an.maxzoom||an.visibility!=="none"&&(ct($r,this.zoom,We.brightness,le),(De[an.id]=an.createBucket({index:Fe.bucketLayerIDs.length,layers:$r,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_r,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ur,We,this.tileID.canonical,this.tileTransform),Fe.bucketLayerIDs.push($r.map(ds=>ds.id))))}}let nt,vt,bt,ii;Ne.trim();const si={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ai=()=>{if(nt)return this.status="done",ye(nt);if(this.extraShadowCaster)this.status="done",ye(null,{buckets:s.bd(De).filter(oi=>!oi.isEmpty()),featureIndex:Fe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:We.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(vt&&bt&&ii){const oi=new it(vt),Gi=new s.dU(bt,ii,this.lut);for(const Yi in De){const di=De[Yi];di instanceof s.aR?(ct(di.layers,this.zoom,We.brightness,le),s.dV(di,vt,oi.positions,bt,Gi.iconPositions,this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):di.hasPattern&&(di instanceof s.aX||di instanceof s.aY||di instanceof s.d0)&&(ct(di.layers,this.zoom,We.brightness,le),di.addFeatures(We,this.tileID.canonical,Gi.patternPositions,le,this.tileTransform,this.brightness))}this.status="done",ye(null,{buckets:s.bd(De).filter(Yi=>!Yi.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oi.image,lineAtlas:Ne,imageAtlas:Gi,brightness:We.brightness})}};if(!this.extraShadowCaster){const oi=s.dT(We.glyphDependencies,di=>Object.keys(di).map(Number));Object.keys(oi).length?ve.send("getGlyphs",{uid:this.uid,stacks:oi,scope:this.scope},(di,Wi)=>{nt||(nt=di,vt=Wi,ai())},void 0,!1,si):vt={};const Gi=Object.keys(We.iconDependencies);Gi.length?ve.send("getImages",{icons:Gi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(di,Wi)=>{nt||(nt=di,bt=Wi,ai())},void 0,!1,si):bt={};const Yi=Object.keys(We.patternDependencies);Yi.length?ve.send("getImages",{icons:Yi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(di,Wi)=>{nt||(nt=di,ii=Wi,ai())},void 0,!1,si):ii={}}ai()}}function ct(Ve,X,J,le){const ve=new s.a3(X,{brightness:J});for(const ye of Ve)ye.recalculate(ve,le)}class St extends s.E{constructor(X,J,le,ve,ye,Ce){super(),this.actor=X,this.layerIndex=J,this.availableImages=le,this.loadVectorData=ye||s.aw,this.loading={},this.loaded={},this.deduped=new s.au(X.scheduler),this.isSpriteLoaded=ve,this.scheduler=X.scheduler,this.brightness=Ce}loadTile(X,J){const le=X.uid,ve=X&&X.request,ye=ve&&ve.collectResourceTiming,Ce=this.loading[le]=new et(X);Ce.abort=this.loadVectorData(X,(Fe,De)=>{const Ne=!this.loading[le];if(delete this.loading[le],Ne||Fe||!De)return Ce.status="done",Ne||(this.loaded[le]=Ce),J(Fe);const We=De.rawData,$e={};De.expires&&($e.expires=De.expires),De.cacheControl&&($e.cacheControl=De.cacheControl),Ce.vectorTile=De.vectorTile||new s.dW.VectorTile(new s.bb(We));const nt=()=>{Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,(vt,bt)=>{if(vt||!bt)return J(vt);const ii={};if(ye){const si=ce(ve);si.length>0&&(ii.resourceTiming=JSON.parse(JSON.stringify(si)))}J(null,s.l({rawTileData:We.slice(0)},bt,$e,ii))})};this.isSpriteLoaded?nt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(nt,{type:"parseTile",isSymbolTile:X.isSymbolTile,zoom:X.tileZoom}):nt()}),this.loaded=this.loaded||{},this.loaded[le]=Ce})}reloadTile(X,J){const le=this.loaded,ve=X.uid;if(le&&le[ve]){const ye=le[ve];ye.showCollisionBoxes=X.showCollisionBoxes,ye.projection=X.projection,ye.brightness=X.brightness,ye.tileTransform=s.aK(X.tileID.canonical,X.projection),ye.extraShadowCaster=X.extraShadowCaster,ye.lut=X.lut;const Ce=(Fe,De)=>{const Ne=ye.reloadCallback;Ne&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,Ne)),J(Fe,De)};ye.status==="parsing"?ye.reloadCallback=Ce:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,Ce):Ce())}else J(null,void 0)}abortTile(X,J){const le=X.uid,ve=this.loading[le];ve&&(ve.abort&&ve.abort(),delete this.loading[le]),J()}removeTile(X,J){const le=this.loaded,ve=X.uid;le&&le[ve]&&delete le[ve],J()}}class _t{loadTile(X,J){const{uid:le,encoding:ve,rawImageData:ye,padding:Ce}=X,Fe=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,Ce):ye;J(null,new s.dX(le,Fe,ve,Ce<1))}getImageData(X,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const le=this.offscreenCanvasContext.getImageData(-J,-J,X.width+2*J,X.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}s.ba.setPbf(s.bb);class zt{decodeRasterArray({task:X,buffer:J},le){s.ba.performDecoding(J,X).then(ve=>{le(null,ve)},ve=>{le(ve)})}}const Gt=s.dW.VectorTileFeature.prototype.toGeoJSON;class Rt{constructor(X){this._feature=X,this.extent=s.ab,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){const X=[];for(const J of this._feature.geometry)X.push([new s.P(J[0],J[1])]);return X}{const X=[];for(const J of this._feature.geometry){const le=[];for(const ve of J)le.push(new s.P(ve[0],ve[1]));X.push(le)}return X}}toGeoJSON(X,J,le){return Gt.call(this,X,J,le)}}class yi{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ab,this.length=X.length,this._features=X}feature(X){return new Rt(this._features[X])}}const Ti=64/4096,kt=128;class lr{constructor(){this.features=new Map}clear(){this.features.clear()}load(X=[],J){for(const le of X){const ve=le.id;if(ve==null)continue;let ye=this.features.get(ve);ye&&this.updateCache(ye,J),le.geometry?(ye=qt(le),this.updateCache(ye,J),this.features.set(ve,ye)):this.features.delete(ve),this.updateCache(ye,J)}}updateCache(X,J){for(const{canonical:le,uid:ve}of Object.values(J)){const{z:ye,x:Ce,y:Fe}=le;Sr(X,Math.pow(2,ye),Ce,Fe)&&delete J[ve]}}getTile(X,J,le){const ve=Math.pow(2,X),ye=[];for(const Ce of this.features.values())Sr(Ce,ve,J,le)&&ye.push(hs(Ce,ve,J,le));return{features:ye}}getFeatures(){return[...this.features.values()]}}function Sr({minX:Ve,minY:X,maxX:J,maxY:le},ve,ye,Ce){return Ve<(ye+1+Ti)/ve&&X<(Ce+1+Ti)/ve&&J>(ye-Ti)/ve&&le>(Ce-Ti)/ve}function qt(Ve){const{id:X,geometry:J,properties:le}=Ve;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ve,coordinates:ye}=J,Ce={id:X,type:1,geometry:[],tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Fe=Ce.geometry;if(ve==="Point")Xt(ye,Fe,Ce);else if(ve==="MultiPoint")for(const De of ye)Xt(De,Fe,Ce);else if(ve==="LineString")Ce.type=2,sn(ye,Fe,Ce);else if(ve==="MultiLineString")Ce.type=2,Cn(ye,Fe,Ce);else if(ve==="Polygon")Ce.type=3,Cn(ye,Fe,Ce,!0);else{if(ve!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ce.type=3;for(const De of ye)Cn(De,Fe,Ce,!0)}return Ce}function Xt([Ve,X],J,le){const ve=s.am(Ve);let ye=s.at(X);ye=ye<0?0:ye>1?1:ye,J.push(ve,ye),le.minX=Math.min(le.minX,ve),le.minY=Math.min(le.minY,ye),le.maxX=Math.max(le.maxX,ve),le.maxY=Math.max(le.maxY,ye)}function sn(Ve,X,J,le=!1,ve=!1){const ye=[];for(const Ce of Ve)Xt(Ce,ye,J);X.push(ye),le&&function(Ce,Fe){let De=0;for(let Ne=0,We=Ce.length,$e=We-2;Ne<We;$e=Ne,Ne+=2)De+=(Ce[Ne]-Ce[$e])*(Ce[Ne+1]+Ce[$e+1]);if(De>0===Fe)for(let Ne=0,We=Ce.length;Ne<We/2;Ne+=2){const $e=Ce[Ne],nt=Ce[Ne+1];Ce[Ne]=Ce[We-2-Ne],Ce[Ne+1]=Ce[We-1-Ne],Ce[We-2-Ne]=$e,Ce[We-1-Ne]=nt}}(ye,ve)}function Cn(Ve,X,J,le=!1){for(let ve=0;ve<Ve.length;ve++)sn(Ve[ve],X,J,le,ve===0)}function hs(Ve,X,J,le){const{id:ve,type:ye,geometry:Ce,tags:Fe}=Ve,De=[];if(ye===1)(function(Ne,We,$e,nt,vt){for(let bt=0;bt<Ne.length;bt+=2){const ii=Math.round(s.ab*(Ne[bt+0]*We-$e)),si=Math.round(s.ab*(Ne[bt+1]*We-nt));vt.push([ii,si])}})(Ce,X,J,le,De);else for(const Ne of Ce)Ht(Ne,X,J,le,De);return{id:ve,type:ye,geometry:De,tags:Fe}}function Ht(Ve,X,J,le,ve){const ye=-kt,Ce=s.ab+kt;let Fe;for(let De=0;De<Ve.length-2;De+=2){let Ne=Math.round(s.ab*(Ve[De+0]*X-J)),We=Math.round(s.ab*(Ve[De+1]*X-le)),$e=Math.round(s.ab*(Ve[De+2]*X-J)),nt=Math.round(s.ab*(Ve[De+3]*X-le));const vt=$e-Ne,bt=nt-We;Ne<ye&&$e<ye||(Ne<ye?(We+=Math.round(bt*((ye-Ne)/vt)),Ne=ye):$e<ye&&(nt=We+Math.round(bt*((ye-Ne)/vt)),$e=ye),We<ye&&nt<ye||(We<ye?(Ne+=Math.round(vt*((ye-We)/bt)),We=ye):nt<ye&&($e=Ne+Math.round(vt*((ye-We)/bt)),nt=ye),Ne>=Ce&&$e>=Ce||(Ne>=Ce?(We+=Math.round(bt*((Ce-Ne)/vt)),Ne=Ce):$e>=Ce&&(nt=We+Math.round(bt*((Ce-Ne)/vt)),$e=Ce),We>=Ce&&nt>=Ce||(We>=Ce?(Ne+=Math.round(vt*((Ce-We)/bt)),We=Ce):nt>=Ce&&($e=Ne+Math.round(vt*((Ce-We)/bt)),nt=Ce),Fe&&Ne===Fe[Fe.length-1][0]&&We===Fe[Fe.length-1][1]||(Fe=[[Ne,We]],ve.push(Fe)),Fe.push([$e,nt])))))}}var Li,Vi,pn,Qt={exports:{}},on=function(){if(pn)return Qt.exports;pn=1;var Ve=s.d_(),X=function(){if(Vi)return Li;Vi=1;var We=s.dY(),$e=s.dZ().VectorTileFeature;function nt(bt,ii){this.options=ii||{},this.features=bt,this.length=bt.length}function vt(bt,ii){this.id=typeof bt.id=="number"?bt.id:void 0,this.type=bt.type,this.rawGeometry=bt.type===1?[bt.geometry]:bt.geometry,this.properties=bt.tags,this.extent=ii||4096}return Li=nt,nt.prototype.feature=function(bt){return new vt(this.features[bt],this.options.extent)},vt.prototype.loadGeometry=function(){var bt=this.rawGeometry;this.geometry=[];for(var ii=0;ii<bt.length;ii++){for(var si=bt[ii],ai=[],oi=0;oi<si.length;oi++)ai.push(new We(si[oi][0],si[oi][1]));this.geometry.push(ai)}return this.geometry},vt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var bt=this.geometry,ii=1/0,si=-1/0,ai=1/0,oi=-1/0,Gi=0;Gi<bt.length;Gi++)for(var Yi=bt[Gi],di=0;di<Yi.length;di++){var Wi=Yi[di];ii=Math.min(ii,Wi.x),si=Math.max(si,Wi.x),ai=Math.min(ai,Wi.y),oi=Math.max(oi,Wi.y)}return[ii,ai,si,oi]},vt.prototype.toGeoJSON=$e.prototype.toGeoJSON,Li}();function J(We){var $e=new Ve;return function(nt,vt){for(var bt in nt.layers)vt.writeMessage(3,le,nt.layers[bt])}(We,$e),$e.finish()}function le(We,$e){var nt;$e.writeVarintField(15,We.version||1),$e.writeStringField(1,We.name||""),$e.writeVarintField(5,We.extent||4096);var vt={keys:[],values:[],keycache:{},valuecache:{}};for(nt=0;nt<We.length;nt++)vt.feature=We.feature(nt),$e.writeMessage(2,ve,vt);var bt=vt.keys;for(nt=0;nt<bt.length;nt++)$e.writeStringField(3,bt[nt]);var ii=vt.values;for(nt=0;nt<ii.length;nt++)$e.writeMessage(4,Ne,ii[nt])}function ve(We,$e){var nt=We.feature;nt.id!==void 0&&$e.writeVarintField(1,nt.id),$e.writeMessage(2,ye,We),$e.writeVarintField(3,nt.type),$e.writeMessage(4,De,nt)}function ye(We,$e){var nt=We.feature,vt=We.keys,bt=We.values,ii=We.keycache,si=We.valuecache;for(var ai in nt.properties){var oi=nt.properties[ai],Gi=ii[ai];if(oi!==null){Gi===void 0&&(vt.push(ai),ii[ai]=Gi=vt.length-1),$e.writeVarint(Gi);var Yi=typeof oi;Yi!=="string"&&Yi!=="boolean"&&Yi!=="number"&&(oi=JSON.stringify(oi));var di=Yi+":"+oi,Wi=si[di];Wi===void 0&&(bt.push(oi),si[di]=Wi=bt.length-1),$e.writeVarint(Wi)}}}function Ce(We,$e){return($e<<3)+(7&We)}function Fe(We){return We<<1^We>>31}function De(We,$e){for(var nt=We.loadGeometry(),vt=We.type,bt=0,ii=0,si=nt.length,ai=0;ai<si;ai++){var oi=nt[ai],Gi=1;vt===1&&(Gi=oi.length),$e.writeVarint(Ce(1,Gi));for(var Yi=vt===3?oi.length-1:oi.length,di=0;di<Yi;di++){di===1&&vt!==1&&$e.writeVarint(Ce(2,Yi-1));var Wi=oi[di].x-bt,_r=oi[di].y-ii;$e.writeVarint(Fe(Wi)),$e.writeVarint(Fe(_r)),bt+=Wi,ii+=_r}vt===3&&$e.writeVarint(Ce(7,1))}}function Ne(We,$e){var nt=typeof We;nt==="string"?$e.writeStringField(1,We):nt==="boolean"?$e.writeBooleanField(7,We):nt==="number"&&(We%1!=0?$e.writeDoubleField(3,We):We<0?$e.writeSVarintField(6,We):$e.writeVarintField(5,We))}return Qt.exports=J,Qt.exports.fromVectorTileJs=J,Qt.exports.fromGeojsonVt=function(We,$e){$e=$e||{};var nt={};for(var vt in We)nt[vt]=new X(We[vt].features,$e),nt[vt].name=vt,nt[vt].version=$e.version,nt[vt].extent=$e.extent;return J({layers:nt})},Qt.exports.GeoJSONWrapper=X,Qt.exports}(),Xr=s.d$(on);const Gn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},Jt=Math.fround||(Is=new Float32Array(1),Ve=>(Is[0]=+Ve,Is[0]));var Is;const Pr=3,ht=5,Wt=6;class jt{constructor(X){this.options=Object.assign(Object.create(Gn),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:J,minZoom:le,maxZoom:ve}=this.options;J&&console.time("total time");const ye=`prepare ${X.length} points`;J&&console.time(ye),this.points=X;const Ce=[];for(let De=0;De<X.length;De++){const Ne=X[De];if(!Ne.geometry)continue;const[We,$e]=Ne.geometry.coordinates,nt=Jt(nr(We)),vt=Jt(Ae($e));Ce.push(nt,vt,1/0,De,-1,1),this.options.reduce&&Ce.push(0)}let Fe=this.trees[ve+1]=this._createTree(Ce);J&&console.timeEnd(ye);for(let De=ve;De>=le;De--){const Ne=+Date.now();Fe=this.trees[De]=this._createTree(this._cluster(Fe,De)),J&&console.log("z%d: %d clusters in %dms",De,Fe.numItems,+Date.now()-Ne)}return J&&console.timeEnd("total time"),this}getClusters(X,J){let le=((X[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,X[1]));let ye=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)le=-180,ye=180;else if(le>ye){const $e=this.getClusters([le,ve,180,Ce],J),nt=this.getClusters([-180,ve,ye,Ce],J);return $e.concat(nt)}const Fe=this.trees[this._limitZoom(J)],De=Fe.range(nr(le),Ae(Ce),nr(ye),Ae(ve)),Ne=Fe.data,We=[];for(const $e of De){const nt=this.stride*$e;We.push(Ne[nt+ht]>1?ni(Ne,nt,this.clusterProps):this.points[Ne[nt+Pr]])}return We}getChildren(X){const J=this._getOriginId(X),le=this._getOriginZoom(X),ve="No cluster with the specified id.",ye=this.trees[le];if(!ye)throw new Error(ve);const Ce=ye.data;if(J*this.stride>=Ce.length)throw new Error(ve);const Fe=this.options.radius/(this.options.extent*Math.pow(2,le-1)),De=ye.within(Ce[J*this.stride],Ce[J*this.stride+1],Fe),Ne=[];for(const We of De){const $e=We*this.stride;Ce[$e+4]===X&&Ne.push(Ce[$e+ht]>1?ni(Ce,$e,this.clusterProps):this.points[Ce[$e+Pr]])}if(Ne.length===0)throw new Error(ve);return Ne}getLeaves(X,J,le){const ve=[];return this._appendLeaves(ve,X,J=J||10,le=le||0,0),ve}getTile(X,J,le){const ve=this.trees[this._limitZoom(X)],ye=Math.pow(2,X),{extent:Ce,radius:Fe}=this.options,De=Fe/Ce,Ne=(le-De)/ye,We=(le+1+De)/ye,$e={features:[]};return this._addTileFeatures(ve.range((J-De)/ye,Ne,(J+1+De)/ye,We),ve.data,J,le,ye,$e),J===0&&this._addTileFeatures(ve.range(1-De/ye,Ne,1,We),ve.data,ye,le,ye,$e),J===ye-1&&this._addTileFeatures(ve.range(0,Ne,De/ye,We),ve.data,-1,le,ye,$e),$e.features.length?$e:null}getClusterExpansionZoom(X){let J=this._getOriginZoom(X)-1;for(;J<=this.options.maxZoom;){const le=this.getChildren(X);if(J++,le.length!==1)break;X=le[0].properties.cluster_id}return J}_appendLeaves(X,J,le,ve,ye){const Ce=this.getChildren(J);for(const Fe of Ce){const De=Fe.properties;if(De&&De.cluster?ye+De.point_count<=ve?ye+=De.point_count:ye=this._appendLeaves(X,De.cluster_id,le,ve,ye):ye<ve?ye++:X.push(Fe),X.length===le)break}return ye}_createTree(X){const J=new s.by(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<X.length;le+=this.stride)J.add(X[le],X[le+1]);return J.finish(),J.data=X,J}_addTileFeatures(X,J,le,ve,ye,Ce){for(const Fe of X){const De=Fe*this.stride,Ne=J[De+ht]>1;let We,$e,nt;if(Ne)We=ge(J,De,this.clusterProps),$e=J[De],nt=J[De+1];else{const ii=this.points[J[De+Pr]];We=ii.properties;const[si,ai]=ii.geometry.coordinates;$e=nr(si),nt=Ae(ai)}const vt={type:1,geometry:[[Math.round(this.options.extent*($e*ye-le)),Math.round(this.options.extent*(nt*ye-ve))]],tags:We};let bt;bt=Ne||this.options.generateId?J[De+Pr]:this.points[J[De+Pr]].id,bt!==void 0&&(vt.id=bt),Ce.features.push(vt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,J){const{radius:le,extent:ve,reduce:ye,minPoints:Ce}=this.options,Fe=le/(ve*Math.pow(2,J)),De=X.data,Ne=[],We=this.stride;for(let $e=0;$e<De.length;$e+=We){if(De[$e+2]<=J)continue;De[$e+2]=J;const nt=De[$e],vt=De[$e+1],bt=X.within(De[$e],De[$e+1],Fe),ii=De[$e+ht];let si=ii;for(const ai of bt){const oi=ai*We;De[oi+2]>J&&(si+=De[oi+ht])}if(si>ii&&si>=Ce){let ai,oi=nt*ii,Gi=vt*ii,Yi=-1;const di=($e/We<<5)+(J+1)+this.points.length;for(const Wi of bt){const _r=Wi*We;if(De[_r+2]<=J)continue;De[_r+2]=J;const Ur=De[_r+ht];oi+=De[_r]*Ur,Gi+=De[_r+1]*Ur,De[_r+4]=di,ye&&(ai||(ai=this._map(De,$e,!0),Yi=this.clusterProps.length,this.clusterProps.push(ai)),ye(ai,this._map(De,_r)))}De[$e+4]=di,Ne.push(oi/si,Gi/si,1/0,di,-1,si),ye&&Ne.push(Yi)}else{for(let ai=0;ai<We;ai++)Ne.push(De[$e+ai]);if(si>1)for(const ai of bt){const oi=ai*We;if(!(De[oi+2]<=J)){De[oi+2]=J;for(let Gi=0;Gi<We;Gi++)Ne.push(De[oi+Gi])}}}}return Ne}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,J,le){if(X[J+ht]>1){const Ce=this.clusterProps[X[J+Wt]];return le?Object.assign({},Ce):Ce}const ve=this.points[X[J+Pr]].properties,ye=this.options.map(ve);return le&&ye===ve?Object.assign({},ye):ye}}function ni(Ve,X,J){return{type:"Feature",id:Ve[X+Pr],properties:ge(Ve,X,J),geometry:{type:"Point",coordinates:[(le=Ve[X],360*(le-.5)),ze(Ve[X+1])]}};var le}function ge(Ve,X,J){const le=Ve[X+ht],ve=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,ye=Ve[X+Wt],Ce=ye===-1?{}:Object.assign({},J[ye]);return Object.assign(Ce,{cluster:!0,cluster_id:Ve[X+Pr],point_count:le,point_count_abbreviated:ve})}function nr(Ve){return Ve/360+.5}function Ae(Ve){const X=Math.sin(Ve*Math.PI/180),J=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return J<0?0:J>1?1:J}function ze(Ve){const X=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Se(Ve,X,J,le){let ve=le;const ye=X+(J-X>>1);let Ce,Fe=J-X;const De=Ve[X],Ne=Ve[X+1],We=Ve[J],$e=Ve[J+1];for(let nt=X+3;nt<J;nt+=3){const vt=wt(Ve[nt],Ve[nt+1],De,Ne,We,$e);if(vt>ve)Ce=nt,ve=vt;else if(vt===ve){const bt=Math.abs(nt-ye);bt<Fe&&(Ce=nt,Fe=bt)}}ve>le&&(Ce-X>3&&Se(Ve,X,Ce,le),Ve[Ce+2]=ve,J-Ce>3&&Se(Ve,Ce,J,le))}function wt(Ve,X,J,le,ve,ye){let Ce=ve-J,Fe=ye-le;if(Ce!==0||Fe!==0){const De=((Ve-J)*Ce+(X-le)*Fe)/(Ce*Ce+Fe*Fe);De>1?(J=ve,le=ye):De>0&&(J+=Ce*De,le+=Fe*De)}return Ce=Ve-J,Fe=X-le,Ce*Ce+Fe*Fe}function lt(Ve,X,J,le){const ve={id:Ve??null,type:X,geometry:J,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")Et(ve,J);else if(X==="Polygon")Et(ve,J[0]);else if(X==="MultiLineString")for(const ye of J)Et(ve,ye);else if(X==="MultiPolygon")for(const ye of J)Et(ve,ye[0]);return ve}function Et(Ve,X){for(let J=0;J<X.length;J+=3)Ve.minX=Math.min(Ve.minX,X[J]),Ve.minY=Math.min(Ve.minY,X[J+1]),Ve.maxX=Math.max(Ve.maxX,X[J]),Ve.maxY=Math.max(Ve.maxY,X[J+1])}function dt(Ve,X,J,le){if(!X.geometry)return;const ve=X.geometry.coordinates;if(ve&&ve.length===0)return;const ye=X.geometry.type,Ce=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let Fe=[],De=X.id;if(J.promoteId?De=X.properties[J.promoteId]:J.generateId&&(De=le||0),ye==="Point")Pt(ve,Fe);else if(ye==="MultiPoint")for(const Ne of ve)Pt(Ne,Fe);else if(ye==="LineString")Dt(ve,Fe,Ce,!1);else if(ye==="MultiLineString"){if(J.lineMetrics){for(const Ne of ve)Fe=[],Dt(Ne,Fe,Ce,!1),Ve.push(lt(De,"LineString",Fe,X.properties));return}It(ve,Fe,Ce,!1)}else if(ye==="Polygon")It(ve,Fe,Ce,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const Ne of X.geometry.geometries)dt(Ve,{id:De,geometry:Ne,properties:X.properties},J,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ne of ve){const We=[];It(Ne,We,Ce,!0),Fe.push(We)}}Ve.push(lt(De,ye,Fe,X.properties))}function Pt(Ve,X){X.push(hi(Ve[0]),$t(Ve[1]),0)}function Dt(Ve,X,J,le){let ve,ye,Ce=0;for(let De=0;De<Ve.length;De++){const Ne=hi(Ve[De][0]),We=$t(Ve[De][1]);X.push(Ne,We,0),De>0&&(Ce+=le?(ve*We-Ne*ye)/2:Math.sqrt(Math.pow(Ne-ve,2)+Math.pow(We-ye,2))),ve=Ne,ye=We}const Fe=X.length-3;X[2]=1,Se(X,0,Fe,J),X[Fe+2]=1,X.size=Math.abs(Ce),X.start=0,X.end=X.size}function It(Ve,X,J,le){for(let ve=0;ve<Ve.length;ve++){const ye=[];Dt(Ve[ve],ye,J,le),X.push(ye)}}function hi(Ve){return Ve/360+.5}function $t(Ve){const X=Math.sin(Ve*Math.PI/180),J=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return J<0?0:J>1?1:J}function gt(Ve,X,J,le,ve,ye,Ce,Fe){if(le/=X,ye>=(J/=X)&&Ce<le)return Ve;if(Ce<J||ye>=le)return null;const De=[];for(const Ne of Ve){const We=Ne.geometry;let $e=Ne.type;const nt=ve===0?Ne.minX:Ne.minY,vt=ve===0?Ne.maxX:Ne.maxY;if(nt>=J&&vt<le){De.push(Ne);continue}if(vt<J||nt>=le)continue;let bt=[];if($e==="Point"||$e==="MultiPoint")vi(We,bt,J,le,ve);else if($e==="LineString")Di(We,bt,J,le,ve,!1,Fe.lineMetrics);else if($e==="MultiLineString")Mi(We,bt,J,le,ve,!1);else if($e==="Polygon")Mi(We,bt,J,le,ve,!0);else if($e==="MultiPolygon")for(const ii of We){const si=[];Mi(ii,si,J,le,ve,!0),si.length&&bt.push(si)}if(bt.length){if(Fe.lineMetrics&&$e==="LineString"){for(const ii of bt)De.push(lt(Ne.id,$e,ii,Ne.tags));continue}$e!=="LineString"&&$e!=="MultiLineString"||(bt.length===1?($e="LineString",bt=bt[0]):$e="MultiLineString"),$e!=="Point"&&$e!=="MultiPoint"||($e=bt.length===3?"Point":"MultiPoint"),De.push(lt(Ne.id,$e,bt,Ne.tags))}}return De.length?De:null}function vi(Ve,X,J,le,ve){for(let ye=0;ye<Ve.length;ye+=3){const Ce=Ve[ye+ve];Ce>=J&&Ce<=le&&yr(X,Ve[ye],Ve[ye+1],Ve[ye+2])}}function Di(Ve,X,J,le,ve,ye,Ce){let Fe=rr(Ve);const De=ve===0?Vr:cn;let Ne,We,$e=Ve.start;for(let si=0;si<Ve.length-3;si+=3){const ai=Ve[si],oi=Ve[si+1],Gi=Ve[si+2],Yi=Ve[si+3],di=Ve[si+4],Wi=ve===0?ai:oi,_r=ve===0?Yi:di;let Ur=!1;Ce&&(Ne=Math.sqrt(Math.pow(ai-Yi,2)+Math.pow(oi-di,2))),Wi<J?_r>J&&(We=De(Fe,ai,oi,Yi,di,J),Ce&&(Fe.start=$e+Ne*We)):Wi>le?_r<le&&(We=De(Fe,ai,oi,Yi,di,le),Ce&&(Fe.start=$e+Ne*We)):yr(Fe,ai,oi,Gi),_r<J&&Wi>=J&&(We=De(Fe,ai,oi,Yi,di,J),Ur=!0),_r>le&&Wi<=le&&(We=De(Fe,ai,oi,Yi,di,le),Ur=!0),!ye&&Ur&&(Ce&&(Fe.end=$e+Ne*We),X.push(Fe),Fe=rr(Ve)),Ce&&($e+=Ne)}let nt=Ve.length-3;const vt=Ve[nt],bt=Ve[nt+1],ii=ve===0?vt:bt;ii>=J&&ii<=le&&yr(Fe,vt,bt,Ve[nt+2]),nt=Fe.length-3,ye&&nt>=3&&(Fe[nt]!==Fe[0]||Fe[nt+1]!==Fe[1])&&yr(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&X.push(Fe)}function rr(Ve){const X=[];return X.size=Ve.size,X.start=Ve.start,X.end=Ve.end,X}function Mi(Ve,X,J,le,ve,ye){for(const Ce of Ve)Di(Ce,X,J,le,ve,ye,!1)}function yr(Ve,X,J,le){Ve.push(X,J,le)}function Vr(Ve,X,J,le,ve,ye){const Ce=(ye-X)/(le-X);return yr(Ve,ye,J+(ve-J)*Ce,1),Ce}function cn(Ve,X,J,le,ve,ye){const Ce=(ye-J)/(ve-J);return yr(Ve,X+(le-X)*Ce,ye,1),Ce}function Yr(Ve,X){const J=[];for(let le=0;le<Ve.length;le++){const ve=Ve[le],ye=ve.type;let Ce;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ce=xn(ve.geometry,X);else if(ye==="MultiLineString"||ye==="Polygon"){Ce=[];for(const Fe of ve.geometry)Ce.push(xn(Fe,X))}else if(ye==="MultiPolygon"){Ce=[];for(const Fe of ve.geometry){const De=[];for(const Ne of Fe)De.push(xn(Ne,X));Ce.push(De)}}J.push(lt(ve.id,ye,Ce,ve.tags))}return J}function xn(Ve,X){const J=[];J.size=Ve.size,Ve.start!==void 0&&(J.start=Ve.start,J.end=Ve.end);for(let le=0;le<Ve.length;le+=3)J.push(Ve[le]+X,Ve[le+1],Ve[le+2]);return J}function Cs(Ve,X){if(Ve.transformed)return Ve;const J=1<<Ve.z,le=Ve.x,ve=Ve.y;for(const ye of Ve.features){const Ce=ye.geometry,Fe=ye.type;if(ye.geometry=[],Fe===1)for(let De=0;De<Ce.length;De+=2)ye.geometry.push(Kr(Ce[De],Ce[De+1],X,J,le,ve));else for(let De=0;De<Ce.length;De++){const Ne=[];for(let We=0;We<Ce[De].length;We+=2)Ne.push(Kr(Ce[De][We],Ce[De][We+1],X,J,le,ve));ye.geometry.push(Ne)}}return Ve.transformed=!0,Ve}function Kr(Ve,X,J,le,ve,ye){return[Math.round(J*(Ve*le-ve)),Math.round(J*(X*le-ye))]}function Or(Ve,X,J,le,ve){const ye=X===ve.maxZoom?0:ve.tolerance/((1<<X)*ve.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:Ve.length,source:null,x:J,y:le,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of Ve)uo(Ce,Fe,ye,ve);return Ce}function uo(Ve,X,J,le){const ve=X.geometry,ye=X.type,Ce=[];if(Ve.minX=Math.min(Ve.minX,X.minX),Ve.minY=Math.min(Ve.minY,X.minY),Ve.maxX=Math.max(Ve.maxX,X.maxX),Ve.maxY=Math.max(Ve.maxY,X.maxY),ye==="Point"||ye==="MultiPoint")for(let Fe=0;Fe<ve.length;Fe+=3)Ce.push(ve[Fe],ve[Fe+1]),Ve.numPoints++,Ve.numSimplified++;else if(ye==="LineString")zi(Ce,ve,Ve,J,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Fe=0;Fe<ve.length;Fe++)zi(Ce,ve[Fe],Ve,J,ye==="Polygon",Fe===0);else if(ye==="MultiPolygon")for(let Fe=0;Fe<ve.length;Fe++){const De=ve[Fe];for(let Ne=0;Ne<De.length;Ne++)zi(Ce,De[Ne],Ve,J,!0,Ne===0)}if(Ce.length){let Fe=X.tags||null;if(ye==="LineString"&&le.lineMetrics){Fe={};for(const Ne in X.tags)Fe[Ne]=X.tags[Ne];Fe.mapbox_clip_start=ve.start/ve.size,Fe.mapbox_clip_end=ve.end/ve.size}const De={geometry:Ce,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Fe};X.id!==null&&(De.id=X.id),Ve.features.push(De)}}function zi(Ve,X,J,le,ve,ye){const Ce=le*le;if(le>0&&X.size<(ve?Ce:le))return void(J.numPoints+=X.length/3);const Fe=[];for(let De=0;De<X.length;De+=3)(le===0||X[De+2]>Ce)&&(J.numSimplified++,Fe.push(X[De],X[De+1])),J.numPoints++;ve&&function(De,Ne){let We=0;for(let $e=0,nt=De.length,vt=nt-2;$e<nt;vt=$e,$e+=2)We+=(De[$e]-De[vt])*(De[$e+1]+De[vt+1]);if(We>0===Ne)for(let $e=0,nt=De.length;$e<nt/2;$e+=2){const vt=De[$e],bt=De[$e+1];De[$e]=De[nt-2-$e],De[$e+1]=De[nt-1-$e],De[nt-2-$e]=vt,De[nt-1-$e]=bt}}(Fe,ye),Ve.push(Fe)}const Ps={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gc{constructor(X,J){const le=(J=this.options=function(ye,Ce){for(const Fe in Ce)ye[Fe]=Ce[Fe];return ye}(Object.create(Ps),J)).debug;if(le&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let ve=function(ye,Ce){const Fe=[];if(ye.type==="FeatureCollection")for(let De=0;De<ye.features.length;De++)dt(Fe,ye.features[De],Ce,De);else dt(Fe,ye.type==="Feature"?ye:{geometry:ye},Ce);return Fe}(X,J);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=function(ye,Ce){const Fe=Ce.buffer/Ce.extent;let De=ye;const Ne=gt(ye,1,-1-Fe,Fe,0,-1,2,Ce),We=gt(ye,1,1-Fe,2+Fe,0,-1,2,Ce);return(Ne||We)&&(De=gt(ye,1,-Fe,1+Fe,0,-1,2,Ce)||[],Ne&&(De=Yr(Ne,1).concat(De)),We&&(De=De.concat(Yr(We,-1)))),De}(ve,J),ve.length&&this.splitTile(ve,0,0,0),le&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,J,le,ve,ye,Ce,Fe){const De=[X,J,le,ve],Ne=this.options,We=Ne.debug;for(;De.length;){ve=De.pop(),le=De.pop(),J=De.pop(),X=De.pop();const $e=1<<J,nt=qn(J,le,ve);let vt=this.tiles[nt];if(!vt&&(We>1&&console.time("creation"),vt=this.tiles[nt]=Or(X,J,le,ve,Ne),this.tileCoords.push({z:J,x:le,y:ve}),We)){We>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,le,ve,vt.numFeatures,vt.numPoints,vt.numSimplified),console.timeEnd("creation"));const Ur=`z${J}`;this.stats[Ur]=(this.stats[Ur]||0)+1,this.total++}if(vt.source=X,ye==null){if(J===Ne.indexMaxZoom||vt.numPoints<=Ne.indexMaxPoints)continue}else{if(J===Ne.maxZoom||J===ye)continue;if(ye!=null){const Ur=ye-J;if(le!==Ce>>Ur||ve!==Fe>>Ur)continue}}if(vt.source=null,X.length===0)continue;We>1&&console.time("clipping");const bt=.5*Ne.buffer/Ne.extent,ii=.5-bt,si=.5+bt,ai=1+bt;let oi=null,Gi=null,Yi=null,di=null,Wi=gt(X,$e,le-bt,le+si,0,vt.minX,vt.maxX,Ne),_r=gt(X,$e,le+ii,le+ai,0,vt.minX,vt.maxX,Ne);X=null,Wi&&(oi=gt(Wi,$e,ve-bt,ve+si,1,vt.minY,vt.maxY,Ne),Gi=gt(Wi,$e,ve+ii,ve+ai,1,vt.minY,vt.maxY,Ne),Wi=null),_r&&(Yi=gt(_r,$e,ve-bt,ve+si,1,vt.minY,vt.maxY,Ne),di=gt(_r,$e,ve+ii,ve+ai,1,vt.minY,vt.maxY,Ne),_r=null),We>1&&console.timeEnd("clipping"),De.push(oi||[],J+1,2*le,2*ve),De.push(Gi||[],J+1,2*le,2*ve+1),De.push(Yi||[],J+1,2*le+1,2*ve),De.push(di||[],J+1,2*le+1,2*ve+1)}}getTile(X,J,le){X=+X,J=+J,le=+le;const ve=this.options,{extent:ye,debug:Ce}=ve;if(X<0||X>24)return null;const Fe=1<<X,De=qn(X,J=J+Fe&Fe-1,le);if(this.tiles[De])return Cs(this.tiles[De],ye);Ce>1&&console.log("drilling down to z%d-%d-%d",X,J,le);let Ne,We=X,$e=J,nt=le;for(;!Ne&&We>0;)We--,$e>>=1,nt>>=1,Ne=this.tiles[qn(We,$e,nt)];return Ne&&Ne.source?(Ce>1&&(console.log("found parent tile z%d-%d-%d",We,$e,nt),console.time("drilling down")),this.splitTile(Ne.source,We,$e,nt,X,J,le),Ce>1&&console.timeEnd("drilling down"),this.tiles[De]?Cs(this.tiles[De],ye):null):null}}function qn(Ve,X,J){return 32*((1<<Ve)*J+X)+Ve}function Oo(Ve,X){const J=Ve.tileID.canonical;if(!this._geoJSONIndex)return void X(null,null);const le=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!le)return void X(null,null);const ve=new yi(le.features);let ye=Xr(ve);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),X(null,{vectorTile:ve,rawData:ye.buffer})}class ml extends St{constructor(X,J,le,ve,ye,Ce){super(X,J,le,ve,Oo,Ce),ye&&(this.loadGeoJSON=ye),this._dynamicIndex=new lr}loadData(X,J){const le=X&&X.request,ve=le&&le.collectResourceTiming;this.loadGeoJSON(X,(ye,Ce)=>{if(ye||!Ce)return J(ye);if(typeof Ce!="object")return J(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{try{if(X.filter){const De=s.M(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(Ne=>`${Ne.key}: ${Ne.message}`).join(", "));Ce.features=Ce.features.filter(Ne=>De.value.evaluate({zoom:0},Ne))}X.dynamic?(Ce.type==="Feature"&&(Ce={type:"FeatureCollection",features:[Ce]}),X.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ce.features,this.loaded),X.cluster&&(Ce.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=X.cluster?new jt(function({superclusterOptions:De,clusterProperties:Ne}){if(!Ne||!De)return De;const We={},$e={},nt={accumulated:null,zoom:0},vt={properties:null},bt=Object.keys(Ne);for(const ii of bt){const[si,ai]=Ne[ii],oi=s.M(ai),Gi=s.M(typeof si=="string"?[si,["accumulated"],["get",ii]]:si);We[ii]=oi.value,$e[ii]=Gi.value}return De.map=ii=>{vt.properties=ii;const si={};for(const ai of bt)si[ai]=We[ai].evaluate(nt,vt);return si},De.reduce=(ii,si)=>{vt.properties=si;for(const ai of bt)nt.accumulated=ii[ai],ii[ai]=$e[ai].evaluate(nt,vt)},De}(X)).load(Ce.features):X.dynamic?this._dynamicIndex:function(De,Ne){return new gc(De,Ne)}(Ce,X.geojsonVtOptions)}catch(De){return J(De)}const Fe={};if(ve){const De=ce(le);De&&(Fe.resourceTiming={},Fe.resourceTiming[X.source]=JSON.parse(JSON.stringify(De)))}J(null,Fe)}})}reloadTile(X,J){const le=this.loaded;return le&&le[X.uid]?X.partial?J(null,void 0):super.reloadTile(X,J):this.loadTile(X,J)}loadGeoJSON(X,J){if(X.request)s.n(X.request,J);else{if(typeof X.data!="string")return J(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(X.data))}catch{return J(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(le){J(le)}}getClusterChildren(X,J){try{J(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(le){J(le)}}getClusterLeaves(X,J){try{J(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(le){J(le)}}}class sa{constructor(X,J){this.tileID=new s.aA(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=X.projection,this.brightness=J}parse(X,J,le,ve){this.status="parsing";const ye=new s.aA(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),Ce={},Fe=J.familiesBySource[le.source],De=new s.dR(ye,le.promoteId);return De.bucketLayerIDs=[],De.is3DTile=!0,s.e0(X).then(Ne=>{if(!Ne)return ve(new Error("Could not parse tile"));const We=s.e1(Ne,1/s.c8(le.tileID.canonical)),$e=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ne.json.asset.extras&&Ne.json.asset.extras.MAPBOX_mesh_features,nt=Ne.json.extensionsUsed&&Ne.json.extensionsUsed.includes("EXT_meshopt_compression"),vt=new s.a3(this.zoom,{brightness:this.brightness});for(const bt in Fe)for(const ii of Fe[bt]){const si=ii[0];De.bucketLayerIDs.push(ii.map(oi=>oi.id)),si.recalculate(vt,[]);const ai=new s.e2(We,ye,$e,nt,this.brightness,De);$e||(ai.needsUpload=!0),Ce[si.fqid]=ai,ai.evaluate(si)}this.status="done",ve(null,{buckets:Ce,featureIndex:De})}).catch(Ne=>ve(new Error(Ne.message)))}}class _l{constructor(X,J,le,ve,ye,Ce){this.actor=X,this.layerIndex=J,this.brightness=Ce,this.loading={},this.loaded={}}loadTile(X,J){const le=X.uid,ve=this.loading[le]=new sa(X,this.brightness);s.bc(X.request,(ye,Ce)=>{const Fe=!this.loading[le];return delete this.loading[le],Fe||ye?(ve.status="done",Fe||(this.loaded[le]=ve),J(ye)):Ce&&Ce.byteLength!==0?void ve.parse(Ce,this.layerIndex,X,(De,Ne)=>{ve.status="done",this.loaded=this.loaded||{},this.loaded[le]=ve,De||!Ne?J(De):J(null,Ne)}):(ve.status="done",this.loaded[le]=ve,J())})}reloadTile(X,J){const le=this.loaded,ve=X.uid;if(le&&le[ve]){const ye=le[ve];ye.projection=X.projection,ye.brightness=X.brightness;const Ce=(Fe,De)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(X,J)),J(Fe,De)};ye.status==="parsing"?ye.reloadCallback=Ce:ye.status==="done"&&this.loadTile(X,J)}}abortTile(X,J){const le=X.uid;this.loading[le]&&delete this.loading[le],J()}removeTile(X,J){const le=this.loaded,ve=X.uid;le&&le[ve]&&delete le[ve],J()}}class Bo{constructor(X){this.self=X,this.actor=new s.e3(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.bL({name:"mercator"}),this.workerSourceTypes={vector:St,geojson:ml,"batched-model":_l},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,le)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=le},this.self.registerRTLTextPlugin=J=>{if(s.e4.isParsed())throw new Error("RTL text plugin already registered.");s.e4.applyArabicShaping=J.applyArabicShaping,s.e4.processBidirectionalText=J.processBidirectionalText,s.e4.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches(X,J,le){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],delete this.rasterArrayWorkerSource,le()}checkIfReady(X,J,le){le()}setReferrer(X,J){this.referrer=J}spriteLoaded(X,{scope:J,isLoaded:le}){if(this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),this.isSpriteLoaded[X][J]=le,this.workerSources[X]&&this.workerSources[X][J])for(const ve in this.workerSources[X][J]){const ye=this.workerSources[X][J][ve];for(const Ce in ye){const Fe=ye[Ce];Fe instanceof St&&(Fe.isSpriteLoaded=le,Fe.fire(new s.x("isSpriteLoaded")))}}}setImages(X,{scope:J,images:le},ve){if(this.availableImages[X]||(this.availableImages[X]={}),this.availableImages[X][J]=le,this.workerSources[X]&&this.workerSources[X][J]){for(const ye in this.workerSources[X][J]){const Ce=this.workerSources[X][J][ye];for(const Fe in Ce)Ce[Fe].availableImages=le}ve()}else ve()}setProjection(X,J){this.projections[X]=s.bL(J)}setBrightness(X,J,le){this.brightness=J,le()}setLayers(X,J,le){this.getLayerIndex(X,J.scope).replace(J.layers,J.options),le()}updateLayers(X,J,le){this.getLayerIndex(X,J.scope).update(J.layers,J.removedIds,J.options),le()}loadTile(X,J,le){J.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,J.type,J.source,J.scope).loadTile(J,le)}loadDEMTile(X,J,le){this.getDEMWorkerSource(X,J.source,J.scope).loadTile(J,le)}decodeRasterArray(X,J,le){this.getRasterArrayWorkerSource().decodeRasterArray(J,le)}reloadTile(X,J,le){J.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,J.type,J.source,J.scope).reloadTile(J,le)}abortTile(X,J,le){this.getWorkerSource(X,J.type,J.source,J.scope).abortTile(J,le)}removeTile(X,J,le){this.getWorkerSource(X,J.type,J.source,J.scope).removeTile(J,le)}removeSource(X,J,le){if(!(this.workerSources[X]&&this.workerSources[X][J.scope]&&this.workerSources[X][J.scope][J.type]&&this.workerSources[X][J.scope][J.type][J.source]))return;const ve=this.workerSources[X][J.scope][J.type][J.source];delete this.workerSources[X][J.scope][J.type][J.source],ve.removeSource!==void 0?ve.removeSource(J,le):le()}loadWorkerSource(X,J,le){try{this.self.importScripts(J.url),le()}catch(ve){le(ve.toString())}}syncRTLPluginState(X,J,le){try{s.e4.setState(J);const ve=s.e4.getPluginURL();if(s.e4.isLoaded()&&!s.e4.isParsed()&&ve!=null){this.self.importScripts(ve);const ye=s.e4.isParsed();le(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),ye)}}catch(ve){le(ve.toString())}}setDracoUrl(X,J){this.dracoUrl=J}getAvailableImages(X,J){this.availableImages[X]||(this.availableImages[X]={});let le=this.availableImages[X][J];return le||(le=[]),le}getLayerIndex(X,J){this.layerIndexes[X]||(this.layerIndexes[X]={});let le=this.layerIndexes[X][J];return le||(le=this.layerIndexes[X][J]=new ke,le.scope=J),le}getWorkerSource(X,J,le,ve){return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][ve]||(this.workerSources[X][ve]={}),this.workerSources[X][ve][J]||(this.workerSources[X][ve][J]={}),this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),this.workerSources[X][ve][J][le]||(this.workerSources[X][ve][J][le]=new this.workerSourceTypes[J]({send:(ye,Ce,Fe,De,Ne,We)=>{this.actor.send(ye,Ce,Fe,X,Ne,We)},scheduler:this.actor.scheduler},this.getLayerIndex(X,ve),this.getAvailableImages(X,ve),this.isSpriteLoaded[X][ve],void 0,this.brightness)),this.workerSources[X][ve][J][le]}getDEMWorkerSource(X,J,le){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][le]||(this.demWorkerSources[X][le]={}),this.demWorkerSources[X][le][J]||(this.demWorkerSources[X][le][J]=new _t),this.demWorkerSources[X][le][J]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new zt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(X,J){s.e5(J)}getWorkerPerformanceMetrics(X,J,le){le(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Bo(self)),Bo}),$(["./shared"],function(s){var ce="3.7.0";const pe={create:"create",load:"load",fullLoad:"fullLoad"},me={mark(l){performance.mark(l)},measure(l,t,r){performance.measure(l,t,r)}};function ke(l){const t=l.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var qe,it={},et=function(){if(qe)return it;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,S=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(S);try{y=new Worker(I),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(I),m}()?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var S=y.getImageData(0,0,1,1);return S&&S.width===m.width}()?(r[f=c&&c.failIfMajorPerformanceCaveat]===void 0&&(r[f]=function(m){var y,S=function(I){var P=document.createElement("canvas"),L=Object.create(l.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=I,P.getContext("webgl2",L)}(m);if(!S)return!1;try{y=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!y||S.isContextLost())&&(S.shaderSource(y,"void main() {}"),S.compileShader(y),S.getShaderParameter(y,S.COMPILE_STATUS)===!0)}(f)),r[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}qe=1,it.supported=l,it.notSupportedReason=t;var r={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},it}();function ct(l,t,r){const c=document.createElement(l);return t!=null&&(c.className=t),r&&r.appendChild(c),c}function St(l,t,r){const c=document.createElementNS("http://www.w3.org/2000/svg",l);for(const f of Object.keys(t))c.setAttributeNS(null,f,String(t[f]));return r&&r.appendChild(c),c}const _t=typeof document<"u"?document.documentElement&&document.documentElement.style:null,zt=_t&&_t.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Gt;function Rt(){_t&&zt&&(Gt=_t[zt],_t[zt]="none")}function yi(){_t&&zt&&(_t[zt]=Gt)}function Ti(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Ti,!0)}function kt(){window.addEventListener("click",Ti,!0),window.setTimeout(()=>{window.removeEventListener("click",Ti,!0)},0)}function lr(l,t){const r=l.getBoundingClientRect();return Xt(l,r,t)}function Sr(l,t){const r=l.getBoundingClientRect(),c=[];for(let f=0;f<t.length;f++)c.push(Xt(l,r,t[f]));return c}function qt(l){return window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function Xt(l,t,r){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new s.P((r.clientX-t.left)*c,(r.clientY-t.top)*c)}const sn="01",Cn="NO_ACCESS_TOKEN";class hs{constructor(t,r,c){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let c=0;c<10;c++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",sn,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!s.f(t))return t;const c=Li(t);return c.params.push(`sdk=js-${ce}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!s.f(t))return t;const c=Li(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeModelURL(t,r){if(!s.f(t))return t;const c=Li(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeSourceURL(t,r,c,f){if(!s.f(t))return t;const m=Li(t);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),c&&m.params.push(`language=${c}`),f&&m.params.push(`worldview=${f}`),this._makeAPIURL(m,this._customAccessToken||r)}normalizeSpriteURL(t,r,c,f){const m=Li(t);return s.f(t)?(m.path=`/styles/v1${m.path}/sprite${r}${c}`,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=`${r}${c}`,Vi(m))}normalizeTileURL(t,r,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.f(t))return t;const f=Li(t);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||c&&f.authority!=="raster"&&c===512?"@2x":""}${s.m.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${s.e.RASTER_URL_PREFIX}${f.path}`:f.authority==="rasterarrays"?f.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${f.path}`:f.authority==="3dtiles"?f.path=`/${s.e.TILES3D_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${s.e.TILE_URL_VERSION}${f.path}`);const m=this._customAccessToken||function(y){for(const S of y){const I=S.match(/^access_token=(.*)$/);if(I)return I[1]}return null}(f.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,m)}canonicalizeTileURL(t,r){const c=Li(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let f="mapbox://";c.path.match(/^\/raster\/v1\//)?f+=`raster/${c.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?f+=`rasterarrays/${c.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:f+=`tiles/${c.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let m=c.params;return r&&(m=m.filter(y=>!y.match(/^access_token=/))),m.length&&(f+=`?${m.join("&")}`),f}canonicalizeTileset(t,r){const c=!!r&&s.f(r),f=[];for(const m of t.tiles||[])s.h(m)?f.push(this.canonicalizeTileURL(m,c)):f.push(m);return f}_makeAPIURL(t,r){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=Li(s.e.API_URL);if(t.protocol=f.protocol,t.authority=f.authority,t.protocol==="http"){const m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(f.path!=="/"&&(t.path=`${f.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Vi(t);if(r=r||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter(m=>m.indexOf("access_token")===-1),t.params.push(`access_token=${r||""}`),Vi(t)}}const Ht=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Li(l){const t=l.match(Ht);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Vi(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const pn="mapbox.eventData";function Qt(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.j(t[1]))}catch{return null}}class on{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=Qt(s.e.ACCESS_TOKEN);let c="";return c=r&&r.u?s.k(r.u):s.e.ACCESS_TOKEN||"",t?`${pn}.${t}:${c}`:`${pn}:${c}`}fetchEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const f=localStorage.getItem(r);f&&(this.eventData=JSON.parse(f));const m=localStorage.getItem(c);m&&(this.anonId=m)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid"),f=this.anonId;if(t&&f)try{localStorage.setItem(c,f),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,c,f){if(!s.e.EVENTS_URL)return;const m=Li(s.e.EVENTS_URL);m.params.push(`access_token=${f||s.e.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},S=r?s.l(y,r):y,I={url:Vi(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=s.p(I,P=>{this.pendingRequest=null,c(P),this.saveEventData(),this.processRequests(f)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Xr=new class extends on{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(r=>s.f(r)||s.h(r))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Qt(s.e.ACCESS_TOKEN),r=t?t.u:s.e.ACCESS_TOKEN;let c=r!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(f),S=(f-this.eventData.lastSuccess)/864e5;c=c||S>=1||S<-1||m.getDate()!==y.getDate()}else c=!0;c?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:sn,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=f,this.eventData.tokenU=r)},l):this.processRequests()}},Gn=Xr.postTurnstileEvent.bind(Xr),Jt=new class extends on{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,r,c){this.skuToken=t,this.errorCb=c,s.e.EVENTS_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},r):this.errorCb(new Error(Cn)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:sn,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},Is=Jt.postMapLoadEvent.bind(Jt),Pr=new class extends on{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=s.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:r,style:c,importedStyles:f}=t;if(!s.e.EVENTS_URL||!l&&!s.e.ACCESS_TOKEN)return;const m=this.getMapInstanceId(r),y={mapInstanceId:m,eventId:this.getEventId(m),style:c};f.length&&(y.importedStyles=f),this.queueRequest({timestamp:Date.now(),payload:y},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},l)}},ht=Pr.postStyleLoadEvent.bind(Pr),Wt=new class extends on{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){s.e.EVENTS_URL&&(l||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),c=function(f){const m=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),S=function(N){const q={};if(N){for(const Z in N)if(Z!=="other")for(const H of N[Z]){const W=`${Z}ResolveRangeMin`,ie=`${Z}ResolveRangeMax`,ne=`${Z}RequestCount`,ee=`${Z}RequestCachedCount`;q[W]=Math.min(q[W]||1/0,H.startTime),q[ie]=Math.max(q[ie]||-1/0,H.responseEnd);const ae=oe=>{q[oe]===void 0&&(q[oe]=0),++q[oe]};H.transferSize!==void 0&&H.transferSize===0&&ae(ee),ae(ne)}}return q}(function(N,q){const Z={};if(N)for(const H of N){const W=q(H);Z[W]===void 0&&(Z[W]=[]),Z[W].push(H)}return Z}(m,ke)),I=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=P?P.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},B=(N,q,Z)=>{Z!=null&&N.push({name:q,value:Z.toString()})};for(const N in S)B(k.counters,N,S[N]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(B(k.counters,"interactionRangeMin",f.interactionRange[0]),B(k.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const N of Object.keys(pe)){const q=pe[N],Z=y.find(H=>H.name===q);Z&&B(k.counters,q,Z.startTime)}return B(k.counters,"visibilityHidden",f.visibilityHidden),B(k.attributes,"style",function(N){if(N)for(const q of N){const Z=q.name.split("?")[0];if(s.i(Z)){const H=Z.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}}(m)),B(k.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),B(k.attributes,"fogEnabled",f.fogEnabled?"true":"false"),B(k.attributes,"projection",f.projection),B(k.attributes,"zoom",f.zoom),B(k.metadata,"devicePixelRatio",I),B(k.metadata,"connectionEffectiveType",L),B(k.metadata,"navigatorUserAgent",navigator.userAgent),B(k.metadata,"screenWidth",window.screen.width),B(k.metadata,"screenHeight",window.screen.height),B(k.metadata,"windowWidth",window.innerWidth),B(k.metadata,"windowHeight",window.innerHeight),B(k.metadata,"mapWidth",f.width/I),B(k.metadata,"mapHeight",f.height/I),B(k.metadata,"webglRenderer",f.renderer),B(k.metadata,"webglVendor",f.vendor),B(k.metadata,"sdkVersion",ce),B(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(r);for(const f of c.metadata);for(const f of c.counters);for(const f of c.attributes);this.postEvent(t,c,()=>{},l)}},jt=Wt.postPerformanceEvent.bind(Wt),ni=new class extends on{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,r,c){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const f=Li(s.e.API_URL+s.e.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${c||s.e.ACCESS_TOKEN||""}`);const m={url:Vi(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(m,y=>{this.pendingRequest=null,r(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(l,t,r,c){this.skuToken=t,this.errorCb=c,s.e.SESSION_PATH&&s.e.API_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},r):this.errorCb(new Error(Cn)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},ge=ni.getSessionAPI.bind(ni),nr=new Set;function Ae(l,t){t?nr.add(l):nr.delete(l)}class ze{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Se(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class wt extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new s.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,r){if(this.loaded[r]!==t&&(this.loaded[r]=t,t)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,r,f);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images[r][t]}addImage(t,r,c){this._validate(t,c)&&(this.images[r][t]=c)}_validate(t,r){let c=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new s.t(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new s.t(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new s.t(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,r){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||r<f[1])return!1;c=f[1]}return!0}_validateContent(t,r){return!(t&&(t.length!==4||t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,r,c){c.version=this.images[r][t].version+1,this.images[r][t]=c,this.updatedImages[r][t]=!0}removeImage(t,r){const c=this.images[r][t];delete this.images[r][t],delete this.patterns[r][t],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,r,c){let f=!0;const m=!!this.loaded[r];if(!m)for(const y of t)this.images[r][y]||(f=!1);m||f?this._notify(t,r,c):this.requestors.push({ids:t,scope:r,callback:c})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,r,c){const f={};for(const m of t){this.images[r][m]||this.fire(new s.x("styleimagemissing",{id:m}));const y=this.images[r][m];y?f[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:s.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,f)}getPixelSize(t){const{width:r,height:c}=this.atlasImage[t];return{width:r,height:c}}getPattern(t,r,c){const f=this.patterns[r][t],m=this.getImage(t,r);if(!m)return null;if(f&&f.position.version===m.version)return f.position;if(f)f.position.version=m.version;else{const y={w:m.data.width+2*s.y,h:m.data.height+2*s.y,x:0,y:0},S=new s.I(y,m,s.y);this.patterns[r][t]={bin:y,position:S}}return this._updatePatternAtlas(r,c),this.patterns[r][t].position}bind(t,r){const c=t.gl;let f=this.atlasTexture[r];f?this.dirty&&(f.update(this.atlasImage[r]),this.dirty=!1):(f=new s.T(t,this.atlasImage[r],c.RGBA8),this.atlasTexture[r]=f),f.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const c=[];for(const S in this.patterns[t])c.push(this.patterns[t][S].bin);const{w:f,h:m}=s.z(c),y=this.atlasImage[t];y.resize({width:f||1,height:m||1});for(const S in this.patterns[t]){const{bin:I,position:P}=this.patterns[t][S];let L=P.padding;const k=I.x+L,B=I.y+L,N=this.images[t][S].data,q=N.width,Z=N.height;L=L>1?L-1:L,s.r.copy(N,y,{x:0,y:0},{x:k,y:B},{width:q,height:Z},r),s.r.copy(N,y,{x:0,y:Z-L},{x:k,y:B-L},{width:q,height:L},r),s.r.copy(N,y,{x:0,y:0},{x:k,y:B+Z},{width:q,height:L},r),s.r.copy(N,y,{x:q-L,y:0},{x:k-L,y:B},{width:L,height:Z},r),s.r.copy(N,y,{x:0,y:0},{x:k+q,y:B},{width:L,height:Z},r),s.r.copy(N,y,{x:q-L,y:Z-L},{x:k-L,y:B-L},{width:L,height:L},r),s.r.copy(N,y,{x:0,y:Z-L},{x:k+q,y:B-L},{width:L,height:L},r),s.r.copy(N,y,{x:0,y:0},{x:k+q,y:B+Z},{width:L,height:L},r),s.r.copy(N,y,{x:q-L,y:0},{x:k-L,y:B+Z},{width:L,height:L},r)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,r){for(const c of t){if(this.callbackDispatchedThisFrame[r][c])continue;this.callbackDispatchedThisFrame[r][c]=!0;const f=this.images[r][c];Se(f)&&this.updateImage(c,r,f)}}}function lt(l){const t=l.key,r=l.value,c=l.valueSpec||{},f=l.objectElementValidators||{},m=l.style,y=l.styleSpec;let S=[];const I=s.B(r);if(I!=="object")return[new s.V(t,r,`object expected, ${I} found`)];for(const P in r){const L=P.split(".")[0];let k;f[L]?k=f[L]:c[L]?k=zi:f["*"]?k=f["*"]:c["*"]&&(k=zi),k?S=S.concat(k({key:(t&&`${t}.`)+P,value:r[P],valueSpec:c[L]||c["*"],style:m,styleSpec:y,object:r,objectKey:P},r)):S.push(new s.A(t,r[P],`unknown property "${P}"`))}for(const P in c)f[P]||c[P].required&&c[P].default===void 0&&r[P]===void 0&&S.push(new s.V(t,r,`missing required property "${P}"`));return S}function Et(l){const t=l.value,r=l.valueSpec,c=l.style,f=l.styleSpec,m=l.key,y=l.arrayElementValidator||zi;if(s.B(t)!=="array")return[new s.V(m,t,`array expected, ${s.B(t)} found`)];if(r.length&&t.length!==r.length)return[new s.V(m,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new s.V(m,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let S={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};f.$version<7&&(S.function=r.function),s.B(r.value)==="object"&&(S=r.value);let I=[];for(let P=0;P<t.length;P++)I=I.concat(y({array:t,arrayIndex:P,value:t[P],valueSpec:S,style:c,styleSpec:f,key:`${m}[${P}]`},!0));return I}function dt(l){const t=l.key,r=l.value,c=l.valueSpec;let f=s.B(r);if(f==="number"&&r!=r&&(f="NaN"),f!=="number")return[new s.V(t,r,`number expected, ${f} found`)];if("minimum"in c){let m=c.minimum;if(s.B(c.minimum)==="array"&&(m=c.minimum[l.arrayIndex]),r<m)return[new s.V(t,r,`${r} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if(s.B(c.maximum)==="array"&&(m=c.maximum[l.arrayIndex]),r>m)return[new s.V(t,r,`${r} is greater than the maximum value ${m}`)]}return[]}function Pt(l){const t=l.valueSpec,r=s.D(l.value.type);let c,f,m,y={};const S=r!=="categorical"&&l.value.property===void 0,I=!S,P=s.B(l.value.stops)==="array"&&s.B(l.value.stops[0])==="array"&&s.B(l.value.stops[0][0])==="object",L=lt({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(N){if(r==="identity")return[new s.V(N.key,N.value,'identity function may not have a "stops" property')];let q=[];const Z=N.value;return q=q.concat(Et({key:N.key,value:Z,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:k})),s.B(Z)==="array"&&Z.length===0&&q.push(new s.V(N.key,Z,"array must have at least one stop")),q},default:function(N){return zi({key:N.key,value:N.value,valueSpec:t,style:N.style,styleSpec:N.styleSpec})}}});return r==="identity"&&S&&L.push(new s.V(l.key,l.value,'missing required property "property"')),r==="identity"||l.value.stops||L.push(new s.V(l.key,l.value,'missing required property "stops"')),r==="exponential"&&l.valueSpec.expression&&!s.F(l.valueSpec)&&L.push(new s.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(I&&!s.G(l.valueSpec)?L.push(new s.V(l.key,l.value,"property functions not supported")):S&&!s.H(l.valueSpec)&&L.push(new s.V(l.key,l.value,"zoom functions not supported"))),r!=="categorical"&&!P||l.value.property!==void 0||L.push(new s.V(l.key,l.value,'"property" property is required')),L;function k(N){let q=[];const Z=N.value,H=N.key;if(s.B(Z)!=="array")return[new s.V(H,Z,`array expected, ${s.B(Z)} found`)];if(Z.length!==2)return[new s.V(H,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if(s.B(Z[0])!=="object")return[new s.V(H,Z,`object expected, ${s.B(Z[0])} found`)];if(Z[0].zoom===void 0)return[new s.V(H,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new s.V(H,Z,"object stop key must have value")];const W=s.D(Z[0].zoom);if(typeof W!="number")return[new s.V(H,Z[0].zoom,"stop zoom values must be numbers")];if(m&&m>W)return[new s.V(H,Z[0].zoom,"stop zoom values must appear in ascending order")];W!==m&&(m=W,f=void 0,y={}),q=q.concat(lt({key:`${H}[0]`,value:Z[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:dt,value:B}}))}else q=q.concat(B({key:`${H}[0]`,value:Z[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},Z));return s.J(s.K(Z[1]))?q.concat([new s.V(`${H}[1]`,Z[1],"expressions are not allowed in function stops.")]):q.concat(zi({key:`${H}[1]`,value:Z[1],valueSpec:t,style:N.style,styleSpec:N.styleSpec}))}function B(N,q){const Z=s.B(N.value),H=s.D(N.value),W=N.value!==null?N.value:q;if(c){if(Z!==c)return[new s.V(N.key,W,`${Z} stop domain type must match previous stop domain type ${c}`)]}else c=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new s.V(N.key,W,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&r!=="categorical"){let ie=`number expected, ${Z} found`;return s.G(t)&&r===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(N.key,W,ie)]}return r!=="categorical"||Z!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?r!=="categorical"&&Z==="number"&&typeof H=="number"&&typeof f=="number"&&f!==void 0&&H<f?[new s.V(N.key,W,"stop domain values must appear in ascending order")]:(f=H,r==="categorical"&&H in y?[new s.V(N.key,W,"stop domain values must be unique")]:(y[H]=!0,[])):[new s.V(N.key,W,`integer expected, found ${String(H)}`)]}}function Dt(l){const t=(l.expressionContext==="property"?s.L:s.M)(s.K(l.value),l.valueSpec);if(t.result==="error")return t.value.map(c=>new s.V(`${l.key}${c.key}`,l.value,c.message));const r=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!r.outputDefined())return[new s.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!s.N(r))return[new s.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return It(r,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!s.O(r,["zoom","feature-state"]))return[new s.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!s.Q(r))return[new s.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function It(l,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const f of t.valueSpec.expression.parameters)r.delete(f);if(r.size===0)return[];const c=[];return l instanceof s.S&&r.has(l.name)?[new s.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(f=>{c.push(...It(f,t))}),c)}function hi(l){const t=l.key,r=l.value,c=l.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(s.D(r))===-1&&f.push(new s.V(t,r,`expected one of [${c.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(c.values).indexOf(s.D(r))===-1&&f.push(new s.V(t,r,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(r)} found`)),f}function $t(l){return s.W(s.K(l.value))?Dt(s.C({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):gt(l)}function gt(l){const t=l.value,r=l.key;if(s.B(t)!=="array")return[new s.V(r,t,`array expected, ${s.B(t)} found`)];const c=l.styleSpec;let f,m=[];if(t.length<1)return[new s.V(r,t,"filter array must have at least 1 element")];switch(m=m.concat(hi({key:`${r}[0]`,value:t[0],valueSpec:c.filter_operator,style:l.style,styleSpec:l.styleSpec})),s.D(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.D(t[1])==="$type"&&m.push(new s.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new s.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=s.B(t[1]),f!=="string"&&m.push(new s.V(`${r}[1]`,t[1],`string expected, ${f} found`)));for(let y=2;y<t.length;y++)f=s.B(t[y]),s.D(t[1])==="$type"?m=m.concat(hi({key:`${r}[${y}]`,value:t[y],valueSpec:c.geometry_type,style:l.style,styleSpec:l.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&m.push(new s.V(`${r}[${y}]`,t[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)m=m.concat(gt({key:`${r}[${y}]`,value:t[y],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":f=s.B(t[1]),t.length!==2?m.push(new s.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&m.push(new s.V(`${r}[1]`,t[1],`string expected, ${f} found`))}return m}function vi(l,t){const r=l.key,c=l.style,f=l.layer,m=l.styleSpec,y=l.value,S=l.objectKey,I=m[`${t}_${l.layerType}`];if(!I)return[];const P=S.match(/^(.*)-transition$/);if(t==="paint"&&P&&I[P[1]]&&I[P[1]].transition)return zi({key:r,value:y,valueSpec:m.transition,style:c,styleSpec:m});const L=l.valueSpec||I[S];if(!L)return[new s.A(r,y,`unknown property "${S}"`)];let k;if(s.B(y)==="string"&&s.G(L)&&!L.tokens&&(k=/^{([^}]+)}$/.exec(y))){const N=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new s.V(r,y,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}const B=[];if(l.layerType==="symbol")S!=="text-field"||!c||c.glyphs||c.imports||B.push(new s.V(r,y,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&s.X(s.K(y))&&s.D(y.type)==="identity"&&B.push(new s.V(r,y,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&s.G(L)&&(s.Y(L)||s.H(L))){const N=s.L(s.K(y),L),q=N.value.expression||N.value._styleExpression.expression;q&&!s.O(q,["measure-light"])&&(S==="model-emissive-strength"&&s.Q(q)&&s.N(q)||B.push(new s.V(r,y,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(zi({key:l.key,value:y,valueSpec:L,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:S}))}function Di(l){return vi(l,"paint")}function rr(l){return vi(l,"layout")}function Mi(l){let t=[];const r=l.value,c=l.key,f=l.style,m=l.styleSpec;r.type||r.ref||t.push(new s.V(c,r,'either "type" or "ref" is required'));let y=s.D(r.type);const S=s.D(r.ref);if(r.id){const I=s.D(r.id);for(let P=0;P<l.arrayIndex;P++){const L=f.layers[P];s.D(L.id)===I&&t.push(new s.V(c,r.id,`duplicate layer id "${r.id}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let I;["type","source","source-layer","filter","layout"].forEach(P=>{P in r&&t.push(new s.V(c,r[P],`"${P}" is prohibited for ref layers`))}),f.layers.forEach(P=>{s.D(P.id)===S&&(I=P)}),I?I.ref?t.push(new s.V(c,r.ref,"ref cannot reference another ref layer")):y=s.D(I.type):typeof S=="string"&&t.push(new s.V(c,r.ref,`ref layer "${S}" not found`))}else if(y!=="background"&&y!=="sky"&&y!=="slot")if(r.source){const I=f.sources&&f.sources[r.source],P=I&&s.D(I.type);I?P==="vector"&&y==="raster"?t.push(new s.V(c,r.source,`layer "${r.id}" requires a raster source`)):P==="raster"&&y!=="raster"?t.push(new s.V(c,r.source,`layer "${r.id}" requires a vector source`)):P!=="vector"||r["source-layer"]?P==="raster-dem"&&y!=="hillshade"?t.push(new s.V(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(y)?y!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||P==="geojson"&&I.lineMetrics?y==="raster-particle"&&P!=="raster-array"&&t.push(new s.V(c,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new s.V(c,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new s.V(c,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(c,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new s.V(c,r.source,`source "${r.source}" not found`))}else t.push(new s.V(c,r,'missing required property "source"'));return t=t.concat(lt({key:c,value:r,valueSpec:m.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zi({key:`${c}.type`,value:r.type,valueSpec:m.layer.type,style:l.style,styleSpec:l.styleSpec,object:r,objectKey:"type"}),filter:I=>$t(s.C({layerType:y},I)),layout:I=>lt({layer:r,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":P=>rr(s.C({layerType:y},P))}}),paint:I=>lt({layer:r,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":P=>Di(s.C({layerType:y,layer:r},P))}})}})),t}function yr(l){const t=l.value,r=l.key,c=s.B(t);return c!=="string"?[new s.V(r,t,`string expected, ${c} found`)]:[]}const Vr={promoteId:function({key:l,value:t}){if(s.B(t)==="string")return yr({key:l,value:t});{const r=[];for(const c in t)r.push(...yr({key:`${l}.${c}`,value:t[c]}));return r}}};function cn(l){const t=l.value,r=l.key,c=l.styleSpec,f=l.style;if(!t.type)return[new s.V(r,t,'"type" is required')];const m=s.D(t.type);let y=[];switch(["vector","raster","raster-dem","raster-array"].includes(m)&&(t.url||t.tiles||y.push(new s.A(r,t,'Either "url" or "tiles" is required.'))),m){case"vector":case"raster":case"raster-dem":case"raster-array":return y=y.concat(lt({key:r,value:t,valueSpec:c[`source_${m.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:Vr})),y;case"geojson":if(y=lt({key:r,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Vr}),t.cluster)for(const S in t.clusterProperties){const[I,P]=t.clusterProperties[S],L=typeof I=="string"?[I,["accumulated"],["get",S]]:I;y.push(...Dt({key:`${r}.${S}.map`,value:P,expressionContext:"cluster-map"})),y.push(...Dt({key:`${r}.${S}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return y;case"video":return lt({key:r,value:t,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return lt({key:r,value:t,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new s.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return hi({key:`${r}.type`,value:t.type,valueSpec:{values:Yr(c)},style:f,styleSpec:c})}}function Yr(l){return l.source.reduce((t,r)=>{const c=l[r];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values))),t},[])}function xn(l){const t=l.value,r=l.styleSpec,c=r.light,f=l.style;let m=[];const y=s.B(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new s.V("light",t,`object expected, ${y} found`)]),m;for(const S in t){const I=S.match(/^(.*)-transition$/);m=m.concat(I&&c[I[1]]&&c[I[1]].transition?zi({key:S,value:t[S],valueSpec:r.transition,style:f,styleSpec:r}):c[S]?zi({key:S,value:t[S],valueSpec:c[S],style:f,styleSpec:r}):[new s.V(S,t[S],`unknown property "${S}"`)])}return m}function Cs(l){const t=l.value;let r=[];if(!t)return r;const c=s.B(t);if(c!=="object")return r=r.concat([new s.V("light-3d",t,`object expected, ${c} found`)]),r;const f=l.styleSpec,m=f["light-3d"],y=l.key,S=l.style,I=l.style.lights;for(const k of["type","id"])if(!(k in t))return r=r.concat([new s.V("light-3d",t,`missing property ${k} on light`)]),r;if(t.type&&I)for(let k=0;k<l.arrayIndex;k++){const B=s.D(t.type),N=I[k];s.D(N.type)===B&&r.push(new s.V(y,t.id,`duplicate light type "${t.type}", previously defined at line ${N.id.__line__}`))}const P=`properties_light_${t.type}`;if(!(P in f))return r=r.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),r;const L=f[P];for(const k in t)if(k==="properties"){const B=t[k],N=s.B(B);if(N!=="object")return r=r.concat([new s.V("properties",B,`object expected, ${N} found`)]),r;for(const q in B)r=r.concat(L[q]?zi({key:q,value:B[q],valueSpec:L[q],style:S,styleSpec:f}):[new s.A(l.key,B[q],`unknown property "${q}"`)])}else{const B=k.match(/^(.*)-transition$/);r=r.concat(B&&m[B[1]]&&m[B[1]].transition?zi({key:k,value:t[k],valueSpec:f.transition,style:S,styleSpec:f}):m[k]?zi({key:k,value:t[k],valueSpec:m[k],style:S,styleSpec:f}):[new s.A(k,t[k],`unknown property "${k}"`)])}return r}function Kr(l){const t=l.value,r=l.key,c=l.style,f=l.styleSpec,m=f.terrain;let y=[];const S=s.B(t);if(t===void 0||S==="null")return y;if(S!=="object")return y=y.concat([new s.V("terrain",t,`object expected, ${S} found`)]),y;for(const I in t){const P=I.match(/^(.*)-transition$/);y=y.concat(P&&m[P[1]]&&m[P[1]].transition?zi({key:I,value:t[I],valueSpec:f.transition,style:c,styleSpec:f}):m[I]?zi({key:I,value:t[I],valueSpec:m[I],style:c,styleSpec:f}):[new s.A(I,t[I],`unknown property "${I}"`)])}if(t.source){const I=c.sources&&c.sources[t.source],P=I&&s.D(I.type);I?P!=="raster-dem"&&y.push(new s.V(r,t.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):y.push(new s.V(r,t.source,`source "${t.source}" not found`))}else y.push(new s.V(r,t,'terrain is missing required property "source"'));return y}function Or(l){const t=l.value,r=l.style,c=l.styleSpec,f=c.fog;let m=[];const y=s.B(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new s.V("fog",t,`object expected, ${y} found`)]),m;for(const S in t){const I=S.match(/^(.*)-transition$/);m=m.concat(I&&f[I[1]]&&f[I[1]].transition?zi({key:S,value:t[S],valueSpec:c.transition,style:r,styleSpec:c}):f[S]?zi({key:S,value:t[S],valueSpec:f[S],style:r,styleSpec:c}):[new s.A(S,t[S],`unknown property "${S}"`)])}return m}const uo={"*":()=>[],array:Et,boolean:function(l){const t=l.value,r=l.key,c=s.B(t);return c!=="boolean"?[new s.V(r,t,`boolean expected, ${c} found`)]:[]},number:dt,color:function(l){const t=l.key,r=l.value,c=s.B(r);return c!=="string"?[new s.V(t,r,`color expected, ${c} found`)]:s.U.parseCSSColor(r)===null?[new s.V(t,r,`color expected, "${r}" found`)]:[]},enum:hi,filter:$t,function:Pt,layer:Mi,object:lt,source:cn,model:s.Z,light:xn,"light-3d":Cs,terrain:Kr,fog:Or,string:yr,formatted:function(l){return yr(l).length===0?[]:Dt(l)},resolvedImage:function(l){return yr(l).length===0?[]:Dt(l)},projection:function(l){const t=l.value,r=l.styleSpec,c=r.projection,f=l.style;let m=[];const y=s.B(t);if(y==="object")for(const S in t)m=m.concat(zi({key:S,value:t[S],valueSpec:c[S],style:f,styleSpec:r}));else y!=="string"&&(m=m.concat([new s.V("projection",t,`object or string expected, ${y} found`)]));return m},import:function(l){const{value:t,styleSpec:r}=l,{data:c,...f}=t;Object.defineProperty(f,"__line__",{value:t.__line__,enumerable:!1});let m=lt(s.C({},l,{value:f,valueSpec:r.import}));return s.D(f.id)===""&&m.push(new s.V(`${l.key}.id`,f,"import id can't be an empty string")),c&&(m=m.concat(gc(c,r,{key:`${l.key}.data`}))),m}};function zi(l,t=!1){const r=l.value,c=l.valueSpec,f=l.styleSpec;if(c.expression&&s.X(s.D(r)))return Pt(l);if(c.expression&&s.J(s.K(r)))return Dt(l);if(c.type&&uo[c.type]){const m=uo[c.type](l);return t===!0&&m.length>0&&s.B(l.value)==="array"?Dt(l):m}return lt(s.C({},l,{valueSpec:c.type?f[c.type]:c}))}function Ps(l){const t=l.value,r=l.key,c=yr(l);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new s.V(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new s.V(r,t,'"glyphs" url must include a "{range}" token'))),c}function gc(l,t=s._,r={}){return zi({key:r.key||"",value:l,valueSpec:t.$root,styleSpec:t,style:l,objectElementValidators:{glyphs:Ps,"*":()=>[]}})}function qn(l,t=s._){return ye(gc(l,t))}const Oo=l=>ye(cn(l)),ml=l=>ye(xn(l)),sa=l=>ye(Cs(l)),_l=l=>ye(Kr(l)),Bo=l=>ye(Or(l)),Ve=l=>ye(Mi(l)),X=l=>ye($t(l)),J=l=>ye(Di(l)),le=l=>ye(rr(l)),ve=l=>ye(s.Z(l));function ye(l){return l.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function Ce(l,t){let r=!1;if(t&&t.length)for(const c of t)c instanceof s.A?s.w(c.message):(l.fire(new s.t(new Error(c.message))),r=!0);return r}let Fe;class De extends s.E{constructor(t,r="flat"){super(),this._transitionable=new s.$(Fe||(Fe=new s.a0({anchor:new s.a1(s._.light.anchor),position:new s.a2(s._.light.position),color:new s.a1(s._.light.color),intensity:new s.a1(s._.light.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,c={}){this._validate(ml,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&Ce(this,t.call(qn,s.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}const Ne=new s.a0({source:new s.a1(s._.terrain.source),exaggeration:new s.a1(s._.terrain.exaggeration)});let We=class extends s.E{constructor(l,t,r,c){super(),this.scope=r,this._transitionable=new s.$(Ne,r,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new s.a3(l)).get("exaggeration")}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof s.a4}};const $e=45,nt=65,vt=.05;function bt(l,t,r,c){const f=s.a7($e,nt,r),[m,y]=ii(l,c);let S=1-Math.min(1,Math.exp((t-m)/(y-m)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*f*l.alpha}function ii(l,t){const r=.5/Math.tan(.5*t);return[l.range[0]+r,l.range[1]+r]}function si(l,t,r,c,f){const m=s.a6.vec3.transformMat4([],[t,r,c],f.mercatorFogMatrix);return bt(l,s.a6.vec3.length(m),f.pitch,f._fov)}function ai(l,t,r,c,f,m,y){const S=[[r,c,0],[f,c,0],[f,m,0],[r,m,0]];let I=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const L of S){const k=s.a6.vec3.transformMat4([],L,t),B=s.a6.vec3.length(k);I=Math.min(I,B),P=Math.max(P,B)}return[bt(l,I,y.pitch,y._fov),bt(l,P,y.pitch,y._fov)]}const oi=new s.a0({range:new s.a1(s._.fog.range),color:new s.a1(s._.fog.color),"high-color":new s.a1(s._.fog["high-color"]),"space-color":new s.a1(s._.fog["space-color"]),"horizon-blend":new s.a1(s._.fog["horizon-blend"]),"star-intensity":new s.a1(s._.fog["star-intensity"]),"vertical-range":new s.a1(s._.fog["vertical-range"])});class Gi extends s.E{constructor(t,r,c,f){super(),this._transitionable=new s.$(oi,c,new Map(f)),this.set(t,f),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new s.a8(oi),this.scope=c}get state(){const t=this._transform,r=t.projection.name==="globe",c=s.a9(t.zoom),f=this.properties.get("range"),m=[.5,3];return{range:r?[s.aa(m[0],f[0],c),s.aa(m[1],f[1],c)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,c={}){if(this._validate(Bo,t,c))return;const f=s.l({},t);for(const m of Object.keys(s._.fog))f[m]===void 0&&(f[m]=s._.fog[m].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.a7($e,nt,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(c,f,m){const y=s.a5.fromLngLat(f),S=m.elevation?m.elevation.getAtPointOrZero(y):0;return si(c,y.x,y.y,S,m)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ai(this.state,r,0,0,s.ab,s.ab,this._transform)}getOpacityForBounds(t,r,c,f,m){return this._transform.projection.supportsFog?ai(this.state,t,r,c,f,m,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ii(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const c of r){const f=t.points[c];let m;if(f[2]>=0)m=f;else{const y=t.points[c-4];m=s.ac(y,f,y[2]/(y[2]-f[2]))}if(si(this.state,m[0],m[1],0,this._transform)>=vt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&Ce(this,t.call(qn,s.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}class Yi extends s.E{constructor(t,r,c,f){super(),this.scope=c,this._options=t,this.properties=new s.a8(r),this._transitionable=new s.$(r,c,new Map(f)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let di,Wi;class _r{constructor(t,r,c,f){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(t,r){let c,f;if(t instanceof s.P||typeof t[0]=="number"){const m=s.P.convert(t);c=[m],f=r.isPointAboveHorizon(m)}else{const m=s.P.convert(t[0]),y=s.P.convert(t[1]);c=[m,y],f=s.ae(m,y).every(S=>r.isPointAboveHorizon(S))}return new _r(c,r.getCameraPoint(),f,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.ae(r,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<c.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?f[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(f[3]=this.cameraPoint)),s.af(f,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.ae(r,c,t),m=this.cameraPoint.clone();switch(3*((m.y>r.y)+(m.y>c.y))+((m.x>r.x)+(m.x>c.x))){case 0:f[0]=m,f[4]=m.clone();break;case 1:f.splice(1,0,m);break;case 2:f[1]=m;break;case 3:f.splice(4,0,m);break;case 5:f.splice(2,0,m);break;case 6:f[3]=m;break;case 7:f.splice(3,0,m);break;case 8:f[2]=m}return f}containsTile(t,r,c,f=0){const m=t.queryPadding/r._pixelsPerMercatorPixel+1,y=c?this._bufferedCameraMercator(m,r):this._bufferedScreenMercator(m,r);let S=t.tileID.wrap+(y.unwrapped?f:0);const I=y.polygon.map(H=>s.ag(t.tileTransform,H,S));if(!s.ah(I,0,0,s.ab,s.ab))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const P=this.screenGeometryMercator.polygon.map(H=>s.ai(t.tileTransform,H,S)),L=P.map(H=>new s.P(H[0],H[1])),k=r.getFreeCameraOptions().position||new s.a5(0,0,0),B=s.ai(t.tileTransform,k,S),N=P.map(H=>{const W=s.a6.vec3.sub(H,H,B);return s.a6.vec3.normalize(W,W),new s.aj(B,W)}),q=s.ak(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:N,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Z=s.al(I),Z.min.x=s.ap(Z.min.x,0,s.ab),Z.min.y=s.ap(Z.min.y,0,s.ab),Z.max.x=s.ap(Z.max.x,0,s.ab),Z.max.y=s.ap(Z.max.y,0,s.ab),Z),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:q};var Z}_bufferedScreenMercator(t,r){const c=an(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let f;return f=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(m=>r.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[c]=f,f}}_bufferedCameraMercator(t,r){const c=an(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let f;return f=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(m=>r.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[c]=f,f}}_projectAndResample(t,r){const c=function(m,y){const S=s.a6.mat4.multiply([],y.pixelMatrix,y.globeMatrix),I=[0,-s.aq,0,1],P=[0,s.aq,0,1],L=[0,0,0,1];s.a6.vec4.transformMat4(I,I,S),s.a6.vec4.transformMat4(P,P,S),s.a6.vec4.transformMat4(L,L,S);const k=new s.P(I[0]/I[3],I[1]/I[3]),B=new s.P(P[0]/P[3],P[1]/P[3]),N=s.an(m,k)&&I[3]<L[3],q=s.an(m,B)&&P[3]<L[3];if(!N&&!q)return null;const Z=function(fe,he,_e){for(let Te=1;Te<fe.length;Te++){const be=$r(he.pointCoordinate3D(fe[Te-1]).x),xe=$r(he.pointCoordinate3D(fe[Te]).x);if(_e<0){if(be<xe)return{idx:Te,t:-be/(xe-1-be)}}else if(xe<be)return{idx:Te,t:(1-be)/(xe+1-be)}}return null}(m,y,N?-1:1);if(!Z)return null;const{idx:H,t:W}=Z;let ie=H>1?Ur(m.slice(0,H),y):[],ne=H<m.length?Ur(m.slice(H),y):[];ie=ie.map(fe=>new s.P($r(fe.x),fe.y)),ne=ne.map(fe=>new s.P($r(fe.x),fe.y));const ee=[...ie];ee.length===0&&ee.push(ne[ne.length-1]);const ae=s.aa(ee[ee.length-1].y,(ne.length===0?ie[0]:ne[0]).y,W);let oe;return oe=N?[new s.P(0,ae),new s.P(0,0),new s.P(1,0),new s.P(1,ae)]:[new s.P(1,ae),new s.P(1,1),new s.P(0,1),new s.P(0,ae)],ee.push(...oe),ne.length===0?ee.push(ie[0]):ee.push(...ne),{polygon:ee.map(fe=>new s.a5(fe.x,fe.y)),unwrapped:!1}}(t,r);if(c)return c;const f=function(m,y){let S=!1,I=-1/0,P=0;for(let k=0;k<m.length-1;k++)m[k].x>I&&(I=m[k].x,P=k);for(let k=0;k<m.length-1;k++){const B=(P+k)%(m.length-1),N=m[B],q=m[B+1];Math.abs(N.x-q.x)>.5&&(N.x<q.x?(N.x+=1,B===0&&(m[m.length-1].x+=1)):(q.x+=1,B+1===m.length-1&&(m[0].x+=1)),S=!0)}const L=s.am(y.center.lng);return S&&L<Math.abs(L-1)&&m.forEach(k=>{k.x-=1}),{polygon:m,unwrapped:S}}(Ur(t,r).map(m=>new s.P($r(m.x),m.y)),r);return{polygon:f.polygon.map(m=>new s.a5(m.x,m.y)),unwrapped:f.unwrapped}}}function Ur(l,t){return s.ao(l,r=>{const c=t.pointCoordinate3D(r);r.x=c.x,r.y=c.y},1/256)}function $r(l){return l<0?1+l%1:l%1}function an(l){return 100*l|0}function ds(l,t,r,c,f){const m=function(S,I){if(S)return f(S);if(I){if(l.url&&I.tiles&&l.tiles&&delete l.tiles,I.variants){if(!Array.isArray(I.variants))return f(new Error("variants must be an array"));for(const L of I.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return f(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return f(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){I=s.l(I,L);break}}}const P=s.ar(s.l(I,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(P.vectorLayers=I.vector_layers,P.vectorLayerIds=P.vectorLayers.map(L=>L.id)),I.raster_layers&&(P.rasterLayers=I.raster_layers,P.rasterLayerIds=P.rasterLayers.map(L=>L.id)),P.tiles=t.canonicalizeTileset(P,l.url),f(null,P)}},y=function(S,I,P){if(!S)return null;if(!I&&!P)return S;P=P||S.worldview_default;const L=Object.values(S.language||{});if(L.length===0)return null;const k=Object.values(S.worldview||{});if(k.length===0)return null;const B=L.every(q=>q===I),N=k.every(q=>q===P);return B&&N?S:I in(S.language_options||{})||P in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(l.data,r,c);return y?s.q.frame(()=>m(null,y)):l.url?s.n(t.transformRequest(t.normalizeSourceURL(l.url,null,r,c),s.R.Source),m):s.q.frame(()=>{const{data:S,...I}=l;m(null,I)})}class qs{constructor(t,r,c){this.bounds=s.as.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),c=Math.floor(s.am(this.bounds.getWest())*r),f=Math.floor(s.at(this.bounds.getNorth())*r),m=Math.ceil(s.am(this.bounds.getEast())*r),y=Math.ceil(s.at(this.bounds.getSouth())*r);return t.x>=c&&t.x<m&&t.y>=f&&t.y<y}}class yc extends s.E{constructor(t,r,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.ar(r,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new s.au}load(t){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=ds(this._options,this.map._requestManager,r,c,(f,m)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.t(f))):m&&(s.l(this,m),m.bounds&&(this.tileBounds=new qs(m.bounds,this.minzoom,this.maxzoom)),Gn(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(f)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(t,r){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),f=this.map._requestManager.transformRequest(c,s.R.Tile),m=this.map.style?this.map.style.getLut(this.scope):null,y={request:f,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,lut:m?{image:m.image.clone()}:null,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(y.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",y,S.bind(this));else if(t.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",y,S.bind(this),void 0,!0);else{const I=s.aw.call({deduped:this._deduped},y,(P,L)=>{P||!L?S.call(this,P):(y.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},t.actor&&t.actor.send("loadTile",y,S.bind(this),void 0,!0))},!0);t.request={cancel:I}}function S(I,P){return delete t.request,t.aborted?r(null):I&&I.status!==404?r(I):(P&&P.resourceTiming&&(t.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&t.setExpiryData(P),t.loadVectorData(P,this.map.painter),s.ax(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class gl extends s.E{constructor(t,r,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},r),s.l(this,s.ar(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._tileJSONRequest=ds(this._options,this.map._requestManager,null,null,(r,c)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new s.t(r)):c&&(s.l(this,c),c.bounds&&(this.tileBounds=new qs(c.bounds,this.minzoom,this.maxzoom)),Gn(c.tiles),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const c=s.q.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(f,s.R.Tile),(m,y,S,I)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):m?(t.state="errored",r(m)):y?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:I}),t.setTexture(y,this.map.painter),t.state="loaded",s.ax(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class oa extends gl{constructor(t,r,c,f){super(t,r,c,f),this.type="raster-array",this.maxzoom=22,this._options=s.l({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);r&&r.enabled&&c&&r._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(c,s.R.Tile);t.requestParams=f,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(m,y,S,I)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(m)return m.code===20?void 0:(t.state="errored",r(m));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:I}),t.state="empty",r(null)})}unloadTile(t,r){const c=t.texture;c&&c instanceof s.T?(t.destroy(!0),this.map.painter.saveTileTexture(c)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,c){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(r,c,(f,m)=>{if(f)return t.state="errored",this.fire(new s.t(f)),void this.triggerRepaint(t);m&&(t.setTexture(m,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find(({id:m})=>m===t),c=r&&r.fields,f=c&&c.bands&&c.bands;return f?f[0]:0}getTextureDescriptor(t,r,c){if(!t)return;const f=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let m=null;r instanceof s.aB?m=r.paint.get("raster-array-band"):r instanceof s.aC&&(m=r.paint.get("raster-particle-array-band"));const y=m||this.getInitialBand(f);if(y!=null)if(t.textureDescriptor){if(!t.updateNeeded(f,y)||c)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,f,y)}}const xc={vector:yc,raster:gl,"raster-dem":class extends gl{constructor(l,t,r,c){super(l,t,r,c),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const r=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(f,m){f&&(l.state="errored",t(f)),m&&(l.dem=m,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=s.o(this.map._requestManager.transformRequest(r,s.R.Tile),(function(f,m,y,S){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(f)l.state="errored",t(f);else if(m){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:y,expires:S});const I=ImageBitmap&&m instanceof ImageBitmap&&s.ay(),P=1-(m.width-s.az(m.width))/2;P<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const L=I?m:s.q.getImageData(m,P),k={uid:l.uid,coord:l.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:P};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",k,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,r=Math.pow(2,t.z),c=(t.x-1+r)%r,f=t.x===0?l.wrap-1:l.wrap,m=(t.x+1+r)%r,y=t.x+1===r?l.wrap+1:l.wrap,S={};return S[new s.aA(l.overscaledZ,f,t.z,c,t.y).key]={backfilled:!1},S[new s.aA(l.overscaledZ,y,t.z,m,t.y).key]={backfilled:!1},t.y>0&&(S[new s.aA(l.overscaledZ,f,t.z,c,t.y-1).key]={backfilled:!1},S[new s.aA(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new s.aA(l.overscaledZ,y,t.z,m,t.y-1).key]={backfilled:!1}),t.y+1<r&&(S[new s.aA(l.overscaledZ,f,t.z,c,t.y+1).key]={backfilled:!1},S[new s.aA(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new s.aA(l.overscaledZ,y,t.z,m,t.y+1).key]={backfilled:!1}),S}},"raster-array":oa,geojson:class extends s.E{constructor(l,t,r,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(c),this._data=t.data,this._options=s.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const f=s.ab/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*f,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*f,extent:s.ab,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.ab,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*f,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new s.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new s.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of l.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,r,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:r},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.x("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.l({append:l},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(r),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.t(c));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(m.resourceTiming=f.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new s.x("data",m)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,t){const r=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,f=this._partialReload,m={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:c?{image:c.image.clone()}:null,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:f};l.request=this.actor.send(r,m,(y,S)=>f&&!S?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):y?t(y):(l.loadVectorData(S,this.map.painter,r==="reloadTile"),t(null))),void 0,r==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aD{constructor(l,t,r,c){super(l,t,r,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aE(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new s.t(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new s.t(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aD,model:class extends s.E{constructor(l,t,r,c){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const l=[];for(const t in this._options.models){const r=this._options.models[t],c=s.aG(this.map._requestManager.transformRequest(r.uri,s.R.Model).url).then(f=>{if(!f)return;const m=s.aH(f),y=new s.aI(t,r.position,r.orientation,m);y.computeBoundsAndApplyParent(),this.models.push(y)}).catch(f=>{this.fire(new s.t(new Error(`Could not load model ${t} from ${r.uri}: ${f.message}`)))});l.push(c)}return Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new s.t(new Error(`Could not load models: ${t.message}`)))})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,t){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(l,t,r,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}load(l){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=ds(this._options,this.map._requestManager,t,r,(c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new s.t(c))):f&&(s.l(this,f),f.bounds&&(this.tileBounds=new qs(f.bounds,this.minzoom,this.maxzoom)),Gn(f.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const r=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(r,s.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const m=Object.values(l.buckets);for(const y of m)y.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,f.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,f.bind(this),void 0,!0);function f(m,y){return l.aborted?t(null):m&&m.status!==404?t(m):(y&&(y.resourceTiming&&(l.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&l.setExpiryData(y),l.buckets={...l.buckets,...y.buckets},y.featureIndex&&(l.latestFeatureIndex=y.featureIndex)),l.state="loaded",void t(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aD{constructor(l,t,r,c){super(l,t,r,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(m=>typeof m!="number"))||this.fire(new s.t(new s.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.t(new s.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.t(new s.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.t(new s.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.t(new s.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof s.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends s.E{constructor(l,t,r,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.ar(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:r,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:r,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:r,y:c,z:f}=l.tileID.canonical,m=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:r,y:c,z:f},{signal:m.signal})).then((function(y){return delete l.request,l.aborted?(l.state="unloaded",t(null)):y===void 0?(l.state="errored",t(null)):y===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(y)?(this.loadTileData(l,y),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(y=>{y.code!==20&&(l.state="errored",t(y))}),l.request.cancel=()=>m.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof s.T?(l.destroy(!0),l.texture&&l.texture instanceof s.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:r,y:c,z:f}=l.tileID.canonical;this._implementation.unloadTile({x:r,y:c,z:f})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=s.av(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}}},aa=function(l,t,r,c){const f=new xc[t.type](l,t,r,c);if(f.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${f.id}`);return s.aJ(["load","abort","unload","serialize","prepare"],f),f};function Xu(l,t){const r=s.a6.mat4.identity([]);return s.a6.mat4.scale(r,r,[.5*l.width,.5*-l.height,1]),s.a6.mat4.translate(r,r,[1,-1,0]),s.a6.mat4.multiply(r,r,l.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(r)}function Yu(l,t,r,c,f,m,y,S=!1){const I=l.tilesIn(c,y,S);I.sort(la);const P=[];for(const k of I)P.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(t,r,l._state,k,f,m,Xu(l.transform,k.tile.tileID),S)});const L=function(k){const B={},N={};for(const q of k){const Z=q.queryResults,H=q.wrappedTileID,W=N[H]=N[H]||{};for(const ie in Z){const ne=Z[ie],ee=W[ie]=W[ie]||{},ae=B[ie]=B[ie]||[];for(const oe of ne)ee[oe.featureIndex]||(ee[oe.featureIndex]=!0,ae.push(oe))}}return B}(P);for(const k in L)L[k].forEach(B=>{const N=B.feature,q=N.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(N.source=q.source,q["source-layer"]&&(N.sourceLayer=q["source-layer"]),N.state=N.id!==void 0?l.getFeatureState(q["source-layer"],N.id):{})});return L}function yl(l,t){const r=l.getRenderableIds().map(m=>l.getTileByID(m)),c=[],f={};for(let m=0;m<r.length;m++){const y=r[m],S=y.tileID.canonical.key;f[S]||(f[S]=!0,y.querySourceFeatures(c,t))}return c}function la(l,t){const r=l.tileID,c=t.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}const is=32,fs=33,ps=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,r=0,c=0,f=0,m=0,y=0,S=0;for(1&t?f=m=y=is:r=c=S=is;(t>>=1)>1;){const P=r+f>>1,L=c+m>>1;1&t?(f=r,m=c,r=y,c=S):(r=f,c=m,f=y,m=S),y=P,S=L}const I=4*l;ps[I+0]=r,ps[I+1]=c,ps[I+2]=f,ps[I+3]=m}const Pn=new Uint16Array(2178),Rs=new Uint8Array(1089),xl=new Uint16Array(1089);function Ku(l){return l===0?-.03125:l===32?.03125:0}const Ju={type:2,extent:s.ab,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ab+1,0),new s.P(s.ab+1,s.ab+1),new s.P(0,s.ab+1),new s.P(0,0)]]};class Ls{constructor(t,r,c,f,m){this.tileID=t,this.uid=s.aP(),this.uses=0,this.tileSize=r,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<s.q.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(f,m){const y={};if(!m)return y;for(const S of f){const I=S.layerIds.map(P=>m.getLayer(P)).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(P=>I.filter(L=>L.id===P)[0]));for(const P of I)y[P.fqid]=S}}return y}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const m=this.buckets[f];if(m instanceof s.aR){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const m=this.buckets[f];if(m instanceof s.aR&&m.hasRTLText){this.hasRTLText=!0,s.aS();break}}this.queryPadding=0;for(const f in this.buckets){const m=this.buckets[f],y=r.style.getOwnLayer(f);if(!y)continue;const S=y.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.aQ}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(t)}const r=t.gl,c=this.imageAtlas;if(c&&!c.uploaded){const f=!!Object.keys(c.patternPositions).length;this.imageAtlasTexture=new s.T(t,c.image,r.RGBA8,{useMipmap:f}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const f=r.style.getBrightness();(this._lastUpdatedBrightness||f)&&(this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this._lastUpdatedBrightness=f,this.updateBuckets(r)))}queryRenderedFeatures(t,r,c,f,m,y,S,I){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:S,transform:y,params:m,tileTransform:this.tileTransform},t,r,c):{}}querySourceFeatures(t,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),m=r?r.sourceLayer:"",y=f._geojsonTileLayer||f[m];if(!y)return;const S=s.aT(r&&r.filter),{z:I,x:P,y:L}=this.tileID.canonical,k={z:I,x:P,y:L};for(let B=0;B<y.length;B++){const N=y.feature(B);if(S.needGeometry){const H=s.aU(N,!0);if(!S.filter(new s.a3(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!S.filter(new s.a3(this.tileID.overscaledZ),N))continue;const q=c.getId(N,m),Z=new s.aV(N,I,P,L,q);Z.tile=k,t.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const c=s.aW(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(r)if(this.expirationTime<r)f=!0;else{const m=this.expirationTime-r;m?this.expirationTime=c+Math.max(m,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&r&&this.updateBuckets(r)}updateBuckets(t){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),c=t.style.listImages(),f=t.style.getBrightness();for(const m in this.buckets){if(!t.style.hasLayer(m))continue;const y=this.buckets[m],S=y.layers[0].sourceLayer||"_geojsonTileLayer",I=r[S],P=t.style.getOwnSourceCache(y.layers[0].source);let L={};P&&(L=P._state.getState(S,void 0)),y.update(L,I,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},f),(y instanceof s.aX||y instanceof s.aY)&&t._terrain&&t._terrain.enabled&&P&&y.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(P.id,this.tileID);const k=t&&t.style&&t.style.getOwnLayer(m);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,r){const c=r.context,f=c.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(c,t,f.RGBA8,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(t,r){const c={};for(const f of r)c[f]=!0;this.dependencies[t]=c}hasDependency(t,r){for(const c of t){const f=this.dependencies[c];if(f){for(const m of r)if(f[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const c=s.aZ(Ju,this.tileID.canonical,this.tileTransform)[0],f=new s.a_,m=new s.a$;for(let y=0;y<c.length;y++){const{x:S,y:I}=c[y];f.emplaceBack(S,I),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(m),this._tileDebugBuffer=t.createVertexBuffer(f,s.b0.members),this._tileDebugSegments=s.b1.simpleSegment(0,0,f.length,m.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const c=s.aZ(Ju,this.tileID.canonical,this.tileTransform)[0];let f,m;if(this.isRaster){const y=function(S,I){const P=s.aK(S,I),L=Math.pow(2,S.z);for(let H=0;H<fs;H++)for(let W=0;W<fs;W++){const ie=s.aL((S.x+(W+Ku(W))/is)/L),ne=s.aM((S.y+(H+Ku(H))/is)/L),ee=I.project(ie,ne),ae=H*fs+W;Pn[2*ae+0]=Math.round((ee.x*P.scale-P.x)*s.ab),Pn[2*ae+1]=Math.round((ee.y*P.scale-P.y)*s.ab)}Rs.fill(0),xl.fill(0);for(let H=2045;H>=0;H--){const W=4*H,ie=ps[W+0],ne=ps[W+1],ee=ps[W+2],ae=ps[W+3],oe=ie+ee>>1,fe=ne+ae>>1,he=oe+fe-ne,_e=fe+ie-oe,Te=ne*fs+ie,be=ae*fs+ee,xe=fe*fs+oe,Re=Math.hypot((Pn[2*Te+0]+Pn[2*be+0])/2-Pn[2*xe+0],(Pn[2*Te+1]+Pn[2*be+1])/2-Pn[2*xe+1])>=16;Rs[xe]=Rs[xe]||(Re?1:0),H<1022&&(Rs[xe]=Rs[xe]||Rs[(ne+_e>>1)*fs+(ie+he>>1)]||Rs[(ae+_e>>1)*fs+(ee+he>>1)])}const k=new s.aN,B=new s.aO;let N=0;function q(H,W){const ie=W*fs+H;return xl[ie]===0&&(k.emplaceBack(Pn[2*ie+0],Pn[2*ie+1],H*s.ab/is,W*s.ab/is),xl[ie]=++N),xl[ie]-1}function Z(H,W,ie,ne,ee,ae){const oe=H+ie>>1,fe=W+ne>>1;if(Math.abs(H-ee)+Math.abs(W-ae)>1&&Rs[fe*fs+oe])Z(ee,ae,H,W,oe,fe),Z(ie,ne,ee,ae,oe,fe);else{const he=q(H,W),_e=q(ie,ne),Te=q(ee,ae);B.emplaceBack(he,_e,Te)}}return Z(0,0,is,is,is,0),Z(is,is,0,0,0,is),{vertices:k,indices:B}}(this.tileID.canonical,r);f=y.vertices,m=y.indices}else{f=new s.aN,m=new s.aO;for(const{x:S,y:I}of c)f.emplaceBack(S,I,0,0);const y=s.b2(f.int16,void 0,4);for(let S=0;S<y.length;S+=3)m.emplaceBack(y[S],y[S+1],y[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(f,s.b3.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(m),this._tileBoundsSegments=s.b1.simpleSegment(0,0,f.length,m.length)}_makeGlobeTileDebugBuffers(t,r){const c=r.projection;if(!c||c.name!=="globe"||r.freezeTileCoverage)return;const f=this.tileID.canonical,m=s.b4(f,r),y=s.b5(m),S=s.a9(r.zoom);let I;S>0&&(I=s.a6.mat4.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,f,r,y,I,S),this._makeGlobeTileDebugTextBuffer(t,f,r,y,I,S)}_globePoint(t,r,c,f,m,y,S){let I=s.b6(t,r,c);if(y){const P=1<<c.z,L=s.am(f.center.lng),k=s.at(f.center.lat),B=(c.x+.5)/P-L;let N=0;B>.5?N=-1:B<-.5&&(N=1);let q=(t/s.ab+c.x)/P+N,Z=(r/s.ab+c.y)/P;q=(q-L)*f._pixelsPerMercatorPixel+L,Z=(Z-k)*f._pixelsPerMercatorPixel+k;const H=[q*f.worldSize,Z*f.worldSize,0];s.a6.vec3.transformMat4(H,H,y),I=s.b7(I,H,S)}return s.a6.vec3.transformMat4(I,I,m)}_makeGlobeTileDebugBorderBuffer(t,r,c,f,m,y){const S=new s.a_,I=new s.a$,P=new s.b8,L=(B,N,q,Z,H)=>{const W=(q-B)/(H-1),ie=(Z-N)/(H-1),ne=S.length;for(let ee=0;ee<H;ee++){const ae=B+ee*W,oe=N+ee*ie;S.emplaceBack(ae,oe);const fe=this._globePoint(ae,oe,r,c,f,m,y);P.emplaceBack(fe[0],fe[1],fe[2]),I.emplaceBack(ne+ee)}},k=s.ab;L(0,0,k,0,16),L(k,0,k,k,16),L(k,k,0,k,16),L(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(I),this._tileDebugBuffer=t.createVertexBuffer(S,s.b0.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,s.b9.members),this._tileDebugSegments=s.b1.simpleSegment(0,0,S.length,I.length)}_makeGlobeTileDebugTextBuffer(t,r,c,f,m,y){const S=s.ab/4,I=new s.a_,P=new s.aO,L=new s.b8,k=25;P.reserve(32),I.reserve(k),L.reserve(k);const B=(N,q)=>k*N+q;for(let N=0;N<k;N++){const q=N*S;for(let Z=0;Z<k;Z++){const H=Z*S;I.emplaceBack(H,q);const W=this._globePoint(H,q,r,c,f,m,y);L.emplaceBack(W[0],W[1],W[2])}}for(let N=0;N<4;N++)for(let q=0;q<4;q++){const Z=B(N,q),H=B(N,q+1),W=B(N+1,q),ie=B(N+1,q+1);P.emplaceBack(Z,H,W),P.emplaceBack(W,H,ie)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(I,s.b0.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,s.b9.members),this._tileDebugTextSegments=s.b1.simpleSegment(0,0,k,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.ba.setPbf(s.bb);class vc extends Ls{constructor(t,r,c,f,m){super(t,r,c,f,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,r){const c=r.context,f=c.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t,{premultiply:!1}):this.texture=new s.T(c,t,f.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,r){const c=this._mrt=new s.ba(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bc(f,(m,y,S,I)=>{if(m)r(m);else try{const P=c.getHeaderLength(y);if(P>t)return void(this.request=this.fetchHeader(P,r));c.parseHeader(y),this._isHeaderLoaded=!0;let L=0;for(const k of Object.values(c.layers))L=Math.max(L,k.dataIndex[k.dataIndex.length-1].last_byte);y.byteLength>=L&&(this.entireBuffer=y),r(null,this.entireBuffer||y,S,I)}catch(P){r(P)}}),this.request}fetchBand(t,r,c){const f=this._mrt;if(!this._isHeaderLoaded||!f)return void c(new Error("Tile header is not ready"));const m=this.actor;if(!m)return void c(new Error("Can't fetch tile band without an actor"));let y;const S=(k,B)=>{y.complete(k,B),k?c(k):(this.updateTextureDescriptor(t,r),c(null,this.textureDescriptor&&this.textureDescriptor.img))},I=(k,B)=>{if(k)return c(k);const N=m.send("decodeRasterArray",{buffer:B,task:y},S,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),y.cancel()})},P=f.getLayer(t);if(!P)return void c(new Error(`Unknown sourceLayer "${t}"`));if(P.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=P.getDataRange([r]);if(y=f.createDecodingTask(L),!y||y.tasks.length)if(this.flushQueues(),this.entireBuffer)I(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),B=s.bc(k,I);this._fetchQueue.push(()=>{B.cancel(),y.cancel()})}else c(null)}updateNeeded(t,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,r){if(!this._mrt)return;const c=this._mrt.getLayer(t);if(!c||!c.hasBand(r)||!c.hasDataForBand(r))return;const{bytes:f,tileSize:m,buffer:y,offset:S,scale:I}=c.getBandView(r),P=m+2*y,L={data:f,width:P,height:P},k=this.texture;k&&k instanceof s.T&&k.update(L,{premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:L,buffer:y,offset:S,tileSize:m,format:c.pixelFormat,mix:[I,256*I,65536*I,16777216*I]}}}class nf{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,c){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const m={value:r,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},c)),this.data[f].push(m),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const c=t.wrapped().key,f=r===void 0?0:this.data[c].indexOf(r),m=this.data[c][f];return this.data[c].splice(f,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const c in this.data)for(const f of this.data[c])t(f.value)||r.push(f);for(const c of r)this.remove(c.value.tileID,c)}}class Dm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,c){const f=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},s.l(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==f&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const m in this.state[t][f])c[m]||(this.deletedStates[t][f][m]=null)}else for(const m in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][m]===null&&delete this.deletedStates[t][f][m]}removeFeatureState(t,r,c){if(this.deletedStates[t]===null)return;const f=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&r!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,r){const c=this.state[t]||{},f=this.stateChanges[t]||{},m=this.deletedStates[t];if(m===null)return{};if(r!==void 0){const S=String(r),I=s.l({},c[S],f[S]);if(m){const P=m[r];if(P===null)return{};for(const L in P)delete I[L]}return I}const y=s.l({},c,f);if(m)for(const S in m)delete y[S];return y}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const m={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),s.l(this.state[f][y],this.stateChanges[f][y]),m[y]=this.state[f][y];c[f]=m}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const m={};if(this.deletedStates[f]===null)for(const y in this.state[f])m[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(this.deletedStates[f][y]===null)this.state[f][y]={};else if(this.state[f][y])for(const S of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][S];m[y]=this.state[f][y]}c[f]=c[f]||{},s.l(c[f],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in t)t[f].setFeatureState(c,r)}}class Rn extends s.E{constructor(t,r,c){super(),this.id=t,this._onlySymbols=c,r.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new nf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Dm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(t),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.bd(this._tiles).map(t=>t.tileID).sort(ho).map(t=>t.key)}getRenderableIds(t,r){const c=[];for(const f in this._tiles)this._isIdRenderable(+f,t,r)&&c.push(this._tiles[f]);return t?c.sort((f,m)=>{const y=f.tileID,S=m.tileID,I=new s.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),P=new s.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-S.overscaledZ||P.y-I.y||P.x-I.x}).map(f=>f.tileID.key):c.map(f=>f.tileID).sort(ho).map(f=>f.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=r),this._loadTile(c,this._tileLoaded.bind(this,c,t,r)))}_tileLoaded(t,r,c,f){if(f)if(t.state="errored",f.status!==404)this._source.fire(new s.t(f,{tile:t}));else{if(this._source.fire(new s.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.x("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let f=0;f<r.length;f++){const m=r[f];if(t.neighboringTiles&&t.neighboringTiles[m]){const y=this.getTileByID(m);c(t,y),c(y,t)}}function c(f,m){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-f.tileID.canonical.x;const S=m.tileID.canonical.y-f.tileID.canonical.y,I=Math.pow(2,f.tileID.canonical.z),P=m.tileID.key;y===0&&S===0||Math.abs(S)>1||(Math.abs(y)>1&&(Math.abs(y+I)===1?y+=I:Math.abs(y-I)===1&&(y-=I)),m.dem&&f.dem&&(f.dem.backfillBorder(m.dem,y,S),f.neighboringTiles&&f.neighboringTiles[P]&&(f.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,c,f){for(const m in this._tiles){let y=this._tiles[m];if(f[m]||!y.hasData()||y.tileID.overscaledZ<=r||y.tileID.overscaledZ>c)continue;let S=y.tileID;for(;y&&y.tileID.overscaledZ>r+1;){const P=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[P.key],y&&y.hasData()&&(S=P)}let I=S;for(;I.overscaledZ>r;)if(I=I.scaledTo(I.overscaledZ-1),t[I.key]){f[S.key]=S;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=t.overscaledZ-1;c>=r;c--){const f=t.scaledTo(c),m=this._getLoadedTile(f);if(m)return m}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const c=Math.ceil(t.width/r)+1,f=Math.ceil(t.height/r)+1,m=Math.floor(c*f*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(S)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const c={};for(const f in this._tiles){const m=this._tiles[f];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+r),c[m.tileID.key]=m}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(t,r,c,f){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const m=this._source.type==="batched-model";let y;if(this.used||this.usedForTerrain){if(this._source.tileID)y=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new s.aA(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y));else if(this.tileCoverLift!==0){const P=t.clone();P.tileCoverLift=this.tileCoverLift,y=P.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:m}),this._source.minzoom<=1&&t.projection.name==="globe"&&(y.push(new s.aA(1,0,1,0,0)),y.push(new s.aA(1,0,1,1,0)),y.push(new s.aA(1,0,1,0,1)),y.push(new s.aA(1,0,1,1,1)))}else if(y=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:m}),this._source.hasTile){const P=this._source.hasTile.bind(this._source);y=y.filter(L=>P(L))}}else y=[];if(y.length>0&&this.castsShadows&&f&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!vl(this._source.type)){const P=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),L=Math.min(P,this._source.maxzoom);if(m){const k=t.extendTileCover(y,L);for(const B of k)y.push(B)}else{const k=t.extendTileCover(y,L,f);for(const B of k)this._shadowCasterTiles[B.key]=!0,y.push(B)}}const S=this._updateRetainedTiles(y);if(vl(this._source.type)&&y.length!==0){const P={},L={},k=Object.keys(S);for(const N of k){const q=S[N],Z=this._tiles[N];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=s.q.now())continue;const H=this.findLoadedParent(q,Math.max(q.overscaledZ-Rn.maxOverzooming,this._source.minzoom));H&&(this._addTile(H.tileID),P[H.tileID.key]=H.tileID),L[N]=q}const B=y[y.length-1].overscaledZ;for(const N in this._tiles){const q=this._tiles[N];if(S[N]||!q.hasData())continue;let Z=q.tileID;for(;Z.overscaledZ>B;){Z=Z.scaledTo(Z.overscaledZ-1);const H=this._tiles[Z.key];if(H&&H.hasData()&&L[Z.key]){S[N]=q.tileID;break}}}for(const N in P)S[N]||(this._coveredTiles[N]=!0,S[N]=P[N])}for(const P in S)this._tiles[P].clearFadeHold();const I=s.be(this._tiles,S);for(const P of I){const L=this._tiles[P];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(+P)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const c={},f=t.reduce((P,L)=>Math.min(P,L.overscaledZ),1/0),m=t[0].overscaledZ,y=Math.max(m-Rn.maxOverzooming,this._source.minzoom),S=Math.max(m+Rn.maxUnderzooming,this._source.minzoom),I={};for(const P of t){const L=this._addTile(P);r[P.key]=P,L.hasData()||f<this._source.maxzoom&&(I[P.key]=P)}this._retainLoadedChildren(I,f,S,r);for(const P of t){let L=this._tiles[P.key];if(L.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const B=P.children(this._source.maxzoom)[0],N=this.getTile(B);if(N&&N.hasData()){r[B.key]=B;continue}}else{const B=P.children(this._source.maxzoom);if(r[B[0].key]&&r[B[1].key]&&r[B[2].key]&&r[B[3].key])continue}let k=L.wasRequested();for(let B=P.overscaledZ-1;B>=y;--B){const N=P.scaledTo(B);if(c[N.key]||(c[N.key]=!0,L=this.getTile(N),!L&&k&&(L=this._addTile(N)),L&&(r[N.key]=N,k=L.wasRequested(),L.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let c,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}r.push(f.key);const m=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;f=m}for(const m of r)this._loadedParentTiles[m]=c}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const c=!!r;if(!c){const f=this.map?this.map.painter:null,m=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new vc(t,m,this.transform.tileZoom,f,this._isRaster):new Ls(t,m,this.transform.tileZoom,f,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,c||this._source.fire(new s.x("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=r.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,c){const f=[],m=this.transform;if(!m)return f;const y=m.projection.name==="globe",S=s.am(m.center.lng);for(const I in this._tiles){const P=this._tiles[I];if(c&&P.clearQueryDebugViz(),P.holdingForFade())continue;let L;if(y){const k=P.tileID.canonical;if(k.z===0){const B=[Math.abs(s.ap(S,...ca(k,-1))-S),Math.abs(s.ap(S,...ca(k,1))-S)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(s.ap(S,...ca(k,-1))-S),Math.abs(s.ap(S,...ca(k,0))-S),Math.abs(s.ap(S,...ca(k,1))-S)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const k of L){const B=t.containsTile(P,m,r,k);B&&f.push(B)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const c=this.getRenderableIds(t,r).map(m=>this._tiles[m].tileID),f=this.transform.projection.name==="globe";for(const m of c)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=f?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return c}sortCoordinatesByDistance(t){const r=t.slice(),c=this.transform._camera.position,f=this.transform._camera.forward(),m={};for(const y of r){const S=1/(1<<y.canonical.z);m[y.key]=((y.canonical.x+.5)*S+y.wrap-c[0])*f[0]+((y.canonical.y+.5)*S-c[1])*f[1]-c[2]*f[2]}return r.sort((y,S)=>m[y.key]-m[S.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(vl(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,r,c){this._state.updateState(t=t||"_geojsonTileLayer",r,c)}removeFeatureState(t,r,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,c)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,c){const f=this._tiles[t];f&&f.setDependencies(r,c)}reloadTilesForDependencies(t,r){for(const c in this._tiles)this._tiles[c].hasDependency(t,r)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(t,r))};return void this._source.on("data",I)}const c=new Map,f=Array.isArray(t)?t:[t],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const I of f){const P=I.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of P)c.set(L.key,L);this.usedForTerrain&&I.updateElevation(!1)}const S=Array.from(c.values());s.bf(S,(I,P)=>{const L=new Ls(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,k=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),P(k,L)})},r)}}function ho(l,t){const r=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-r||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function vl(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function ca(l,t){const r=1<<l.z;return[l.x/r+t,(l.x+1)/r+t]}Rn.maxOverzooming=10,Rn.maxUnderzooming=3;class Qu{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const c in this.style._mergedLayers){const f=this.style._mergedLayers[c];if(f.type==="fill-extrusion")this.layers.push({layer:f,visible:t,visibilityChanged:r});else if(f.type==="model"){const m=this.style.getLayerSource(f);m&&m.type==="batched-model"&&this.layers.push({layer:f,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const c=r.layer;let f=!1;c.type==="fill-extrusion"?f=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="model"&&(f=!c.isHidden(t)&&c.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!f&&r.visible,r.visible=f}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const f of this.layers){const m=f.layer,y=this.style.getLayerSourceCache(m);let S=1;m.type==="fill-extrusion"&&(S=f.visible?m.paint.get("fill-extrusion-vertical-scale"):0);let I=y?y.getTile(r):null;if(!I&&y&&r.canonical.z>y.getSource().minzoom){let P=r.scaledTo(Math.min(y.getSource().maxzoom,r.overscaledZ-1));for(;P.overscaledZ>=y.getSource().minzoom&&(I=y.getTile(P),!I&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:I?I.getBucket(m):null,tileID:I?I.tileID:r,verticalScale:S})}t.hasAnyZOffset=!1;let c=!1;for(let f=0;f<t.symbolInstances.length;f++){const m=t.symbolInstances.get(f),y=m.zOffset,S=this._getHeightAtTileOffset(r,m.tileAnchorX,m.tileAnchorY);m.zOffset=S!==Number.NEGATIVE_INFINITY?S:y,c||y===m.zOffset||(c=!0),t.hasAnyZOffset||m.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,c,f){let m=r,y=c;if(t.canonical.z!==f.canonical.z){const S=f.canonical,I=1/(1<<t.canonical.z-S.z);m=(r+t.canonical.x*s.ab)*I-S.x*s.ab|0,y=(c+t.canonical.y*s.ab)*I-S.y*s.ab|0}return{tileX:m,tileY:y}}_getHeightAtTileOffset(t,r,c){let f,m;for(let y=0;y<this.layers.length;++y){if(this.layers[y].layer.type!=="fill-extrusion")continue;const{bucket:S,tileID:I,verticalScale:P}=this.currentBuildingBuckets[y];if(!S)continue;const{tileX:L,tileY:k}=this._mapCoordToOverlappingTile(t,r,c,I),B=S.getHeightAtTileCoord(L,k);B&&B.height!==void 0&&(B.hidden?f=B.height:m=Math.max(B.height*P,m||0))}if(m!==void 0)return m;for(let y=0;y<this.layers.length;++y){const S=this.layers[y];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:I,tileID:P}=this.currentBuildingBuckets[y];if(!I)continue;const{tileX:L,tileY:k}=this._mapCoordToOverlappingTile(t,r,c,P),B=I.getHeightAtTileCoord(L,k);if(B&&!B.hidden)return B.height===void 0&&f!==void 0?Math.min(B.maxHeight,f)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ua(l,t){const r={};for(const c in l)c!=="ref"&&(r[c]=l[c]);return s.bg.forEach(c=>{c in t&&(r[c]=t[c])}),r}function eh(l){l=l.slice();const t=Object.create(null);for(let r=0;r<l.length;r++)t[l[r].id]=l[r];for(let r=0;r<l.length;r++)"ref"in l[r]&&(l[r]=ua(l[r],t[l[r].ref]));return l}const ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function th(l,t,r){r.push({command:ki.addSource,args:[l,t[l]]})}function qi(l,t,r){t.push({command:ki.removeSource,args:[l]}),r[l]=!0}function zm(l,t,r,c){qi(l,r,c),th(l,t,r)}function Yt(l,t,r){let c;for(c in l[r])if(l[r].hasOwnProperty(c)&&c!=="data"&&!s.bh(l[r][c],t[r][c]))return!1;for(c in t[r])if(t[r].hasOwnProperty(c)&&c!=="data"&&!s.bh(l[r][c],t[r][c]))return!1;return!0}function bl(l,t,r,c,f,m){let y;for(y in t=t||{},l=l||{})l.hasOwnProperty(y)&&(s.bh(l[y],t[y])||r.push({command:m,args:[c,y,t[y],f]}));for(y in t)t.hasOwnProperty(y)&&!l.hasOwnProperty(y)&&(s.bh(l[y],t[y])||r.push({command:m,args:[c,y,t[y],f]}))}function Fo(l){return l.id}function ha(l,t){return l[t.id]=t,l}class Ds{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ap(t,0,1);let r=1,c=this._distances[r];const f=t*this.paddedLength+this.padding;for(;c<f&&r<this._distances.length;)c=this._distances[++r];const m=r-1,y=this._distances[m],S=c-y,I=S>0?(f-y)/S:0;return this.points[m].mult(1-I).add(this.points[r].mult(I))}}class bc{constructor(t,r,c){const f=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(r/c);for(let y=0;y<this.xCellCount*this.yCellCount;y++)f.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,c,f,m){this._forEachCell(r,c,f,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(m)}insertCircle(t,r,c,f){this._forEachCell(r-f,c-f,r+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,r,c,f,m,y){this.boxCells[m].push(y)}_insertCircleCell(t,r,c,f,m,y){this.circleCells[m].push(y)}_query(t,r,c,f,m,y){if(c<0||t>this.width||f<0||r>this.height)return!m&&[];const S=[];if(t<=0&&r<=0&&this.width<=c&&this.height<=f){if(m)return!0;for(let I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const P=this.circles[3*I],L=this.circles[3*I+1],k=this.circles[3*I+2];S.push({key:this.circleKeys[I],x1:P-k,y1:L-k,x2:P+k,y2:L+k})}return y?S.filter(y):S}return this._forEachCell(t,r,c,f,this._queryCell,S,{hitTest:m,seenUids:{box:{},circle:{}}},y),m?S.length>0:S}_queryCircle(t,r,c,f,m){const y=t-c,S=t+c,I=r-c,P=r+c;if(S<0||y>this.width||P<0||I>this.height)return!f&&[];const L=[];return this._forEachCell(y,I,S,P,this._queryCellCircle,L,{hitTest:f,circle:{x:t,y:r,radius:c},seenUids:{box:{},circle:{}}},m),f?L.length>0:L}query(t,r,c,f,m){return this._query(t,r,c,f,!1,m)}hitTest(t,r,c,f,m){return this._query(t,r,c,f,!0,m)}hitTestCircle(t,r,c,f){return this._queryCircle(t,r,c,!0,f)}_queryCell(t,r,c,f,m,y,S,I){const P=S.seenUids,L=this.boxCells[m];if(L!==null){const B=this.bboxes;for(const N of L)if(!P.box[N]){P.box[N]=!0;const q=4*N;if(t<=B[q+2]&&r<=B[q+3]&&c>=B[q+0]&&f>=B[q+1]&&(!I||I(this.boxKeys[N]))){if(S.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[N],x1:B[q],y1:B[q+1],x2:B[q+2],y2:B[q+3]})}}}const k=this.circleCells[m];if(k!==null){const B=this.circles;for(const N of k)if(!P.circle[N]){P.circle[N]=!0;const q=3*N;if(this._circleAndRectCollide(B[q],B[q+1],B[q+2],t,r,c,f)&&(!I||I(this.circleKeys[N]))){if(S.hitTest)return y.push(!0),!0;{const Z=B[q],H=B[q+1],W=B[q+2];y.push({key:this.circleKeys[N],x1:Z-W,y1:H-W,x2:Z+W,y2:H+W})}}}}}_queryCellCircle(t,r,c,f,m,y,S,I){const P=S.circle,L=S.seenUids,k=this.boxCells[m];if(k!==null){const N=this.bboxes;for(const q of k)if(!L.box[q]){L.box[q]=!0;const Z=4*q;if(this._circleAndRectCollide(P.x,P.y,P.radius,N[Z+0],N[Z+1],N[Z+2],N[Z+3])&&(!I||I(this.boxKeys[q])))return y.push(!0),!0}}const B=this.circleCells[m];if(B!==null){const N=this.circles;for(const q of B)if(!L.circle[q]){L.circle[q]=!0;const Z=3*q;if(this._circlesCollide(N[Z],N[Z+1],N[Z+2],P.x,P.y,P.radius)&&(!I||I(this.circleKeys[q])))return y.push(!0),!0}}}_forEachCell(t,r,c,f,m,y,S,I){const P=this._convertToXCellCoord(t),L=this._convertToYCellCoord(r),k=this._convertToXCellCoord(c),B=this._convertToYCellCoord(f);for(let N=P;N<=k;N++)for(let q=L;q<=B;q++)if(m.call(this,t,r,c,f,this.xCellCount*q+N,y,S,I))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,c,f,m,y){const S=f-t,I=m-r,P=c+y;return P*P>S*S+I*I}_circleAndRectCollide(t,r,c,f,m,y,S){const I=(y-f)/2,P=Math.abs(t-(f+I));if(P>I+c)return!1;const L=(S-m)/2,k=Math.abs(r-(m+L));if(k>L+c)return!1;if(P<=I||k<=L)return!0;const B=P-I,N=k-L;return B*B+N*N<=c*c}}const ms={unknown:0,flipRequired:1,flipNotRequired:2},Ct=Math.tan(85*Math.PI/180);function Ai(l,t,r,c,f,m,y){const S=s.a6.mat4.create();if(r)if(m.name==="globe"){const I=s.bi(f,t);s.a6.mat4.multiply(S,S,I)}else{const I=s.a6.mat2.invert([],y);S[0]=I[0],S[1]=I[1],S[4]=I[2],S[5]=I[3],c||s.a6.mat4.rotateZ(S,S,f.angle)}else s.a6.mat4.multiply(S,f.labelPlaneMatrix,l);return S}function Ii(l,t,r,c,f,m,y){const S=Ai(l,t,r,c,f,m,y);return m.name==="globe"&&r||(S[2]=S[6]=S[10]=S[14]=0),S}function Ln(l,t,r,c,f,m,y){if(r){if(m.name==="globe"){const S=Ai(l,t,r,c,f,m,y);return s.a6.mat4.invert(S,S),s.a6.mat4.multiply(S,l,S),S}{const S=s.a6.mat4.clone(l),I=s.a6.mat4.identity([]);return I[0]=y[0],I[1]=y[1],I[4]=y[2],I[5]=y[3],s.a6.mat4.multiply(S,S,I),c||s.a6.mat4.rotateZ(S,S,-f.angle),S}}return f.glCoordMatrix}function mn(l,t,r,c){const f=[l,t,r,1];r?s.a6.vec4.transformMat4(f,f,c):Tc(f,f,c);const m=f[3];return f[0]/=m,f[1]/=m,f[2]/=m,f}function Ri(l,t){return Math.min(.5+l/t*.5,1.5)}function wc(l,t){const r=l[0]/l[3],c=l[1]/l[3];return r>=-t[0]&&r<=t[0]&&c>=-t[1]&&c<=t[1]}function da(l,t,r,c,f,m,y,S,I,P){const L=r.transform,k=c?l.textSizeData:l.iconSizeData,B=s.bj(k,r.transform.zoom),N=L.projection.name==="globe",q=[256/r.width*2+1,256/r.height*2+1],Z=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Z.clear();let H=null;N&&(H=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const W=l.lineVertexArray,ie=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,ne=r.transform.width/r.transform.height;let ee,ae=!1;for(let oe=0;oe<ie.length;oe++){const fe=ie.get(oe),{numGlyphs:he,writingMode:_e}=fe;if(_e!==s.bk.vertical||ae||ee===s.bk.horizontal||(ae=!0),ee=_e,(fe.hidden||_e===s.bk.vertical)&&!ae){zs(he,Z);continue}ae=!1;const Te=new s.P(fe.tileAnchorX,fe.tileAnchorY);let{x:be,y:xe,z:Re}=L.projection.projectTilePoint(Te.x,Te.y,P.canonical);if(I){const[Ye,Qe,Ft]=I(Te);be+=Ye,xe+=Qe,Re+=Ft}const Ge=[be,xe,Re,1];if(s.a6.vec4.transformMat4(Ge,Ge,t),!wc(Ge,q)){zs(he,Z);continue}const Ke=Ge[3],je=Ri(r.transform.getCameraToCenterDistance(L.projection),Ke),rt=s.bl(k,B,fe),Le=y?rt/je:rt*je,Xe=mn(be,xe,Re,f);if(Xe[3]<=0){zs(he,Z);continue}let He={};const st=y?null:I,at=Mr(fe,Le,!1,S,t,f,m,l.glyphOffsetArray,W,Z,H,Xe,Te,He,ne,st,L.projection,P,y);ae=at.useVertical,st&&at.needsFlipping&&(He={}),(at.notEnoughRoom||ae||at.needsFlipping&&Mr(fe,Le,!0,S,t,f,m,l.glyphOffsetArray,W,Z,H,Xe,Te,He,ne,st,L.projection,P,y).notEnoughRoom)&&zs(he,Z)}c?(l.text.dynamicLayoutVertexBuffer.updateData(Z),H&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(H)):(l.icon.dynamicLayoutVertexBuffer.updateData(Z),H&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(H))}function fa(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z){const{lineStartIndex:H,glyphStartIndex:W,segment:ie}=S,ne=W+S.numGlyphs,ee=H+S.lineLength,ae=t.getoffsetX(W),oe=t.getoffsetX(ne-1),fe=ma(l*ae,r,c,f,m,y,ie,H,ee,I,P,L,k,B,!0,N,q,Z);if(!fe)return null;const he=ma(l*oe,r,c,f,m,y,ie,H,ee,I,P,L,k,B,!0,N,q,Z);return he?{first:fe,last:he}:null}function vn(l,t,r,c){return l===s.bk.horizontal&&Math.abs(c)>Math.abs(r)?{useVertical:!0}:l===s.bk.vertical?c>0?{needsFlipping:!0}:null:t!==ms.unknown&&function(f,m){return f===0||Math.abs(m/f)>Ct}(r,c)?t===ms.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Mr(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z,H,W,ie){const ne=t/24,ee=l.lineOffsetX*ne,ae=l.lineOffsetY*ne,{lineStartIndex:oe,glyphStartIndex:fe,numGlyphs:he,segment:_e,writingMode:Te,flipState:be}=l,xe=oe+l.lineLength,Re=Ge=>{if(L){const[Le,Xe,He]=Ge.up,st=P.length;s.bm(L,st+0,Le,Xe,He),s.bm(L,st+1,Le,Xe,He),s.bm(L,st+2,Le,Xe,He),s.bm(L,st+3,Le,Xe,He)}const[Ke,je,rt]=Ge.point;s.bn(P,Ke,je,rt,Ge.angle)};if(he>1){const Ge=fa(ne,S,ee,ae,r,k,B,l,I,m,N,Z,!1,H,W,ie);if(!Ge)return{notEnoughRoom:!0};if(c&&!r){let[Ke,je,rt]=Ge.first.point,[Le,Xe,He]=Ge.last.point;[Ke,je]=mn(Ke,je,rt,y),[Le,Xe]=mn(Le,Xe,He,y);const st=vn(Te,be,(Le-Ke)*q,Xe-je);if(l.flipState=st&&st.needsFlipping?ms.flipRequired:ms.flipNotRequired,st)return st}Re(Ge.first);for(let Ke=fe+1;Ke<fe+he-1;Ke++){const je=ma(ne*S.getoffsetX(Ke),ee,ae,r,k,B,_e,oe,xe,I,m,N,Z,!1,!1,H,W,ie);if(!je)return P.length-=4*(Ke-fe),{notEnoughRoom:!0};Re(je)}Re(Ge.last)}else{if(c&&!r){const Ke=mn(B.x,B.y,0,f),je=oe+_e+1,rt=new s.P(I.getx(je),I.gety(je)),Le=mn(rt.x,rt.y,0,f),Xe=Le[3]>0?Le:pa(B,rt,Ke,1,f,void 0,H,W.canonical),He=vn(Te,be,(Xe[0]-Ke[0])*q,Xe[1]-Ke[1]);if(l.flipState=He&&He.needsFlipping?ms.flipRequired:ms.flipNotRequired,He)return He}const Ge=ma(ne*S.getoffsetX(fe),ee,ae,r,k,B,_e,oe,xe,I,m,N,Z,!1,!1,H,W,ie);if(!Ge)return{notEnoughRoom:!0};Re(Ge)}return{}}function sf(l,t,r,c,f){const{x:m,y,z:S}=c.projectTilePoint(l.x,l.y,t);if(!f)return mn(m,y,S,r);const[I,P,L]=f(l);return mn(m+I,y+P,S+L,r)}function pa(l,t,r,c,f,m,y,S){const I=sf(l.sub(t)._unit()._add(l),S,f,y,m);return s.a6.vec3.sub(I,r,I),s.a6.vec3.normalize(I,I),s.a6.vec3.scaleAndAdd(I,r,I,c)}function ma(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z,H,W){const ie=c?l-t:l+t;let ne=ie>0?1:-1,ee=0;c&&(ne*=-1,ee=Math.PI),ne<0&&(ee+=Math.PI);let ae=S+y+(ne>0?0:1)|0,oe=f,fe=f,he=0,_e=0;const Te=Math.abs(ie),be=[],xe=[];let Re=m,Ge=Re;const Ke=()=>pa(Ge,Re,fe,Te-he+1,L,B,Z,H.canonical);for(;he+_e<=Te;){if(ae+=ne,ae<S||ae>=I)return null;if(fe=oe,Ge=Re,be.push(fe),N&&xe.push(Ge),Re=new s.P(P.getx(ae),P.gety(ae)),oe=k[ae],!oe){const Qe=sf(Re,H.canonical,L,Z,B);oe=Qe[3]>0?k[ae]=Qe:Ke()}he+=_e,_e=s.a6.vec3.distance(fe,oe)}q&&B&&(k[ae]&&(oe=Ke(),_e=s.a6.vec3.distance(fe,oe)),k[ae]=oe);const je=(Te-he)/_e,rt=Re.sub(Ge)._mult(je)._add(Ge),Le=s.a6.vec3.sub([],oe,fe),Xe=s.a6.vec3.scaleAndAdd([],fe,Le,je);let He=[0,0,1],st=Le[0],at=Le[1];if(W&&(He=Z.upVector(H.canonical,rt.x,rt.y),He[0]!==0||He[1]!==0||He[2]!==1)){const Qe=[He[2],0,-He[0]],Ft=s.a6.vec3.cross([],He,Qe);s.a6.vec3.normalize(Qe,Qe),s.a6.vec3.normalize(Ft,Ft),st=s.a6.vec3.dot(Le,Qe),at=s.a6.vec3.dot(Le,Ft)}if(r){const Qe=s.a6.vec3.cross([],He,Le);s.a6.vec3.normalize(Qe,Qe),s.a6.vec3.scaleAndAdd(Xe,Xe,Qe,r*ne)}const Ye=ee+Math.atan2(at,st);return be.push(Xe),N&&xe.push(rt),{point:Xe,angle:Ye,path:be,tilePath:xe,up:He}}function zs(l,t){const r=t.length,c=r+4*l;t.resize(c),t.float32.fill(-1/0,4*r,4*c)}function Tc(l,t,r){const c=t[0],f=t[1];return l[0]=r[0]*c+r[4]*f+r[12],l[1]=r[1]*c+r[5]*f+r[13],l[3]=r[3]*c+r[7]*f+r[15],l}const $n=100;class _n{constructor(t,r,c=new bc(t.width+200,t.height+200,25),f=new bc(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$n,this.screenBottomBoundary=t.height+$n,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,c,f,m,y,S,I){let P=c.projectedAnchorX,L=c.projectedAnchorY,k=c.projectedAnchorZ;const B=c.elevation,N=c.tileID,q=t.getProjection();if(B&&N){const[oe,fe,he]=q.upVector(N.canonical,c.tileAnchorX,c.tileAnchorY),_e=q.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=oe*B*_e,L+=fe*B*_e,k+=he*B*_e}const Z=this.projectAndGetPerspectiveRatio(S,P,L,k,c.tileID,q.name==="globe"||!!B||this.transform.pitch>0,q),H=y*Z.perspectiveRatio,W=(c.x1*r+f.x-c.padding)*H+Z.point.x,ie=(c.y1*r+f.y-c.padding)*H+Z.point.y,ne=(c.x2*r+f.x+c.padding)*H+Z.point.x,ee=(c.y2*r+f.y+c.padding)*H+Z.point.y,ae=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(W,ie,ne,ee)||!m&&this.grid.hitTest(W,ie,ne,ee,I)||ae?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[W,ie,ne,ee],offscreen:this.isOffscreen(W,ie,ne,ee),occluded:!1}}placeCollisionCircles(t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z){const H=[],W=this.transform.elevation,ie=t.getProjection(),ne=W?W.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,ie):null,ee=new s.P(c.tileAnchorX,c.tileAnchorY);let{x:ae,y:oe,z:fe}=ie.projectTilePoint(ee.x,ee.y,Z.canonical);if(ne){const[rt,Le,Xe]=ne(ee);ae+=rt,oe+=Le,fe+=Xe}const he=ie.name==="globe",_e=this.projectAndGetPerspectiveRatio(S,ae,oe,fe,Z,he||!!W||this.transform.pitch>0,ie),{perspectiveRatio:Te}=_e,be=(k?y/Te:y*Te)/s.bq,xe=mn(ae,oe,fe,I),Re=_e.signedDistanceFromCamera>0?fa(be,m,c.lineOffsetX*be,c.lineOffsetY*be,!1,xe,ee,c,f,I,{},W&&!k?ne:null,k&&!!W,ie,Z,k):null;let Ge=!1,Ke=!1,je=!0;if(Re&&!_e.occluded){const rt=.5*N*Te+q,Le=new s.P(-100,-100),Xe=new s.P(this.screenRightBoundary,this.screenBottomBoundary),He=new Ds,{first:st,last:at}=Re,Ye=st.path.length;let Qe=[];for(let Tt=Ye-1;Tt>=1;Tt--)Qe.push(st.path[Tt]);for(let Tt=1;Tt<at.path.length;Tt++)Qe.push(at.path[Tt]);const Ft=2.5*rt;P&&(Qe=Qe.map(([Tt,Kt,Lt],Zt)=>(ne&&!he&&(Lt=ne(Zt<Ye-1?st.tilePath[Ye-1-Zt]:at.tilePath[Zt-Ye+2])[2]),mn(Tt,Kt,Lt,P))),Qe.some(Tt=>Tt[3]<=0)&&(Qe=[]));let ft=[];if(Qe.length>0){let Tt=1/0,Kt=-1/0,Lt=1/0,Zt=-1/0;for(const _i of Qe)Tt=Math.min(Tt,_i[0]),Lt=Math.min(Lt,_i[1]),Kt=Math.max(Kt,_i[0]),Zt=Math.max(Zt,_i[1]);Kt>=Le.x&&Tt<=Xe.x&&Zt>=Le.y&&Lt<=Xe.y&&(ft=[Qe.map(_i=>new s.P(_i[0],_i[1]))],(Tt<Le.x||Kt>Xe.x||Lt<Le.y||Zt>Xe.y)&&(ft=s.bo(ft,Le.x,Le.y,Xe.x,Xe.y)))}for(const Tt of ft){He.reset(Tt,.25*rt);let Kt=0;Kt=He.length<=.5*rt?1:Math.ceil(He.paddedLength/Ft)+1;for(let Lt=0;Lt<Kt;Lt++){const Zt=Lt/Math.max(Kt-1,1),_i=He.lerp(Zt),fi=_i.x+$n,Xi=_i.y+$n;H.push(fi,Xi,rt,0);const er=fi-rt,cr=Xi-rt,rs=fi+rt,Rr=Xi+rt;if(je=je&&this.isOffscreen(er,cr,rs,Rr),Ke=Ke||this.isInsideGrid(er,cr,rs,Rr),!r&&this.grid.hitTestCircle(fi,Xi,rt,B)&&(Ge=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ge,occluded:!1}}}}return{circles:!L&&Ge||!Ke?[]:H,offscreen:je,collisionDetected:Ge,occluded:_e.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let c=1/0,f=1/0,m=-1/0,y=-1/0;for(const L of t){const k=new s.P(L.x+$n,L.y+$n);c=Math.min(c,k.x),f=Math.min(f,k.y),m=Math.max(m,k.x),y=Math.max(y,k.y),r.push(k)}const S=this.grid.query(c,f,m,y).concat(this.ignoredGrid.query(c,f,m,y)),I={},P={};for(const L of S){const k=L.key;if(I[k.bucketInstanceId]===void 0&&(I[k.bucketInstanceId]={}),I[k.bucketInstanceId][k.featureIndex])continue;const B=[new s.P(L.x1,L.y1),new s.P(L.x2,L.y1),new s.P(L.x2,L.y2),new s.P(L.x1,L.y2)];s.bp(r,B)&&(I[k.bucketInstanceId][k.featureIndex]=!0,P[k.bucketInstanceId]===void 0&&(P[k.bucketInstanceId]=[]),P[k.bucketInstanceId].push(k.featureIndex))}return P}insertCollisionBox(t,r,c,f,m){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:m},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,c,f,m){const y=r?this.ignoredGrid:this.grid,S={bucketInstanceId:c,featureIndex:f,collisionGroupID:m};for(let I=0;I<t.length;I+=4)y.insertCircle(S,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,r,c,f,m,y,S){const I=[r,c,f,1];let P=!1;f||this.transform.pitch>0?(s.a6.vec4.transformMat4(I,I,t),this.fogState&&m&&S.name!=="globe"&&(P=function(B,N,q,Z,H,W){const ie=W.calculateFogTileMatrix(H),ne=[N,q,Z];return s.a6.vec3.transformMat4(ne,ne,ie),bt(B,s.a6.vec3.length(ne),W.pitch,W._fov)}(this.fogState,r,c,f,m.toUnwrapped(),this.transform)>.9)):Tc(I,I,t);const L=I[3];return{point:new s.P((I[0]/L+1)/2*this.transform.width+$n,(-I[1]/L+1)/2*this.transform.height+$n),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/L*.5,1.5),signedDistanceFromCamera:L,occluded:y&&I[2]>L||P}}isOffscreen(t,r,c,f){return c<$n||t>=this.screenRightBoundary||f<$n||r>this.screenBottomBoundary}isInsideGrid(t,r,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=s.a6.mat4.identity([]);return s.a6.mat4.translate(t,t,[-100,-100,0]),t}}function bn(l,t,r){const c=t.createTileMatrix(l,l.worldSize,r.toUnwrapped());return s.a6.mat4.multiply(new Float32Array(16),l.projMatrix,c)}function of(l,t,r){if(t.projection.name===r.projection.name)return l.projMatrix;const c=r.clone();return c.setProjection(t.projection),bn(c,t.getProjection(),l)}function fo(l,t,r){return t.name===r.projection.name?l.projMatrix:bn(r,t,l)}class Br{constructor(t,r,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class wn{constructor(t,r,c,f,m,y=!1){this.text=new Br(t?t.text:null,r,c,m),this.icon=new Br(t?t.icon:null,r,f,m),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _s{constructor(t,r,c,f=!1){this.text=t,this.icon=r,this.skipFade=c,this.clipped=f}}class Jr{constructor(){this.invProjMatrix=s.a6.mat4.create(),this.viewportMatrix=s.a6.mat4.create(),this.circles=[]}}class ih{constructor(t,r,c,f,m){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=m}}class gs{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[t]}}function _a(l,t,r,c,f){const{horizontalAlign:m,verticalAlign:y}=s.bx(l),S=-(m-.5)*t,I=-(y-.5)*r,P=s.bw(l,c);return new s.P(S+P[0]*f,I+P[1]*f)}function No(l,t,r,c,f){const m=new s.P(l,t);return r&&m._rotate(c?f:-f),m}class Vo{constructor(t,r,c,f,m,y){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new _n(this.transform,m),this.buildingIndex=y,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new gs(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,c,f){const m=c.getBucket(r),y=c.latestFeatureIndex;if(!m||!y||r.fqid!==m.layerIds[0])return;const S=m.layers[0].layout,I=m.layers[0].paint,P=c.collisionBoxArray,L=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),k=c.tileSize/s.ab,B=c.tileID.toUnwrapped();this.transform.setProjection(m.projection);const N=(q=c.tileID,Z=m.getProjection(),H=this.transform,Z.name===this.projection?H.calculateProjMatrix(q.toUnwrapped()):bn(H,Z,q));var q,Z,H;const W=S.get("text-pitch-alignment")==="map",ie=S.get("text-rotation-alignment")==="map";r.compileFilter();const ne=r.dynamicFilter(),ee=r.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(c),oe=Ii(N,c.tileID.canonical,W,ie,this.transform,m.getProjection(),ae);let fe=null;if(W){const Te=Ln(N,c.tileID.canonical,W,ie,this.transform,m.getProjection(),ae);fe=s.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Te)}let he=null;ne&&c.latestFeatureIndex&&(he={unwrappedTileID:B,dynamicFilter:ne,dynamicFilterNeedsFeature:ee}),this.retainedQueryData[m.bucketInstanceId]=new ih(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,c.tileID);const _e={bucket:m,layout:S,paint:I,posMatrix:N,textLabelPlaneMatrix:oe,labelToScreenMatrix:fe,clippingData:he,scale:L,textPixelRatio:k,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:s.bj(m.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.bj(m.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(f)for(const Te of m.sortKeyRanges){const{sortKey:be,symbolInstanceStart:xe,symbolInstanceEnd:Re}=Te;t.push({sortKey:be,symbolInstanceStart:xe,symbolInstanceEnd:Re,parameters:_e})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z,H,W,ie){const{textOffset0:ne,textOffset1:ee,crossTileID:ae}=B,oe=[ne,ee],fe=_a(t,c,f,oe,m),he=this.collisionIndex.placeCollisionBox(q,m,r,No(fe.x,fe.y,y,S,this.transform.angle),k,I,P,L.predicate);if(H){const _e=q.getSymbolInstanceIconSize(ie,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,_e,H,No(fe.x,fe.y,y,S,this.transform.angle),k,I,P,L.predicate).box.length===0)return}if(he.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[ae]&&this.prevPlacement.placements[ae]&&this.prevPlacement.placements[ae].text&&(_e=this.prevPlacement.variableOffsets[ae].anchor),this.variableOffsets[ae]={textOffset:oe,width:c,height:f,anchor:t,textScale:m,prevAnchor:_e},this.markUsedJustification(q,t,B,Z),q.allowVerticalPlacement&&(this.markUsedOrientation(q,Z,B),this.placedOrientations[ae]=Z),{shift:fe,placedGlyphBoxes:he}}}placeLayerBucketPart(t,r,c,f){const{bucket:m,layout:y,paint:S,posMatrix:I,textLabelPlaneMatrix:P,labelToScreenMatrix:L,clippingData:k,textPixelRatio:B,holdingForFade:N,collisionBoxArray:q,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:H,collisionGroup:W,latestFeatureIndex:ie}=t.parameters,ne=y.get("text-optional"),ee=y.get("icon-optional"),ae=y.get("text-allow-overlap"),oe=y.get("icon-allow-overlap"),fe=y.get("text-rotation-alignment")==="map",he=y.get("text-pitch-alignment")==="map",_e=y.get("symbol-z-elevate"),Te=S.get("symbol-z-offset"),be=S.get("symbol-elevation-reference")==="sea";this.transform.setProjection(m.projection);let xe=ae&&(oe||!m.hasIconData()||ee),Re=oe&&(ae||!m.hasTextData()||ne);const Ge=!Te.isConstant();!m.collisionArrays&&q&&m.deserializeCollisionBoxes(q),c&&f&&m.updateCollisionDebugBuffers(this.transform.zoom,q);const Ke=(je,rt,Le)=>{const{crossTileID:Xe,numVerticalGlyphVertices:He}=je;let st=null;if(k&&k.dynamicFilterNeedsFeature||Ge){const pi=this.retainedQueryData[m.bucketInstanceId];st=ie.loadFeature({featureIndex:je.featureIndex,bucketIndex:pi.bucketIndex,sourceLayerIndex:pi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(k&&!(0,k.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},st,this.retainedQueryData[m.bucketInstanceId].tileID.canonical,new s.P(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Xe]=new _s(!1,!1,!1,!0),void r.add(Xe);const at=Te.evaluate(st,{});if(r.has(Xe))return;if(N)return void(this.placements[Xe]=new _s(!1,!1,!1));let Ye=!1,Qe=!1,Ft=!0,ft=!1,Tt=!1,Kt=null,Lt={box:null,offscreen:null,occluded:null},Zt={box:null,offscreen:null,occluded:null},_i=null,fi=null,Xi=null,er=0,cr=0,rs=0;Le.textFeatureIndex?er=Le.textFeatureIndex:je.useRuntimeCollisionCircles&&(er=je.featureIndex),Le.verticalTextFeatureIndex&&(cr=Le.verticalTextFeatureIndex);const Rr=pi=>{pi.tileID=this.retainedQueryData[m.bucketInstanceId].tileID;const Bi=this.transform.elevation;pi.elevation=be?at:at+(Bi?Bi.getAtTileOffset(pi.tileID,pi.tileAnchorX,pi.tileAnchorY):0),pi.elevation+=je.zOffset},wi=Le.textBox;if(wi){Rr(wi);const pi=$i=>{let Tr=s.bk.horizontal;if(m.allowVerticalPlacement&&!$i&&this.prevPlacement){const Lr=this.prevPlacement.placedOrientations[Xe];Lr&&(this.placedOrientations[Xe]=Lr,Tr=Lr,this.markUsedOrientation(m,Tr,je))}return Tr},Bi=($i,Tr)=>{if(m.allowVerticalPlacement&&He>0&&Le.verticalTextBox){for(const Lr of m.writingModes)if(Lr===s.bk.vertical?(Lt=Tr(),Zt=Lt):Lt=$i(),Lt&&Lt.box&&Lt.box.length)break}else Lt=$i()};if(y.get("text-variable-anchor")){let $i=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Xe]){const Pi=this.prevPlacement.variableOffsets[Xe];$i.indexOf(Pi.anchor)>0&&($i=$i.filter(Zr=>Zr!==Pi.anchor),$i.unshift(Pi.anchor))}const Tr=(Pi,Zr,Qr)=>{const Hr=m.getSymbolInstanceTextSize(Z,je,this.transform.zoom,rt),sr=(Pi.x2-Pi.x1)*Hr+2*Pi.padding,En=(Pi.y2-Pi.y1)*Hr+2*Pi.padding,Sn=je.hasIconTextFit&&!oe?Zr:null;Sn&&Rr(Sn);let ns={box:[],offscreen:!1,occluded:!1};const Kn=ae?2*$i.length:$i.length;for(let On=0;On<Kn;++On){const ss=this.attemptAnchorPlacement($i[On%$i.length],Pi,sr,En,Hr,fe,he,B,I,W,On>=$i.length,je,rt,m,Qr,Sn,Z,H);if(ss&&(ns=ss.placedGlyphBoxes,ns&&ns.box&&ns.box.length)){Ye=!0,Kt=ss.shift;break}}return ns};Bi(()=>Tr(wi,Le.iconBox,s.bk.horizontal),()=>{const Pi=Le.verticalTextBox;return Pi&&Rr(Pi),m.allowVerticalPlacement&&!(Lt&&Lt.box&&Lt.box.length)&&He>0&&Pi?Tr(Pi,Le.verticalIconBox,s.bk.vertical):{box:null,offscreen:null,occluded:null}}),Lt&&(Ye=Lt.box,Ft=Lt.offscreen,ft=Lt.occluded);const Lr=pi(!(!Lt||!Lt.box));if(!Ye&&this.prevPlacement){const Pi=this.prevPlacement.variableOffsets[Xe];Pi&&(this.variableOffsets[Xe]=Pi,this.markUsedJustification(m,Pi.anchor,je,Lr))}}else{const $i=(Tr,Lr)=>{const Pi=m.getSymbolInstanceTextSize(Z,je,this.transform.zoom,rt),Zr=this.collisionIndex.placeCollisionBox(m,Pi,Tr,new s.P(0,0),ae,B,I,W.predicate);return Zr&&Zr.box&&Zr.box.length&&(this.markUsedOrientation(m,Lr,je),this.placedOrientations[Xe]=Lr),Zr};Bi(()=>$i(wi,s.bk.horizontal),()=>{const Tr=Le.verticalTextBox;return m.allowVerticalPlacement&&He>0&&Tr?(Rr(Tr),$i(Tr,s.bk.vertical)):{box:null,offscreen:null,occluded:null}}),pi(!!(Lt&&Lt.box&&Lt.box.length))}}if(_i=Lt,Ye=_i&&_i.box&&_i.box.length>0,Ft=_i&&_i.offscreen,ft=_i&&_i.occluded,je.useRuntimeCollisionCircles){const pi=m.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),Bi=s.bl(m.textSizeData,Z,pi),$i=y.get("text-padding");fi=this.collisionIndex.placeCollisionCircles(m,ae,pi,m.lineVertexArray,m.glyphOffsetArray,Bi,I,P,L,c,he,W.predicate,je.collisionCircleDiameter*Bi/s.bq,$i,this.retainedQueryData[m.bucketInstanceId].tileID),Ye=ae||fi.circles.length>0&&!fi.collisionDetected,Ft=Ft&&fi.offscreen,ft=fi.occluded}if(Le.iconFeatureIndex&&(rs=Le.iconFeatureIndex),Le.iconBox){const pi=Bi=>{Rr(Bi);const $i=je.hasIconTextFit&&Kt?No(Kt.x,Kt.y,fe,he,this.transform.angle):new s.P(0,0),Tr=m.getSymbolInstanceIconSize(H,this.transform.zoom,je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(m,Tr,Bi,$i,oe,B,I,W.predicate)};Zt&&Zt.box&&Zt.box.length&&Le.verticalIconBox?(Xi=pi(Le.verticalIconBox),Qe=Xi.box.length>0):(Xi=pi(Le.iconBox),Qe=Xi.box.length>0),Ft=Ft&&Xi.offscreen,Tt=Xi.occluded}const Ji=ne||je.numHorizontalGlyphVertices===0&&He===0,mr=ee||je.numIconVertices===0;if(Ji||mr?mr?Ji||(Qe=Qe&&Ye):Ye=Qe&&Ye:Qe=Ye=Qe&&Ye,Ye&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,y.get("text-ignore-placement"),m.bucketInstanceId,Zt&&Zt.box&&cr?cr:er,W.ID),Qe&&Xi&&this.collisionIndex.insertCollisionBox(Xi.box,y.get("icon-ignore-placement"),m.bucketInstanceId,rs,W.ID),fi&&(Ye&&this.collisionIndex.insertCollisionCircles(fi.circles,y.get("text-ignore-placement"),m.bucketInstanceId,er,W.ID),c)){const pi=m.bucketInstanceId;let Bi=this.collisionCircleArrays[pi];Bi===void 0&&(Bi=this.collisionCircleArrays[pi]=new Jr);for(let $i=0;$i<fi.circles.length;$i+=4)Bi.circles.push(fi.circles[$i+0]),Bi.circles.push(fi.circles[$i+1]),Bi.circles.push(fi.circles[$i+2]),Bi.circles.push(fi.collisionDetected?1:0)}const Ki=m.projection.name!=="globe";xe=xe&&(Ki||!ft),Re=Re&&(Ki||!Tt),this.placements[Xe]=new _s(Ye||xe,Qe||Re,Ft||m.justReloaded),r.add(Xe)};if(_e&&this.buildingIndex&&(this.buildingIndex.updateZOffset(m,this.retainedQueryData[m.bucketInstanceId].tileID),m.updateZOffset()),m.sortFeaturesByY){const je=m.getSortedSymbolIndexes(this.transform.angle);for(let rt=je.length-1;rt>=0;--rt){const Le=je[rt];Ke(m.symbolInstances.get(Le),Le,m.collisionArrays[Le])}m.hasAnyZOffset&&s.w(`${m.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(m.hasAnyZOffset){const je=m.getSortedIndexesByZOffset();for(let rt=0;rt<je.length;++rt){const Le=je[rt];Ke(m.symbolInstances.get(Le),Le,m.collisionArrays[Le])}}else for(let je=t.symbolInstanceStart;je<t.symbolInstanceEnd;je++)Ke(m.symbolInstances.get(je),je,m.collisionArrays[je]);if(c&&m.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[m.bucketInstanceId];s.a6.mat4.invert(je.invProjMatrix,I),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(t,r,c,f){const{leftJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:I,crossTileID:P}=c,L=s.bv(r),k=f===s.bk.vertical?I:L==="left"?m:L==="center"?y:L==="right"?S:-1;m>=0&&(t.text.placedSymbolArray.get(m).crossTileID=k>=0&&m!==k?0:P),y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=k>=0&&y!==k?0:P),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=k>=0&&S!==k?0:P),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=k>=0&&I!==k?0:P)}markUsedOrientation(t,r,c){const f=r===s.bk.horizontal||r===s.bk.horizontalOnly?r:0,m=r===s.bk.vertical?r:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:P}=c,L=t.text.placedSymbolArray;y>=0&&(L.get(y).placedOrientation=f),S>=0&&(L.get(S).placedOrientation=f),I>=0&&(L.get(I).placedOrientation=f),P>=0&&(L.get(P).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const f=r?r.symbolFadeChange(t):1,m=r?r.opacities:{},y=r?r.variableOffsets:{},S=r?r.placedOrientations:{};for(const I in this.placements){const P=this.placements[I],L=m[I];L?(this.opacities[I]=new wn(L,f,P.text,P.icon,null,P.clipped),c=c||P.text!==L.text.placed||P.icon!==L.icon.placed):(this.opacities[I]=new wn(null,f,P.text,P.icon,P.skipFade,P.clipped),c=c||P.text||P.icon)}for(const I in m){const P=m[I];if(!this.opacities[I]){const L=new wn(P,f,!1,!1);L.isHidden()||(this.opacities[I]=L,c=c||P.text.placed||P.icon.placed)}}for(const I in y)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=y[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,c,f){const m=new Set;for(const y of r){const S=y.getBucket(t);S&&y.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,m,y,y.collisionBoxArray,c,f,y.tileID,t.scope),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,y.tileID),S.updateZOffset()))}}updateBucketOpacities(t,r,c,f,m,y,S,I){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const P=t.layers[0].layout,L=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),B=new wn(null,0,!1,!1,!0),N=P.get("text-allow-overlap"),q=P.get("icon-allow-overlap"),Z=P.get("text-variable-anchor"),H=P.get("text-rotation-alignment")==="map",W=P.get("text-pitch-alignment")==="map",ie=L.get("symbol-z-offset"),ne=L.get("symbol-elevation-reference")==="sea",ee=!ie.isConstant(),ae=new wn(null,0,N&&(q||!t.hasIconData()||P.get("icon-optional")),q&&(N||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const oe=(he,_e,Te)=>{for(let be=0;be<_e/4;be++)he.opacityVertexArray.emplaceBack(Te)};let fe=0;y&&t.updateReplacement(S,y);for(let he=0;he<t.symbolInstances.length;he++){const _e=t.symbolInstances.get(he),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:be,crossTileID:xe,numIconVertices:Re,tileAnchorX:Ge,tileAnchorY:Ke}=_e;let je=null;if(_e&&ee){const ft=this.retainedQueryData[t.bucketInstanceId];je=c.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:ft.bucketIndex,sourceLayerIndex:ft.sourceLayerIndex,layoutVertexArrayOffset:0})}const rt=ie.evaluate(je,{}),Le=r.has(xe);let Xe=this.opacities[xe];Le?Xe=B:Xe||(Xe=ae,this.opacities[xe]=Xe),r.add(xe);const He=Te>0||be>0,st=Re>0,at=this.placedOrientations[xe],Ye=at===s.bk.vertical,Qe=at===s.bk.horizontal||at===s.bk.horizontalOnly;!He&&!st||Xe.isHidden()||fe++;let Ft=!1;if((He||st)&&y)for(const ft of t.activeReplacements){if(s.br(ft,m,s.bs.Symbol,I)||ft.min.x>Ge||Ge>ft.max.x||ft.min.y>Ke||Ke>ft.max.y)continue;const Tt=s.bt(Ge,Ke,S.canonical,ft.footprintTileId.canonical);if(Ft=s.bu(Tt,ft.footprint),Ft)break}if(He){const ft=Ft?ya:ga(Xe.text);oe(t.text,Te,Ye?ya:ft),oe(t.text,be,Qe?ya:ft);const Tt=Xe.text.isHidden(),{leftJustifiedTextSymbolIndex:Kt,centerJustifiedTextSymbolIndex:Lt,rightJustifiedTextSymbolIndex:Zt,verticalPlacedTextSymbolIndex:_i}=_e,fi=t.text.placedSymbolArray,Xi=Tt||Ye?1:0;Kt>=0&&(fi.get(Kt).hidden=Xi),Lt>=0&&(fi.get(Lt).hidden=Xi),Zt>=0&&(fi.get(Zt).hidden=Xi),_i>=0&&(fi.get(_i).hidden=Tt||Qe?1:0);const er=this.variableOffsets[xe];er&&this.markUsedJustification(t,er.anchor,_e,at);const cr=this.placedOrientations[xe];cr&&(this.markUsedJustification(t,"left",_e,cr),this.markUsedOrientation(t,cr,_e))}if(st){const ft=Ft?ya:ga(Xe.icon),{placedIconSymbolIndex:Tt,verticalPlacedIconSymbolIndex:Kt}=_e,Lt=t.icon.placedSymbolArray,Zt=Xe.icon.isHidden()?1:0;Tt>=0&&(oe(t.icon,Re,Ye?ya:ft),Lt.get(Tt).hidden=Zt),Kt>=0&&(oe(t.icon,_e.numVerticalIconVertices,Qe?ya:ft),Lt.get(Kt).hidden=Zt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ft=t.collisionArrays[he];if(ft){let Tt=new s.P(0,0),Kt=!0;if(ft.textBox||ft.verticalTextBox){if(Z){const Zt=this.variableOffsets[xe];Zt?(Tt=_a(Zt.anchor,Zt.width,Zt.height,Zt.textOffset,Zt.textScale),H&&Tt._rotate(W?this.transform.angle:-this.transform.angle)):Kt=!1}k&&(Kt=!Xe.clipped),ft.textBox&&Ec(t.textCollisionBox.collisionVertexArray,Xe.text.placed,!Kt||Ye,rt,ne,Tt.x,Tt.y),ft.verticalTextBox&&Ec(t.textCollisionBox.collisionVertexArray,Xe.text.placed,!Kt||Qe,rt,ne,Tt.x,Tt.y)}const Lt=Kt&&!!(!Qe&&ft.verticalIconBox);ft.iconBox&&Ec(t.iconCollisionBox.collisionVertexArray,Xe.icon.placed,Lt,rt,ne,_e.hasIconTextFit?Tt.x:0,_e.hasIconTextFit?Tt.y:0),ft.verticalIconBox&&Ec(t.iconCollisionBox.collisionVertexArray,Xe.icon.placed,!Lt,rt,ne,_e.hasIconTextFit?Tt.x:0,_e.hasIconTextFit?Tt.y:0)}}}if(t.fullyClipped=fe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function Ec(l,t,r,c,f,m,y){l.emplaceBack(t?1:0,r?1:0,m||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,r?1:0,m||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,r?1:0,m||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,r?1:0,m||0,y||0,c,f?1:0)}const $s=Math.pow(2,25),km=Math.pow(2,24),af=Math.pow(2,17),Dn=Math.pow(2,16),Om=Math.pow(2,9),Sc=Math.pow(2,8),lf=Math.pow(2,1);function ga(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,r=Math.floor(127*l.opacity);return r*$s+t*km+r*af+t*Dn+r*Om+t*Sc+r*lf+t}const ya=0;class Bm{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,c,f,m){const y=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(y,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<y.length;){const S=y[this._currentPartIndex];if(r.placeLayerBucketPart(S,this._seenCrossTileIDs,c,S.symbolInstanceStart===0),this._currentPartIndex++,m())return!0}return!1}}class wl{constructor(t,r,c,f,m,y,S,I,P){this.placement=new Vo(t,m,y,S,I,P),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,r,c,f){const m=s.q.now(),y=()=>{const S=s.q.now()-m;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=r[t[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){const P=S,L=P.layout.get("symbol-z-elevate"),k=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,B=P.layout.get("symbol-z-order"),N=B==="viewport-y"||B==="auto"&&!(B!=="viewport-y"&&k),q=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),Z=N&&q,H=this._inProgressLayer=this._inProgressLayer||new Bm(P),W=s.av(S.source,S.scope);if(H.continuePlacement(L||Z?f[W]:c[W],this.placement,this._showCollisionBoxes,S,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Uo=512/s.ab/2;class Fm{constructor(t,r,c){this.tileID=t,this.bucketInstanceId=c,this.index=new s.by(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const f=t.canonical.x*s.ab,m=t.canonical.y*s.ab;for(let y=0;y<r.length;y++){const{key:S,crossTileID:I,tileAnchorX:P,tileAnchorY:L}=r.get(y),k=Math.floor((f+P)*Uo),B=Math.floor((m+L)*Uo);this.index.add(k,B),this.keys.push(S),this.crossTileIDs.push(I)}this.index.finish()}findMatches(t,r,c){const f=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),m=Uo/Math.pow(2,r.canonical.z-this.tileID.canonical.z),y=r.canonical.x*s.ab,S=r.canonical.y*s.ab;for(let I=0;I<t.length;I++){const P=t.get(I);if(P.crossTileID)continue;const{key:L,tileAnchorX:k,tileAnchorY:B}=P,N=Math.floor((y+k)*m),q=Math.floor((S+B)*m),Z=this.index.range(N-f,q-f,N+f,q+f);for(const H of Z){const W=this.crossTileIDs[H];if(this.keys[H]===L&&!c.has(W)){c.add(W),P.crossTileID=W;break}}}}}class xa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const c in this.indexes){const f=this.indexes[c],m={};for(const y in f){const S=f[y];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+r),m[S.tileID.key]=S}this.indexes[c]=m}this.lng=t}addBucket(t,r,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<r.symbolInstances.length;m++)r.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const f=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>t.overscaledZ)for(const S in y){const I=y[S];I.tileID.isChildOf(t)&&I.findMatches(r.symbolInstances,t,f)}else{const S=y[t.scaledTo(Number(m)).key];S&&S.findMatches(r.symbolInstances,t,f)}}for(let m=0;m<r.symbolInstances.length;m++){const y=r.symbolInstances.get(m);y.crossTileID||(y.crossTileID=c.generate(),f.add(y.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fm(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const c of r.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let r=!1;for(const c in this.indexes){const f=this.indexes[c];for(const m in f)t[f[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[m]),delete f[m],r=!0)}return r}}class Mc{constructor(){this.layerIndexes={},this.crossTileIDs=new xa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,c,f){let m=this.layerIndexes[t.fqid];m===void 0&&(m=this.layerIndexes[t.fqid]=new cf);let y=!1;const S={};f.name!=="globe"&&m.handleWrapJump(c);for(const I of r){const P=I.getBucket(t);P&&t.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(I.tileID,P,this.crossTileIDs)&&(y=!0),S[P.bucketInstanceId]=!0)}return m.removeStaleBuckets(S)&&(y=!0),y}pruneUnusedLayers(t){const r={};t.forEach(c=>{r[c]=!0});for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}const Zn=771;class bi{constructor(t,r,c,f){this.blendFunction=t,this.blendColor=r,this.mask=c,this.blendEquation=f}}bi.Replace=[1,0,1,0],bi.disabled=new bi(bi.Replace,s.bz.transparent,[!1,!1,!1,!1]),bi.unblended=new bi(bi.Replace,s.bz.transparent,[!0,!0,!0,!0]),bi.alphaBlended=new bi([1,Zn,1,Zn],s.bz.transparent,[!0,!0,!0,!0]),bi.alphaBlendedNonPremultiplied=new bi([770,Zn,770,Zn],s.bz.transparent,[!0,!0,!0,!0]),bi.multiply=new bi([774,0,774,0],s.bz.transparent,[!0,!0,!0,!0]);class Vt{constructor(t,r,c){this.func=t,this.mask=r,this.range=c}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const rh=7680;class li{constructor(t,r,c,f,m,y){this.test=t,this.ref=r,this.mask=c,this.fail=f,this.depthFail=m,this.pass=y}}li.disabled=new li({func:519,mask:0},0,0,rh,rh,rh);const nh=1029,Tl=2305;class ei{constructor(t,r,c){this.enable=t,this.mode=r,this.frontFace=c}}function sh(l,t){const r=s.bC(l,3);s.a6.mat4.fromQuat(l,t),s.bE(l,3,r)}function Ac(l,t){const r=s.a6.quat.identity([]);return s.a6.quat.rotateZ(r,r,-t),s.a6.quat.rotateX(r,r,-l),r}function oh(l,t){const r=[l[0],l[1],0],c=[t[0],t[1],0];if(s.a6.vec3.length(r)>=1e-15){const y=s.a6.vec3.normalize([],r);s.a6.vec3.scale(c,y,s.a6.vec3.dot(c,y)),t[0]=c[0],t[1]=c[1]}const f=s.a6.vec3.cross([],t,l);if(s.a6.vec3.len(f)<1e-15)return null;const m=Math.atan2(-f[1],f[0]);return Ac(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),m)}ei.disabled=new ei(!1,nh,Tl),ei.backCCW=new ei(!0,nh,Tl),ei.backCW=new ei(!0,nh,2304),ei.frontCW=new ei(!0,1028,2304),ei.frontCCW=new ei(!0,1028,Tl);class po{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof s.a5?t:new s.a5(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=s.bA(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const c=this.position,f=this._elevation?this._elevation.getAtPointOrZero(s.a5.fromLngLat(t)):0,m=s.a5.fromLngLat(t,f),y=[m.x-c.x,m.y-c.y,m.z-c.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=oh(y,r)}setPitchBearing(t,r){this.orientation=Ac(s.bB(t),s.bB(-r))}}class jo{constructor(t,r){this._transform=s.a6.mat4.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new s.a5(t[0],t[1],t[2])}get position(){const t=s.bC(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&s.bE(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.a6.quat.identity([]),t&&sh(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Ac(t,r),sh(this._transform,this._orientation)}forward(){const t=s.bC(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.bC(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.bC(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const c=new Float64Array(16);return s.a6.mat4.invert(c,this.getWorldToCamera(t,r)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,c){const f=this.position;s.a6.vec3.scale(f,f,-t);const m=new Float64Array(16);return s.a6.mat4.fromScaling(m,[c,c,c]),s.a6.mat4.translate(m,m,f),m[10]*=r,m}getWorldToCamera(t,r){const c=new Float64Array(16),f=new Float64Array(4),m=this.position;return s.a6.quat.conjugate(f,this._orientation),s.a6.vec3.scale(m,m,-t),s.a6.mat4.fromQuat(c,f),s.a6.mat4.translate(c,c,m),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=r,c[9]*=r,c[10]*=r,c[11]*=r,c}getCameraToClipPerspective(t,r,c,f){const m=new Float64Array(16);return s.a6.mat4.perspective(m,t,r,c,f),m}getCameraToClipOrthographic(t,r,c,f,m,y){const S=new Float64Array(16);return s.a6.mat4.ortho(S,t,r,c,f,m,y),S}getDistanceToElevation(t,r=!1){const c=t===0?0:s.bD(t,r?s.aM(this.position[1]):this.position[1]),f=this.forward();return(c-this.position[2])/f[2]}clone(){return new jo([...this.position],[...this.orientation])}}const un={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Ic{constructor(t=0,r=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=c,this.right=f}interpolate(t,r,c){return r.top!=null&&t.top!=null&&(this.top=s.aa(t.top,r.top,c)),r.bottom!=null&&t.bottom!=null&&(this.bottom=s.aa(t.bottom,r.bottom,c)),r.left!=null&&t.left!=null&&(this.left=s.aa(t.left,r.left,c)),r.right!=null&&t.right!=null&&(this.right=s.aa(t.right,r.right,c)),this}getCenter(t,r){const c=s.ap((this.left+t-this.right)/2,0,t),f=s.ap((this.top+r-this.bottom)/2,0,r);return new s.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ic(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const va=(l,t,r)=>(1-r)*l+r*t,ba=l=>l*l*l*l*l;class Cc{constructor(t,r,c,f,m,y,S){this.tileSize=512,this._renderWorldCopies=m===void 0||m,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=c??0,this._maxPitch=f??60,this.setProjection(y),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ic,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new jo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Cc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return s.ar(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=s.bL(this.projectionOptions);const c=this.getProjection(),f=!s.bh(r,c);return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bL({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bA(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=s.a6.mat2.create(),s.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=s.ap(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.bB(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let f=0,m=0;for(let y=0;y<r.length;y++){const S=new s.P(r[y][0]*this.width,c+r[y][1]*(this.height-c)),I=t.pointCoordinate(S);if(!I)continue;const P=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);f+=I[3]*P,m+=P}return m===0?NaN:f/m}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*r,f=this._mercatorZfromZoom(t),m=this._mercatorZfromZoom(this._maxZoom),y=Math.max(f-c,m);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const f=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,c));return s.ap(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!s.a6.quat.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];s.a6.vec3.exactEquals(c,this._camera.position)||(this._setCameraPosition(c),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new po;return r.position=new s.a5(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!s.a6.quat.length(t))return!1;s.a6.quat.normalize(t,t);const r=s.a6.vec3.transformQuat([],[0,0,-1],t),c=s.a6.vec3.transformQuat([],[0,-1,0],t);if(c[2]<0)return!1;const f=oh(r,c);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;t[2]=s.ap(t[2],f/c,f/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,c){this._unmodified=!1,this._edgeInsets.interpolate(t,r,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new s.bM(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new s.P(0,0)),f=this.pointCoordinate(new s.P(this.width,0)),m=this.pointCoordinate(new s.P(this.width,this.height)),y=this.pointCoordinate(new s.P(0,this.height)),S=Math.floor(Math.min(c.x,f.x,m.x,y.x)),I=Math.floor(Math.max(c.x,f.x,m.x,y.x)),P=1;for(let L=S-P;L<=I+P;L++)L!==0&&r.push(new s.bM(L,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,c){let f=[];const m=c!==void 0,y=!m;if(y&&this.zoom<r||m&&c[0]===0&&c[1]===0)return f;const S=new Set,I=(L,k,B,N,q)=>{const Z=s.c1(k,L,B,N,q);S.has(Z)||(f.push(new s.aA(L,k,B,N,q)),S.add(Z))};for(let L=0;L<t.length;L++){const k=t[L];if(y&&k.canonical.z!==r)continue;const B=k.canonical,N=k.overscaledZ,q=k.wrap,Z=1<<B.z,H=B.x+1<Z,W=B.x>0,ie=B.y+1<Z,ne=B.y>0,ee=k.wrap-(W?0:1),ae=k.wrap+(H?0:1),oe=W?B.x-1:Z-1,fe=H?B.x+1:0;if(m)c[0]<0?(I(N,ae,B.z,fe,B.y),c[1]<0&&ie&&(I(N,q,B.z,B.x,B.y+1),I(N,ae,B.z,fe,B.y+1)),c[1]>0&&ne&&(I(N,q,B.z,B.x,B.y-1),I(N,ae,B.z,fe,B.y-1))):c[0]>0?(I(N,ee,B.z,oe,B.y),c[1]<0&&ie&&(I(N,q,B.z,B.x,B.y+1),I(N,ee,B.z,oe,B.y+1)),c[1]>0&&ne&&(I(N,q,B.z,B.x,B.y-1),I(N,ee,B.z,oe,B.y-1))):c[1]<0&&ie?I(N,q,B.z,B.x,B.y+1):ne&&I(N,q,B.z,B.x,B.y-1);else{const he=k.visibleQuadrants;1&he&&(I(N,ee,B.z,oe,B.y),ne&&(I(N,q,B.z,B.x,B.y-1),I(N,ee,B.z,oe,B.y-1))),2&he&&(I(N,ae,B.z,fe,B.y),ne&&(I(N,q,B.z,B.x,B.y-1),I(N,ae,B.z,fe,B.y-1))),4&he&&(I(N,ee,B.z,oe,B.y),ie&&(I(N,q,B.z,B.x,B.y+1),I(N,ee,B.z,oe,B.y+1))),8&he&&(I(N,ae,B.z,fe,B.y),ie&&(I(N,q,B.z,B.x,B.y+1),I(N,ae,B.z,fe,B.y+1)))}}const P=[];for(const L of f)f.some(k=>L.isChildOf(k))||P.push(L);if(f=P.filter(L=>!t.some(k=>!!(L.overscaledZ<r&&k.isChildOf(L))||L.equals(k)||L.isChildOf(k))),y){const L=1<<r,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[L*k.x,L*k.y],N=4,q=N*N;f=f.filter(Z=>{const H=Z.canonical.x+.5-B[0],W=Z.canonical.y+.5-B[1];return H*H+W*W<q})}return f}coveringTiles(t){let r=this.coveringZoomLevel(t);const c=r,f=this.elevation&&this.elevation.exaggeration(),m=f&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const S=this.locationCoordinate(this.center),I=this.center.lat,P=1<<r,L=[P*S.x,P*S.y,0],k=this.projection.name==="globe",B=!k,N=s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,B),q=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=P*s.bD(1,this.center.lat),H=this._camera.position[2]/s.bD(1,this.center.lat),W=[P*q.x,P*q.y,H*(B?1:Z)],ie=k||f,ne=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ee=this.isLODDisabled(!0)?r:0;let ae;if(this._elevation&&t.isTerrainDEM)ae=1e4*this._elevation.exaggeration();else if(this._elevation){const Le=this._elevation.getMinMaxForVisibleTiles();ae=Le?Le.max:this._centerAltitude}else ae=this._centerAltitude;const oe=t.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?s.bO(this):1,he=Le=>{const He=new s.a5(Le.x+25e-6,Le.y,Le.z),st=new s.a5(Le.x,Le.y+25e-6,Le.z),at=Le.toLngLat(),Ye=He.toLngLat(),Qe=st.toLngLat(),Ft=this.locationCoordinate(at),ft=this.locationCoordinate(Ye),Tt=this.locationCoordinate(Qe),Kt=Math.hypot(ft.x-Ft.x,ft.y-Ft.y),Lt=Math.hypot(Tt.x-Ft.x,Tt.y-Ft.y);return Math.sqrt(Kt*Lt)*fe/25e-6},_e=Le=>{const Xe=ae,He=oe;return{aabb:s.bR(this,P,0,0,0,Le,He,Xe,this.projection),zoom:0,x:0,y:0,minZ:He,maxZ:Xe,wrap:Le,fullyVisible:!1}},Te=[];let be=[];const xe=r,Re=t.reparseOverscaled?c:r,Ge=(H-this._centerAltitude)*Z,Ke=Le=>{if(!this._elevation||!Le.tileID||!y)return;const Xe=this._elevation.getMinMaxForTile(Le.tileID),He=Le.aabb;Xe?(He.min[2]=Xe.min,He.max[2]=Xe.max,He.center[2]=(He.min[2]+He.max[2])/2):(Le.shouldSplit=rt(Le),Le.shouldSplit||(He.min[2]=He.max[2]=He.center[2]=this._centerAltitude))},je=(Le,Xe)=>{if(.707*Xe<Le)return 1;const He=Xe/Le;return He/(1.4144271570014144+(Math.pow(1.1,He-1.4144271570014144+1)-1)/(1.1-1)-1)},rt=Le=>{if(Le.zoom<ee)return!0;if(Le.zoom===xe)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;const Xe=Le.aabb.distanceX(W),He=Le.aabb.distanceY(W);let st=Ge,at=1;if(k){st=Le.aabb.distanceZ(W);const Lt=Math.pow(2,Le.zoom),Zt=s.aM((Le.y+1)/Lt),_i=s.aM(Le.y/Lt),fi=Math.min(Math.max(I,Zt),_i),Xi=s.c5(fi)/s.c5(I);if(at=fi===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xi/this._mercatorScaleRatio),this.zoom<=s.c2&&Le.zoom===xe-1&&Xi>=.9)return!0}else if(m&&(st=Le.aabb.distanceZ(W)*Z),this.projection.isReprojectedInTileSpace&&c<=5){const Lt=Math.pow(2,Le.zoom),Zt=he(new s.a5((Le.x+.5)/Lt,(Le.y+.5)/Lt));at=Zt>.85?1:Zt}if(!y){const Lt=Math.sqrt(Xe*Xe+He*He+st*st);let Zt=(1<<xe-Le.zoom)*ne*at;return Zt*=je(Math.max(st,Ge),Lt),Lt<Zt}let Ye=Number.MAX_VALUE,Qe=0;const Ft=Le.aabb.getCorners(),ft=[];for(const Lt of Ft){s.a6.vec3.sub(ft,Lt,W),k||(m?ft[2]*=Z:ft[2]=Ge);const Zt=s.a6.vec3.dot(ft,this._camera.forward());Zt<Ye&&(Ye=Zt,Qe=Math.abs(ft[2]))}let Tt=(1<<xe-Le.zoom)*ne*at;if(Tt*=je(Math.max(Qe,Ge),Ye),Ye<Tt)return!0;const Kt=Le.aabb.closestPoint(L);return Kt[0]===L[0]&&Kt[1]===L[1]};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Te.push(_e(-Le)),Te.push(_e(Le));for(Te.push(_e(0));Te.length>0;){const Le=Te.pop(),Xe=Le.x,He=Le.y;let st=Le.fullyVisible;const at=()=>this.projection.name==="globe"&&(Le.y===0||Le.y===(1<<Le.zoom)-1);if(!st){let Ye=ie?Le.aabb.intersects(N):Le.aabb.intersectsFlat(N);if(Ye===0&&at()){const Qe=new s.bP(Le.zoom,Xe,He);Ye=s.bQ(this,P,Qe,!0).intersects(N)}if(Ye===0)continue;st=Ye===2}if(Le.zoom!==xe&&rt(Le))for(let Ye=0;Ye<4;Ye++){const Qe=(Xe<<1)+Ye%2,Ft=(He<<1)+(Ye>>1),ft={aabb:y?Le.aabb.quadrant(Ye):s.bR(this,P,Le.zoom+1,Qe,Ft,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:Qe,y:Ft,wrap:Le.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};m&&!k&&(ft.tileID=new s.aA(Le.zoom+1===xe?Re:Le.zoom+1,Le.wrap,Le.zoom+1,Qe,Ft),Ke(ft)),Te.push(ft)}else{const Ye=Le.zoom===xe?Re:Le.zoom;if(t.minzoom&&t.minzoom>Ye)continue;let Qe=0;if(!st){let Kt=ie?Le.aabb.intersectsPrecise(N):Le.aabb.intersectsPreciseFlat(N);if(Kt===0&&at()){const Lt=new s.bP(Le.zoom,Xe,He);Kt=s.bQ(this,P,Lt,!0).intersectsPrecise(N)}if(Kt===0)continue;if(t.calculateQuadrantVisibility)if(N.containsPoint(Le.aabb.center))Qe=15;else for(let Lt=0;Lt<4;Lt++)Le.aabb.quadrant(Lt).intersects(N)!==0&&(Qe|=1<<Lt)}const Ft=L[0]-(.5+Xe+(Le.wrap<<Le.zoom))*(1<<r-Le.zoom),ft=L[1]-.5-He,Tt=Le.tileID?Le.tileID:new s.aA(Ye,Le.wrap,Le.zoom,Xe,He);t.calculateQuadrantVisibility&&(Tt.visibleQuadrants=Qe),be.push({tileID:Tt,distanceSq:Ft*Ft+ft*ft})}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,Xe=this.horizonLineFromTop();be=be.filter(He=>{const st=[0,0,0,1],at=[s.ab,s.ab,0,1],Ye=this.calculateFogTileMatrix(He.tileID.toUnwrapped());s.a6.vec4.transformMat4(st,st,Ye),s.a6.vec4.transformMat4(at,at,Ye);const Qe=s.a6.vec4.min([],st,at),Ft=s.a6.vec4.max([],st,at),ft=s.bS(Qe,Ft);if(ft===0)return!0;let Tt=!1;const Kt=this._elevation;if(Kt&&ft>Le&&Xe!==0){const Lt=this.calculateProjMatrix(He.tileID.toUnwrapped());let Zt;t.isTerrainDEM||(Zt=Kt.getMinMaxForTile(He.tileID)),Zt||(Zt={min:oe,max:ae});const _i=s.c3(this.rotation),fi=[_i[0]*s.ab,_i[1]*s.ab,Zt.max];s.a6.vec3.transformMat4(fi,fi,Lt),Tt=(1-fi[1])*this.height*.5<Xe}return ft<Le||Tt})}return be.sort((Le,Xe)=>Le.distanceSq-Xe.distanceSq).map(Le=>Le.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=s.ap(t.lat,-s.bT,s.bT),c=this.projection.project(t.lng,r);return new s.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let c,f;const m=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;c=(r.x-m.x)/S,f=(r.y-m.y)/S}else{const S=this.pointCoordinate(r),I=this.pointCoordinate(m);c=S.x-I.x,f=S.y-I.y}const y=this.locationCoordinate(t);this.setLocation(new s.a5(y.x-c,y.y-f))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,r){const c=r?s.bD(r,t.lat):void 0,f=this.projection.project(t.lng,t.lat);return new s.a5(f.x,f.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const c=r??this._centerAltitude,f=[t.x,t.y,0,1],m=[t.x,t.y,1,1];s.a6.vec4.transformMat4(f,f,this.pixelMatrixInverse),s.a6.vec4.transformMat4(m,m,this.pixelMatrixInverse);const y=m[3];s.a6.vec4.scale(f,f,1/f[3]),s.a6.vec4.scale(m,m,1/y);const S=f[2],I=m[2];return{p0:f,p1:m,t:S===I?0:(c-S)/(I-S)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return s.a6.vec4.transformMat4(r,r,this.pixelMatrixInverse),s.a6.vec4.transformMat4(c,c,this.pixelMatrixInverse),s.a6.vec4.scale(r,r,1/r[3]),s.a6.vec4.scale(c,c,1/c[3]),r[2]=s.bD(r[2],this._center.lat)*this.worldSize,c[2]=s.bD(c[2],this._center.lat)*this.worldSize,s.a6.vec4.scale(r,r,1/this.worldSize),s.a6.vec4.scale(c,c,1/this.worldSize),new s.aj([r[0],r[1],r[2]],s.a6.vec3.normalize([],s.a6.vec3.sub([],c,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:c,t:f}=t,m=s.bD(r[2],this._center.lat),y=s.bD(c[2],this._center.lat);return new s.a5(s.aa(r[0],c[0],f)/this.worldSize,s.aa(r[1],c[1],f)/this.worldSize,s.aa(m,y,f))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new s.a5(r[0],r[1],r[2]);let c=0,f=this.horizonLineFromTop();if(t.y>f)return this.pointCoordinate(t);const m=.02*f,y=t.clone();for(let S=0;S<10&&f-c>m;S++){y.y=s.aa(c,f,.66);const I=this.projection.pointCoordinate3D(this,y.x,y.y);I?(f=y.y,r=I):c=y.y}return r?new s.a5(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.bU)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const c=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,f=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return s.a6.vec4.transformMat4(f,f,this.pixelMatrix),f[3]>0?new s.P(f[0]/f[3],f[1]/f[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,m=this.pointLocation3D(new s.P(r,t)),y=this.pointLocation3D(new s.P(f,t)),S=this.pointLocation3D(new s.P(f,c)),I=this.pointLocation3D(new s.P(r,c));let P=Math.min(m.lng,y.lng,S.lng,I.lng),L=Math.max(m.lng,y.lng,S.lng,I.lng),k=Math.min(m.lat,y.lat,S.lat,I.lat),B=Math.max(m.lat,y.lat,S.lat,I.lat);const N=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,Z=(H,W,ie,ne,ee)=>{const ae=(H+ie)/2,oe=(W+ne)/2,fe=new s.P(ae,oe),{lng:he,lat:_e}=this.pointLocation3D(fe),Te=Math.max(0,P-he,k-_e,he-L,_e-B);P=Math.min(P,he),L=Math.max(L,he),k=Math.min(k,_e),B=Math.max(B,_e),(ee<q||Te>N)&&(Z(H,W,ae,oe,ee+1),Z(ae,oe,ie,ne,ee+1))};if(Z(r,t,f,t,1),Z(f,t,f,c,1),Z(f,c,r,c,1),Z(r,c,r,t,1),this.projection.name==="globe"){const[H,W]=s.bV(this);H?(B=90,L=180,P=-180):W&&(k=-90,L=180,P=-180)}return new s.as(new s.bK(P,k),new s.bK(L,B))}_getBoundsRectangular(t,r){const{top:c,left:f}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,S=new s.P(f,c),I=new s.P(y,c),P=new s.P(y,m),L=new s.P(f,m);let k=this.pointCoordinate(S,t),B=this.pointCoordinate(I,t);const N=this.pointCoordinate(P,r),q=this.pointCoordinate(L,r),Z=(H,W)=>(W.y-H.y)/(W.x-H.x);return k.y>1&&B.y>=0?k=new s.a5((1-q.y)/Z(q,k)+q.x,1):k.y<0&&B.y<=1&&(k=new s.a5(-q.y/Z(q,k)+q.x,0)),B.y>1&&k.y>=0?B=new s.a5((1-N.y)/Z(N,B)+N.x,1):B.y<0&&k.y<=1&&(B=new s.a5(-N.y/Z(N,B)+N.x,0)),new s.as().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((c,f)=>{if(f.dem){const m=f.dem.tree;c.min=Math.min(c.min,m.minimums[0]),c.max=Math.max(c.max,m.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.bT,this.maxLat=s.bT,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.am(this.minLng)*this.tileSize,this.worldMaxX=s.am(this.maxLng)*this.tileSize,this.worldMinY=s.at(this.maxLat)*this.tileSize,this.worldMaxY=s.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,c=this._distanceTileDataCache;if(c[r])return c[r];const f=t.canonical,m=1/this.height,y=this.cameraWorldSize,S=y/this.zoomScale(f.z),I=(f.x+Math.pow(2,f.z)*t.wrap)*S,P=f.y*S,L=this.point;L.x*=y/this.worldSize,L.y*=y/this.worldSize;const k=this.angle,B=Math.sin(-k),N=-Math.cos(-k);return c[r]={bearing:[B,N],center:[(L.x-I)*m,(L.y-P)*m],scale:S/s.ab*m},c[r]}calculateFogTileMatrix(t){const r=t.key,c=this._fogTileMatrixCache;if(c[r])return c[r];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.a6.mat4.multiply(f,this.worldToFogMatrix,f),c[r]=new Float32Array(f),c[r]}calculateProjMatrix(t,r=!1,c=!1){const f=t.key;let m;if(m=c?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,m[f])return m[f];const y=this.calculatePosMatrix(t,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,s.a6.mat4.multiply(y,S,y),m[f]=new Float32Array(y),m[f]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[r])return c[r];const f=s.bW(t,this);return c[r]=f,c[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=s.a6.mat4.fromScaling([],[t,t,t]);return s.a6.mat4.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=s.bD(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(r),f=this._camera.forward(),m=s.bD(1,this._center.lat);c[2]/=m,f[2]/=m,s.a6.vec3.normalize(f,f);const y=t.raycast(c,f,t.exaggeration());if(y){const S=s.a6.vec3.scaleAndAdd([],c,f,y),I=new s.a5(S[0],S[1],s.bD(S[2],s.aM(S[1]))),P=(I.z+s.a6.vec3.length([I.x-c[0],I.y-c[1],I.z-c[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,c=s.bD(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),m=r.getAtPointOrZero(new s.a5(...f)),y=this.pixelsPerMeter/this.worldSize*m,S=this._minimumHeightOverTerrain(),I=f[2]-y;if(I<=S)if(I<0||t){const P=this.locationCoordinate(this._center,this._centerAltitude),L=[f[0],f[1],P.z-f[2]],k=s.a6.vec3.length(L);L[2]-=(S-I)/this._pixelsPerMercatorPixel;const B=s.a6.vec3.length(L);if(B===0)return;s.a6.vec3.scale(L,L,k/B*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],P.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=s.ap(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=s.ap(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const r=this._unmodified,{x:c,y:f}=this.point;let m=0,y=c,S=f;const I=this.width/2,P=this.height/2,L=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(f-P<L&&(S=L+P),f+P>k&&(S=k-P),k-L<this.height&&(m=Math.max(m,this.height/(k-L)),S=(k+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,q=this.worldSize/2-(B+N)/2;y=(c+q+this.worldSize)%this.worldSize-q,y-I<B&&(y=B+I),y+I>N&&(y=N-I),N-B<this.width&&(m=Math.max(m,this.width/(N-B)),y=(N+B)/2)}y===c&&S===f||(this.center=this.unproject(new s.P(y,S))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bD(1,this.center.lat)/s.bD(1,s.c4));const f=s.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this.projection.zAxisUnit==="meters"?c:1,y=this._camera.getWorldToCamera(this.worldSize,m);let S;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-t.x/this.width,I[9]=2*t.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Te=_e*this.aspect,be=-Te,xe=-_e;Te-=t.x,be-=t.x,_e+=t.y,xe+=t.y,S=this._camera.getCameraToClipOrthographic(be,Te,xe,_e,this._nearZ,this._farZ),((Re,Ge,Ke,je)=>{for(let rt=0;rt<16;rt++)Re[rt]=va(Ge[rt],Ke[rt],je)})(S,S,I,ba(this.pitch>=15?1:this.pitch/15))}else S=I;const P=s.a6.mat4.mul([],I,y);let L=s.a6.mat4.mul([],S,y);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),Te=s.a6.mat4.identity([]);s.a6.mat4.translate(Te,Te,[_e.x*this.worldSize,_e.y*this.worldSize,0]),s.a6.mat4.multiply(Te,Te,s.bY(this)),s.a6.mat4.translate(Te,Te,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),s.a6.mat4.multiply(L,L,Te),s.a6.mat4.multiply(P,P,Te),this.inverseAdjustmentMatrix=s.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a6.mat4.scale([],L,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=L,this.invProjMatrix=s.a6.mat4.invert(new Float64Array(16),this.projMatrix),r){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-t.x/this.width,_e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.a6.mat4.mul([],_e,y)}else this.expandedFarZProjMatrix=this.projMatrix;const k=s.a6.mat4.invert([],S);this.frustumCorners=s.b_.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const B=new Float32Array(16);s.a6.mat4.identity(B),s.a6.mat4.scale(B,B,[1,-1,1]),s.a6.mat4.rotateX(B,B,this._pitch),s.a6.mat4.rotateZ(B,B,this.angle);const N=s.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a6.mat4.clone(N);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-t.x/this.width,N[9]=2*(t.y+q)/this.height,this.skyboxMatrix=s.a6.mat4.multiply(B,N,B);const Z=this.point,H=Z.x,W=Z.y,ie=this.width%2/2,ne=this.height%2/2,ee=Math.cos(this.angle),ae=Math.sin(this.angle),oe=H-Math.round(H)+ee*ie+ae*ne,fe=W-Math.round(W)+ee*ne+ae*ie,he=new Float64Array(L);if(s.a6.mat4.translate(he,he,[oe>.5?oe-1:oe,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=he,L=s.a6.mat4.create(),s.a6.mat4.scale(L,L,[this.width/2,-this.height/2,1]),s.a6.mat4.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=s.a6.mat4.create(),s.a6.mat4.scale(L,L,[1,-1,1]),s.a6.mat4.translate(L,L,[-1,-1,0]),s.a6.mat4.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=s.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},L=s.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.b$(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.a6.vec3.transformMat4(_e,_e,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,c=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,m=[t,t,r];s.a6.vec3.scale(m,m,f),s.a6.vec3.scale(c,c,-1),s.a6.vec3.multiply(c,c,m);const y=s.a6.mat4.create();s.a6.mat4.translate(y,y,c),s.a6.mat4.scale(y,y,m),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,f)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),f=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-c[0]*m,f.y/this.worldSize-c[1]*m,t/this.worldSize*this._centerAltitude-c[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],f=t[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(m=Math.min((r-c)/f,1)),this._camera.position=s.a6.vec3.scaleAndAdd([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:c,bearing:f}=this._camera.getPitchBearing(),m=s.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bB(this._maxPitch)),S=Math.max((t[2]-m)/Math.cos(c),y),I=this._zoomFromMercatorZ(S);s.a6.vec3.scaleAndAdd(t,t,r,S),this._pitch=s.ap(c,s.bB(this.minPitch),s.bB(this.maxPitch)),this.angle=s.bA(f,-Math.PI,Math.PI),this._setZoom(s.ap(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.a5(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,c=s.bU,f=0,m=1/0;for(;c-r>1e-6&&c>r;){const y=r+.5*(c-r),S=this.tileSize*Math.pow(2,y),I=this.getCameraToCenterDistance(this.projection,y,S),P=this.scaleZoom(I/(t*this.tileSize)),L=Math.abs(y-P);L<m&&(m=L,f=y),y<P?r=y:c=y}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const c=Math.min(t.x,r.x),f=Math.max(t.x,r.x),m=Math.min(t.y,r.y),y=Math.max(t.y,r.y);if(m<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.P(c,m),new s.P(f,y),new s.P(c,y),new s.P(f,m)],I=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const L of S){const k=this.pointRayIntersection(L);if(k.t<0)return!0;const B=this.rayIntersectionCoordinate(k);if(B.x<I||B.y<0||B.x>P||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,r){const c=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,t)),f=this._zoomFromMercatorZ(c)+r;return c-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([r,c,f],m){const y=[r,c,f,1];s.a6.vec4.transformMat4(y,y,m);const S=y[3]=Math.max(y[3],1e-6);return y[0]/=S,y[1]/=S,y[2]/=S,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,c=this.worldSize){const f=s.bX(t,r,this.width,this.height,1024),m=t.pixelSpaceConversion(this.center.lat,c,f);let y=.5/Math.tan(.5*this._fov)*this.height*m;return this.isOrthographic&&(y=va(1,y,ba(this.pitch>=15?1:this.pitch/15))),y}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.a6.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Zs=(l,t)=>{if(t>0&&l.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=l.transform,c=Math.max(Math.abs(r._zoom-(l.minCutoffZoom-1)),1),f=r.isLODDisabled(!1)?s.a7(60,45,r.pitch):s.a7(30,15,r.pitch),m=r._farZ-r._nearZ,y=t*r.height,S=((1-(I=f))*r.cameraToCenterDistance+I*(r._farZ+y))*c;var I;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(S-r._nearZ)/m,(S-y-r._nearZ)/m]}}},xr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class ah{constructor(t,r){this.aabb=t,this.lastCascade=r}}class mt{add(t,r){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],r.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],r.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],r.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],r.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],r.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],r.max[2])):this.receivers[t.key]=new ah(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,c){const f=s.c9.fromPoints(t.points);let m=0;for(const y in this.receivers){const S=this.receivers[y];if(!S||!f.intersectsAabb(S.aabb))continue;S.aabb.min=f.closestPoint(S.aabb.min),S.aabb.max=f.closestPoint(S.aabb.max);const I=S.aabb.getCorners();for(let P=0;P<c.length;P++){let L=!0;for(const k of I){const B=[k[0]*r,k[1]*r,k[2]];if(s.a6.vec3.transformMat4(B,B,c[P].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(S.lastCascade=P,m=Math.max(m,P),L)break}}return m+1}}class uf{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new mt,this._depthMode=new Vt(t.context.gl.LEQUAL,Vt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(xr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(xr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(xr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const f=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||f<=0||(this._shadowLayerCount=c.style.order.reduce((q,Z)=>{const H=c.style._mergedLayers[Z];return q+(H.hasShadowPass()&&!H.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const m=c.context,y=xr.shadowMapResolution,S=xr.shadowMapResolution;if(this._cascades.length===0||xr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<xr.cascadeCount;++q){const Z=c._shadowMapDebug,H=m.gl,W=m.createFramebuffer(y,S,Z,"texture"),ie=new s.T(m,{width:y,height:S,data:null},H.DEPTH_COMPONENT16);if(W.depthAttachment.set(ie.texture),Z){const ne=new s.T(m,{width:y,height:S,data:null},H.RGBA8);W.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:W,texture:ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bN,scale:0})}}this.shadowDirection=Pc(r);let I=0;if(t.elevation){const q=t.elevation,Z=[1e4,-1e4];q.visibleDemTiles.filter(H=>H.dem).forEach(H=>{const W=H.dem.tree;Z[0]=Math.min(Z[0],W.minimums[0]),Z[1]=Math.max(Z[1],W.maximums[0])}),Z[0]!==1e4&&(I=(Z[1]-Z[0])*q.exaggeration())}const P=1.5*t.cameraToCenterDistance,L=3*P,k=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const Z=this._cascades[q];let H=t.height/50,W=1;xr.cascadeCount===1?W=L:q===0?W=P:(H=P,W=L);const[ie,ne]=Lc(t,this.shadowDirection,H,W,xr.shadowMapResolution,I);Z.scale=t.scale,Z.matrix=ie,Z.boundingSphereRadius=ne,s.a6.mat4.invert(k,Z.matrix),Z.frustum=s.bN.fromInvProjectionMatrix(k,1,0,!0),Z.far=W}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/xr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=xr.shadowMapResolution,this._uniformValues.u_shadowmap_0=un.ShadowMap0,this._uniformValues.u_shadowmap_1=un.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const N=c.transform.elevation;for(const q of this._groundShadowTiles){let Z={min:0,max:0};if(N){const H=N.getMinMaxForTile(q);H&&(Z=H)}this.addShadowReceiver(q.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const c=this.painter,f=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),f.viewport.set([0,0,xr.shadowMapResolution,xr.shadowMapResolution]);for(let m=0;m<this._numCascadesToRender;++m){c.currentShadowCascade=m,f.bindFramebuffer.set(this._cascades[m].framebuffer.framebuffer),f.clear({color:s.bz.white,depth:1});for(const y of t.order){const S=t._mergedLayers[y];if(!S.hasShadowPass()||S.isHidden(c.transform.zoom))continue;const I=t.getLayerSourceCache(S),P=I?r[I.id]:void 0;(S.type==="model"||P&&P.length)&&c.renderLayer(c,I,S,P)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,c=t.context,f=r.directionalLight,m=r.ambientLight;if(!f||!m)return;const y=[],S=Zs(t,t.longestCutoffRange);S.shouldRenderCutoff&&y.push("RENDER_CUTOFF");const I=Rc(r,f,m),P=new Vt(c.gl.LEQUAL,Vt.ReadOnly,t.depthRangeFor3D);for(const L of this._groundShadowTiles){const k=L.toUnwrapped(),B=t.isTileAffectedByFog(L),N=t.getOrCreateProgram("groundShadow",{defines:y,overrideFog:B});this.setupShadows(k,N),t.uploadCommonUniforms(c,N,k,null,S);const q={u_matrix:t.transform.calculateProjMatrix(k),u_ground_shadow_factor:I};N.draw(t,c.gl.TRIANGLES,P,li.disabled,bi.multiply,ei.disabled,q,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?bi.unblended:bi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,c=r.calculatePosMatrix(t,r.worldSize);return s.a6.mat4.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){return s.a6.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,c,f=0){if(!this.enabled)return;const m=this.painter.transform,y=this.painter.context,S=y.gl,I=this._uniformValues,P=new Float64Array(16),L=m.calculatePosMatrix(t,m.worldSize);for(let k=0;k<this._cascades.length;k++)s.a6.mat4.multiply(P,this._cascades[k].matrix,L),I[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),y.activeTexture.set(S.TEXTURE0+un.ShadowMap0+k),this._cascades[k].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!c,this.useNormalOffset){const k=s.c8(t.canonical),B=2/m.tileSize*s.ab/xr.shadowMapResolution,N=B*this._cascades[0].boundingSphereRadius,q=B*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(c==="vector-tile"?1:3)/Math.pow(2,f-t.canonical.z-(1-m.zoom+Math.floor(m.zoom)));I.u_shadow_normal_offset=[k,N*Z,q*Z],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(y,I)}setupShadowsFromMatrix(t,r,c=!1){if(!this.enabled)return;const f=this.painter.context,m=f.gl,y=this._uniformValues,S=new Float64Array(16);for(let I=0;I<xr.cascadeCount;I++)s.a6.mat4.multiply(S,this._cascades[I].matrix,t),y[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),f.activeTexture.set(m.TEXTURE0+un.ShadowMap0+I),this._cascades[I].texture.bind(m.NEAREST,m.CLAMP_TO_EDGE);if(this.useNormalOffset=c,c){const I=xr.normalOffset;y.u_shadow_normal_offset=[1,I,I],y.u_shadow_bias=[6e-5,.0012,.012]}else y.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(f,y)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,c,f){if(f[2]>=0)return{};const m=function(I,P,L){const k=L/(1<<I.canonical.z);return new s.c9([I.canonical.x*k+I.wrap*L,I.canonical.y*k+I.wrap*L,0],[(I.canonical.x+1)*k+I.wrap*L,(I.canonical.y+1)*k+I.wrap*L,P])}(t,r,c).getCorners(),y=r/-f[2];f[0]<0?(s.a6.vec3.add(m[0],m[0],[f[0]*y,0,0]),s.a6.vec3.add(m[3],m[3],[f[0]*y,0,0])):f[0]>0&&(s.a6.vec3.add(m[1],m[1],[f[0]*y,0,0]),s.a6.vec3.add(m[2],m[2],[f[0]*y,0,0])),f[1]<0?(s.a6.vec3.add(m[0],m[0],[0,f[1]*y,0]),s.a6.vec3.add(m[1],m[1],[0,f[1]*y,0])):f[1]>0&&(s.a6.vec3.add(m[2],m[2],[0,f[1]*y,0]),s.a6.vec3.add(m[3],m[3],[0,f[1]*y,0]));const S={};return S.vertices=m,S.planes=[wa(m[1],m[0],m[4]),wa(m[2],m[1],m[5]),wa(m[3],m[2],m[6]),wa(m[0],m[3],m[7])],S}addShadowReceiver(t,r,c){this._receivers.add(t,s.c9.fromTileIdAndHeight(t,r,c))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function wa(l,t,r){const c=s.a6.vec3.sub([],r,t),f=s.a6.vec3.sub([],l,t),m=s.a6.vec3.cross([],c,f),y=s.a6.vec3.length(m);return y===0?[0,0,1,0]:(s.a6.vec3.scale(m,m,1/y),[m[0],m[1],m[2],-s.a6.vec3.dot(m,t)])}function Pc(l){const t=l.properties.get("direction"),r=s.c7(t.x,t.y,t.z);r[2]=s.ap(r[2],0,75);const c=s.ca([r[0],r[1],r[2]]);return s.a6.vec3.fromValues(c.x,c.y,c.z)}function Rc(l,t,r){const c=t.properties.get("color"),f=t.properties.get("intensity"),m=t.properties.get("direction"),y=[m.x,m.y,m.z],S=r.properties.get("color"),I=r.properties.get("intensity"),P=Math.max(s.a6.vec3.dot([0,0,1],y),0),L=[0,0,0];s.a6.vec3.scale(L,S.toRenderColor(l.getLut(t.scope)).toArray01Linear().slice(0,3),I);const k=[0,0,0];return s.a6.vec3.scale(k,c.toRenderColor(l.getLut(r.scope)).toArray01Linear().slice(0,3),P*f),s.cb([L[0]>0?L[0]/(L[0]+k[0]):0,L[1]>0?L[1]/(L[1]+k[1]):0,L[2]>0?L[2]/(L[2]+k[2]):0])}function Lc(l,t,r,c,f,m){const y=l.zoom,S=l.scale,I=l.worldSize,P=1/I,L=l.aspect,k=Math.sqrt(1+L*L)*Math.tan(.5*l.fovX),B=k*k,N=c-r,q=c+r;let Z,H;B>N/q?(Z=c,H=c*k):(Z=.5*q*(1+B),H=.5*Math.sqrt(N*N+2*(c*c+r*r)*B+q*q*B*B));const W=l.projection.pixelsPerMeter(l.center.lat,I),ie=l._camera.getCameraToWorldMercator(),ne=[0,0,-Z*P];s.a6.vec3.transformMat4(ne,ne,ie);let ee=H*P;const ae=l._edgeInsets;if(!(ae.left===0&&ae.top===0&&ae.right===0&&ae.bottom===0||ae.left===ae.right&&ae.top===ae.bottom)){const st=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?W:1),at=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,r,c);at[8]=2*-l.centerOffset.x/l.width,at[9]=2*l.centerOffset.y/l.height;const Ye=new Float64Array(16);s.a6.mat4.mul(Ye,at,st);const Qe=new Float64Array(16);s.a6.mat4.invert(Qe,Ye);const Ft=s.bN.fromInvProjectionMatrix(Qe,I,y,!0);for(const ft of Ft.points){const Tt=((oe=ft)[0]/=S,oe[1]/=S,oe[2]=s.bD(oe[2],l._center.lat),oe);ee=Math.max(ee,s.a6.vec3.len(s.a6.vec3.subtract([],ne,Tt)))}}var oe;ee*=f/(f-1);const fe=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),_e=new jo;_e.position=ne,_e.setPitchBearing(fe,he);const Te=_e.getWorldToCamera(I,W),be=ee*I,xe=Math.min(l._mercatorZfromZoom(17)*I*-2,-2*be),Re=_e.getCameraToClipOrthographic(-be,be,-be,be,xe,(be+m*W)/t[2]),Ge=new Float64Array(16);s.a6.mat4.multiply(Ge,Re,Te);const Ke=s.a6.vec3.fromValues(Math.floor(1e6*ne[0])/1e6*I,Math.floor(1e6*ne[1])/1e6*I,0),je=.5*f,rt=[0,0,0];s.a6.vec3.transformMat4(rt,Ke,Ge),s.a6.vec3.scale(rt,rt,je);const Le=[Math.floor(rt[0]),Math.floor(rt[1]),Math.floor(rt[2])],Xe=[0,0,0];s.a6.vec3.sub(Xe,rt,Le),s.a6.vec3.scale(Xe,Xe,-1/je);const He=new Float64Array(16);return s.a6.mat4.identity(He),s.a6.mat4.translate(He,He,Xe),s.a6.mat4.multiply(Ge,He,Ge),[Ge,be]}class Hs extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,r){return s.aG(this.requestManager.transformRequest(r,s.R.Model).url).then(c=>{if(!c)return;const f=s.aH(c),m=new s.aI(t,void 0,void 0,f);return m.computeBoundsAndApplyParent(),m}).catch(c=>{if(c&&c.status===404)return null;this.fire(new s.t(new Error(`Could not load model ${t} from ${r}: ${c.message}`)))})}load(t,r){this.models[r]||(this.models[r]={});const c=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+c.length;const f=[];for(const m of c)f.push(this.loadModel(m,t[m]));Promise.allSettled(f).then(m=>{for(let y=0;y<m.length;y++){const{status:S,value:I}=m[y];S==="fulfilled"&&I&&(this.models[r][c[y]]={model:I,numReferences:1})}this.numModelsLoading[r]-=c.length,this.fire(new s.x("data",{dataType:"style"}))}).catch(m=>{this.fire(new s.t(new Error(`Could not load models: ${m.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r){return!!this.getModel(t,r)}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}addModel(t,r,c){this.models[c]||(this.models[c]={}),this.hasModel(t,c)&&this.models[c][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(r)},c)}addModels(t,r){this.models[r]||(this.models[r]={});const c={};for(const f in t)this.models[r][f]={},c[f]=this.requestManager.normalizeModelURL(t[f]);this.load(c,r)}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={});const c={};for(const f of t)this.hasModel(f,r)?this.models[r][f].numReferences++:c[f]=this.requestManager.normalizeModelURL(f);this.load(c,r)}removeModel(t,r){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0)){const c=this.models[r][t].model;delete this.models[r][t],c.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const c in this.models[r])this.models[r][c].model&&this.models[r][c].model.upload(t.context)}}const lh=new s.a0({data:new s.a1(s._.colorTheme.data)}),Hn=(l,t)=>Ce(l,t&&t.filter(r=>r.identifier!=="source.canvas")),Dc=s.ar(ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ta=s.ar(ki,["setCenter","setZoom","setBearing","setPitch"]),hf={version:8,layers:[],sources:{}},df={duration:300,delay:0};class Wn extends s.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=s.l({},df),this._buildingIndex=new Qu(this),this.crossTileSymbolIndex=new Mc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new ze,this.dispatcher=r.dispatcher?r.dispatcher:new s.cd(s.ce(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new wt,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new s.cf(t._requestManager,r.localFontFamily?s.cg.all:r.localIdeographFontFamily?s.cg.ideographs:s.cg.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new Hs(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",s.ch());const c=this;this._rtlTextPluginCallback=Wn.registerForPluginStateChange(f=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(m,y)=>{if(s.ci(m),y&&y.every(S=>S))for(const S in c._sourceCaches){const I=c._sourceCaches[S],P=I.getSource().type;P!=="vector"&&P!=="geojson"||I.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const m=this.getOwnSource(f.sourceId);if(m&&m.vectorLayerIds)for(const y in this._layers){const S=this._layers[y];S.source===m.id&&this._validateLayer(S)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.f(t))return t;const r=s.cj(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${s.ck(JSON.stringify(t))}`}_diffStyle(t,r,c){this.globalId=this._getGlobalId(t);const f=(m,y)=>{try{y(null,this.setState(m,c))}catch(S){y(S,!1)}};if(typeof t=="string"){const m=this.map._requestManager.normalizeStyleURL(t),y=this.map._requestManager.transformRequest(m,s.R.Style);s.n(y,(S,I)=>{S?this.fire(new s.t(S)):I&&f(I,r)})}else typeof t=="object"&&f(t,r)}loadURL(t,r={}){this.fire(new s.x("dataloading",{dataType:"style"}));const c=typeof r.validate=="boolean"?r.validate:!s.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const f=this.importsCache.get(t);if(f)return this._load(f,c);const m=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(m,(y,S)=>{if(this._request=null,y)this.fire(new s.t(y));else if(S)return this.importsCache.set(t,S),this._load(S,c)})}loadJSON(t,r={}){this.fire(new s.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new s.x("dataloading",{dataType:"style"})),this._load(hf,!1)}_loadImports(t,r,c){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const f=[];for(const m of t){const y=this._createFragmentStyle(m),S=new Promise(L=>{y.once("style.import.load",L),y.once("error",L)}).then(()=>this.mergeAll());if(f.push(S),this.resolvedImports.has(m.url)){y.loadEmpty();continue}const I=m.data||this.importsCache.get(m.url);I?(y.loadJSON(I,{validate:r}),this._isInternalStyle(I)&&(y.globalId=null)):m.url?y.loadURL(m.url,{validate:r}):y.loadEmpty();const P={style:y,id:m.id,config:m.config};if(c){const L=this.fragments.findIndex(({id:k})=>k===c);this.fragments=this.fragments.slice(0,L).concat(P).concat(this.fragments.slice(L))}else this.fragments.push(P)}return Promise.allSettled(f)}getImportGlobalIds(t=this,r=new Set){for(const c of t.fragments)c.style.globalId&&r.add(c.style.globalId),this.getImportGlobalIds(c.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?s.av(t.id,this.scope):t.id;let c;const f=this._initialConfig&&this._initialConfig[r];(t.config||f)&&(c=s.l({},t.config,f));const m=new Wn(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,configDependentLayers:this._configDependentLayers});return m.setEventedParent(this.map,{style:m}),m}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){const c=t.schema;if(this._isInternalStyle(t)){const y=s.l({},hf,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(y,r)}if(this.updateConfig(this._config,c),r&&Hn(this,qn(t)))return;this._loaded=!0,this.stylesheet=s.cl(t);const f=()=>{for(const P in t.sources)this.addSource(P,t.sources[P],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const y=eh(this.stylesheet.layers);if(this._order=y.map(P=>P.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const P=this.stylesheet.lights[0];this.light=new De(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new De(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const P of y){const L=s.cq(P,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize();const k=this.getOwnLayerSourceCache(L),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&L.canCastShadows()&&B&&(k.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.x("data",{dataType:"style"}));const I=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new s.x(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.x(I?"style.load":"style.import.load")))},m=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=m,m){const y=this._evaluateColorThemeData(m);this._loadColorTheme(y).then(()=>{f()}).catch(S=>{s.w(`Couldn't load color theme from the stylesheet: ${S}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,r,c,f,m,y,S,I;const P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(t=L.light),L.stylesheet.lights)for(const k of L.stylesheet.lights)k.type==="ambient"&&L.ambientLight!=null&&(r=L.ambientLight),k.type==="directional"&&L.directionalLight!=null&&(c=L.directionalLight);f=this._prioritizeTerrain(f,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(m=L.fog),L.stylesheet.camera!=null&&(I=L.stylesheet.camera),L.stylesheet.projection!=null&&(y=L.stylesheet.projection),L.stylesheet.transition!=null&&(S=L.stylesheet.transition),P[L.scope]=L._styleColorTheme}}),this.light=t,this.ambientLight=r,this.directionalLight=c,this.fog=m,this._styleColorThemeForScope=P,f===null?delete this.terrain:this.terrain=f,this.camera=I||{"camera-projection":"perspective"},this.projection=y||{name:"mercator"},this.transition=s.l({},df,S),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=c=>{for(const f of c.fragments)r(f.style);t(c)};r(this)}_prioritizeTerrain(t,r,c){const f=t&&t.drapeRenderMode===0;return c===null?r&&r.drapeRenderMode===0?r:f?t:null:r!=null&&(!t||f||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},c={};this.forEachFragmentStyle(f=>{for(const m in f._sourceCaches){const y=s.av(m,f.scope);t[y]=f._sourceCaches[m]}for(const m in f._otherSourceCaches){const y=s.av(m,f.scope);r[y]=f._otherSourceCaches[m]}for(const m in f._symbolSourceCaches){const y=s.av(m,f.scope);c[y]=f._symbolSourceCaches[m]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=c}mergeLayers(){const t={},r=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(m=>{for(const y of m._order){const S=m._layers[y];if(S.type==="slot"){const I=s.cm(y);if(t[I])continue;t[I]=[]}S.slot&&t[S.slot]?t[S.slot].push(S):r.push(S)}}),this._mergedOrder=[];const f=(m=[])=>{for(const y of m)if(y.type==="slot"){const S=s.cm(y.id);t[S]&&f(t[S]),this._mergedSlots.push(S)}else{const S=s.av(y.id,y.scope);this._mergedOrder.push(S),c[S]=y,y.is3D()&&(this._has3DLayers=!0),y.type==="circle"&&(this._hasCircleLayers=!0),y.type==="symbol"&&(this._hasSymbolLayers=!0),y.type==="clip"&&(this._clipLayerPresent=!0)}};f(r),this._mergedOrder.sort((m,y)=>{const S=c[m],I=c[y];return S.hasInitialOcclusionOpacityProperties?I.is3D()?1:0:S.is3D()&&I.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(r,c,f){const m=s.l({},c);for(const S of Object.keys(s._.colorTheme))m[S]===void 0&&(m[S]=s._.colorTheme[S].default);const y=new s.$(lh,r,new Map(f));return y.setTransitionOrValue(m,f),y.untransitioned().possiblyEvaluate(new s.a3(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,f)=>{const m="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let y=t;y.startsWith(m)||(y=m+y);const S="mapbox-reserved-lut",I=new Image;I.src=y,I.onerror=()=>{this._styleColorTheme.lutLoading=!1,f(new Error("Failed to load image data"))},I.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void c();this._styleColorTheme.lutLoading=!1;const{width:P,height:L,data:k}=s.q.getImageData(I);if(L>32)return void f(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==L*L)return void f(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new s.r({width:P,height:L},k),pixelRatio:1,sdf:!1,version:0});const B=this.imageManager.getImage(S,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},c()):f(new Error("Missing LUT image."))}})}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,c,f){let m,y,S;const I=s.q.devicePixelRatio>1?"@2x":"";let P=s.n(c.transformRequest(c.normalizeSpriteURL(r,I,".json"),s.R.SpriteJSON),(B,N)=>{P=null,S||(S=B,m=N,k())}),L=s.o(c.transformRequest(c.normalizeSpriteURL(r,I,".png"),s.R.SpriteImage),(B,N)=>{L=null,S||(S=B,y=N,k())});function k(){if(S)f(S);else if(m&&y){const B=s.q.getImageData(y),N={};for(const q in m){const{width:Z,height:H,x:W,y:ie,sdf:ne,pixelRatio:ee,stretchX:ae,stretchY:oe,content:fe}=m[q],he=new s.r({width:Z,height:H});s.r.copy(B,he,{x:W,y:ie},{x:0,y:0},{width:Z,height:H},null),N[q]={data:he,pixelRatio:ee,sdf:ne,stretchX:ae,stretchY:oe,content:fe}}f(null,N)}}return{cancel(){P&&(P.cancel(),P=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(r,c)=>{if(this._spriteRequest=null,r)this.fire(new s.t(r));else if(c)for(const f in c)this.imageManager.addImage(f,this.scope,c[f]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.x("data",{dataType:"style"}))})}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const c=t.sourceLayer;c&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(c)===-1)&&this.fire(new s.t(new Error(`Source layer "${c}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const c=this.fragments[r];return c&&c.style&&(t.data=c.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const c=this._sourceCaches[r].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const r=[];for(const c of t){const f=this._layers[c];f&&f.type!=="custom"&&r.push(f.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new s.t(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new s.t(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const c=this.map.painter;if(c)for(let f=t.minzoom||0;f<(t.maxzoom||25.5);f++){const m=t.getProgramIds();if(m)for(const y of m){const S=t.getDefaultProgramParams(y,r.zoom,this._styleColorTheme.lut);S&&(c.style=this,this.fog&&(c._fogVisible=!0,S.overrideFog=!0,c.getOrCreateProgram(y,S)),c._fogVisible=!1,S.overrideFog=!1,c.getOrCreateProgram(y,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,c.getOrCreateProgram(y,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const c=this._changes.isDirty();let f=!1;if(this._changes.isDirty()){const y=this._changes.getLayerUpdatesByScope();for(const S in y){const{updatedIds:I,removedIds:P}=y[S];(I||P)&&(this._updateWorkerLayers(S,I,P),f=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const m={};for(const y in this._mergedSourceCaches){const S=this._mergedSourceCaches[y];m[y]=S.used,S.used=!1,S.tileCoverLift=0}for(const y of this._mergedOrder){const S=this._mergedLayers[y];if(S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)){const I=this.getLayerSourceCache(S);I&&(I.used=!0,I.tileCoverLift=Math.max(I.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,t)}):this.precompilePrograms(S,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&f&&this.mergeLayers();for(const y in m){const S=this._mergedSourceCaches[y];m[y]!==S.used&&S.getSource().fire(new s.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new s.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const r in this._sourceCaches)this._sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,r,c){const f=this.getFragmentStyle(t);f&&this.dispatcher.broadcast("updateLayers",{layers:r?f._serializeLayers(r):[],scope:t,removedIds:c||[],options:f.options})}setState(t,r){if(this._checkLoaded(),Hn(this,qn(t)))return!1;(t=s.cl(t)).layers=eh(t.layers);const c=function(y,S){if(!y)return[{command:ki.setStyle,args:[S]}];let I=[];try{if(!s.bh(y.version,S.version))return[{command:ki.setStyle,args:[S]}];if(s.bh(y.center,S.center)||I.push({command:ki.setCenter,args:[S.center]}),s.bh(y.zoom,S.zoom)||I.push({command:ki.setZoom,args:[S.zoom]}),s.bh(y.bearing,S.bearing)||I.push({command:ki.setBearing,args:[S.bearing]}),s.bh(y.pitch,S.pitch)||I.push({command:ki.setPitch,args:[S.pitch]}),s.bh(y.sprite,S.sprite)||I.push({command:ki.setSprite,args:[S.sprite]}),s.bh(y.glyphs,S.glyphs)||I.push({command:ki.setGlyphs,args:[S.glyphs]}),s.bh(y.imports,S.imports)||function(N=[],q=[],Z){q=q||[];const H=(N=N||[]).map(Fo),W=q.map(Fo),ie=N.reduce(ha,{}),ne=q.reduce(ha,{}),ee=H.slice();let ae,oe,fe,he;for(ae=0,oe=0;ae<H.length;ae++)fe=H[ae],ne.hasOwnProperty(fe)?oe++:(Z.push({command:ki.removeImport,args:[fe]}),ee.splice(ee.indexOf(fe,oe),1));for(ae=0,oe=0;ae<W.length;ae++)fe=W[W.length-1-ae],ee[ee.length-1-ae]!==fe&&(ie.hasOwnProperty(fe)?(Z.push({command:ki.removeImport,args:[fe]}),ee.splice(ee.lastIndexOf(fe,ee.length-oe),1)):oe++,he=ee[ee.length-ae],Z.push({command:ki.addImport,args:[ne[fe],he]}),ee.splice(ee.length-ae,0,fe));for(const _e of q){const Te=ie[_e.id];Te&&!s.bh(Te,_e)&&Z.push({command:ki.updateImport,args:[_e.id,_e]})}}(y.imports,S.imports,I),s.bh(y.transition,S.transition)||I.push({command:ki.setTransition,args:[S.transition]}),s.bh(y.light,S.light)||I.push({command:ki.setLight,args:[S.light]}),s.bh(y.fog,S.fog)||I.push({command:ki.setFog,args:[S.fog]}),s.bh(y.projection,S.projection)||I.push({command:ki.setProjection,args:[S.projection]}),s.bh(y.lights,S.lights)||I.push({command:ki.setLights,args:[S.lights]}),s.bh(y.camera,S.camera)||I.push({command:ki.setCamera,args:[S.camera]}),!s.bh(y["color-theme"],S["color-theme"]))return[{command:ki.setStyle,args:[S]}];const P={},L=[];(function(N,q,Z,H){let W;for(W in q=q||{},N=N||{})N.hasOwnProperty(W)&&(q.hasOwnProperty(W)||qi(W,Z,H));for(W in q){if(!q.hasOwnProperty(W))continue;const ie=q[W];N.hasOwnProperty(W)?s.bh(N[W],ie)||(N[W].type==="geojson"&&ie.type==="geojson"&&Yt(N,q,W)?Z.push({command:ki.setGeoJSONSourceData,args:[W,ie.data]}):zm(W,q,Z,H)):th(W,q,Z)}})(y.sources,S.sources,L,P);const k=[];y.layers&&y.layers.forEach(N=>{N.source&&P[N.source]?I.push({command:ki.removeLayer,args:[N.id]}):k.push(N)});let B=y.terrain;B&&P[B.source]&&(I.push({command:ki.setTerrain,args:[void 0]}),B=void 0),I=I.concat(L),s.bh(B,S.terrain)||I.push({command:ki.setTerrain,args:[S.terrain]}),function(N,q,Z){q=q||[];const H=(N=N||[]).map(Fo),W=q.map(Fo),ie=N.reduce(ha,{}),ne=q.reduce(ha,{}),ee=H.slice(),ae=Object.create(null);let oe,fe,he,_e,Te,be,xe;for(oe=0,fe=0;oe<H.length;oe++)he=H[oe],ne.hasOwnProperty(he)?fe++:(Z.push({command:ki.removeLayer,args:[he]}),ee.splice(ee.indexOf(he,fe),1));for(oe=0,fe=0;oe<W.length;oe++)he=W[W.length-1-oe],ee[ee.length-1-oe]!==he&&(ie.hasOwnProperty(he)?(Z.push({command:ki.removeLayer,args:[he]}),ee.splice(ee.lastIndexOf(he,ee.length-fe),1)):fe++,be=ee[ee.length-oe],Z.push({command:ki.addLayer,args:[ne[he],be]}),ee.splice(ee.length-oe,0,he),ae[he]=!0);for(oe=0;oe<W.length;oe++)if(he=W[oe],_e=ie[he],Te=ne[he],!ae[he]&&!s.bh(_e,Te))if(s.bh(_e.source,Te.source)&&s.bh(_e["source-layer"],Te["source-layer"])&&s.bh(_e.type,Te.type)){for(xe in bl(_e.layout,Te.layout,Z,he,null,ki.setLayoutProperty),bl(_e.paint,Te.paint,Z,he,null,ki.setPaintProperty),s.bh(_e.slot,Te.slot)||Z.push({command:ki.setSlot,args:[he,Te.slot]}),s.bh(_e.filter,Te.filter)||Z.push({command:ki.setFilter,args:[he,Te.filter]}),s.bh(_e.minzoom,Te.minzoom)&&s.bh(_e.maxzoom,Te.maxzoom)||Z.push({command:ki.setLayerZoomRange,args:[he,Te.minzoom,Te.maxzoom]}),_e)_e.hasOwnProperty(xe)&&xe!=="layout"&&xe!=="paint"&&xe!=="filter"&&xe!=="metadata"&&xe!=="minzoom"&&xe!=="maxzoom"&&xe!=="slot"&&(xe.indexOf("paint.")===0?bl(_e[xe],Te[xe],Z,he,xe.slice(6),ki.setPaintProperty):s.bh(_e[xe],Te[xe])||Z.push({command:ki.setLayerProperty,args:[he,xe,Te[xe]]}));for(xe in Te)Te.hasOwnProperty(xe)&&!_e.hasOwnProperty(xe)&&xe!=="layout"&&xe!=="paint"&&xe!=="filter"&&xe!=="metadata"&&xe!=="minzoom"&&xe!=="maxzoom"&&xe!=="slot"&&(xe.indexOf("paint.")===0?bl(_e[xe],Te[xe],Z,he,xe.slice(6),ki.setPaintProperty):s.bh(_e[xe],Te[xe])||Z.push({command:ki.setLayerProperty,args:[he,xe,Te[xe]]}))}else Z.push({command:ki.removeLayer,args:[he]}),be=ee[ee.lastIndexOf(he)+1],Z.push({command:ki.addLayer,args:[Te,be]})}(k,S.layers,I)}catch(P){console.warn("Unable to compute style diff:",P),I=[{command:ki.setStyle,args:[S]}]}return I}(this.serialize(),t).filter(y=>!(y.command in Ta));if(c.length===0)return!1;const f=c.filter(y=>!(y.command in Dc));if(f.length>0)throw new Error(`Unimplemented: ${f.map(y=>y.command).join(", ")}.`);const m=[];return c.forEach(y=>{m.push(this[y.command].apply(this,y.args))}),r&&Promise.all(m).then(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new s.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(t,r){this.imageManager.updateImage(t,this.scope,r)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new s.t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,r,c={}){return this._checkLoaded(),this._validate(ve,`models.${t}`,r,null,c)||(this.modelManager.addModel(t,r,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new s.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Oo,`sources.${t}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const f=aa(t,r,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id}));const m=y=>{const S=(y?"symbol:":"other:")+f.id,I=s.av(S,this.scope),P=this._sourceCaches[S]=new Rn(I,f,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=P,P.onAdd(this.map)};m(!1),r.type!=="vector"&&r.type!=="geojson"||m(!0),f.onAdd&&f.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new s.t(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.t(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const c=this.getOwnSourceCaches(t);for(const f of c){const m=s.cm(f.id);delete this._sourceCaches[m],this._changes.discardSourceCacheUpdate(f.id),f.fire(new s.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const c=this.getOwnSourceCache(r);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const c=t[r]._tiles;for(const f in c){const m=c[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const f of t){if(this._validate(sa,"lights",f))return;switch(f.type){case"ambient":if(this.ambientLight){const m=this.ambientLight;m.set(f),m.updateTransitions(r)}else this.ambientLight=new Yi(f,di||(di=new s.a0({color:new s.a1(s._.properties_light_ambient.color),intensity:new s.a1(s._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const m=this.directionalLight;m.set(f),m.updateTransitions(r)}else this.directionalLight=new Yi(f,Wi||(Wi=new s.a0({direction:new s.ad(s._.properties_light_directional.direction),color:new s.a1(s._.properties_light_directional.color),intensity:new s.a1(s._.properties_light_directional.intensity),"cast-shadows":new s.a1(s._.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.a1(s._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=new s.a3(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const c=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),f=t.properties.get("color").toRenderColor(null).toArray01(),m=t.properties.get("intensity"),y=t.properties.get("direction"),S=1-s.c7(y.x,y.y,y.z)[2]/90,I=c(f)*m*S,P=r.properties.get("color").toRenderColor(null).toArray01(),L=r.properties.get("intensity");return(I+c(P)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(s.cn(t)){const r=s.co(t),c=this.fragments.find(({id:m})=>m===r);if(!c)throw new Error(`Style import not found: ${t}`);const f=s.cm(t);return c.style.getFragmentStyle(f)}{const r=this.fragments.find(({id:c})=>c===t);if(!r)throw new Error(`Style import not found: ${t}`);return r.style}}getConfigProperty(t,r){const c=this.getFragmentStyle(t);if(!c)return null;const f=s.av(r,c.scope),m=c.options.get(f),y=m?m.value||m.default:null;return y?y.serialize():null}setConfigProperty(t,r,c){const f=this.getFragmentStyle(t);if(!f)return;const m=f.stylesheet.schema;if(!m||!m[r])return;const y=s.M(c);if(y.result!=="success")return void Hn(this,y.value);const S=y.value.expression,I=s.av(r,f.scope),P=f.options.get(I);if(!P)return;let L;const{minValue:k,maxValue:B,stepValue:N,type:q,values:Z}=m[r],H=s.M(m[r].default);H.result==="success"&&(L=H.value.expression),L?(this.options.set(I,{...P,value:S,default:L,minValue:k,maxValue:B,stepValue:N,type:q,values:Z}),this.updateConfigDependencies(r)):this.fire(new s.t(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const c=r.stylesheet.schema;if(!c)return null;const f={};for(const m in c){const y=s.av(m,r.scope),S=r.options.get(y),I=S?S.value||S.default:null;f[m]=I?I.serialize():null}return f}setConfig(t,r){const c=this.getFragmentStyle(t);c&&(c.updateConfig(r,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=r,c.updateConfig(c._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const c in r){let f,m;const y=s.M(r[c].default);if(y.result==="success"&&(f=y.value.expression),t&&t[c]!==void 0){const B=s.M(t[c]);B.result==="success"&&(m=B.value.expression)}const{minValue:S,maxValue:I,stepValue:P,type:L,values:k}=r[c];if(f){const B=s.av(c,this.scope);this.options.set(B,{default:f,value:m,minValue:S,maxValue:I,stepValue:P,type:L,values:k})}else this.fire(new s.t(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new s.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const r of this._configDependentLayers){const c=this.getLayer(r);if(c){if(t&&!c.configDependencies.has(t))continue;c.possiblyEvaluateVisibility(),this._updateLayer(c)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(r=>{if(r._styleColorTheme.colorTheme){const c=r._evaluateColorThemeData(r._styleColorTheme.colorTheme);(!r._styleColorTheme.lut&&c!==""||r._styleColorTheme.lut&&c!==r._styleColorTheme.lut.data)&&r.setColorTheme(r._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(t,r,c={}){this._checkLoaded();const f=t.id;if(this._layers[f])return void this.fire(new s.t(new Error(`Layer with id "${f}" already exists on this map`)));let m;if(t.type==="custom"){if(Hn(this,s.cp(t)))return;m=s.cq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=s.cl(t),t=s.l(t,{source:f})),this._validate(Ve,`layers.${f}`,t,{arrayIndex:-1},c))return;m=s.cq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(m),m.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[m.id]=m.serialize()}m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid);let y=this._order.length;if(r){const L=this._order.indexOf(r);if(L===-1)return void this.fire(new s.t(new Error(`Layer with id "${r}" does not exist on this map.`)));m.slot===this._layers[r].slot?y=L:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,f),this._layerOrderChanged=!0,this._layers[f]=m;const S=this.getOwnLayerSourceCache(m),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&m.canCastShadows()&&I&&(S.castsShadows=!0);const P=this._changes.getRemovedLayer(m);if(P&&m.source&&S&&m.type!=="custom"){this._changes.discardLayerRemoval(m);const L=s.av(m.source,m.scope);P.type!==m.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),S.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),m.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===r)return;const f=this._order.indexOf(t);this._order.splice(f,1);let m=this._order.length;if(r){const y=this._order.indexOf(r);if(y===-1)return void this.fire(new s.t(new Error(`Layer with id "${r}" does not exist on this map.`)));c.slot===this._layers[r].slot?m=y:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(m,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const f=this.getOwnLayerSourceCache(r);if(f&&f.castsShadows){let m=!1;for(const y in this._layers)if(this._layers[y].source===r.source&&this._layers[y].canCastShadows()){m=!0;break}f.castsShadows=m}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,c){this._checkLoaded();const f=this._checkLayer(t);f&&(f.minzoom===r&&f.maxzoom===c||(r!=null&&(f.minzoom=r),c!=null&&(f.maxzoom=c),this._updateLayer(f)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==r&&(c.slot=r,this._updateLayer(c))}setFilter(t,r,c={}){this._checkLoaded();const f=this._checkLayer(t);if(f&&!s.bh(f.filter,r))return r==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(X,`layers.${f.id}.filter`,r,{layerType:f.type},c)||(f.filter=s.cl(r),this._updateLayer(f)))}getFilter(t){const r=this._checkLayer(t);if(r)return s.cl(r.filter)}setLayoutProperty(t,r,c,f={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!s.bh(m.getLayoutProperty(r),c)){if(c!=null&&(!f||f.validate!==!1)&&Hn(m,le.call(qn,{key:`layers.${t}.layout.${r}`,layerType:m.type,objectKey:r,value:c,styleSpec:s._,style:{glyphs:!0,sprite:!0}})))return;m.setLayoutProperty(r,c),m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),this._updateLayer(m)}}getLayoutProperty(t,r){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(r)}setPaintProperty(t,r,c,f={}){this._checkLoaded();const m=this._checkLayer(t);if(!m||s.bh(m.getPaintProperty(r),c)||c!=null&&(!f||f.validate!==!1)&&Hn(m,J.call(qn,{key:`layers.${t}.paint.${r}`,layerType:m.type,objectKey:r,value:c,styleSpec:s._})))return;const y=m.setPaintProperty(r,c);m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),y&&this._updateLayer(m),this._changes.updatePaintProperties(m)}getPaintProperty(t,r){const c=this._checkLayer(t);if(c)return c.getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const c=t.source,f=t.sourceLayer,m=this._checkSource(c);if(!m)return;const y=m.type;if(y==="geojson"&&f)return void this.fire(new s.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(y==="vector"&&!f)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(c);for(const I of S)I.setFeatureState(f,t.id,r)}removeFeatureState(t,r){this._checkLoaded();const c=t.source,f=this._checkSource(c);if(!f)return;const m=f.type,y=m==="vector"?t.sourceLayer:void 0;if(m==="vector"&&!y)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.t(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(c);for(const I of S)I.removeFeatureState(y,t.id,r)}getFeatureState(t){this._checkLoaded();const r=t.source,c=t.sourceLayer,f=this._checkSource(r);if(f){if(f.type!=="vector"||c)return t.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(c,t.id);this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),c=s.av(t.source,t.scope),f=this._changes.getUpdatedSourceCaches();t.source&&!f[c]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=S=>this._mergedLayers[S].is3D(),c=this.order,f={},m=[];for(let S=c.length-1;S>=0;S--){const I=c[S];if(r(I)){f[I]=S;for(const P of t){const L=P[I];if(L)for(const k of L)m.push(k)}}}m.sort((S,I)=>I.intersectionZ-S.intersectionZ);const y=[];for(let S=c.length-1;S>=0;S--){const I=c[S];if(r(I))for(let P=m.length-1;P>=0;P--){const L=m[P].feature;if(L.layer&&f[L.layer.id]<S)break;y.push(L),m.pop()}else for(const P of t){const L=P[I];if(L)for(const k of L)y.push(k.feature)}}return y}queryRenderedFeatures(t,r,c){r&&r.filter&&this._validate(X,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const f={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new s.t(new Error("parameters.layers must be an Array."))),[];for(const P of r.layers){const L=this._mergedLayers[P];if(!L)return this.fire(new s.t(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];f[L.source]=!0}}const m=[],y=r.serializedLayers||{},S=r&&r.layers?r.layers.some(P=>{const L=this.getLayer(P);return L&&L.is3D()}):this.has3DLayers(),I=_r.createFromScreenPoints(t,c);for(const P in this._mergedSourceCaches){const L=this._mergedSourceCaches[P].getSource();if(!L||L.scope!==r.scope)continue;const k=this._mergedSourceCaches[P].getSource().id;r.layers&&!f[k]||m.push(Yu(this._mergedSourceCaches[P],this._mergedLayers,y,I,r,c,S,!!this.map._showQueryGeometry))}return this.placement&&m.push(function(P,L,k,B,N,q,Z){const H={},W=q.queryRenderedSymbols(B),ie=[];for(const ne of Object.keys(W).map(Number))ie.push(Z[ne]);ie.sort(la);for(const ne of ie){const ee=ne.featureIndex.lookupSymbolFeatures(W[ne.bucketInstanceId],L,ne.bucketIndex,ne.sourceLayerIndex,N.filter,N.layers,N.availableImages,P);for(const ae in ee){const oe=H[ae]=H[ae]||[],fe=ee[ae];fe.sort((he,_e)=>{const Te=ne.featureSortOrder;if(Te){const be=Te.indexOf(he.featureIndex);return Te.indexOf(_e.featureIndex)-be}return _e.featureIndex-he.featureIndex});for(const he of fe)oe.push(he)}}for(const ne in H)H[ne].forEach(ee=>{const ae=ee.feature,oe=k(P[ne]);if(!oe)return;const fe=oe.getFeatureState(ae.layer["source-layer"],ae.id);ae.source=ae.layer.source,ae.layer["source-layer"]&&(ae.sourceLayer=ae.layer["source-layer"]),ae.state=fe});return H}(this._mergedLayers,y,this.getLayerSourceCache.bind(this),I.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(t,r){r&&r.filter&&this._validate(X,"querySourceFeatures.filter",r.filter,null,r);const c=this.getOwnSourceCaches(t);let f=[];for(const m of c)f=f.concat(yl(m,r));return f}addSourceType(t,r,c){return Wn.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Wn.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,c={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const S in t)if(!s.bh(t[S],f[S])){m=!0;break}if(!m)return;const y=this._getTransitionParameters();this.light.setLight(t,r,c),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const f=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const S="terrain-dem-src";this.addSource(S,c.source),c=s.cl(c),c=s.l(c,{source:S})}const m=s.l({},c),y={};if(this.terrain&&f){m.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(y.style=S.serialize())}if(this._validate(_l,"terrain",m,y))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&r!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,r),this.fire(new s.x("data",{dataType:"style"}))}else{const m=this.terrain,y=m.get();for(const S of Object.keys(s._.terrain))!c.hasOwnProperty(S)&&s._.terrain[S].default&&(c[S]=s._.terrain[S].default);for(const S in t)if(!s.bh(t[S],y[S])){m.set(t,this.options),this.stylesheet.terrain=t;const I=this._getTransitionParameters({duration:0});m.updateTransitions(I),this.fire(new s.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new Gi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!s.bh(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();const r=()=>{for(const f in this._layers)this._layers[f].lut=this._styleColorTheme.lut;for(const f in this._sourceCaches)this._sourceCaches[f].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void r();const c=this._evaluateColorThemeData(t);this._loadColorTheme(c).then(()=>{this.fire(new s.x("colorthemeset")),r()}).catch(f=>{s.w(`Couldn't set color theme: ${f}`)})}_getTransitionParameters(t){return{now:s.q.now(),transition:s.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):r.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const c=this.terrain=new We(t,r,this.scope,this.options);r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,c,f,m={}){if(m&&m.validate===!1)return!1;const y=s.l({},this.serialize());return Hn(this,t.call(qn,s.l({key:r,style:y,value:c,styleSpec:s._},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const c of r)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const c of r)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let r;this.directionalLight&&(r=Pc(this.directionalLight));for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].update(t,void 0,void 0,r)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,c,f,m,y,S=!1){let I=!1,P=!1;const L={},k={};for(const B of this._mergedOrder){const N=this._mergedLayers[B];if(N.type!=="symbol")continue;const q=s.av(N.source,N.scope);let Z=L[q];if(!Z){const W=this.getLayerSourceCache(N);if(!W)continue;const ie=W.getRenderableIds(!0).map(ne=>W.getTileByID(ne));k[q]=ie.slice(),Z=L[q]=ie.sort((ne,ee)=>ee.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ee.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(N,Z,r.center.lng,r.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new s.x("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),r.zoom))&&(this.pauseablePlacement=new wl(r,this._mergedOrder,S,c,f,m,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),P=!0),I&&this.pauseablePlacement.placement.setStale()),P||I){this._buildingIndex.onNewFrame(r.zoom);for(let B=0;B<this._mergedOrder.length;B++){const N=this._mergedLayers[this._mergedOrder[B]];if(N.type!=="symbol")continue;const q=this.isLayerClipped(N);this.placement.updateLayerOpacities(N,L[s.av(N.source,N.scope)],B,q?y:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:m})=>m===t.id)!==-1)return void this.fire(new s.t(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return c.push(t),this._loadImports([t],!0);const f=c.findIndex(({id:m})=>m===r);return f===-1&&this.fire(new s.t(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,f).concat(t).concat(c.slice(f)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);return f===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==c[f].url&&this.setImportUrl(t,r.url),s.bh(r.config,c[f].config)||this.setImportConfig(t,r.config),s.bh(r.data,c[f].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let c=this.stylesheet.imports||[];const f=this.getImportIndex(t);if(f===-1)return this;const m=this.getImportIndex(r);if(m===-1)return this;const y=c[f],S=this.fragments[f];return c=c.filter(({id:I})=>I!==t),this.fragments=this.fragments.filter(({id:I})=>I!==t),this.stylesheet.imports=c.slice(0,m).concat(y).concat(c.slice(m)),this.fragments=this.fragments.slice(0,m).concat(S).concat(this.fragments.slice(m)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);if(f===-1)return this;c[f].url=r;const m=this.fragments[f];return m.style=this._createFragmentStyle(c[f]),m.style.on("style.import.load",()=>this.mergeAll()),m.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const c=this.getImportIndex(t),f=this.stylesheet.imports||[];return c===-1?this:r?(this.fragments[c].style.setState(r),this._reloadImports(),this):(delete f[c].data,this.setImportUrl(t,f[c].url))}setImportConfig(t,r){this._checkLoaded();const c=this.getImportIndex(t),f=this.stylesheet.imports||[];if(c===-1)return this;r?f[c].config=r:delete f[c].config;const m=this.fragments[c],y=m.style.stylesheet&&m.style.stylesheet.schema;return m.config=r,m.style.updateConfig(r,y),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(r.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(c=>c.id===t);return r===-1&&this.fire(new s.t(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[r];c&&t.push(c.getSource())}return t}getSource(t,r){const c=this.getSourceCache(t,r);return c&&c.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const c=s.av(t,r);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const r=s.av(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const c=t[r];c==="reload"?this.reloadSource(r):c==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const c of r){const f=this.getLayer(c);f&&f.updateTransitions(t)}}getImages(t,r,c){this.imageManager.getImages(r.icons,r.scope,c),this._updateTilesForChangedImages();const f=m=>{m&&m.setDependencies(r.tileID.key,r.type,r.icons)};f(this._otherSourceCaches[r.source]),f(this._symbolSourceCaches[r.source])}getGlyphs(t,r,c){this.glyphManager.getGlyphs(r.stacks,r.scope,c)}getResource(t,r,c){return s.ct(r,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new s.t(new Error(`There is no source with ID '${t}'`))),!1):r.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const c=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(c||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wn.getSourceType=function(l){return xc[l]},Wn.setSourceType=function(l,t){xc[l]=t},Wn.registerForPluginStateChange=s.cc;var ff=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ch=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,uh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,zc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,mf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,_f=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,gf=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,hh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,yf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,El=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const kc=[];_o(ff,kc),_o(uh,kc),_o(ch,kc);const Sl={"_prelude_fog.vertex.glsl":mf,"_prelude_terrain.vertex.glsl":pf,"_prelude_shadow.vertex.glsl":yf,"_prelude_fog.fragment.glsl":_f,"_prelude_shadow.fragment.glsl":El,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":gf,"_prelude_raster_particle.glsl":hh},Ea={};Ci("",pf),Ci(_f,mf),Ci(El,yf),Ci(gf,""),Ci(hh,"");const Ml=Ci(ch,uh),Oc=ff;var mo={background:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ci("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ci(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ci("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ci("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ci(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ci(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ci(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ci("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ci("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ci(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ci(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ci("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ci(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zc),skyboxGradient:Ci(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zc),skyboxCapture:Ci(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ci(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ci(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Ci("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function _o(l,t){const r=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of r)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=c.split(" ");for(const m of f)t.includes(m)||t.push(m)}}function Ci(l,t){const r=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let f=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);f&&(f=f.map(P=>{const L=P.split(" ");return L[L.length-1]}),f=[...new Set(f)]);const m={},y=[],S=[];if(l=l.replace(r,(P,L)=>(S.push(L),"")),(t=t.replace(r,(P,L)=>(y.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...kc];_o(l,I),_o(t,I);for(const P of[...y,...S])Sl[P]||console.error(`Undefined include: ${P}`),Ea[P]||(Ea[P]=[],_o(Sl[P],Ea[P])),I=[...I,...Ea[P]];return{fragmentSource:l=l.replace(c,(P,L,k,B,N)=>(m[N]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${k} ${B} ${N};
#else
uniform ${k} ${B} u_${N};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${k} ${B} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${B} ${N};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(c,(P,L,k,B,N)=>{const q=B==="float"?"vec2":B,Z=N.match(/color/)?"color":q;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${k} ${B} a_${N};
#endif
`:m[N]?L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${q} a_${N};
out ${k} ${B} ${N};
#else
uniform ${k} ${B} u_${N};
#endif
`:L==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${k} ${B} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${Z}(a_${N}, u_${N}_t);
#else
    ${k} ${B} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${B} a_${N};
    out ${k} ${B} ${N};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${q} a_${N};
#else
uniform ${k} ${B} u_${N};
#endif
`:L==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${k} ${B} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${q} a_${N};
#else
uniform ${k} ${B} u_${N};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${k} ${B} ${N} = a_${N};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${B} ${N} = a_${N};
#else
    ${k} ${B} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${B} ${N} = unpack_mix_${Z}(a_${N}, u_${N}_t);
#else
    ${k} ${B} ${N} = u_${N};
#endif
`}),staticAttributes:f,usedDefines:I,vertexIncludes:y,fragmentIncludes:S}}class Sa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,c,f,m,y,S,I){this.context=t;let P=this.boundPaintVertexBuffers.length!==f.length;for(let k=0;!P&&k<f.length;k++)this.boundPaintVertexBuffers[k]!==f[k]&&(P=!0);let L=this.boundDynamicVertexBuffers.length!==S.length;for(let k=0;!L&&k<S.length;k++)this.boundDynamicVertexBuffers[k]!==S[k]&&(L=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||P||L||this.boundIndexBuffer!==m||this.boundVertexOffset!==y)this.freshBind(r,c,f,m,y,S,I);else{t.bindVertexArrayOES.set(this.vao);for(const k of S)k&&(k.bind(),I&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,r,I));m&&m.dynamicDraw&&m.bind()}}freshBind(t,r,c,f,m,y,S){const I=t.numAttributes,P=this.context,L=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=y,r.enableAttributes(L,t),r.bind(),r.setVertexAttribPointers(L,t,m);for(const k of c)k.enableAttributes(L,t),k.bind(),k.setVertexAttribPointers(L,t,m);for(const k of y)k&&(k.enableAttributes(L,t),k.bind(),k.setVertexAttribPointers(L,t,m),S&&k.instanceCount&&k.setVertexAttribDivisor(L,t,S));f&&f.bind(),P.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Al(l,t){const r=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new s.a5(0,c/r).toLngLat().lat,new s.a5(0,(c+1)/r).toLngLat().lat]}function Bc(l,t,r,c,f,m,y){const S=l.context,I=S.gl,P=r.hillshadeFBO;if(!P)return;l.prepareDrawTile();const L=l.isTileAffectedByFog(t),k=l.getOrCreateProgram("hillshade",{overrideFog:L});S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get());const B=((H,W,ie,ne)=>{const ee=ie.paint.get("hillshade-shadow-color"),ae=ie.paint.get("hillshade-highlight-color"),oe=ie.paint.get("hillshade-accent-color"),fe=ie.paint.get("hillshade-emissive-strength");let he=s.bB(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")he-=H.transform.angle;else if(H.style&&H.style.enable3dLights()&&H.style.directionalLight){const Te=H.style.directionalLight.properties.get("direction"),be=s.c7(Te.x,Te.y,Te.z);he=s.bB(be[1])}const _e=!H.options.moving;return{u_matrix:ne||H.transform.calculateProjMatrix(W.tileID.toUnwrapped(),_e),u_image:0,u_latrange:Al(0,W.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),he],u_shadow:ee.toRenderColor(ie.lut),u_highlight:ae.toRenderColor(ie.lut),u_emissive_strength:fe,u_accent:oe.toRenderColor(ie.lut)}})(l,r,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(S,k,t.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:q,tileBoundsSegments:Z}=l.getTileBoundsBuffers(r);k.draw(l,I.TRIANGLES,f,m,y,ei.disabled,B,c.id,N,q,Z)}function Fc(l,t,r){if(!t.needsDEMTextureUpload)return;const c=l.context,f=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(r.stride);const m=r.getPixels();t.demTexture?t.demTexture.update(m,{premultiply:!1}):t.demTexture=new s.T(c,m,f.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Il(l,t,r){const c=l.context,f=c.gl;if(!t.dem)return;const m=t.dem;if(c.activeTexture.set(f.TEXTURE1),Fc(l,t,m),!t.demTexture)return;t.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);const y=m.dim;c.activeTexture.set(f.TEXTURE0);let S=t.hillshadeFBO;if(!S){const B=new s.T(c,{width:y,height:y,data:null},f.RGBA8);B.bind(f.LINEAR,f.CLAMP_TO_EDGE),S=t.hillshadeFBO=c.createFramebuffer(y,y,!0,"renderbuffer"),S.colorAttachment.set(B.texture)}c.bindFramebuffer.set(S.framebuffer),c.viewport.set([0,0,y,y]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:P,tileBoundsSegments:L}=l.getMercatorTileBoundsBuffers(),k=[];l.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(l,f.TRIANGLES,Vt.disabled,li.disabled,bi.unblended,ei.disabled,((B,N)=>{const q=N.stride,Z=s.a6.mat4.create();return s.a6.mat4.ortho(Z,0,s.ab,-s.ab,0,0,1),s.a6.mat4.translate(Z,Z,[0,-s.ab,0]),{u_matrix:Z,u_image:1,u_dimension:[q,q],u_zoom:B.overscaledZ}})(t.tileID,m),r.id,I,P,L),t.needsHillshadePrepare=!1}class Qi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class dh extends Qi{getDefault(){return s.bz.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class xf extends Qi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class fh extends Qi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Nc extends Qi{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends Qi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class vf extends Qi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class bf extends Qi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class wf extends Qi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ma extends Qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Tf extends Qi{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Nm extends Qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class Vm extends Qi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Um extends Qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class ph extends Qi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class mh extends Qi{getDefault(){return s.bz.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _h extends Qi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class gh extends Qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Ef extends Qi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Sf extends Qi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let jm=class extends Qi{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class Pl extends Qi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Rl extends Qi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Mf extends Qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Xn extends Qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yh extends Qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Vc extends Qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Uc extends Qi{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xh extends Qi{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class vh extends Qi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class jc extends Qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class bh extends Qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ll extends Qi{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Gc extends Ll{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class wh extends Ll{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Af extends Ll{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Aa extends wh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Gm=(l,t,r)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),If=(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:r,u_zoom_transition:f,u_merc_center:m,u_image0:0,u_frustum_tl:y,u_frustum_tr:S,u_frustum_br:I,u_frustum_bl:P,u_globe_pos:L,u_globe_radius:k,u_viewport:B,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:q});function Cf(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const Ia=new class{constructor(){this.operations={}}newMorphing(l,t,r,c,f){if(l in this.operations){const m=this.operations[l];m.to.tileID.key!==r.tileID.key&&(m.queued=r)}else this.operations[l]={startTime:c,phase:0,duration:f,from:t,to:r,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const r=this.operations[t];for(r.phase=(l-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Pf={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Rf(l,t,r){if(t===0)return 0;const c=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function Th(l,t){const r=1<<l.z;return!t&&(l.x===0||l.x===r-1)||l.y===0||l.y===r-1}const Dl=l=>({u_matrix:l});function qc(l,t,r,c,f){if(f>0){const m=s.q.now(),y=(m-l.timeAdded)/f,S=t?(m-t.timeAdded)/f:-1,I=r.getSource(),P=c.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(l.tileID.overscaledZ-P),k=L&&l.refreshedUponExpiration?1:s.ap(L?y:1-S,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Ca extends Rn{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},c=new s.cd(s.ce(),null),f=aa("mock-dem",r,c,t.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class Lf extends Rn{constructor(t){const r=aa("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new s.cd(s.ce(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,c){if(t.freezeTileCoverage)return;this.transform=t;const f=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,y)=>{if(m[y.key]="",!this._tiles[y.key]){const S=new Ls(y,this._source.tileSize*y.overscaleFactor(),t.tileZoom);S.state="loaded",this._tiles[y.key]=S}return m},{});for(const m in this._tiles)m in f||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const c=Object.values(r);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Eh extends s.aA{constructor(t,r,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=c}}class Sh extends s.cE{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,f,m]=function(I){const P=new s.a_,L=new s.aO,k=131;P.reserve(17161),L.reserve(33800);const B=s.ab/128,N=s.ab+B/2,q=N+B;for(let H=-B;H<q;H+=B)for(let W=-B;W<q;W+=B){const ie=W<0||W>N||H<0||H>N?24575:0,ne=s.ap(Math.round(W),0,s.ab),ee=s.ap(Math.round(H),0,s.ab);P.emplaceBack(ne+ie,ee)}const Z=(H,W)=>{const ie=W*k+H;L.emplaceBack(ie+1,ie,ie+k),L.emplaceBack(ie+k,ie+k+1,ie+1)};for(let H=1;H<129;H++)for(let W=1;W<129;W++)Z(W,H);return[0,129].forEach(H=>{for(let W=0;W<130;W++)Z(W,H),Z(H,W)}),[P,L,32768]}(),y=t.context;this.gridBuffer=y.createVertexBuffer(c,s.b0.members),this.gridIndexBuffer=y.createIndexBuffer(f),this.gridSegments=s.b1.simpleSegment(0,0,c.length,f.length),this.gridNoSkirtSegments=s.b1.simpleSegment(0,0,c.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Lf(r.map),this.orthoMatrix=s.a6.mat4.create(),s.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ab,0,s.ab,0,1);const S=y.gl;this._overlapStencilMode=new li({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ca(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const f=t.terrain.properties,m=t.terrain.drapeRenderMode===0,y=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const S=t.terrain&&t.terrain.scope,I=f.get("source"),P=m?this._mockSourceCache:t.getSourceCache(I,S);if(!P)return void s.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=P,this._exaggeration=y?this.calculateExaggeration(r):f.get("exaggeration"),!r.projection.requiresDraping&&y&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(r,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),r.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){const r=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const f=r!=null?c-r:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;const m=t.zoom,y=this._style.terrain;if(!this._previousUpdateTimestamp)return y.getExaggeration(m);let S=m-this._previousZoom;const I=this._previousUpdateTimestamp;let P=m;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(m-P)>.5&&(S=.5*(m-P+S)),S*f<0&&(P+=S)),this._evaluationZoom=P;const L=y.getExaggeration(P),k=L===y.getExaggeration(Math.max(0,P-.1));if(k&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-I));return(k||L<.1||Math.abs(S)<1e-4)&&(B=Math.min(.2,4*B)),s.aa(this._exaggeration,L,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(s.a5.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=r.getIds().map(I=>{const P=r.getTileByID(I).tileID;return P.projMatrix=c.calculateProjMatrix(P.toUnwrapped()),P});(function(I,P){const L=P.transform.pointCoordinate(P.transform.getCameraPoint()),k=new s.P(L.x,L.y);I.sort((B,N)=>{if(N.overscaledZ-B.overscaledZ)return N.overscaledZ-B.overscaledZ;const q=new s.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),Z=new s.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),H=k.mult(1<<B.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(q)-H.distSqr(Z)})})(f,this.painter);const m=this.proxyToSource||{};this.proxyToSource={},f.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const y=this._style._mergedSourceCaches;for(const I in y){const P=y[I];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,t[I],m),P.usedForTerrain))continue;const L=t[I];P.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[r.id]=f.map(I=>new Eh(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const P=this.terrainTileForTile[I.key];if(!P)continue;const L=P.tileID.key;L in S||(this._visibleDemTiles.push(P),S[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const c=this._findTileCoveringTileID(r,this.sourceCache);c&&(this.terrainTileForTile[r.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const c in this.terrainTileForTile){const f=this.terrainTileForTile[c],m=f.dem;!m||f.demTexture&&!f.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),Fc(this.painter,f,m))}}_prepareDemTileUniforms(t,r,c,f){if(!r||r.demTexture==null)return!1;const m=t.tileID.canonical,y=Math.pow(2,r.tileID.canonical.z-m.z),S=f||"";return c[`u_dem_tl${S}`]=[m.x*y%1,m.y*y%1],c[`u_dem_scale${S}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce((c,f)=>{if(!f.dem)return c;const m=f.dem.tree.minimums[0];return m>0&&t++,c+m},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const c=this._getLoadedAreaMinimum(),f=new s.cF({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let m=this._emptyDEMTexture;return m?m.update(f,{premultiply:!1}):m=this._emptyDEMTexture=new s.T(t,f,r.R32F,{premultiply:!1}),m}setupElevationDraw(t,r,c){const f=this.painter.context,m=f.gl,y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};y.u_exaggeration=this.exaggeration();let S=null,I=null,P=1;if(c&&c.morphing&&this._useVertexMorphing){const N=c.morphing.srcDemTile,q=c.morphing.dstDemTile;P=c.morphing.phase,N&&q&&(this._prepareDemTileUniforms(t,N,y,"_prev")&&(I=N),this._prepareDemTileUniforms(t,q,y)&&(S=q))}const L=N=>N&&N.demTexture&&this.painter.linearFloatFilteringSupported()?m.LINEAR:m.NEAREST;let k=null;var B;if(this.enabled?I&&S?(k=S.demTexture,f.activeTexture.set(m.TEXTURE4),I.demTexture.bind(L(I),m.CLAMP_TO_EDGE),y.u_dem_lerp=P):(S=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,S,y)?S.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,f.activeTexture.set(m.TEXTURE2),k&&(y.u_dem_size=(B=k).size[0]===1?1:B.size[0]-2,k.bind(L(S),m.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,r,y),c&&c.useMeterToDem&&S){const N=(1<<S.tileID.canonical.z)*s.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=N}if(c&&c.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),r.setTerrainUniformValues(f,y),this.painter.transform.projection.name==="globe"){const N=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);r.setGlobeUniformValues(f,N)}}globeUniformValues(t,r,c){const f=t.projection;return{u_tile_tl_up:f.upVector(r,0,0),u_tile_tr_up:f.upVector(r,s.ab,0),u_tile_br_up:f.upVector(r,s.ab,s.ab),u_tile_bl_up:f.upVector(r,0,s.ab),u_tile_up_scale:c?s.cG(1):f.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,m,y,S,I){if(f.transform.projection.name==="globe")(function(P,L,k,B,N){const q=P.context,Z=q.gl;let H,W;const ie=P.transform,ne=s.cx(P,q,ie),ee=(Re,Ge)=>{if(W===Ge)return;const Ke=[Pf[Ge],"PROJECTION_GLOBE_VIEW"];ne&&Ke.push("CUSTOM_ANTIALIASING");const je=P.isTileAffectedByFog(Re);H=P.getOrCreateProgram("globeRaster",{defines:Ke,overrideFog:je}),W=Ge},ae=P.colorModeForRenderPass(),oe=new Vt(Z.LEQUAL,Vt.ReadWrite,P.depthRangeFor3D);Ia.update(N);const fe=s.cy(ie),he=[s.am(ie.center.lng),s.at(ie.center.lat)],_e=P.globeSharedBuffers,Te=[ie.width*s.q.devicePixelRatio,ie.height*s.q.devicePixelRatio],be=Float32Array.from(ie.globeMatrix),xe={useDenormalizedUpVectorScale:!0};{const Re=P.transform,Ge=Rf(Re.zoom,L.exaggeration(),L.sourceCache._source.tileSize);W=-1;const Ke=Z.TRIANGLES;for(const je of B){const rt=k.getTile(je),Le=li.disabled,Xe=L.prevTerrainTileForTile[je.key],He=L.terrainTileForTile[je.key];Cf(Xe,He)&&Ia.newMorphing(je.key,Xe,He,N,250),q.activeTexture.set(Z.TEXTURE0),rt.texture&&rt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const st=Ia.getMorphValuesForProxy(je.key),at=st?1:0;st&&s.C(xe,{morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:s.cw(st.phase)}});const Ye=s.cz(je.canonical),Qe=s.cA(Ye.getCenter().lat),Ft=s.cB(je.canonical,Ye,Qe,Re.worldSize/Re._pixelsPerMercatorPixel),ft=s.b5(s.cC(je.canonical)),Tt=If(Re.expandedFarZProjMatrix,be,fe,ft,s.a9(Re.zoom),he,Re.frustumCorners.TL,Re.frustumCorners.TR,Re.frustumCorners.BR,Re.frustumCorners.BL,Re.globeCenterInViewSpace,Re.globeRadius,Te,Ge,Re._farZ,Ft);if(ee(je,at),H&&(L.setupElevationDraw(rt,H,xe),P.uploadCommonUniforms(q,H,je.toUnwrapped()),_e)){const[Kt,Lt,Zt]=_e.getGridBuffers(Qe,Ge!==0);H.draw(P,Ke,oe,Le,ae,ei.backCCW,Tt,"globe_raster",Kt,Lt,Zt)}}}if(_e&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const Re=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&Re.push("CUSTOM_ANTIALIASING"),H=P.getOrCreateProgram("globeRaster",{defines:Re});for(const Ge of B){const{x:Ke,y:je,z:rt}=Ge.canonical,Le=je===0,Xe=je===(1<<rt)-1,[He,st,at,Ye]=_e.getPoleBuffers(rt,!1);if(Ye&&(Le||Xe)){const Qe=k.getTile(Ge);q.activeTexture.set(Z.TEXTURE0),Qe.texture&&Qe.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Ft=s.cD(rt,Ke,ie);const ft=s.b5(s.cC(Ge.canonical)),Tt=(Kt,Lt)=>Kt.draw(P,Z.TRIANGLES,oe,li.disabled,ae,ei.disabled,If(ie.expandedFarZProjMatrix,Ft,Ft,ft,0,he,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Te,0,ie._farZ),"globe_pole_raster",Lt,at,Ye);L.setupElevationDraw(Qe,H,xe),P.uploadCommonUniforms(q,H,Ge.toUnwrapped()),Le&&P.renderDefaultNorthPole&&Tt(H,He),Xe&&P.renderDefaultSouthPole&&(Ft=s.a6.mat4.scale(s.a6.mat4.create(),Ft,[1,-1,1]),Tt(H,st))}}}})(f,m,y,S,I);else{const P=f.context,L=P.gl;let k,B;const N=f.shadowRenderer,q=Zs(f,f.longestCutoffRange),Z=ae=>{if(B===ae)return;const oe=[];oe.push(Pf[ae]),q.shouldRenderCutoff&&oe.push("RENDER_CUTOFF"),k=f.getOrCreateProgram("terrainRaster",{defines:oe}),B=ae},H=f.colorModeForRenderPass(),W=new Vt(L.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D);Ia.update(I);const ie=f.transform,ne=Rf(ie.zoom,m.exaggeration(),m.sourceCache._source.tileSize);let ee=[0,0,0];if(N){const ae=f.style.directionalLight,oe=f.style.ambientLight;ae&&oe&&(ee=Rc(f.style,ae,oe))}{B=-1;const ae=L.TRIANGLES,[oe,fe]=[m.gridIndexBuffer,m.gridSegments];for(const he of S){const _e=y.getTile(he),Te=li.disabled,be=m.prevTerrainTileForTile[he.key],xe=m.terrainTileForTile[he.key];Cf(be,xe)&&Ia.newMorphing(he.key,be,xe,I,250),P.activeTexture.set(L.TEXTURE0),_e.texture&&_e.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const Re=Ia.getMorphValuesForProxy(he.key),Ge=Re?1:0;let Ke;Re&&(Ke={morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:s.cw(Re.phase)}});const je=Gm(he.projMatrix,Th(he.canonical,ie.renderWorldCopies)?ne/10:ne,ee);if(Z(Ge),!k)continue;m.setupElevationDraw(_e,k,Ke);const rt=he.toUnwrapped();N&&N.setupShadows(rt,k),f.uploadCommonUniforms(P,k,rt,null,q),k.draw(f,ae,W,Te,H,ei.backCCW,je,"terrain_raster",m.gridBuffer,oe,fe)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,c=this.painter.context,f=this.proxySourceCache,m=this.proxiedCoords[f.id],y=this._drapedRenderBatches.shift(),S=r.style.order,I=[];let P=0;for(const L of m){const k=f.getTileByID(L.proxyTileKey),B=f.proxyCachedFBO[L.key]?f.proxyCachedFBO[L.key][t]:void 0,N=B!==void 0?f.renderCache[B]:this.pool[P++],q=B!==void 0;if(k.texture=N.tex,q&&!N.dirty){I.push(k.tileID);continue}let Z;c.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(c.clear({color:s.bz.transparent,stencil:0}),N.dirty=!1);for(let H=y.start;H<=y.end;++H){const W=r.style._mergedLayers[S[H]];if(W.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(W),ne=ie?this.proxyToSource[L.key][ie.id]:[L];if(!ne)continue;const ee=ne;c.viewport.set([0,0,N.fb.width,N.fb.height]),Z!==(ie?ie.id:null)&&(this._setupStencil(N,ne,W,ie),Z=ie?ie.id:null),r.renderLayer(r,ie,W,ee)}if(this._drapedRenderBatches.length===0)for(const H of this._pendingGroundEffectLayers){const W=r.style._mergedLayers[S[H]];if(W.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(W),ne=ie?this.proxyToSource[L.key][ie.id]:[L];if(!ne)continue;const ee=ne;c.viewport.set([0,0,N.fb.width,N.fb.height]),Z!==(ie?ie.id:null)&&(this._setupStencil(N,ne,W,ie),Z=ie?ie.id:null),r.renderLayer(r,ie,W,ee)}this.renderedToTile?(N.dirty=!0,I.push(k.tileID)):q||--P,P===5&&(P=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),y.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let c=-1,f=r;for(let m=0;m<r;++m)this._style.isLayerDraped(t._mergedLayers[t.order[m]])?c=Math.max(c,m):f=Math.min(f,m);return f>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,r,c){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const y=m.tileID,S=1<<y.overscaledZ,{x:I,y:P}=y.canonical,L=I/S,k=(I+1)/S,B=P/S,N=(P+1)/S;return{minx:L,miny:B,maxx:k,maxy:N,t:m.dem.tree.raycastRoot(L,B,k,N,t,r,c),tile:m}});f.sort((m,y)=>(m.t!==null?m.t:Number.MAX_VALUE)-(y.t!==null?y.t:Number.MAX_VALUE));for(const m of f){if(m.t==null)return null;const y=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,t,r,c);if(y!=null)return y}return null}_createFBO(){const t=this.painter.context,r=t.gl,c=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const f=new s.T(t,{width:c[0],height:c[1],data:null},r.RGBA8);f.bind(r.LINEAR,r.CLAMP_TO_EDGE);const m=t.createFramebuffer(c[0],c[1],!0,null);return m.colorAttachment.set(f.texture),m.depthAttachment=new Aa(t,m.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:m,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],c=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!c&&r.shouldRedrape():!c&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof yc){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],m=this._style.getLayerSourceCache(f);if(m&&!r[m.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof s.a4){r[m.id]=!0;for(const y of this.proxyCoords){const S=this.proxyToSource[y.key][m.id];if(S)for(const I of S)this._clearRenderCacheForTile(m.id,I)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof gl){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],m=this._style.getLayerSourceCache(f);if(!m||r[m.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;const y=f.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const I=this.proxyToSource[S.key][m.id];if(I)for(const P of I){const L=qc(m.getTile(P),m.findLoadedParent(P,0),m,this.painter.transform,y);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(m.id,P)}}}}_setupDrapedRenderBatches(){const t=this._style.order,r=t.length;if(r===0)return;const c=[];this._pendingGroundEffectLayers=[];let f,m=0,y=this._style._mergedLayers[t[m]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++m<r;)y=this._style._mergedLayers[t[m]];for(;m<r;++m){const S=this._style._mergedLayers[t[m]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?f===void 0&&(f=m):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(m),f!==void 0&&(c.push({start:f,end:m-1}),f=void 0)))}if(f!==void 0&&c.push({start:f,end:m-1}),c.length!==0){const S=c[c.length-1];this._pendingGroundEffectLayers.every(I=>I>S.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const y=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let S=0;S<y.length;++S){const I=Object.values(y[S]);r.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,f=this._tilesDirty;for(let y=c.length-1;y>=0;y--){const S=c[y];if(r.getTileByID(S.key),r.proxyCachedFBO[S.key]!==void 0){const I=t[S.key],P=this.proxyToSource[S.key];let L=0;for(const k in P){const B=P[k],N=I[k];if(!N||N.length!==B.length||B.some((q,Z)=>q!==N[Z]||f[k]&&f[k].hasOwnProperty(q.key))){L=-1;break}++L}for(const k in r.proxyCachedFBO[S.key])r.renderCache[r.proxyCachedFBO[S.key][k]].dirty=L<0||L!==Object.values(I).length}}const m=[...this._drapedRenderBatches];m.sort((y,S)=>S.end-S.start-(y.end-y.start));for(const y of m)for(const S of c){if(r.proxyCachedFBO[S.key])continue;let I=r.renderCachePool.pop();I===void 0&&r.renderCache.length<50&&(I=r.renderCache.length,r.renderCache.push(this._createFBO())),I!==void 0&&(r.proxyCachedFBO[S.key]={},r.proxyCachedFBO[S.key][y.start]=I,r.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,c,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,y=m.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let S;if(c.isTileClipped())S=r.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):li.disabled}_renderTileClippingMasks(t,r){const c=this.painter,f=this.painter.context,m=f.gl;c._tileClippingMaskIDs={},f.setColorMode(bi.disabled),f.setDepthMode(Vt.disabled);const y=c.getOrCreateProgram("clippingMask");for(const S of t){const I=c._tileClippingMaskIDs[S.key]=--r;y.draw(c,m.TRIANGLES,Vt.disabled,new li({func:m.ALWAYS,mask:0},I,255,m.KEEP,m.KEEP,m.REPLACE),bi.disabled,ei.disabled,Dl(S.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const c=[t.x,t.y,1,1];s.a6.vec4.transformMat4(c,c,r.pixelMatrixInverse),s.a6.vec4.scale(c,c,1/c[3]),c[0]/=r.worldSize,c[1]/=r.worldSize;const f=r._camera.position,m=s.bD(1,r.center.lat),y=[f[0],f[1],f[2]/m,0],S=s.a6.vec3.subtract([],c.slice(0,3),y);s.a6.vec3.normalize(S,S);const I=this.raycast(y,S,this._exaggeration);return I!==null&&I?(s.a6.vec3.scaleAndAdd(y,y,S,I),y[3]=y[2],y[2]*=m,y):null}_setupProxiedCoordsForOrtho(t,r,c){if(t.getSource()instanceof s.aD)return this._setupProxiedCoordsForImageSource(t,r,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const f=this.proxiedCoords[t.id]=[],m=this.proxyCoords;for(let I=0;I<m.length;I++){const P=m[I],L=this._findTileCoveringTileID(P,t);if(L){const k=this._createProxiedId(P,L,c[P.key]&&c[P.key][t.id]);f.push(k),this.proxyToSource[P.key][t.id]=[k]}}let y=!1;const S=new Set;for(let I=0;I<r.length;I++){const P=t.getTile(r[I]);if(!P||!P.hasData())continue;const L=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==P.tileID.canonical.z){const k=this.proxyToSource[L.tileID.key][t.id],B=this._createProxiedId(L.tileID,P,c[L.tileID.key]&&c[L.tileID.key][t.id]);k?k.splice(k.length-1,0,B):this.proxyToSource[L.tileID.key][t.id]=[B];const N=this.proxyToSource[L.tileID.key][t.id];S.has(N)||S.add(N),f.push(B),y=!0}}if(this._sourceTilesOverlap[t.id]=y,y&&this._debugParams.sortTilesHiZFirst)for(const I of S)I.sort((P,L)=>L.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,c){if(!t.getSource().loaded())return;const f=this.proxiedCoords[t.id]=[],m=this.proxyCoords,y=t.getSource(),S=y.tileID;if(!S)return;const I=new s.P(S.x,S.y)._div(1<<S.z),P=y.coordinates.map(s.a5.fromLngLat).reduce((k,B)=>(k.min.x=Math.min(k.min.x,B.x-I.x),k.min.y=Math.min(k.min.y,B.y-I.y),k.max.x=Math.max(k.max.x,B.x-I.x),k.max.y=Math.max(k.max.y,B.y-I.y),k),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(k,B)=>{const N=k.wrap+k.canonical.x/(1<<k.canonical.z),q=k.canonical.y/(1<<k.canonical.z),Z=s.ab/(1<<k.canonical.z),H=B.wrap+B.canonical.x/(1<<B.canonical.z),W=B.canonical.y/(1<<B.canonical.z);return N+Z<H+P.min.x||N>H+P.max.x||q+Z<W+P.min.y||q>W+P.max.y};for(let k=0;k<m.length;k++){const B=m[k];for(let N=0;N<r.length;N++){const q=t.getTile(r[N]);if(!q||!q.hasData()||L(B,q.tileID))continue;const Z=this._createProxiedId(B,q,c[B.key]&&c[B.key][t.id]),H=this.proxyToSource[B.key][t.id];H?H.push(Z):this.proxyToSource[B.key][t.id]=[Z],f.push(Z)}}}_createProxiedId(t,r,c){let f=this.orthoMatrix;if(c){const m=c.find(y=>y.key===r.tileID.key);if(m)return m}if(r.tileID.key!==t.key){const m=t.canonical.z-r.tileID.canonical.z;let y,S,I;f=s.a6.mat4.create();const P=r.tileID.wrap-t.wrap<<t.overscaledZ;m>0?(y=s.ab>>m,S=y*((r.tileID.canonical.x<<m)-t.canonical.x+P),I=y*((r.tileID.canonical.y<<m)-t.canonical.y)):(y=s.ab<<-m,S=s.ab*(r.tileID.canonical.x-(t.canonical.x+P<<-m)),I=s.ab*(r.tileID.canonical.y-(t.canonical.y<<-m))),s.a6.mat4.ortho(f,0,y,0,y,0,1),s.a6.mat4.translate(f,f,[S,I,0])}return new Eh(r.tileID,t.key,f)}_findTileCoveringTileID(t,r){let c=r.getTile(t);if(c&&c.hasData())return c;const f=this._findCoveringTileCache[r.id],m=f[t.key];if(c=m?r.getTileByID(m):null,c&&c.hasData()||m===null)return c;let y=c?c.tileID:t,S=y.overscaledZ;const I=r.getSource().minzoom,P=[];if(!m){const k=r.getSource().maxzoom;if(t.canonical.z>=k){const B=t.canonical.z-k;r.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,r.transform.tileZoom),y=new s.aA(S,t.wrap,k,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(S=k,y=new s.aA(S,t.wrap,k,t.canonical.x>>B,t.canonical.y>>B))}y.key!==t.key&&(P.push(y.key),c=r.getTile(y))}const L=k=>{P.forEach(B=>{f[B]=k}),P.length=0};for(S-=1;S>=I&&(!c||!c.hasData());S--){c&&L(c.tileID.key);const k=y.calculateScaledKey(S);if(c=r.getTileByID(k),c&&c.hasData())break;const B=f[k];if(B===null)break;B===void 0?P.push(k):c=r.getTileByID(B)}return L(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[r.key]=!0}}function Mh(l,t,r){const c=function(S,I,P){const L=s.a6.vec3.dot(I,S),k=s.a6.vec3.dot(P,[.2126,.7152,.0722]),B=(q,Z,H)=>(1-H)*q+H*Z,N=B(1-.3*Math.min(k,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(s.ap(I[2],-1,1))/Math.PI+.5)*N}(l,[0,0,1],t),f=[0,0,0];s.a6.vec3.scale(f,r.slice(0,3),c);const m=[0,0,0];s.a6.vec3.scale(m,t.slice(0,3),l[2]);const y=[0,0,0];return s.a6.vec3.add(y,f,m),s.cb(y)}const Go=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Df=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class go{static cacheKey(t,r,c,f){let m=`${r}${f?f.cacheKey:""}`;for(const y of c)t.usedDefines.includes(y)&&(m+=`/${y}`);return m}constructor(t,r,c,f,m,y){const S=t.gl;this.program=S.createProgram(),this.configuration=f,this.name=r,this.fixedDefines=[...y];const I=f?f.getBinderAttributes():[],P=(c.staticAttributes||[]).concat(I);let L=f?f.defines():[];L=L.concat(y.map(H=>`#define ${H}`));const k=`#version 300 es
`;let B=k+L.concat("precision mediump float;",Oc,Ml.fragmentSource).join(`
`);for(const H of c.fragmentIncludes)B+=`
${Sl[H]}`;B+=`
${c.fragmentSource}`;let N=k+L.concat("precision highp float;",Oc,Ml.vertexSource).join(`
`);for(const H of c.vertexIncludes)N+=`
${Sl[H]}`;N+=`
${c.vertexSource}`;const q=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(q,B),S.compileShader(q),S.attachShader(this.program,q);const Z=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Z,N),S.compileShader(Z),S.attachShader(this.program,Z),this.attributes={},this.numAttributes=P.length;for(let H=0;H<this.numAttributes;H++)if(P[H]){const W=P[H].startsWith("a_")?P[H]:`a_${P[H]}`;S.bindAttribLocation(this.program,H,W),this.attributes[W]=H}S.linkProgram(this.program),S.deleteShader(Z),S.deleteShader(q),this.fixedUniforms=m(t),this.binderUniforms=f?f.getUniforms(t):[],(y.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(H=>({u_dem:new s.bJ(H),u_dem_prev:new s.bJ(H),u_dem_tl:new s.bG(H),u_dem_scale:new s.bI(H),u_dem_tl_prev:new s.bG(H),u_dem_scale_prev:new s.bI(H),u_dem_size:new s.bI(H),u_dem_lerp:new s.bI(H),u_exaggeration:new s.bI(H),u_depth:new s.bJ(H),u_depth_size_inv:new s.bG(H),u_depth_range_unpack:new s.bG(H),u_occluder_half_size:new s.bI(H),u_occlusion_depth_offset:new s.bI(H),u_meter_to_dem:new s.bI(H),u_label_plane_matrix_inv:new s.bF(H)}))(t)),y.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new s.bH(H),u_tile_tr_up:new s.bH(H),u_tile_br_up:new s.bH(H),u_tile_bl_up:new s.bH(H),u_tile_up_scale:new s.bI(H)}))(t)),y.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new s.bF(H),u_fog_range:new s.bG(H),u_fog_color:new s.c6(H),u_fog_horizon_blend:new s.bI(H),u_fog_vertical_limit:new s.bG(H),u_fog_temporal_offset:new s.bI(H),u_frustum_tl:new s.bH(H),u_frustum_tr:new s.bH(H),u_frustum_br:new s.bH(H),u_frustum_bl:new s.bH(H),u_globe_pos:new s.bH(H),u_globe_radius:new s.bI(H),u_globe_transition:new s.bI(H),u_is_globe:new s.bJ(H),u_viewport:new s.bG(H)}))(t)),y.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(H=>({u_cutoff_params:new s.c6(H)}))(t)),y.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(H=>({u_lighting_ambient_color:new s.bH(H),u_lighting_directional_dir:new s.bH(H),u_lighting_directional_color:new s.bH(H),u_ground_radiance:new s.bH(H)}))(t)),y.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(H=>({u_light_matrix_0:new s.bF(H),u_light_matrix_1:new s.bF(H),u_fade_range:new s.bG(H),u_shadow_normal_offset:new s.bH(H),u_shadow_intensity:new s.bI(H),u_shadow_texel_size:new s.bI(H),u_shadow_map_resolution:new s.bI(H),u_shadow_direction:new s.bH(H),u_shadow_bias:new s.bH(H),u_shadowmap_0:new s.bJ(H),u_shadowmap_1:new s.bJ(H)}))(t))}}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f]&&c[f].set(this.program,f,r[f])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f]&&c[f].set(this.program,f,r[f])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}_drawDebugWireframe(t,r,c,f,m,y,S,I,P,L){const k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const B=t.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!Go.includes(this.name))||!(!k.layers3D||!Df.includes(this.name))))return;const N=B.gl,q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,m,B);if(!q)return;const Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");const H=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});B.program.set(H.program);const W=(ee,ae,oe)=>{if(ae[ee]&&oe[ee])for(const fe in ae[ee])oe[ee][fe]&&oe[ee][fe].set(oe.program,fe,ae[ee][fe].current)};P&&P.setUniforms(H.program,B,H.binderUniforms,S,{zoom:I}),W("fixedUniforms",this,H),W("terrainUniforms",this,H),W("globeUniforms",this,H),W("fogUniforms",this,H),W("lightsUniforms",this,H),W("shadowUniforms",this,H),q.bind(),B.setColorMode(new bi([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],s.bz.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Vt(r.func===N.LESS?N.LEQUAL:r.func,Vt.ReadOnly,r.range)),B.setStencilMode(li.disabled);const ie=3*y.primitiveLength*2,ne=3*y.primitiveOffset*2*2;L&&L>1?N.drawElementsInstanced(N.LINES,ie,N.UNSIGNED_SHORT,ne,L):N.drawElements(N.LINES,ie,N.UNSIGNED_SHORT,ne),m.bind(),B.program.set(this.program),B.setDepthMode(r),B.setStencilMode(c),B.setColorMode(f)}draw(t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z,H){const W=t.context,ie=W.gl;if(this.failedToCreate)return;W.program.set(this.program),W.setDepthMode(c),W.setStencilMode(f),W.setColorMode(m),W.setCullFace(y);for(const ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,S[ae]);q&&q.setUniforms(this.program,W,this.binderUniforms,B,{zoom:N});const ne={[ie.POINTS]:1,[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[r],ee=H&&H>0?1:void 0;for(const ae of k.get()){const oe=ae.vaos||(ae.vaos={});(oe[I]||(oe[I]=new Sa)).bind(W,this,P,q?q.getPaintVertexBuffers():[],L,ae.vertexOffset,Z||[],ee),H&&H>1?ie.drawElementsInstanced(r,ae.primitiveLength*ne,ie.UNSIGNED_SHORT,ae.primitiveOffset*ne*2,H):L?ie.drawElements(r,ae.primitiveLength*ne,ie.UNSIGNED_SHORT,ae.primitiveOffset*ne*2):ie.drawArrays(r,ae.vertexOffset,ae.vertexLength),r===ie.TRIANGLES&&L&&this._drawDebugWireframe(t,c,f,m,L,ae,B,N,q,H)}}}function Ah(l,t){const r=Math.pow(2,t.tileID.overscaledZ),c=t.tileSize*Math.pow(2,l.transform.tileZoom)/r,f=c*(t.tileID.canonical.x+t.tileID.wrap*r),m=c*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ak(t,1,l.transform.tileZoom),u_pixel_coord_upper:[f>>16,m>>16],u_pixel_coord_lower:[65535&f,65535&m]}}const $c=s.a6.mat4.create(),Ih=(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z)=>{const H=t.style.light,W=H.properties.get("position"),ie=[W.x,W.y,W.z],ne=s.a6.mat3.create();H.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(ne,-t.transform.angle),s.a6.vec3.transformMat3(ie,ie,ne));const ee=H.properties.get("color"),ae=t.transform,oe={u_matrix:l,u_lightpos:ie,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_vertical_gradient:+r,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$c,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:f,u_edge_radius:m,u_width_scale:y,u_flood_light_color:B,u_vertical_scale:N,u_flood_light_intensity:q,u_ground_shadow_factor:Z};return ae.projection.name==="globe"&&(oe.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],oe.u_zoom_transition=P,oe.u_inv_rot_matrix=k,oe.u_merc_center=L,oe.u_up_dir=ae.projection.upVector(new s.bP(0,0,0),L[0]*s.ab,L[1]*s.ab),oe.u_height_lift=I),oe},zf=(l,t,r,c)=>({u_matrix:l,u_edge_radius:t,u_width_scale:r,u_vertical_scale:c}),Ch=(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q)=>{const Z=Ih(l,t,r,c,f,m,y,S,P,L,k,B,N,q,1,[0,0,0]),H={u_height_factor:-Math.pow(2,S.overscaledZ)/I.tileSize/8};return s.l(Z,Ah(t,I),H)},Zc=(l,t)=>({u_matrix:l,u_emissive_strength:t}),kf=(l,t,r,c)=>s.l(Zc(l,t),Ah(r,c)),Of=(l,t,r)=>({u_matrix:l,u_world:r,u_emissive_strength:t}),zl=(l,t,r,c,f)=>s.l(kf(l,t,r,c),{u_world:f}),qm=(l,t,r,c)=>{const f=s.ab/r.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(c),u_extrude_scale:[t.pixelsToGLUnits[0]/f,t.pixelsToGLUnits[1]/f]}},Bf=(l,t,r=1)=>({u_matrix:l,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:r}),Ff=s.a6.mat4.create(),$m=(l,t,r,c,f,m,y)=>{const S=l.transform,I=S.projection.name==="globe",P=I?s.cI(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:s.ak(r,1,m),L={u_matrix:t.projMatrix,u_extrude_scale:P,u_intensity:y,u_inv_rot_matrix:Ff,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){L.u_inv_rot_matrix=c,L.u_merc_center=f,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=s.a9(S.zoom);const k=f[0]*s.ab,B=f[1]*s.ab;L.u_up_dir=S.projection.upVector(new s.bP(0,0,0),k,B)}return L};function Hc(l,[t,r,c,f],[m,y]){if(m===y)return[0,0,0,0];const S=255*(l-1)/(l*(y-m));return[t*S,r*S,c*S,f*S]}function Wc(l,t,[r,c]){return r===c?0:.5/l+(t-r)*(l-1)/(l*(c-r))}const kl=(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z,H,W,ie,ne,ee)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:P,u_fade_t:L.mix,u_opacity:L.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:s.cJ(k.paint.get("raster-saturation")),u_contrast_factor:s.cK(k.paint.get("raster-contrast")),u_spin_weights:Ph(k.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:N,u_zoom_transition:y,u_merc_center:S,u_cutoff_params:I,u_colorization_mix:Hc(s.cL,Z,W),u_colorization_offset:Wc(s.cL,H,W),u_color_ramp:q,u_texture_offset:[ne/(ie+2*ne),ie/(ie+2*ne)],u_texture_res:[ie+2*ne,ie+2*ne],u_emissive_strength:ee});function Ph(l){l*=Math.PI/180;const t=Math.sin(l),r=Math.cos(l);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const ks=.05,Nf=(l,t,r,c,f,m,y,S,I,P,L,k)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:P,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:y,u_merc_center:S,u_cutoff_params:I}),Xc=(l,t,r,c,f,m,y,S,I,P)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:c,u_color_ramp:m,u_velocity_res:f,u_max_speed:y,u_uv_offset:S,u_data_scale:[255*I[0],255*I[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[ks,ks]}),Yc=(l,t,r,c,f,m,y,S,I,P)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:c,u_max_speed:f,u_speed_factor:m,u_reset_rate:y,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*I[0],255*I[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[ks,ks]}),Kc=s.a6.mat4.create(),Rh=(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z,H,W,ie,ne,ee)=>{const ae=f.transform,oe={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ae.getCameraToCenterDistance(ie),u_rotate_symbol:+r,u_aspect_ratio:ae.width/ae.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:y,u_coord_matrix:S,u_is_text:+P,u_elevation_from_sea:I?1:0,u_pitch_with_map:+c,u_texsize:L,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Kc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Kc,u_up_vector:[0,-1,0],u_color_adj_mat:ne,u_icon_transition:ee||0,u_gamma_scale:c?f.transform.getCameraToCenterDistance(ie)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+B};return ie.name==="globe"&&(oe.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],oe.u_zoom_transition=q,oe.u_inv_rot_matrix=H,oe.u_merc_center=Z,oe.u_camera_forward=ae._camera.forward(),oe.u_ecef_origin=s.cM(ae.globeMatrix,N.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(ae.globeMatrix),oe.u_up_vector=W),oe},Vf=(l,t,r,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:r,u_color:c}),qo=(l,t,r,c,f,m,y,S,I)=>s.l(function(P,L,k,B,N,q){const{width:Z,height:H}=B.imageManager.getPixelSize(L),W=Math.pow(2,q.tileID.overscaledZ),ie=q.tileSize*Math.pow(2,B.transform.tileZoom)/W,ne=ie*(q.tileID.canonical.x+q.tileID.wrap*W),ee=ie*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[Z,H],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:N?[B.transform.width,-1*B.transform.height]:[1/s.ak(q,1,B.transform.tileZoom),1/s.ak(q,1,B.transform.tileZoom)],u_pixel_coord_upper:[ne>>16,ee>>16],u_pixel_coord_lower:[65535&ne,65535&ee]}}(0,m,y,c,S,I),{u_matrix:l,u_emissive_strength:t,u_opacity:r}),Pa=new Float32Array(s.a6.mat4.identity([])),At=(l,t,r,c,f,m,y,S,I,P,L,k,B,N=[0,0,0],q)=>{const Z=f.style.light,H=Z.properties.get("position"),W=[-H.x,-H.y,H.z],ie=s.a6.mat3.create();Z.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(ie,-f.transform.angle),s.a6.vec3.transformMat3(W,W,ie));const ne=L.alphaMode==="MASK",ee=Z.properties.get("color").toRenderColor(null),ae=B.paint.get("model-ambient-occlusion-intensity"),oe=B.paint.get("model-color").constantOr(s.bz.white).toRenderColor(null),fe=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:c||Pa,u_lightpos:W,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_camera_pos:N,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+ne,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[y.r,y.g,y.b,y.a],u_emissiveFactor:[S[0],S[1],S[2],1],u_metallicFactor:I,u_roughnessFactor:P,u_baseColorTexture:un.BaseColor,u_metallicRoughnessTexture:un.MetallicRoughness,u_normalTexture:un.Normal,u_occlusionTexture:un.Occlusion,u_emissionTexture:un.Emission,u_lutTexture:un.LUT,u_color_mix:[oe.r,oe.g,oe.b,fe],u_aoIntensity:ae,u_emissive_strength:k,u_occlusionTextureTransform:q||[0,0,0,0]}},Lh=(l,t=Pa,r=Pa)=>({u_matrix:l,u_instance:t,u_node_matrix:r}),Uf={fillExtrusion:l=>({u_matrix:new s.bF(l),u_lightpos:new s.bH(l),u_lightintensity:new s.bI(l),u_lightcolor:new s.bH(l),u_vertical_gradient:new s.bI(l),u_opacity:new s.bI(l),u_edge_radius:new s.bI(l),u_width_scale:new s.bI(l),u_ao:new s.bG(l),u_tile_id:new s.bH(l),u_zoom_transition:new s.bI(l),u_inv_rot_matrix:new s.bF(l),u_merc_center:new s.bG(l),u_up_dir:new s.bH(l),u_height_lift:new s.bI(l),u_flood_light_color:new s.bH(l),u_vertical_scale:new s.bI(l),u_flood_light_intensity:new s.bI(l),u_ground_shadow_factor:new s.bH(l)}),fillExtrusionDepth:l=>({u_matrix:new s.bF(l),u_edge_radius:new s.bI(l),u_width_scale:new s.bI(l),u_vertical_scale:new s.bI(l)}),fillExtrusionPattern:l=>({u_matrix:new s.bF(l),u_lightpos:new s.bH(l),u_lightintensity:new s.bI(l),u_lightcolor:new s.bH(l),u_vertical_gradient:new s.bI(l),u_height_factor:new s.bI(l),u_edge_radius:new s.bI(l),u_width_scale:new s.bI(l),u_ao:new s.bG(l),u_tile_id:new s.bH(l),u_zoom_transition:new s.bI(l),u_inv_rot_matrix:new s.bF(l),u_merc_center:new s.bG(l),u_up_dir:new s.bH(l),u_height_lift:new s.bI(l),u_image:new s.bJ(l),u_texsize:new s.bG(l),u_pixel_coord_upper:new s.bG(l),u_pixel_coord_lower:new s.bG(l),u_tile_units_to_pixels:new s.bI(l),u_opacity:new s.bI(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new s.bF(l),u_opacity:new s.bI(l),u_ao_pass:new s.bI(l),u_meter_to_tile:new s.bI(l),u_ao:new s.bG(l),u_flood_light_intensity:new s.bI(l),u_flood_light_color:new s.bH(l),u_attenuation:new s.bI(l),u_edge_radius:new s.bI(l),u_fb:new s.bJ(l),u_fb_size:new s.bI(l),u_dynamic_offset:new s.bI(l)}),fill:l=>({u_matrix:new s.bF(l),u_emissive_strength:new s.bI(l)}),fillPattern:l=>({u_matrix:new s.bF(l),u_emissive_strength:new s.bI(l),u_image:new s.bJ(l),u_texsize:new s.bG(l),u_pixel_coord_upper:new s.bG(l),u_pixel_coord_lower:new s.bG(l),u_tile_units_to_pixels:new s.bI(l)}),fillOutline:l=>({u_matrix:new s.bF(l),u_emissive_strength:new s.bI(l),u_world:new s.bG(l)}),fillOutlinePattern:l=>({u_matrix:new s.bF(l),u_emissive_strength:new s.bI(l),u_world:new s.bG(l),u_image:new s.bJ(l),u_texsize:new s.bG(l),u_pixel_coord_upper:new s.bG(l),u_pixel_coord_lower:new s.bG(l),u_tile_units_to_pixels:new s.bI(l)}),circle:s.cN,collisionBox:l=>({u_matrix:new s.bF(l),u_camera_to_center_distance:new s.bI(l),u_extrude_scale:new s.bG(l)}),collisionCircle:l=>({u_matrix:new s.bF(l),u_inv_matrix:new s.bF(l),u_camera_to_center_distance:new s.bI(l),u_viewport_size:new s.bG(l)}),debug:l=>({u_color:new s.cu(l),u_matrix:new s.bF(l),u_overlay:new s.bJ(l),u_overlay_scale:new s.bI(l)}),clippingMask:l=>({u_matrix:new s.bF(l)}),heatmap:l=>({u_extrude_scale:new s.bI(l),u_intensity:new s.bI(l),u_matrix:new s.bF(l),u_inv_rot_matrix:new s.bF(l),u_merc_center:new s.bG(l),u_tile_id:new s.bH(l),u_zoom_transition:new s.bI(l),u_up_dir:new s.bH(l)}),heatmapTexture:l=>({u_image:new s.bJ(l),u_color_ramp:new s.bJ(l),u_opacity:new s.bI(l)}),hillshade:l=>({u_matrix:new s.bF(l),u_image:new s.bJ(l),u_latrange:new s.bG(l),u_light:new s.bG(l),u_shadow:new s.cu(l),u_highlight:new s.cu(l),u_emissive_strength:new s.bI(l),u_accent:new s.cu(l)}),hillshadePrepare:l=>({u_matrix:new s.bF(l),u_image:new s.bJ(l),u_dimension:new s.bG(l),u_zoom:new s.bI(l)}),line:s.cO,linePattern:s.cP,raster:l=>({u_matrix:new s.bF(l),u_normalize_matrix:new s.bF(l),u_globe_matrix:new s.bF(l),u_merc_matrix:new s.bF(l),u_grid_matrix:new s.cv(l),u_tl_parent:new s.bG(l),u_scale_parent:new s.bI(l),u_fade_t:new s.bI(l),u_opacity:new s.bI(l),u_image0:new s.bJ(l),u_image1:new s.bJ(l),u_brightness_low:new s.bI(l),u_brightness_high:new s.bI(l),u_saturation_factor:new s.bI(l),u_contrast_factor:new s.bI(l),u_spin_weights:new s.bH(l),u_perspective_transform:new s.bG(l),u_raster_elevation:new s.bI(l),u_zoom_transition:new s.bI(l),u_merc_center:new s.bG(l),u_cutoff_params:new s.c6(l),u_colorization_mix:new s.c6(l),u_colorization_offset:new s.bI(l),u_color_ramp:new s.bJ(l),u_texture_offset:new s.bG(l),u_texture_res:new s.bG(l),u_emissive_strength:new s.bI(l)}),rasterParticle:l=>({u_matrix:new s.bF(l),u_normalize_matrix:new s.bF(l),u_globe_matrix:new s.bF(l),u_merc_matrix:new s.bF(l),u_grid_matrix:new s.cv(l),u_tl_parent:new s.bG(l),u_scale_parent:new s.bI(l),u_fade_t:new s.bI(l),u_opacity:new s.bI(l),u_image0:new s.bJ(l),u_image1:new s.bJ(l),u_raster_elevation:new s.bI(l),u_zoom_transition:new s.bI(l),u_merc_center:new s.bG(l),u_cutoff_params:new s.c6(l)}),rasterParticleTexture:l=>({u_texture:new s.bJ(l),u_opacity:new s.bI(l)}),rasterParticleDraw:l=>({u_particle_texture:new s.bJ(l),u_particle_texture_side_len:new s.bI(l),u_tile_offset:new s.bG(l),u_velocity:new s.bJ(l),u_color_ramp:new s.bJ(l),u_velocity_res:new s.bG(l),u_max_speed:new s.bI(l),u_uv_offset:new s.bG(l),u_data_scale:new s.bG(l),u_data_offset:new s.bI(l),u_particle_pos_scale:new s.bI(l),u_particle_pos_offset:new s.bG(l)}),rasterParticleUpdate:l=>({u_particle_texture:new s.bJ(l),u_particle_texture_side_len:new s.bI(l),u_velocity:new s.bJ(l),u_velocity_res:new s.bG(l),u_max_speed:new s.bI(l),u_speed_factor:new s.bI(l),u_reset_rate:new s.bI(l),u_rand_seed:new s.bI(l),u_uv_offset:new s.bG(l),u_data_scale:new s.bG(l),u_data_offset:new s.bI(l),u_particle_pos_scale:new s.bI(l),u_particle_pos_offset:new s.bG(l)}),symbol:l=>({u_is_size_zoom_constant:new s.bJ(l),u_is_size_feature_constant:new s.bJ(l),u_size_t:new s.bI(l),u_size:new s.bI(l),u_camera_to_center_distance:new s.bI(l),u_rotate_symbol:new s.bJ(l),u_aspect_ratio:new s.bI(l),u_fade_change:new s.bI(l),u_matrix:new s.bF(l),u_label_plane_matrix:new s.bF(l),u_coord_matrix:new s.bF(l),u_is_text:new s.bJ(l),u_elevation_from_sea:new s.bJ(l),u_pitch_with_map:new s.bJ(l),u_texsize:new s.bG(l),u_texsize_icon:new s.bG(l),u_texture:new s.bJ(l),u_texture_icon:new s.bJ(l),u_gamma_scale:new s.bI(l),u_device_pixel_ratio:new s.bI(l),u_tile_id:new s.bH(l),u_zoom_transition:new s.bI(l),u_inv_rot_matrix:new s.bF(l),u_merc_center:new s.bG(l),u_camera_forward:new s.bH(l),u_tile_matrix:new s.bF(l),u_up_vector:new s.bH(l),u_ecef_origin:new s.bH(l),u_is_halo:new s.bJ(l),u_icon_transition:new s.bI(l),u_color_adj_mat:new s.bF(l)}),background:l=>({u_matrix:new s.bF(l),u_emissive_strength:new s.bI(l),u_opacity:new s.bI(l),u_color:new s.cu(l)}),backgroundPattern:l=>({u_matrix:new s.bF(l),u_emissive_strength:new s.bI(l),u_opacity:new s.bI(l),u_image:new s.bJ(l),u_pattern_tl:new s.bG(l),u_pattern_br:new s.bG(l),u_texsize:new s.bG(l),u_pattern_size:new s.bG(l),u_pixel_coord_upper:new s.bG(l),u_pixel_coord_lower:new s.bG(l),u_pattern_units_to_pixels:new s.bG(l)}),terrainRaster:l=>({u_matrix:new s.bF(l),u_image0:new s.bJ(l),u_skirt_height:new s.bI(l),u_ground_shadow_factor:new s.bH(l)}),skybox:l=>({u_matrix:new s.bF(l),u_sun_direction:new s.bH(l),u_cubemap:new s.bJ(l),u_opacity:new s.bI(l),u_temporal_offset:new s.bI(l)}),skyboxGradient:l=>({u_matrix:new s.bF(l),u_color_ramp:new s.bJ(l),u_center_direction:new s.bH(l),u_radius:new s.bI(l),u_opacity:new s.bI(l),u_temporal_offset:new s.bI(l)}),skyboxCapture:l=>({u_matrix_3f:new s.cv(l),u_sun_direction:new s.bH(l),u_sun_intensity:new s.bI(l),u_color_tint_r:new s.c6(l),u_color_tint_m:new s.c6(l),u_luminance:new s.bI(l)}),globeRaster:l=>({u_proj_matrix:new s.bF(l),u_globe_matrix:new s.bF(l),u_normalize_matrix:new s.bF(l),u_merc_matrix:new s.bF(l),u_zoom_transition:new s.bI(l),u_merc_center:new s.bG(l),u_image0:new s.bJ(l),u_grid_matrix:new s.cv(l),u_skirt_height:new s.bI(l),u_far_z_cutoff:new s.bI(l),u_frustum_tl:new s.bH(l),u_frustum_tr:new s.bH(l),u_frustum_br:new s.bH(l),u_frustum_bl:new s.bH(l),u_globe_pos:new s.bH(l),u_globe_radius:new s.bI(l),u_viewport:new s.bG(l)}),globeAtmosphere:l=>({u_frustum_tl:new s.bH(l),u_frustum_tr:new s.bH(l),u_frustum_br:new s.bH(l),u_frustum_bl:new s.bH(l),u_horizon:new s.bI(l),u_transition:new s.bI(l),u_fadeout_range:new s.bI(l),u_color:new s.c6(l),u_high_color:new s.c6(l),u_space_color:new s.c6(l),u_temporal_offset:new s.bI(l),u_horizon_angle:new s.bI(l)}),model:l=>({u_matrix:new s.bF(l),u_lighting_matrix:new s.bF(l),u_normal_matrix:new s.bF(l),u_node_matrix:new s.bF(l),u_lightpos:new s.bH(l),u_lightintensity:new s.bI(l),u_lightcolor:new s.bH(l),u_camera_pos:new s.bH(l),u_opacity:new s.bI(l),u_baseColorFactor:new s.c6(l),u_emissiveFactor:new s.c6(l),u_metallicFactor:new s.bI(l),u_roughnessFactor:new s.bI(l),u_baseTextureIsAlpha:new s.bJ(l),u_alphaMask:new s.bJ(l),u_alphaCutoff:new s.bI(l),u_baseColorTexture:new s.bJ(l),u_metallicRoughnessTexture:new s.bJ(l),u_normalTexture:new s.bJ(l),u_occlusionTexture:new s.bJ(l),u_emissionTexture:new s.bJ(l),u_lutTexture:new s.bJ(l),u_color_mix:new s.c6(l),u_aoIntensity:new s.bI(l),u_emissive_strength:new s.bI(l),u_occlusionTextureTransform:new s.c6(l)}),modelDepth:l=>({u_matrix:new s.bF(l),u_instance:new s.bF(l),u_node_matrix:new s.bF(l)}),groundShadow:l=>({u_matrix:new s.bF(l),u_ground_shadow_factor:new s.bH(l)}),stars:l=>({u_matrix:new s.bF(l),u_up:new s.bH(l),u_right:new s.bH(l),u_intensity_multiplier:new s.bI(l)}),occlusion:l=>({u_matrix:new s.bF(l),u_anchorPos:new s.bH(l),u_screenSizePx:new s.bG(l),u_occluderSizePx:new s.bG(l),u_color:new s.c6(l)})};class zn{constructor(t,r,c,f){this.id=zn.uniqueIdxCounter,zn.uniqueIdxCounter++,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||f||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=zn.uniqueIdxCounter,zn.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}zn.uniqueIdxCounter=0;const $o={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ot{constructor(t,r,c,f,m,y){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=f,this.instanceCount=y,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||m||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let c=0;c<this.attributes.length;c++){const f=r.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,r,c){for(let f=0;f<this.attributes.length;f++){const m=this.attributes[f],y=r.attributes[m.name];y!==void 0&&t.vertexAttribPointer(y,m.components,t[$o[m.type]],!1,this.itemSize,m.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,r,c){for(let f=0;f<this.attributes.length;f++){const m=r.attributes[this.attributes[f].name];m!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(m,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jc{constructor(t,r,c,f,m){this.context=t,this.width=r,this.height=c;const y=this.framebuffer=t.gl.createFramebuffer();f&&(this.colorAttachment=new Gc(t,y)),m&&(this.depthAttachmentType=m,this.depthAttachment=m==="renderbuffer"?new wh(t,y):new Af(t,y))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class Zm{constructor(t,r){this.gl=t,this.clearColor=new dh(this),this.clearDepth=new xf(this),this.clearStencil=new fh(this),this.colorMask=new Nc(this),this.depthMask=new Cl(this),this.stencilMask=new vf(this),this.stencilFunc=new bf(this),this.stencilOp=new wf(this),this.stencilTest=new Ma(this),this.depthRange=new Tf(this),this.depthTest=new Nm(this),this.depthFunc=new Vm(this),this.blend=new Um(this),this.blendFunc=new ph(this),this.blendColor=new mh(this),this.blendEquation=new _h(this),this.cullFace=new gh(this),this.cullFaceSide=new Ef(this),this.frontFace=new Sf(this),this.program=new jm(this),this.activeTexture=new Pl(this),this.viewport=new Rl(this),this.bindFramebuffer=new Mf(this),this.bindRenderbuffer=new Xn(this),this.bindTexture=new yh(this),this.bindVertexBuffer=new Vc(this),this.bindElementBuffer=new Uc(this),this.bindVertexArrayOES=new xh(this),this.pixelStoreUnpack=new vh(this),this.pixelStoreUnpackPremultiplyAlpha=new jc(this),this.pixelStoreUnpackFlipY=new bh(this),this.options=r?{...r}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,c){return new zn(this,t,r,c)}createVertexBuffer(t,r,c,f,m){return new Ot(this,t,r,c,f,m)}createRenderbuffer(t,r,c){const f=this.gl,m=f.createRenderbuffer();return this.bindRenderbuffer.set(m),f.renderbufferStorage(f.RENDERBUFFER,t,r,c),this.bindRenderbuffer.set(null),m}createFramebuffer(t,r,c,f){return new Jc(this,t,r,c,f)}clear({color:t,depth:r,stencil:c,colorMask:f}){const m=this.gl;let y=0;t&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(f||[!0,!0,!0,!0])),r!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),m.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bh(t.blendFunction,bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Qc;function eu(l,t,r,c,f,m,y){const S=l.context,I=S.gl,P=l.transform,L=l.getOrCreateProgram("collisionBox"),k=[];let B=0,N=0;for(let ee=0;ee<c.length;ee++){const ae=c[ee],oe=t.getTile(ae),fe=oe.getBucket(r);if(!fe)continue;const he=of(ae,fe,P);let _e=he;f[0]===0&&f[1]===0||(_e=l.translatePosMatrix(he,oe,f,m));const Te=y?fe.textCollisionBox:fe.iconCollisionBox,be=fe.collisionCircleArray;if(be.length>0){const xe=s.a6.mat4.create(),Re=_e;s.a6.mat4.mul(xe,fe.placementInvProjMatrix,P.glCoordMatrix),s.a6.mat4.mul(xe,xe,fe.placementViewportMatrix),k.push({circleArray:be,circleOffset:N,transform:Re,invTransform:xe,projection:fe.getProjection()}),B+=be.length/4,N=B}Te&&(l.terrain&&l.terrain.setupElevationDraw(oe,L),L.draw(l,I.LINES,Vt.disabled,li.disabled,l.colorModeForRenderPass(),ei.disabled,qm(_e,P,oe,fe.getProjection()),r.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,P.zoom,null,[Te.collisionVertexBuffer,Te.collisionVertexBufferExt]))}if(!y||!k.length)return;const q=l.getOrCreateProgram("collisionCircle"),Z=new s.cQ;Z.resize(4*B),Z._trim();let H=0;for(const ee of k)for(let ae=0;ae<ee.circleArray.length/4;ae++){const oe=4*ae,fe=ee.circleArray[oe+0],he=ee.circleArray[oe+1],_e=ee.circleArray[oe+2],Te=ee.circleArray[oe+3];Z.emplace(H++,fe,he,_e,Te,0),Z.emplace(H++,fe,he,_e,Te,1),Z.emplace(H++,fe,he,_e,Te,2),Z.emplace(H++,fe,he,_e,Te,3)}(!Qc||Qc.length<2*B)&&(Qc=function(ee){const ae=2*ee,oe=new s.aO;oe.resize(ae),oe._trim();for(let fe=0;fe<ae;fe++){const he=6*fe;oe.uint16[he+0]=4*fe+0,oe.uint16[he+1]=4*fe+1,oe.uint16[he+2]=4*fe+2,oe.uint16[he+3]=4*fe+2,oe.uint16[he+4]=4*fe+3,oe.uint16[he+5]=4*fe+0}return oe}(B));const W=S.createIndexBuffer(Qc,!0),ie=S.createVertexBuffer(Z,s.cR.members,!0);for(const ee of k){const ae={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(ne=P).getCameraToCenterDistance(ee.projection),u_viewport_size:[ne.width,ne.height]};q.draw(l,I.TRIANGLES,Vt.disabled,li.disabled,l.colorModeForRenderPass(),ei.disabled,ae,r.id,ie,W,s.b1.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,P.zoom)}var ne;ie.destroy(),W.destroy()}const Ol=s.a6.mat4.create();function Dh(l){const t=l._camera.getWorldToCamera(l.worldSize,1),r=s.a6.mat4.multiply([],t,l.globeMatrix);s.a6.mat4.invert(r,r);const c=[0,0,0],f=[0,1,0,0];return s.a6.vec4.transformMat4(f,f,r),c[0]=f[0],c[1]=f[1],c[2]=f[2],s.a6.vec3.normalize(c,c),c}function Hm({width:l,height:t,anchor:r,textOffset:c,textScale:f},m){const{horizontalAlign:y,verticalAlign:S}=s.bx(r),I=-(y-.5)*l,P=-(S-.5)*t,L=s.bw(r,c);return new s.P((I/f+L[0])*m,(P/f+L[1])*m)}function Wm(l,t,r,c,f,m,y,S,I,P,L){const k=l.text.placedSymbolArray,B=l.text.dynamicLayoutVertexArray,N=l.icon.dynamicLayoutVertexArray,q={},Z=l.getProjection(),H=fo(S,Z,m),W=m.elevation,ie=Z.upVectorScale(S.canonical,m.center.lat,m.worldSize).metersToTile;B.clear();for(let ne=0;ne<k.length;ne++){const ee=k.get(ne),{tileAnchorX:ae,tileAnchorY:oe,numGlyphs:fe}=ee,he=ee.hidden||!ee.crossTileID||l.allowVerticalPlacement&&!ee.placedOrientation?null:c[ee.crossTileID];if(he){let _e=0,Te=0,be=0;if(W){const He=W?W.getAtTileOffset(S,ae,oe):0,[st,at,Ye]=Z.upVector(S.canonical,ae,oe);_e=He*st*ie,Te=He*at*ie,be=He*Ye*ie}let[xe,Re,Ge,Ke]=mn(ee.projectedAnchorX+_e,ee.projectedAnchorY+Te,ee.projectedAnchorZ+be,r?H:y);const je=Ri(m.getCameraToCenterDistance(Z),Ke);let rt=f.evaluateSizeForFeature(l.textSizeData,P,ee)*je/s.bq;r&&(rt*=l.tilePixelRatio/I);const Le=Hm(he,rt);r?({x:xe,y:Re,z:Ge}=Z.projectTilePoint(ae+Le.x,oe+Le.y,S.canonical),[xe,Re,Ge]=mn(xe+_e,Re+Te,Ge+be,y)):(t&&Le._rotate(-m.angle),xe+=Le.x,Re+=Le.y,Ge=0);const Xe=l.allowVerticalPlacement&&ee.placedOrientation===s.bk.vertical?Math.PI/2:0;for(let He=0;He<fe;He++)s.bn(B,xe,Re,Ge,Xe);L&&ee.associatedIconIndex>=0&&(q[ee.associatedIconIndex]={x:xe,y:Re,z:Ge,angle:Xe})}else zs(fe,B)}if(L){N.clear();const ne=l.icon.placedSymbolArray;for(let ee=0;ee<ne.length;ee++){const ae=ne.get(ee),{numGlyphs:oe}=ae,fe=q[ee];if(ae.hidden||!fe)zs(oe,N);else{const{x:he,y:_e,z:Te,angle:be}=fe;for(let xe=0;xe<oe;xe++)s.bn(N,he,_e,Te,be)}}l.icon.dynamicLayoutVertexBuffer.updateData(N)}l.text.dynamicLayoutVertexBuffer.updateData(B)}function Bl(l,t,r,c,f,m,y={}){const S=r.paint.get("icon-translate"),I=r.paint.get("text-translate"),P=r.paint.get("icon-translate-anchor"),L=r.paint.get("text-translate-anchor"),k=r.layout.get("icon-rotation-alignment"),B=r.layout.get("text-rotation-alignment"),N=r.layout.get("icon-pitch-alignment"),q=r.layout.get("text-pitch-alignment"),Z=r.layout.get("icon-keep-upright"),H=r.layout.get("text-keep-upright"),W=r.paint.get("icon-color-saturation"),ie=r.paint.get("icon-color-contrast"),ne=r.paint.get("icon-color-brightness-min"),ee=r.paint.get("icon-color-brightness-max"),ae=r.paint.get("symbol-elevation-reference")==="sea",oe=r.paint.get("text-occlusion-opacity").constantOr(0),fe=l.context,he=fe.gl,_e=l.transform,Te=k==="map",be=B==="map",xe=N==="map",Re=q==="map",Ge=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ke=!1;const je=l.depthModeForSublayer(0,Vt.ReadOnly),rt=[s.am(_e.center.lng),s.at(_e.center.lat)],Le=r.layout.get("text-variable-anchor"),Xe=_e.projection.name==="globe",He=[],st=[0,-1,0];for(const at of c){const Ye=t.getTile(at),Qe=Ye.getBucket(r);if(!Qe||Qe.projection.name==="mercator"&&Xe||Qe.fullyClipped)continue;const Ft=Qe.projection.name==="globe",ft=Ft?s.a9(_e.zoom):0,Tt=fo(at,Qe.getProjection(),_e),Kt=_e.calculatePixelsToTileUnitsMatrix(Ye),Lt=Le&&Qe.hasTextData(),Zt=Qe.hasIconTextFit()&&Lt&&Qe.hasIconData(),_i=Qe.getProjection().createInversionMatrix(_e,at.canonical),fi=Ki=>{_e.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||l.terrain)&&(Ki.push("DEPTH_D24"),Ki.push("DEPTH_OCCLUSION"))},Xi=()=>{const Ki=Te&&r.layout.get("symbol-placement")!=="point",pi=[];fi(pi);const Bi=Ki||Zt,$i=r.paint.get("icon-image-cross-fade").constantOr(0);l.terrainRenderModeElevated()&&xe&&pi.push("PITCH_WITH_MAP_TERRAIN"),Ft&&(pi.push("PROJECTION_GLOBE_VIEW"),Bi&&pi.push("PROJECTED_POS_ON_VIEWPORT")),$i>0&&pi.push("ICON_TRANSITION"),Qe.icon.zOffsetVertexBuffer&&pi.push("Z_OFFSET"),W===0&&ie===0&&ne===0&&ee===1||pi.push("COLOR_ADJUSTMENT"),Qe.sdfIcons&&pi.push("RENDER_SDF");const Tr=Qe.icon.programConfigurations.get(r.id),Lr=l.getOrCreateProgram("symbol",{config:Tr,defines:pi}),Pi=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Zr=Qe.iconSizeData,Qr=s.bj(Zr,_e.zoom),Hr=xe||_e.pitch!==0,sr=Ai(Tt,Ye.tileID.canonical,xe,Te,_e,Qe.getProjection(),Kt),En=Ln(Tt,Ye.tileID.canonical,xe,Te,_e,Qe.getProjection(),Kt),Sn=l.translatePosMatrix(En,Ye,S,P,!0),ns=l.translatePosMatrix(Tt,Ye,S,P),Kn=Bi?Ol:sr,On=Te&&!xe&&!Ki;let ss=st;!Xe&&!_e.mercatorFromTransition||Te||(ss=Dh(_e));const Js=Ft?ss:st,Eo=r.getColorAdjustmentMatrix(W,ie,ne,ee),Ns=Rh(Zr.kind,Qr,On,xe,l,ns,Kn,Sn,ae,!1,Pi,[0,0],!0,at,ft,rt,_i,Js,Qe.getProjection(),Eo,$i),Ua=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,ja=r.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear,gu=Qe.sdfIcons||l.options.rotating||l.options.zooming||ja||Hr?he.LINEAR:he.NEAREST,Ga=Qe.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,or=l.terrain&&xe&&Ki?s.a6.mat4.invert(s.a6.mat4.create(),sr):Ol;if(Ki&&Qe.icon){const Ko=_e.elevation,c_=Ko?Ko.getAtTileOffsetFunc(at,_e.center.lat,_e.worldSize,Qe.getProjection()):null,op=Ii(Tt,Ye.tileID.canonical,xe,Te,_e,Qe.getProjection(),Kt);da(Qe,Tt,l,!1,op,En,xe,Z,c_,at)}return{program:Lr,buffers:Qe.icon,uniformValues:Ns,atlasTexture:Ua,atlasTextureIcon:null,atlasInterpolation:gu,atlasInterpolationIcon:null,isSDF:Qe.sdfIcons,hasHalo:Ga,tile:Ye,labelPlaneMatrixInv:or}},er=()=>{const Ki=be&&r.layout.get("symbol-placement")!=="point",pi=[],Bi=Ki||Le||Zt;l.terrainRenderModeElevated()&&Re&&pi.push("PITCH_WITH_MAP_TERRAIN"),Ft&&(pi.push("PROJECTION_GLOBE_VIEW"),Bi&&pi.push("PROJECTED_POS_ON_VIEWPORT")),Qe.text.zOffsetVertexBuffer&&pi.push("Z_OFFSET"),Qe.iconsInText&&pi.push("RENDER_TEXT_AND_SYMBOL"),pi.push("RENDER_SDF"),fi(pi);const $i=Qe.text.programConfigurations.get(r.id),Tr=l.getOrCreateProgram("symbol",{config:$i,defines:pi});let Lr,Pi=[0,0],Zr=null;const Qr=Qe.textSizeData;Qe.iconsInText&&(Pi=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Zr=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,Lr=Re||_e.pitch!==0||l.options.rotating||l.options.zooming||Qr.kind==="composite"||Qr.kind==="camera"?he.LINEAR:he.NEAREST);const Hr=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture.size:[0,0],sr=s.bj(Qr,_e.zoom),En=Ai(Tt,Ye.tileID.canonical,Re,be,_e,Qe.getProjection(),Kt),Sn=Ln(Tt,Ye.tileID.canonical,Re,be,_e,Qe.getProjection(),Kt),ns=l.translatePosMatrix(Sn,Ye,I,L,!0),Kn=l.translatePosMatrix(Tt,Ye,I,L),On=Bi?Ol:En,ss=be&&!Re&&!Ki;let Js=st;!Xe&&!_e.mercatorFromTransition||be||(Js=Dh(_e));const Eo=Rh(Qr.kind,sr,ss,Re,l,Kn,On,ns,ae,!0,Hr,Pi,!0,at,ft,rt,_i,Ft?Js:st,Qe.getProjection(),oe),Ns=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture:null,Ua=he.LINEAR,ja=r.paint.get("text-halo-width").constantOr(1)!==0,gu=l.terrain&&Re&&Ki?s.a6.mat4.invert(s.a6.mat4.create(),En):Ol;if(Ki&&Qe.text){const Ga=_e.elevation,or=Ga?Ga.getAtTileOffsetFunc(at,_e.center.lat,_e.worldSize,Qe.getProjection()):null,Ko=Ii(Tt,Ye.tileID.canonical,Re,be,_e,Qe.getProjection(),Kt);da(Qe,Tt,l,!0,Ko,Sn,Re,H,or,at)}return{program:Tr,buffers:Qe.text,uniformValues:Eo,atlasTexture:Ns,atlasTextureIcon:Zr,atlasInterpolation:Ua,atlasInterpolationIcon:Lr,isSDF:!0,hasHalo:ja,tile:Ye,labelPlaneMatrixInv:gu}},cr=Qe.icon.segments.get().length,rs=Qe.text.segments.get().length,Rr=cr&&!y.onlyText?Xi():null,wi=rs&&!y.onlyIcons?er():null,Ji=r.paint.get("icon-opacity").constantOr(1),mr=r.paint.get("text-opacity").constantOr(1);if(Ge&&Qe.canOverlap){Ke=!0;const Ki=Ji&&!y.onlyText?Qe.icon.segments.get():[],pi=mr&&!y.onlyIcons?Qe.text.segments.get():[];for(const Bi of Ki)He.push({segments:new s.b1([Bi]),sortKey:Bi.sortKey,state:Rr});for(const Bi of pi)He.push({segments:new s.b1([Bi]),sortKey:Bi.sortKey,state:wi})}else y.onlyText||He.push({segments:Ji?Qe.icon.segments:new s.b1([]),sortKey:0,state:Rr}),y.onlyIcons||He.push({segments:mr?Qe.text.segments:new s.b1([]),sortKey:0,state:wi})}Ke&&He.sort((at,Ye)=>at.sortKey-Ye.sortKey);for(const at of He){const Ye=at.state;if(Ye)if(l.terrain?l.terrain.setupElevationDraw(Ye.tile,Ye.program,{useDepthForOcclusion:_e.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ye.labelPlaneMatrixInv}):l.setupDepthForOcclusion(_e.depthOcclusionForSymbolsAndCircles,Ye.program),fe.activeTexture.set(he.TEXTURE0),Ye.atlasTexture&&Ye.atlasTexture.bind(Ye.atlasInterpolation,he.CLAMP_TO_EDGE,!0),Ye.atlasTextureIcon&&(fe.activeTexture.set(he.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,he.CLAMP_TO_EDGE,!0)),l.uploadCommonLightUniforms(l.context,Ye.program),Ye.hasHalo){const Qe=Ye.uniformValues;Qe.u_is_halo=1,Fl(Ye.buffers,at.segments,r,l,Ye.program,je,f,m,Qe,2),Qe.u_is_halo=0}else{if(Ye.isSDF){const Qe=Ye.uniformValues;Ye.hasHalo&&(Qe.u_is_halo=1,Fl(Ye.buffers,at.segments,r,l,Ye.program,je,f,m,Qe,1)),Qe.u_is_halo=0}Fl(Ye.buffers,at.segments,r,l,Ye.program,je,f,m,Ye.uniformValues,1)}}}function Fl(l,t,r,c,f,m,y,S,I,P){const L=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer];f.draw(c,c.context.gl.TRIANGLES,m,y,S,ei.disabled,I,r.id,l.layoutVertexBuffer,l.indexBuffer,t,r.paint,c.transform.zoom,l.programConfigurations.get(r.id),L,P)}function tu(l,t,r,c,f,m,y){const S=l.context.gl,I=r.paint.get("fill-pattern"),P=r.is3D(),L=P?l.stencilModeFor3D():li.disabled,k=I&&I.constantOr(1);let B,N,q,Z,H;y?(N=k&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(N=k?"fillPattern":"fill",B=S.TRIANGLES);for(const W of c){const ie=t.getTile(W);if(k&&!ie.patternsLoaded())continue;const ne=ie.getBucket(r);if(!ne)continue;l.prepareDrawTile();const ee=ne.programConfigurations.get(r.id),ae=l.isTileAffectedByFog(W),oe=l.getOrCreateProgram(N,{config:ee,overrideFog:ae});k&&(l.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture&&ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ee.updatePaintBuffers());const fe=I.constantOr(null);if(fe&&ie.imageAtlas){const Te=ie.imageAtlas.patternPositions[fe.toString()];Te&&ee.setConstantPatternPositions(Te)}const he=l.translatePosMatrix(W.projMatrix,ie,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),_e=r.paint.get("fill-emissive-strength");if(y){Z=ne.indexBuffer2,H=ne.segments2;const Te=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];q=N==="fillOutlinePattern"&&k?zl(he,_e,l,ie,Te):Of(he,_e,Te)}else Z=ne.indexBuffer,H=ne.segments,q=k?kf(he,_e,l,ie):Zc(he,_e);l.uploadCommonUniforms(l.context,oe,W.toUnwrapped()),oe.draw(l,B,f,P?L:l.stencilModeForClipping(W),m,ei.disabled,q,r.id,ne.layoutVertexBuffer,Z,H,r.paint,l.transform.zoom,ee,void 0)}}function Ra(l,t,r,c,f,m,y,S){r.resetLayerRenderingStats(l);const I=l.context,P=I.gl,L=l.transform,k=r.paint.get("fill-extrusion-pattern"),B=k.constantOr(1),N=r.paint.get("fill-extrusion-opacity"),q=l.style.enable3dLights(),Z=r.paint.get(q&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),H=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],W=r.layout.get("fill-extrusion-edge-radius"),ie=W>0&&!r.paint.get("fill-extrusion-rounded-roof"),ne=ie?0:W,ee=L.projection.name==="globe"?s.c_():0,ae=L.projection.name==="globe",oe=ae?s.a9(L.zoom):0,fe=[s.am(L.center.lng),s.at(L.center.lat)],he=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(r.lut).toArray01().slice(0,3),_e=r.paint.get("fill-extrusion-flood-light-intensity"),Te=r.paint.get("fill-extrusion-vertical-scale"),be=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,xe=Zs(l,r.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let Ge;ae&&Re.push("PROJECTION_GLOBE_VIEW"),H[0]>0&&Re.push("FAUX_AO"),ie&&Re.push("ZERO_ROOF_RADIUS"),S&&Re.push("HAS_CENTROID"),_e>0&&Re.push("FLOOD_LIGHT"),xe.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),be&&Re.push("RENDER_WALL_MODE");const Ke=l.renderPass==="shadow",je=l.shadowRenderer,rt=Ke&&!!je;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let Le=[0,0,0];if(je){const st=l.style.directionalLight,at=l.style.ambientLight;st&&at&&(Le=Rc(l.style,st,at)),Ge=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const Xe=rt?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",He=r.getLayerRenderingStats();for(const st of c){const at=t.getTile(st),Ye=at.getBucket(r);if(!Ye||Ye.projection.name!==L.projection.name)continue;let Qe=!1;je&&(Qe=je.getMaxCascadeForTile(st.toUnwrapped())===0);const Ft=l.isTileAffectedByFog(st),ft=Ye.programConfigurations.get(r.id),Tt=l.getOrCreateProgram(Xe,{config:ft,defines:Qe?Ge:Re,overrideFog:Ft});if(l.terrain&&l.terrain.setupElevationDraw(at,Tt,{useMeterToDem:!0}),!Ye.centroidVertexBuffer){const er=Tt.attributes.a_centroid_pos;er!==void 0&&P.vertexAttrib2f(er,0,0)}!Ke&&je&&je.setupShadows(at.tileID.toUnwrapped(),Tt,"vector-tile",at.tileID.overscaledZ),B&&(l.context.activeTexture.set(P.TEXTURE0),at.imageAtlasTexture&&at.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ft.updatePaintBuffers());const Kt=k.constantOr(null);if(Kt&&at.imageAtlas){const er=at.imageAtlas.patternPositions[Kt.toString()];er&&ft.setConstantPatternPositions(er)}const Lt=r.paint.get("fill-extrusion-vertical-gradient"),Zt=1/Ye.tileToMeter;let _i;if(Ke&&je){if(Oh(at.tileID,Ye,l))continue;const er=je.calculateShadowPassMatrixFromTile(at.tileID.toUnwrapped());_i=zf(er,ne,Zt,Te)}else{const er=l.translatePosMatrix(st.expandedProjMatrix,at,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),cr=L.projection.createInversionMatrix(L,st.canonical);_i=B?Ch(er,l,Lt,N,H,ne,Zt,st,at,ee,oe,fe,cr,he,Te):Ih(er,l,Lt,N,H,ne,Zt,st,ee,oe,fe,cr,he,Te,_e,Le)}l.uploadCommonUniforms(I,Tt,st.toUnwrapped(),null,xe);let fi=Ye.segments;if(L.projection.name==="mercator"&&!Ke&&(fi=Ye.getVisibleSegments(at.tileID,l.terrain,l.transform.getFrustum(0)),!fi.get().length))continue;if(He)if(Ke)for(const er of fi.get())He.numRenderedVerticesInShadowPass+=er.primitiveLength;else for(const er of fi.get())He.numRenderedVerticesInTransparentPass+=er.primitiveLength;const Xi=[];(l.terrain||S)&&Xi.push(Ye.centroidVertexBuffer),ae&&Xi.push(Ye.layoutVertexExtBuffer),be&&Xi.push(Ye.wallVertexBuffer),Tt.draw(l,I.gl.TRIANGLES,f,m,y,ei.backCCW,_i,r.id,Ye.layoutVertexBuffer,Ye.indexBuffer,fi,r.paint,l.transform.zoom,ft,Xi)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}function tn(l,t,r,c,f,m,y,S,I,P,L,k,B,N,q,Z,H,W,ie){const ne=l.context,ee=ne.gl,ae=l.transform,oe=l.transform.zoom,fe=[],he=Zs(l,r.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(fe.push("CLEAR_SUBPASS"),ie&&(fe.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(ee.TEXTURE0),ie.bind(ee.LINEAR,ee.CLAMP_TO_EDGE))):P==="sdf"&&fe.push("SDF_SUBPASS"),H&&fe.push("HAS_CENTROID"),he.shouldRenderCutoff&&fe.push("RENDER_CUTOFF");const _e=r.layout.get("fill-extrusion-edge-radius"),Te=(be,xe,Re,Ge,Ke)=>{const je=xe.programConfigurations.get(r.id),rt=l.isTileAffectedByFog(be),Le=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:je,defines:fe,overrideFog:rt}),Xe=((st,at,Ye,Qe,Ft,ft,Tt,Kt,Lt,Zt,_i)=>({u_matrix:at,u_opacity:Ye,u_ao_pass:Qe?1:0,u_meter_to_tile:Ft,u_ao:ft,u_flood_light_intensity:Tt,u_flood_light_color:Kt,u_attenuation:Lt,u_edge_radius:Zt,u_fb:0,u_fb_size:_i,u_dynamic_offset:1}))(0,Ge,L,I,Ke,[k,B*Ke],N,q,Z,oe>=17?0:_e*Ke,ie?ie.size[0]:0),He=[];H&&He.push(xe.hiddenByLandmarkVertexBuffer),l.uploadCommonUniforms(ne,Le,be.toUnwrapped(),null,he),Le.draw(l,ne.gl.TRIANGLES,f,m,y,S,Xe,r.id,xe.vertexBuffer,xe.indexBuffer,Re,r.paint,oe,je,He)};for(const be of c){const xe=t.getTile(be),Re=xe.getBucket(r);if(!Re||Re.projection.name!==ae.projection.name||!Re.groundEffect||Re.groundEffect&&!Re.groundEffect.hasData())continue;const Ge=Re.groundEffect,Ke=1/Re.tileToMeter;{const je=l.translatePosMatrix(be.projMatrix,xe,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),rt=Ge.getDefaultSegment();Te(be,Ge,rt,je,Ke)}if(W)for(let je=0;je<4;je++){const rt=s.c$[je](be),Le=t.getTile(rt);if(!Le)continue;const Xe=Le.getBucket(r);if(!Xe||Xe.projection.name!==ae.projection.name||!Xe.groundEffect||Xe.groundEffect&&!Xe.groundEffect.hasData())continue;const He=Xe.groundEffect;let st,at;je===0?(st=[-s.ab,0,0],at=1):je===1?(st=[s.ab,0,0],at=0):je===2?(st=[0,-s.ab,0],at=3):(st=[0,s.ab,0],at=2);const Ye=He.regionSegments[at];if(!Ye)continue;const Qe=new Float32Array(16);s.a6.mat4.translate(Qe,be.projMatrix,st),Te(be,He,Ye,l.translatePosMatrix(Qe,xe,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ke)}}}function yo(l,t,r,c,f,m,y){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const S=m?m.findDEMTileFor(r):null;if(!(S&&S.dem||y))return;const I=W=>new s.P(Math.ceil((W+s.d2)*s.d3),0),P=W=>{const ie=t.getSource().minzoom,ne=ae=>{const oe=t.getTileByID(ae);if(oe&&oe.hasData())return oe.getBucket(f)},ee=[0,-1,1];for(const ae of ee){if(W.overscaledZ+ae<ie)continue;const oe=ne(W.calculateScaledKey(W.overscaledZ+ae));if(oe)return oe}},L=[0,0,0],k=(W,ie)=>(L[0]=Math.min(W.min.y,ie.min.y),L[1]=Math.max(W.max.y,ie.max.y),L[2]=s.ab-ie.min.x>W.max.x?ie.min.x-s.ab:W.max.x,L),B=(W,ie)=>(L[0]=Math.min(W.min.x,ie.min.x),L[1]=Math.max(W.max.x,ie.max.x),L[2]=s.ab-ie.min.y>W.max.y?ie.min.y-s.ab:W.max.y,L),N=[(W,ie)=>k(W,ie),(W,ie)=>k(ie,W),(W,ie)=>B(W,ie),(W,ie)=>B(ie,W)],q=(W,ie,ne,ee,ae,oe,fe)=>{if(!m)return 0;const he=[[oe?ne:W,oe?W:ne,0],[oe?ne:ie,oe?ie:ne,0]],_e=fe<0?s.ab+fe:fe,Te=[oe?_e:(W+ie)/2,oe?(W+ie)/2:_e,0];return ne===0&&fe<0||ne!==0&&fe>0?m.getForTilePoints(ae,[Te],!0,ee):he.push(Te),m.getForTilePoints(r,he,!0,S),Math.max(he[0][2],he[1][2],Te[2])/m.exaggeration()};for(let W=0;W<4;W++){const ie=c.borderFeatureIndices[W];if(ie.length===0)continue;const ne=s.c$[W](r),ee=P(ne);if(!(ee&&ee instanceof s.d0)||c.borderDoneWithNeighborZ[W]===ee.canonical.z)continue;ee.centroidVertexArray.length===0&&ee.createCentroidsBuffer();const ae=m?m.findDEMTileFor(ne):null;if(!(ae&&ae.dem||y))continue;const oe=(W<2?1:5)-W,fe=ee.borderDoneWithNeighborZ[oe]!==c.canonical.z,he=ee.borderFeatureIndices[oe];let _e=0;if(c.canonical.z!==ee.canonical.z){for(const Te of ie)c.showCentroid(c.featuresOnBorder[Te]);if(fe)for(const Te of he)ee.showCentroid(ee.featuresOnBorder[Te]);c.borderDoneWithNeighborZ[W]=ee.canonical.z,ee.borderDoneWithNeighborZ[oe]=c.canonical.z}for(const Te of ie){const be=c.featuresOnBorder[Te],xe=c.centroidData[be.centroidDataIndex],Re=be.borders[W];let Ge;for(;_e<he.length;){Ge=ee.featuresOnBorder[he[_e]];const Ke=Ge.borders[oe];if(Ke[1]>Re[0]+3||Ke[0]>Re[0]-3)break;ee.showCentroid(Ge),_e++}if(Ge&&_e<he.length){const Ke=_e;let je=0;for(;!(Ge.borders[oe][0]>Re[1]-3)&&(je++,++_e!==he.length);)Ge=ee.featuresOnBorder[he[_e]];Ge=ee.featuresOnBorder[he[Ke]];let rt=!1;if(je>=1){const He=Ge.borders[oe];Math.abs(Re[0]-He[0])<3&&Math.abs(Re[1]-He[1])<3&&(je=1,rt=!0,_e=Ke+1)}else if(je===0){c.showCentroid(be);continue}const Le=ee.centroidData[Ge.centroidDataIndex];y&&rt&&(((Z=xe).flags|(H=Le).flags)&s.d1?(Z.flags|=s.d1,H.flags|=s.d1):(Z.flags&=~s.d1,H.flags&=~s.d1));const Xe=be.intersectsCount()>1||Ge.intersectsCount()>1;if(je>1)_e=Ke,xe.centroidXY=Le.centroidXY=new s.P(0,0);else if(ae&&ae.dem&&!Xe){const He=N[W](xe,Le),st=W%2?s.ab-1:0,at=q(He[0],Math.min(s.ab-1,He[1]),st,ae,ne,W<2,He[2]);xe.centroidXY=Le.centroidXY=I(at)}else Xe?xe.centroidXY=Le.centroidXY=new s.P(0,0):(xe.centroidXY=c.encodeBorderCentroid(be),Le.centroidXY=ee.encodeBorderCentroid(Ge));c.writeCentroidToBuffer(xe),ee.writeCentroidToBuffer(Le)}else c.showCentroid(be)}c.borderDoneWithNeighborZ[W]=ee.canonical.z,ee.borderDoneWithNeighborZ[oe]=c.canonical.z}var Z,H;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const jf=[1,0,0],zh=[0,1,0],kh=[0,0,1];function Oh(l,t,r){const c=r.transform,f=r.shadowRenderer;if(!f)return!0;const m=l.toUnwrapped(),y=c.tileSize*f._cascades[r.currentShadowCascade].scale;let S=t.maxHeight;if(c.elevation){const Z=c.elevation.getMinMaxForTile(l);Z&&(S+=Z.max)}const I=[...f.shadowDirection];I[2]=-I[2];const P=f.computeSimplifiedTileShadowVolume(m,S,y,I);if(!P)return!1;const L=[jf,zh,kh,I,[I[0],0,I[2]],[0,I[1],I[2]]],k=c.projection.name==="globe",B=c.scaleZoom(y),N=s.bN.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,B,!k),q=f.getCurrentCascadeFrustum();return N.intersectsPrecise(P.vertices,P.planes,L)===0||q.intersectsPrecise(P.vertices,P.planes,L)===0}function Bh(l){return[l[0]*s.d4,l[1]*s.d4,l[2]*s.d4,0]}function kn(l,t,r,c,f,m,y,S,I){const P=c.getSource(),L=r.globeSharedBuffers;if(!L)return;let k,B,N;if(t&&(k=c.getTile(t)),P instanceof s.aD?(B=P.texture,N=s.cD(0,0,r.transform)):k&&t&&(B=k.texture,N=s.cD(t.canonical.z,t.canonical.x,r.transform)),!B||!N)return;l||(N=s.a6.mat4.scale(s.a6.mat4.create(),N,[1,-1,1]));const q=r.context,Z=q.gl,H=f.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,W=r.colorModeForDrapableLayerRenderPass(m),ie=y.defines;ie.push("GLOBE_POLES");const ne=new Vt(Z.LEQUAL,Vt.ReadWrite,r.depthRangeFor3D),ee=Float32Array.from(r.transform.expandedFarZProjMatrix),ae=Float32Array.from(s.b5(s.cC(new s.bP(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),q.activeTexture.set(Z.TEXTURE0),B.bind(H,Z.CLAMP_TO_EDGE),q.activeTexture.set(Z.TEXTURE1),B.bind(H,Z.CLAMP_TO_EDGE),B.useMipmap&&q.extTextureFilterAnisotropic&&r.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[oe,fe,he,_e]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),Te=f.paint.get("raster-elevation");let be;l?(be=oe,r.renderDefaultNorthPole=Te!==0):(be=fe,r.renderDefaultSouthPole=Te!==0);const xe=Bh(y.mix),Re=((Ke,je,rt,Le,Xe,He,st,at,Ye,Qe,Ft,ft,Tt)=>kl(Ke,je,rt,new Float32Array(16),new Float32Array(9),[0,0],Le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},He,[0,0],at,2,Qe,Ft,ft,1,0,Tt))(ee,ae,N,s.a9(r.transform.zoom),0,f,0,Te,0,xe,y.offset,y.range,m),Ge=r.getOrCreateProgram("raster",{defines:ie});r.uploadCommonUniforms(q,Ge,null),Ge.draw(r,Z.TRIANGLES,ne,I,W,S,Re,f.id,be,he,_e)}function br(l){const t=l._nearZ,r=l.projection.farthestPixelDistance(l),c=r-t,f=.2*l.height,m=t+f;return[t,r,(m-f-t)/c,(m-t)/c]}function iu(l,t,r,c){if(l)return t instanceof oa&&l instanceof vc?t.getTextureDescriptor(l,r,!0):{texture:l.texture,mix:Bh(c.mix),offset:c.offset,buffer:0,tileSize:1}}var Fh=s.d5([{name:"a_index",type:"Int16",components:1}]);class Gf{constructor(t,r,c,f){const m={width:c[0],height:c[1],data:null},y=t.gl;this.targetColorTexture=new s.T(t,m,y.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,m,y.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,f),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,f=r.width*r.height;this.particleTexture0=new s.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1});const m=new s.d6;m.reserve(f);for(let y=0;y<f;y++)m.emplaceBack(y);this.particleIndexBuffer=this.context.createVertexBuffer(m,Fh.members,!0),this.particleSegment=s.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function qf(l,t,r){if(!l)return null;const c=t.getTextureDescriptor(l,r,!0);if(!c)return null;let{texture:f,mix:m,offset:y,tileSize:S,buffer:I,format:P}=c;if(!f||!P)return null;let L=!1;return P==="uint32"&&(L=!0,m[3]=0,m=Hc(s.d7,m,[0,r.paint.get("raster-particle-max-speed")]),y=Wc(s.d7,y,[0,r.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[I/(S+2*I),S/(S+2*I)],tileSize:S,scalarData:L,scale:m,offset:y,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function $f(l){const t=l._nearZ,r=l.projection.farthestPixelDistance(l),c=r-t,f=.2*l.height,m=t+f;return[t,r,(m-f-t)/c,(m-t)/c]}const Xm=new s.bz(1,0,0,1),La=new s.bz(0,1,0,1),Da=new s.bz(0,0,1,1),ut=new s.bz(1,0,1,1),Bt=new s.bz(0,1,1,1);function ys(l,t,r,c,f,m,y){const S=l.context,I=l.transform,P=S.gl,L=I.projection.name==="globe",k=L?["PROJECTION_GLOBE_VIEW"]:[];let B=s.a6.mat4.clone(r.projMatrix);if(L&&s.a9(I.zoom)>0){const xe=s.b4(r.canonical,I),Re=s.d8(xe);B=s.a6.mat4.multiply(new Float32Array(16),I.globeMatrix,Re),s.a6.mat4.multiply(B,I.projMatrix,B)}const N=s.a6.mat4.create();N[12]+=2*f/(s.q.devicePixelRatio*I.width),N[13]+=2*m/(s.q.devicePixelRatio*I.height),s.a6.mat4.multiply(B,N,B);const q=l.getOrCreateProgram("debug",{defines:k}),Z=t.getTileByID(r.key);l.terrain&&l.terrain.setupElevationDraw(Z,q);const H=Vt.disabled,W=li.disabled,ie=l.colorModeForRenderPass(),ne="$debug";S.activeTexture.set(P.TEXTURE0),l.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),L?Z._makeGlobeTileDebugBuffers(l.context,I):Z._makeDebugTileBoundsBuffers(l.context,I.projection);const ee=Z._tileDebugBuffer||l.debugBuffer,ae=Z._tileDebugIndexBuffer||l.debugIndexBuffer,oe=Z._tileDebugSegments||l.debugSegments;if(q.draw(l,P.LINE_STRIP,H,W,ie,ei.disabled,Bf(B,c),ne,ee,ae,oe,null,null,null,[Z._globeTileDebugBorderBuffer]),y){const xe=Z.latestRawTileData,Re=Math.floor((xe&&xe.byteLength||0)/1024);let Ge=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Ge+=` => ${r.overscaledZ}`),Ge+=` ${Z.state}`,Ge+=` ${Re}kb`,function(Ke,je){Ke.initDebugOverlayCanvas();const rt=Ke.debugOverlayCanvas,Le=Ke.context.gl,Xe=Ke.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,rt.width,rt.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(je,5,5),Xe.strokeText(je,5,5),Ke.debugOverlayTexture.update(rt),Ke.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(l,Ge)}const fe=t.getTile(r).tileSize,he=512/Math.min(fe,512)*(r.overscaledZ/I.zoom)*.5,_e=Z._tileDebugTextBuffer||l.debugBuffer,Te=Z._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,be=Z._tileDebugTextSegments||l.debugSegments;q.draw(l,P.TRIANGLES,H,W,bi.alphaBlended,ei.disabled,Bf(B,s.bz.transparent,he),ne,_e,Te,be,null,null,null,[Z._globeTileDebugTextBuffer])}function pr(l,t,r,c){Nl(l,0,t+r/2,l.transform.width,r,c)}function Oe(l,t,r,c){Nl(l,t-r/2,0,r,l.transform.height,c)}function Nl(l,t,r,c,f,m){const y=l.context,S=y.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*s.q.devicePixelRatio,r*s.q.devicePixelRatio,c*s.q.devicePixelRatio,f*s.q.devicePixelRatio),y.clear({color:m}),S.disable(S.SCISSOR_TEST)}const ru=s.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Nh}=ru;function xs(l,t,r,c){l.emplaceBack(t,r,c)}class Vh{constructor(t){this.vertexArray=new s.d9,this.indices=new s.aO,xs(this.vertexArray,-1,-1,1),xs(this.vertexArray,1,-1,1),xs(this.vertexArray,-1,1,1),xs(this.vertexArray,1,1,1),xs(this.vertexArray,-1,-1,-1),xs(this.vertexArray,1,-1,-1),xs(this.vertexArray,-1,1,-1),xs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Nh),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.b1.simpleSegment(0,0,36,12)}}function Zo(l,t,r,c,f,m){const y=l.context.gl,S=t.paint.get("sky-atmosphere-color"),I=t.paint.get("sky-atmosphere-halo-color"),P=t.paint.get("sky-atmosphere-sun-intensity"),L=((k,B,N,q,Z)=>({u_matrix_3f:k,u_sun_direction:B,u_sun_intensity:N,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(s.a6.mat3.fromMat4(s.a6.mat3.create(),c),f,P,S,I);y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+m,t.skyboxTexture,0),r.draw(l,y.TRIANGLES,Vt.disabled,li.disabled,bi.unblended,ei.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const za=s.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ym{constructor(t){const r=new s.da;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const c=new s.aO;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,za.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=s.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Km=s.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Zf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class nu{constructor(t){this.colorModeAlphaBlendedWriteRGB=new bi([1,Zn,1,Zn],s.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new bi([1,0,1,0],s.bz.transparent,[!1,!1,!1,!0]),this.params=new Zf,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ym(r);const c=this.params.sizeRange,f=this.params.intensityRange,m=function(L){const k=s.dd(30),B=[];for(let N=0;N<L;++N){const q=2*Math.PI*k(),Z=Math.acos(1-2*k())-.5*Math.PI;B.push(s.a6.vec3.fromValues(Math.cos(Z)*Math.cos(q),Math.cos(Z)*Math.sin(q),Math.sin(Z)))}return B}(this.params.starsCount),y=s.dd(300),S=new s.db,I=new s.aO;let P=0;for(let L=0;L<m.length;++L){const k=s.a6.vec3.scale([],m[L],200),B=Math.max(0,1+.01*c*(1*y()-.5)),N=Math.max(0,1+.01*f*(1*y()-.5));S.emplaceBack(k[0],k[1],k[2],-1,-1,B,N),S.emplaceBack(k[0],k[1],k[2],1,-1,B,N),S.emplaceBack(k[0],k[1],k[2],1,1,B,N),S.emplaceBack(k[0],k[1],k[2],-1,1,B,N),I.emplaceBack(P+0,P+1,P+2),I.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=r.createVertexBuffer(S,Km.members),this.starsIdx=r.createIndexBuffer(I),this.starsSegments=s.b1.simpleSegment(0,0,S.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const c=t.context,f=c.gl,m=t.transform,y=new Vt(f.LEQUAL,Vt.ReadOnly,[0,1]),S=s.a9(m.zoom),I=t.style.getLut(r.scope),P=r.properties.get("color").toRenderColor(I).toArray01(),L=r.properties.get("high-color").toRenderColor(I).toArray01(),k=r.properties.get("space-color").toRenderColor(I).toArray01PremultipliedAlpha(),B=5e-4,N=s.dc(r.properties.get("horizon-blend"),0,1,B,.25),q=s.cx(t,c,m)&&N===B?m.worldSize/(2*Math.PI*1.025)-1:m.globeRadius,Z=t.frameCounter/1e3%1,H=s.a6.vec3.length(m.globeCenterInViewSpace),W=Math.sqrt(Math.pow(H,2)-Math.pow(q,2)),ie=Math.acos(W/H),ne=ee=>{const ae=m.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ee&&ae.push("ALPHA_PASS");const oe=t.getOrCreateProgram("globeAtmosphere",{defines:ae}),fe=((_e,Te,be,xe,Re,Ge,Ke,je,rt,Le,Xe,He)=>({u_frustum_tl:_e,u_frustum_tr:Te,u_frustum_br:be,u_frustum_bl:xe,u_horizon:Re,u_transition:Ge,u_fadeout_range:Ke,u_color:je,u_high_color:rt,u_space_color:Le,u_temporal_offset:Xe,u_horizon_angle:He}))(m.frustumCorners.TL,m.frustumCorners.TR,m.frustumCorners.BR,m.frustumCorners.BL,m.frustumCorners.horizon,S,N,P,L,k,Z,ie);t.uploadCommonUniforms(c,oe);const he=this.atmosphereBuffer;he&&oe.draw(t,f.TRIANGLES,y,li.disabled,ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ei.backCW,fe,ee?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};ne(!1),ne(!0)}drawStars(t,r){const c=s.ap(r.properties.get("star-intensity"),0,1);if(c===0)return;const f=t.context,m=f.gl,y=t.transform,S=t.getOrCreateProgram("stars"),I=s.a6.quat.identity([]);s.a6.quat.rotateX(I,I,-y._pitch),s.a6.quat.rotateZ(I,I,-y.angle),s.a6.quat.rotateX(I,I,s.bB(y._center.lat)),s.a6.quat.rotateY(I,I,-s.bB(y._center.lng));const P=s.a6.mat4.fromQuat(new Float32Array(16),I),L=s.a6.mat4.multiply([],y.starsProjMatrix,P),k=s.a6.mat3.fromMat4([],P),B=s.a6.mat3.invert([],k),N=[0,1,0];s.a6.vec3.transformMat3(N,N,B),s.a6.vec3.scale(N,N,this.params.sizeMultiplier);const q=[1,0,0];s.a6.vec3.transformMat3(q,q,B),s.a6.vec3.scale(q,q,this.params.sizeMultiplier);const Z=(H=N,W=q,ie=c,{u_matrix:Float32Array.from(L),u_up:H,u_right:W,u_intensity_multiplier:ie});var H,W,ie;t.uploadCommonUniforms(f,S),this.starsVx&&this.starsIdx&&S.draw(t,m.TRIANGLES,Vt.disabled,li.disabled,this.colorModeAlphaBlendedWriteRGB,ei.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function su(l,t){const r=[...l],c=t.cameraWorldSizeForFog/t.worldSize,f=s.a6.mat4.identity([]);return s.a6.mat4.scale(f,f,[c,c,1]),s.a6.mat4.multiply(r,f,r),s.a6.mat4.multiply(r,t.worldToFogMatrix,r),r}function ou(l,t,r,c,f){const m=r.material,y=c.context,{baseColorTexture:S,metallicRoughnessTexture:I}=m.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:L,emissionTexture:k}=m;function B(N,q,Z){if(N&&(l.push(q),y.activeTexture.set(y.gl.TEXTURE0+Z),N.gfxTexture)){const{minFilter:H,magFilter:W,wrapS:ie,wrapT:ne}=N.sampler;N.gfxTexture.bindExtraParam(H,W,ie,ne)}}B(S,"HAS_TEXTURE_u_baseColorTexture",un.BaseColor),B(I,"HAS_TEXTURE_u_metallicRoughnessTexture",un.MetallicRoughness),B(P,"HAS_TEXTURE_u_normalTexture",un.Normal),B(L,"HAS_TEXTURE_u_occlusionTexture",un.Occlusion),B(k,"HAS_TEXTURE_u_emissionTexture",un.Emission),f&&(f.texture||(f.texture=new s.df(c.context,f.image,[f.image.height,f.image.height,f.image.height],y.gl.RGBA8)),y.activeTexture.set(y.gl.TEXTURE0+un.LUT),f.texture&&f.texture.bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(l.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||l.push("DIFFUSE_SHADED"),l.push("USE_STANDARD_DERIVATIVES")}function Vl(l,t,r,c,f,m){const y=r.paint.get("model-opacity"),S=t.context,I=new Vt(t.context.gl.LEQUAL,Vt.ReadWrite,t.depthRangeFor3D),P=t.transform,L=l.mesh,k=L.material,B=k.pbrMetallicRoughness,N=t.style.fog;let q;q=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:s.a6.mat4.multiply([],c.zScaleMatrix,l.nodeModelMatrix),s.a6.mat4.multiply(q,c.negCameraPosMatrix,q);const Z=s.a6.mat4.invert([],q);s.a6.mat4.transpose(Z,Z);const H=r.paint.get("model-emissive-strength").constantOr(0),W=At(new Float32Array(l.worldViewProjection),new Float32Array(q),new Float32Array(Z),null,t,y,B.baseColorFactor.toRenderColor(null),k.emissiveFactor,B.metallicFactor,B.roughnessFactor,k,H,r),ie={defines:[]},ne=[];ou(ie.defines,ne,L,t,r.lut);const ee=t.shadowRenderer;ee&&(ee.useNormalOffset=!1);let ae=null;if(N){const he=su(l.nodeModelMatrix,t.transform);if(ae=new Float32Array(he),P.projection.name!=="globe"){const _e=L.aabb.min,Te=L.aabb.max,[be,xe]=N.getOpacityForBounds(he,_e[0],_e[1],Te[0],Te[1]);ie.overrideFog=be>=vt||xe>=vt}}const oe=Zs(t,r.paint.get("model-cutoff-fade-range"));oe.shouldRenderCutoff&&ie.defines.push("RENDER_CUTOFF");const fe=t.getOrCreateProgram("model",ie);t.uploadCommonUniforms(S,fe,null,ae,oe),t.renderPass!=="shadow"&&ee&&ee.setupShadowsFromMatrix(l.nodeModelMatrix,fe),fe.draw(t,S.gl.TRIANGLES,I,f,m,L.material.doubleSided?ei.disabled:ei.backCCW,W,r.id,L.vertexBuffer,L.indexBuffer,L.segments,r.paint,t.transform.zoom,void 0,ne)}function Ul(l,t,r,c,f,m,y){let S;S=l.projection.name==="globe"?s.dg(r,l):[...r],s.a6.mat4.multiply(S,S,t.matrix);const I=s.a6.mat4.multiply([],c,S);if(t.meshes)for(const P of t.meshes){if(P.material.alphaMode!=="BLEND"){y.push({mesh:P,depth:0,modelIndex:f,worldViewProjection:I,nodeModelMatrix:S});continue}const L=s.a6.vec3.transformMat4([],P.centroid,I);L[2]>0&&m.push({mesh:P,depth:L[2],modelIndex:f,worldViewProjection:I,nodeModelMatrix:S})}if(t.children)for(const P of t.children)Ul(l,P,r,c,f,m,y)}function ka(l,t,r,c){const f=r.shadowRenderer;if(!f)return;const m=f.getShadowPassDepthMode(),y=f.getShadowPassColorMode(),S=f.calculateShadowPassMatrixFromMatrix(t),I=Lh(S);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,m,li.disabled,y,ei.backCCW,I,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,r.transform.zoom,void 0,void 0)}function Hf(l,t,r){const c=t.updateZoomBasedPaintProperties(),f=function(m,y,S){let I,P,L,k=m.terrain?m.terrain.exaggeration():0;if(m.terrain&&k>0){const B=m.terrain,N=B.findDEMTileFor(S);N&&N.dem?I=s.di.create(B,S,N):k=0}if(k===0&&(y.terrainElevationMin=0,y.terrainElevationMax=0),k===y.validForExaggeration&&(k===0||I&&I._demTile&&I._demTile.tileID===y.validForDEMTile.id&&I._dem._timestamp===y.validForDEMTile.timestamp))return!1;for(const B in y.instancesPerModel){const N=y.instancesPerModel[B];for(let q=0;q<N.instancedDataArray.length;++q){const Z=(I?k*I.getElevationAt(0|N.instancedDataArray.float32[16*q],0|N.instancedDataArray.float32[16*q+1],!0,!0):0)+N.instancesEvaluatedElevation[q];N.instancedDataArray.float32[16*q+6]=Z,P=P?Math.min(y.terrainElevationMin,Z):Z,L=L?Math.max(y.terrainElevationMax,Z):Z}}return y.terrainElevationMin=P||0,y.terrainElevationMax=L||0,y.validForExaggeration=k,y.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,r);(c||f)&&(t.uploaded=!1,t.upload(l.context))}const vs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c9([0,0,0],[s.ab,s.ab,0])};function Jm(l,t){const r=1<<l.canonical.z,c=t.getFreeCameraOptions().position,f=t.elevation,m=l.canonical.x/r,y=(l.canonical.x+1)/r,S=l.canonical.y/r,I=(l.canonical.y+1)/r;let P=t._centerAltitude;if(f){const N=f.getMinMaxForTile(l);N&&N.max>P&&(P=N.max)}const L=s.ap(c.x,m,y)-c.x,k=s.ap(c.y,S,I)-c.y,B=s.bD(P,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+k*k+B*B))}function gn(l,t,r,c,f,m,y){const S=l.context,I=l.renderPass==="shadow",P=l.shadowRenderer,L=I&&P?P.getShadowPassDepthMode():new Vt(S.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D),k=l.isTileAffectedByFog(m);if(r.meshes)for(const B of r.meshes){const N=["MODEL_POSITION_ON_GPU"],q=[];let Z,H,W;c.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");const ie=Zs(l,t.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),I&&P)Z=l.getOrCreateProgram("modelDepth",{defines:N}),H=Lh(y.shadowTileMatrix,y.shadowTileMatrix,Float32Array.from(r.matrix)),W=P.getShadowPassColorMode();else{ou(N,q,B,l,t.lut),Z=l.getOrCreateProgram("model",{defines:N,overrideFog:k});const ee=B.material,ae=ee.pbrMetallicRoughness,oe=t.paint.get("model-opacity"),fe=t.paint.get("model-emissive-strength").constantOr(0);H=At(m.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,l,oe,ae.baseColorFactor.toRenderColor(null),ee.emissiveFactor,ae.metallicFactor,ae.roughnessFactor,ee,fe,t,f),P&&(y.shadowUniformsInitialized?Z.setShadowUniformValues(S,P.getShadowUniformValues()):(P.setupShadows(m.toUnwrapped(),Z,"model-tile",m.overscaledZ),y.shadowUniformsInitialized=!0)),W=ie.shouldRenderCutoff||oe<1||ee.alphaMode!=="OPAQUE"?bi.alphaBlended:bi.unblended}l.uploadCommonUniforms(S,Z,m.toUnwrapped(),null,ie);const ne=B.material.doubleSided?ei.disabled:ei.backCCW;if(c.instancedDataArray.length>20)q.push(c.instancedDataBuffer),Z.draw(l,S.gl.TRIANGLES,L,li.disabled,W,ne,H,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,l.transform.zoom,void 0,q,c.instancedDataArray.length);else{const ee=I?"u_instance":"u_normal_matrix";for(let ae=0;ae<c.instancedDataArray.length;++ae)H[ee]=new Float32Array(c.instancedDataArray.arrayBuffer,64*ae,16),Z.draw(l,S.gl.TRIANGLES,L,li.disabled,W,ne,H,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,l.transform.zoom,void 0,q)}}if(r.children)for(const B of r.children)gn(l,t,B,c,f,m,y)}const Qm=[1,-1,1];function jl(l,t,r,c){if(!r.modelManager)return!0;const f=r.modelManager;if(!r.shadowRenderer)return!0;const m=r.shadowRenderer,y=t.aabb;let S=!0,I=l.maxHeight;if(I===0){let L=0;for(const k in l.instancesPerModel){const B=f.getModel(k,c);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):S=!1}I=l.maxScale*L*1.41+l.maxVerticalOffset,S&&(l.maxHeight=I)}y.max[2]=I,y.min[2]+=l.terrainElevationMin,y.max[2]+=l.terrainElevationMax,s.a6.vec3.transformMat4(y.min,y.min,t.tileMatrix),s.a6.vec3.transformMat4(y.max,y.max,t.tileMatrix);const P=y.intersects(m.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=P===2),P===0}function dr(l,t){const r=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],f=l.uniformValues.u_cutoff_params[2],m=l.uniformValues.u_cutoff_params[3];return c===r||m===f?1:s.ap(((t-r)/(c-r)-f)/(m-f),0,1)}function Oi(l,t,r,c){if(t.pitch<20)return 1;const f=t.getWorldToCameraMatrix();s.a6.mat4.multiply(f,f,l);const m=s.a6.vec4.fromValues(r.min[0],r.min[1],r.min[2],1);let y=s.a6.vec4.transformMat4(s.a6.vec4.create(),m,f),S=y,I=y;m[1]=r.max[1],y=s.a6.vec4.transformMat4(s.a6.vec4.create(),m,f),S=y[1]<S[1]?y:S,I=y[1]>I[1]?y:I,m[0]=r.max[0],y=s.a6.vec4.transformMat4(s.a6.vec4.create(),m,f),S=y[1]<S[1]?y:S,I=y[1]>I[1]?y:I,m[1]=r.min[1],y=s.a6.vec4.transformMat4(s.a6.vec4.create(),m,f),S=y[1]<S[1]?y:S,I=y[1]>I[1]?y:I;const P=s.ap(c[0],0,1),L=100*t.pixelsPerMeter*s.ap(c[1],0,1),k=s.ap(c[2],0,1),B=s.a6.vec4.lerp(s.a6.vec4.create(),S,I,P),N=Math.tan(.5*t.fovX),q=-B[2]*N;if(L===0)return B[1]<-Math.abs(q)?k:1;const Z=(-Math.abs(q)-B[1])/L,H=(ie,ne,ee)=>(1-ee)*ie+ee*ne,W=s.ap(H(1,k,Z),k,1);return H(1,W,s.ap((t.pitch-20)/20,0,1))}class Wf{}class xo{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,c){{const k=this._storage.get(r.id);if(k)return k.lastUsedFrameIdx=t,k.buf}const f=c.gl,m=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),y=new ArrayBuffer(m),S=new Int16Array(y);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(y));const I=new s.dk;for(let k=0;k<m/2;k+=3){const B=S[k],N=S[k+1],q=S[k+2];I.emplaceBack(B,N),I.emplaceBack(N,q),I.emplaceBack(q,B)}const P=c.bindVertexArrayOES.current,L=new Wf;return L.buf=new zn(c,I),L.lastUsedFrameIdx=t,this._storage.set(r.id,L),c.bindVertexArrayOES.set(P),L.buf}update(t){for(const[r,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class au{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const vo={symbol:function(l,t,r,c,f){if(l.renderPass!=="translucent")return;const m=li.disabled,y=l.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(P,L,k,B,N,q,Z){const H=L.transform,W=N==="map",ie=q==="map";for(const ne of P){const ee=B.getTile(ne),ae=ee.getBucket(k);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const oe=s.bj(ae.textSizeData,H.zoom),fe=fo(ne,ae.getProjection(),H),he=H.calculatePixelsToTileUnitsMatrix(ee),_e=Ai(fe,ee.tileID.canonical,ie,W,H,ae.getProjection(),he),Te=ae.hasIconTextFit()&&ae.hasIconData();if(oe){const be=Math.pow(2,H.zoom-ee.tileID.overscaledZ);Wm(ae,W,ie,Z,s.cS,H,_e,ne,be,oe,Te)}}}(c,l,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),f);const S=r.paint.get("icon-opacity").constantOr(1)!==0,I=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(S||I)?Bl(l,t,r,c,m,y):(S&&Bl(l,t,r,c,m,y,{onlyIcons:!0}),I&&Bl(l,t,r,c,m,y,{onlyText:!0})),t.map.showCollisionBoxes&&(eu(l,t,r,c,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),eu(l,t,r,c,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,r,c){if(l.renderPass!=="translucent")return;const f=r.paint.get("circle-opacity"),m=r.paint.get("circle-stroke-width"),y=r.paint.get("circle-stroke-opacity"),S=r.layout.get("circle-sort-key").constantOr(1)!==void 0,I=r.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(m.constantOr(1)===0||y.constantOr(1)===0))return;const P=l.context,L=P.gl,k=l.transform,B=l.depthModeForSublayer(0,Vt.ReadOnly),N=li.disabled,q=l.colorModeForDrapableLayerRenderPass(I),Z=k.projection.name==="globe",H=[s.am(k.center.lng),s.at(k.center.lat)],W=[];for(let ne=0;ne<c.length;ne++){const ee=c[ne],ae=t.getTile(ee),oe=ae.getBucket(r);if(!oe||oe.projection.name!==k.projection.name)continue;const fe=oe.programConfigurations.get(r.id),he=s.cT(r),_e=l.isTileAffectedByFog(ee);Z&&he.push("PROJECTION_GLOBE_VIEW"),he.push("DEPTH_D24"),l.terrain&&k.depthOcclusionForSymbolsAndCircles&&he.push("DEPTH_OCCLUSION");const Te=l.getOrCreateProgram("circle",{config:fe,defines:he,overrideFog:_e}),be=oe.layoutVertexBuffer,xe=oe.globeExtVertexBuffer,Re=oe.indexBuffer,Ge=k.projection.createInversionMatrix(k,ee.canonical),Ke={programConfiguration:fe,program:Te,layoutVertexBuffer:be,globeExtVertexBuffer:xe,indexBuffer:Re,uniformValues:s.cU(l,ee,ae,Ge,H,r),tile:ae};if(S){const je=oe.segments.get();for(const rt of je)W.push({segments:new s.b1([rt]),sortKey:rt.sortKey,state:Ke})}else W.push({segments:oe.segments,sortKey:0,state:Ke})}S&&W.sort((ne,ee)=>ne.sortKey-ee.sortKey);const ie={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const ne of W){const{programConfiguration:ee,program:ae,layoutVertexBuffer:oe,globeExtVertexBuffer:fe,indexBuffer:he,uniformValues:_e,tile:Te}=ne.state,be=ne.segments;l.terrain&&l.terrain.setupElevationDraw(Te,ae,ie),l.uploadCommonUniforms(P,ae,Te.tileID.toUnwrapped()),ae.draw(l,L.TRIANGLES,B,N,q,ei.disabled,_e,r.id,oe,he,be,r.paint,k.zoom,ee,[fe])}},heatmap:function(l,t,r,c){if(r.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const f=l.context,m=f.gl,y=li.disabled,S=new bi([m.ONE,m.ONE,m.ONE,m.ONE],s.bz.transparent,[!0,!0,!0,!0]);(function(N,q,Z,H){const W=N.gl,ie=q.width*H,ne=q.height*H;N.activeTexture.set(W.TEXTURE1),N.viewport.set([0,0,ie,ne]);let ee=Z.heatmapFbo;if(!ee||ee&&(ee.width!==ie||ee.height!==ne)){ee&&ee.destroy();const ae=W.createTexture();W.bindTexture(W.TEXTURE_2D,ae),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ee=Z.heatmapFbo=N.createFramebuffer(ie,ne,!0,null),function(oe,fe,he,_e,Te,be){const xe=oe.gl;xe.texImage2D(xe.TEXTURE_2D,0,oe.extRenderToTextureHalfFloat?xe.RGBA16F:xe.RGBA,Te,be,0,xe.RGBA,oe.extRenderToTextureHalfFloat?xe.HALF_FLOAT:xe.UNSIGNED_BYTE,null),_e.colorAttachment.set(he)}(N,0,ae,ee,ie,ne)}else W.bindTexture(W.TEXTURE_2D,ee.colorAttachment.get()),N.bindFramebuffer.set(ee.framebuffer)})(f,l,r,l.transform.projection.name==="globe"?.5:.25),f.clear({color:s.bz.transparent});const I=l.transform,P=I.projection.name==="globe",L=P?["PROJECTION_GLOBE_VIEW"]:[],k=P?ei.frontCCW:ei.disabled,B=[s.am(I.center.lng),s.at(I.center.lat)];for(let N=0;N<c.length;N++){const q=c[N];if(t.hasRenderableParent(q))continue;const Z=t.getTile(q),H=Z.getBucket(r);if(!H||H.projection.name!==I.projection.name)continue;const W=l.isTileAffectedByFog(q),ie=H.programConfigurations.get(r.id),ne=l.getOrCreateProgram("heatmap",{config:ie,defines:L,overrideFog:W}),{zoom:ee}=l.transform;l.terrain&&l.terrain.setupElevationDraw(Z,ne),l.uploadCommonUniforms(f,ne,q.toUnwrapped());const ae=I.projection.createInversionMatrix(I,q.canonical);ne.draw(l,m.TRIANGLES,Vt.disabled,y,S,k,$m(l,q,Z,ae,B,ee,r.paint.get("heatmap-intensity")),r.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,r.paint,l.transform.zoom,ie,P?[H.globeExtVertexBuffer]:null)}f.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(f,m){const y=f.context,S=y.gl,I=m.heatmapFbo;if(!I)return;y.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),y.activeTexture.set(S.TEXTURE1);let P=m.colorRampTexture;P||(P=m.colorRampTexture=new s.T(y,m.colorRamp,S.RGBA8)),P.bind(S.LINEAR,S.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,S.TRIANGLES,Vt.disabled,li.disabled,f.colorModeForRenderPass(),ei.disabled,((L,k,B,N)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,m),m.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,m.paint,f.transform.zoom)}(l,r))},line:function(l,t,r,c){if(l.renderPass!=="translucent")return;const f=r.paint.get("line-opacity"),m=r.paint.get("line-width");if(f.constantOr(1)===0||m.constantOr(1)===0)return;const y=r.paint.get("line-emissive-strength"),S=r.paint.get("line-occlusion-opacity"),I=l.context,P=I.gl,L=r.layout.get("line-z-offset"),k=!L.isConstant()||!!L.constantOr(0),B=k?new Vt(l.depthOcclusion?P.GREATER:P.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D):l.depthModeForSublayer(0,Vt.ReadOnly),N=l.colorModeForDrapableLayerRenderPass(y),q=l.terrain&&l.terrain.renderingToTexture,Z=q?1:s.q.devicePixelRatio,H=r.paint.get("line-dasharray"),W=H.constantOr(1),ie=r.layout.get("line-cap"),ne=H.constantOr(null),ee=ie.constantOr(null),ae=r.paint.get("line-pattern"),oe=ae.constantOr(1),fe=ae.constantOr(null),he=r.paint.get("line-opacity").constantOr(1);let _e=!oe&&he!==1||l.depthOcclusion&&S>0&&S<1;const Te=r.paint.get("line-gradient"),be=oe?"linePattern":"line",xe=s.cV(r);let Re;if(q&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(_e=!1),S!==0&&l.depthOcclusion){const Ke=r.paint._values["line-opacity"];Ke&&Ke.value&&Ke.value.kind==="constant"?Re=Ke.value:s.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}if(k&&(l.forceTerrainMode=!0),!k&&S!==0&&l.terrain&&!q)return void s.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Ge=_e&&k?l.stencilModeFor3D():li.disabled;for(const Ke of c){const je=t.getTile(Ke);if(oe&&!je.patternsLoaded())continue;const rt=je.getBucket(r);if(!rt)continue;l.prepareDrawTile();const Le=rt.programConfigurations.get(r.id),Xe=l.isTileAffectedByFog(Ke),He=l.getOrCreateProgram(be,{config:Le,defines:k?[...xe,"ELEVATED"]:xe,overrideFog:Xe});if(fe&&je.imageAtlas){const ft=je.imageAtlas.patternPositions[fe.toString()];ft&&Le.setConstantPatternPositions(ft)}if(!oe&&ne&&ee&&je.lineAtlas){const ft=je.lineAtlas.getDash(ne,ee);ft&&Le.setConstantPatternPositions(ft)}let[st,at]=r.paint.get("line-trim-offset");(ee==="round"||ee==="square")&&st!==at&&(st===0&&(st-=1),at===1&&(at+=1));const Ye=q?Ke.projMatrix:null,Qe=oe?s.cW(l,je,r,Ye,Z,[st,at]):s.cX(l,je,r,Ye,rt.lineClipsArray.length,Z,[st,at]);if(Te){const ft=rt.gradients[r.id];let Tt=ft.texture;if(r.gradientVersion!==ft.version){let Kt=256;if(r.stepInterpolant){const Lt=t.getSource().maxzoom,Zt=Ke.canonical.z===Lt?Math.ceil(1<<l.transform.maxZoom-Ke.canonical.z):1;Kt=s.ap(s.cY(rt.maxLineLength/s.ab*1024*Zt),256,I.maxTextureSize)}ft.gradient=s.cZ({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:Kt,image:ft.gradient||void 0,clips:rt.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new s.T(I,ft.gradient,P.RGBA8),ft.version=r.gradientVersion,Tt=ft.texture}I.activeTexture.set(P.TEXTURE1),Tt.bind(r.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}W&&(I.activeTexture.set(P.TEXTURE0),je.lineAtlasTexture&&je.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),Le.updatePaintBuffers()),oe&&(I.activeTexture.set(P.TEXTURE0),je.imageAtlasTexture&&je.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Le.updatePaintBuffers()),k&&l.terrain.setupElevationDraw(je,He),l.uploadCommonUniforms(I,He,Ke.toUnwrapped());const Ft=ft=>{Re!=null&&(Re.value=he*S),He.draw(l,P.TRIANGLES,B,ft,N,ei.disabled,Qe,r.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,r.paint,l.transform.zoom,Le,[rt.layoutVertexBuffer2,rt.patternVertexBuffer,rt.zOffsetVertexBuffer]),Re!=null&&(Re.value=he)};if(_e&&!k){const ft=l.stencilModeForClipping(Ke).ref;ft===0&&q&&I.clear({stencil:0});const Tt={func:P.EQUAL,mask:255};Qe.u_alpha_discard_threshold=.8,Ft(new li(Tt,ft,255,P.KEEP,P.KEEP,P.INVERT)),Qe.u_alpha_discard_threshold=0,Ft(new li(Tt,ft,255,P.KEEP,P.KEEP,P.KEEP))}else _e&&k&&(Qe.u_alpha_discard_threshold=.001),Ft(k?Ge:l.stencilModeForClipping(Ke))}_e&&(l.resetStencilClippingMasks(),q&&I.clear({stencil:0})),S===0||l.depthOcclusion||q||l.layersWithOcclusionOpacity.push(l.currentLayer),k&&(l.forceTerrainMode=!1)},fill:function(l,t,r,c){const f=r.paint.get("fill-color"),m=r.paint.get("fill-opacity"),y=r.is3D(),S=new Vt(l.context.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D);if(m.constantOr(1)===0)return;const I=r.paint.get("fill-emissive-strength"),P=l.colorModeForDrapableLayerRenderPass(I),L=r.paint.get("fill-pattern"),k=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&f.constantOr(s.bz.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===k){const B=y?S:l.depthModeForSublayer(1,l.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly);tu(l,t,r,c,B,P,!1)}if(!y&&l.renderPass==="translucent"&&r.paint.get("fill-antialias")){const B=y?S:l.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);tu(l,t,r,c,B,P,!0)}},"fill-extrusion":function(l,t,r,c){const f=r.paint.get("fill-extrusion-opacity"),m=l.context,y=m.gl,S=l.terrain,I=S&&S.renderingToTexture;if(f===0)return;const P=l.conflationActive&&l.style.isLayerClipped(r,t.getSource()),L=l.style.order.indexOf(r.fqid);if(P&&function(k,B,N,q,Z){for(const H of q){const W=B.getTile(H).getBucket(N);W&&(W.updateReplacement(H,k.replacementSource,Z),W.uploadCentroid(k.context))}}(l,t,r,c,L),S||P)for(const k of c){const B=t.getTile(k).getBucket(r);B&&yo(l.context,t,k,B,r,S,P)}if(l.renderPass==="shadow"&&l.shadowRenderer){const k=l.shadowRenderer;if(S&&f<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.a4)return;const B=k.getShadowPassDepthMode(),N=k.getShadowPassColorMode();Ra(l,t,r,c,B,li.disabled,N,P)}else if(l.renderPass==="translucent"){const k=!r.paint.get("fill-extrusion-pattern").constantOr(1),B=r.paint.get("fill-extrusion-color").constantOr(s.bz.white);if(!I&&B.a!==0){const N=new Vt(l.context.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D);f===1&&k?Ra(l,t,r,c,N,li.disabled,bi.unblended,P):(Ra(l,t,r,c,N,li.disabled,bi.disabled,P),Ra(l,t,r,c,N,l.stencilModeFor3D(),l.colorModeForRenderPass(),P),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&k&&(!S&&l.transform.projection.name!=="globe"||I)){const N=r.paint.get("fill-extrusion-opacity"),q=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),H=r.paint.get("fill-extrusion-flood-light-intensity"),W=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(r.lut).toArray01().slice(0,3),ie=q>0&&Z>0,ne=H>0,ee=(oe,fe,he)=>(1-he)*oe+he*fe,ae=oe=>{const fe=l.depthModeForSublayer(1,Vt.ReadOnly,y.LEQUAL,!0),he=r.paint.get(oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_e=ee(.1,3,he),Te=l._showOverdrawInspector;if(!Te){const be=new li({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),xe=new bi([y.ONE,y.ONE,y.ONE,y.ONE],s.bz.transparent,[!1,!1,!1,!0],y.MIN);tn(l,t,r,c,fe,be,xe,ei.disabled,oe,"sdf",N,q,Z,H,W,_e,P,!1)}{const be=Te?li.disabled:new li({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),xe=Te?l.colorModeForRenderPass():new bi([y.ONE_MINUS_DST_ALPHA,y.DST_ALPHA,y.ONE,y.ONE],s.bz.transparent,[!0,!0,!0,!0]);tn(l,t,r,c,fe,be,xe,ei.disabled,oe,"color",N,q,Z,H,W,_e,P,!1)}};if(I){const oe=(fe,he,_e)=>{const Te=l.depthModeForSublayer(1,Vt.ReadOnly,y.LEQUAL,!1),be=r.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xe=ee(.1,3,be);{const Re=new bi([y.ONE,y.ONE,y.ONE,y.ONE],s.bz.transparent,[!1,!1,!1,!0]);tn(l,t,r,c,Te,li.disabled,Re,ei.disabled,fe,"clear",N,q,Z,H,W,xe,P,he)}{const Re=new li({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),Ge=new bi([y.ONE,y.ONE,y.ONE,y.ONE],s.bz.transparent,[!1,!1,!1,!0],y.MIN);tn(l,t,r,c,Te,Re,Ge,ei.disabled,fe,"sdf",N,q,Z,H,W,xe,P,he)}{const Re=fe?y.ZERO:y.ONE_MINUS_DST_ALPHA,Ge=new li({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),Ke=new bi([Re,y.DST_ALPHA,y.ONE_MINUS_DST_ALPHA,y.ZERO],s.bz.transparent,[!0,!0,!0,!0]);tn(l,t,r,c,Te,Ge,Ke,ei.disabled,fe,"color",N,q,Z,H,W,xe,P,he)}{const Re=new bi([y.ONE,y.ONE,y.ONE,fe?y.ZERO:y.ONE],s.bz.transparent,[!1,!1,!1,!0],fe?y.FUNC_ADD:y.MAX);tn(l,t,r,c,Te,li.disabled,Re,ei.disabled,fe,"clear",N,q,Z,H,W,xe,P,he,_e)}};if(ie||ne){let fe;if(l.prepareDrawTile(),S){const he=S.drapeBufferSize[0],_e=S.drapeBufferSize[1];fe=S.framebufferCopyTexture,fe&&(!fe||fe.size[0]===he&&fe.size[1]===_e)||(fe&&fe.destroy(),fe=S.framebufferCopyTexture=new s.T(m,new s.r({width:he,height:_e}),y.RGBA8)),fe.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.copyTexImage2D(y.TEXTURE_2D,0,y.RGBA,0,0,he,_e,0)}ie&&oe(!0,!1,fe),ne&&oe(!1,!0,fe)}}else ie&&ae(!0),ne&&ae(!1),(ie||ne)&&l.resetStencilClippingMasks()}}},hillshade:function(l,t,r,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const f=l.context,m=l.terrain&&l.terrain.renderingToTexture,[y,S]=l.renderPass!=="translucent"||m?[{},c]:l.stencilConfigForOverlap(c);for(const I of S){const P=t.getTile(I);if(P.needsHillshadePrepare&&l.renderPass==="offscreen")Il(l,P,r);else if(l.renderPass==="translucent"){const L=l.depthModeForSublayer(0,Vt.ReadOnly),k=r.paint.get("hillshade-emissive-strength"),B=l.colorModeForDrapableLayerRenderPass(k),N=m&&l.terrain?l.terrain.stencilModeForRTTOverlap(I):y[I.overscaledZ];Bc(l,I,P,r,L,N,B)}}f.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,r,c,f,m){if(l.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const y=l.transform.projection.name==="globe",S=r.paint.get("raster-elevation")!==0,I=S&&y;if(l.renderElevatedRasterBackface&&!I)return;const P=l.context,L=P.gl,k=t.getSource(),B=function(oe,fe,he,_e){const Te=fe.paint.get("raster-color"),be=oe.type==="raster-array",xe=[],Re=fe.paint.get("raster-resampling"),Ge=fe.paint.get("raster-color-mix");let Ke=fe.paint.get("raster-color-range");const je=[Ge[0],Ge[1],Ge[2],0],rt=Ge[3];let Le=Re==="nearest"?_e.NEAREST:_e.LINEAR;if(be&&(xe.push("RASTER_ARRAY"),Te||xe.push("RASTER_COLOR"),Re==="linear"&&xe.push("RASTER_ARRAY_LINEAR"),Le=_e.NEAREST,!Ke&&oe.rasterLayers)){const Xe=oe.rasterLayers.find(({id:He})=>He===fe.sourceLayer);Xe&&Xe.fields&&Xe.fields.range&&(Ke=Xe.fields.range)}if(Ke=Ke||[0,1],Te){xe.push("RASTER_COLOR"),he.activeTexture.set(_e.TEXTURE2),fe.updateColorRamp(Ke);let Xe=fe.colorRampTexture;Xe||(Xe=fe.colorRampTexture=new s.T(he,fe.colorRamp,_e.RGBA8)),Xe.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:je,range:Ke,offset:rt,defines:xe,resampling:Le}}(k,r,P,L);if(k instanceof s.aD&&!c.length&&!y)return;const N=r.paint.get("raster-emissive-strength"),q=l.colorModeForDrapableLayerRenderPass(N),Z=l.terrain&&l.terrain.renderingToTexture,H=!l.options.moving,W=r.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(k instanceof s.aD&&!c.length&&(k.onNorthPole||k.onSouthPole)){const oe=S?l.stencilModeFor3D():li.disabled;return void kn(!!k.onNorthPole,null,l,t,r,N,B,ei.disabled,oe)}if(!c.length)return;const[ie,ne]=k instanceof s.aD||Z?[{},c]:l.stencilConfigForOverlap(c),ee=ne[ne.length-1].overscaledZ;I&&B.defines.push("PROJECTION_GLOBE_VIEW"),S&&B.defines.push("RENDER_CUTOFF");const ae=(oe,fe,he)=>{for(const _e of oe){const Te=_e.toUnwrapped(),be=t.getTile(_e);if(Z&&(!be||!be.hasData()))continue;P.activeTexture.set(L.TEXTURE0);const xe=iu(be,k,r,B);if(!xe||!xe.texture)continue;const{texture:Re,mix:Ge,offset:Ke,tileSize:je,buffer:rt}=xe;let Le,Xe;Z?(Le=Vt.disabled,Xe=_e.projMatrix):S?(Le=new Vt(L.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D),Xe=y?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(Te,H)):(Le=l.depthModeForSublayer(_e.overscaledZ-ee,r.paint.get("raster-opacity")===1?Vt.ReadWrite:Vt.ReadOnly,L.LESS),Xe=l.transform.calculateProjMatrix(Te,H));const He=l.terrain&&Z?l.terrain.stencilModeForRTTOverlap(_e):ie[_e.overscaledZ],st=m?0:r.paint.get("raster-fade-duration");be.registerFadeDuration(st);const at=t.findLoadedParent(_e,0),Ye=qc(be,at,t,l.transform,st);let Qe,Ft;l.terrain&&l.terrain.prepareDrawTile(),P.activeTexture.set(L.TEXTURE0),Re.bind(W,L.CLAMP_TO_EDGE),P.activeTexture.set(L.TEXTURE1),at?(at.texture&&at.texture.bind(W,L.CLAMP_TO_EDGE),Qe=Math.pow(2,at.tileID.overscaledZ-be.tileID.overscaledZ),Ft=[be.tileID.canonical.x*Qe%1,be.tileID.canonical.y*Qe%1]):Re.bind(W,L.CLAMP_TO_EDGE),Re.useMipmap&&P.extTextureFilterAnisotropic&&l.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const ft=l.transform;let Tt;const Kt=S?br(ft):[0,0,0,0];let Lt,Zt,_i,fi,Xi,er=0;if(I&&k instanceof s.aD&&k.coordinates.length>3)Lt=Float32Array.from(s.b5(s.cC(new s.bP(0,0,0)))),Zt=Float32Array.from(ft.globeMatrix),_i=Float32Array.from(s.cy(ft)),fi=[s.am(ft.center.lng),s.at(ft.center.lat)],Tt=k.elevatedGlobePerspectiveTransform,Xi=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const wi=s.cz(_e.canonical);er=s.cA(wi.getCenter().lat),Lt=Float32Array.from(s.b5(s.cC(_e.canonical))),Zt=Float32Array.from(ft.globeMatrix),_i=Float32Array.from(s.cy(ft)),fi=[s.am(ft.center.lng),s.at(ft.center.lat)],Tt=[0,0],Xi=Float32Array.from(s.cB(_e.canonical,wi,er,ft.worldSize/ft._pixelsPerMercatorPixel))}else Tt=k instanceof s.aD?k.perspectiveTransform:[0,0],Lt=new Float32Array(16),Zt=new Float32Array(9),_i=new Float32Array(16),fi=[0,0],Xi=new Float32Array(9);const cr=kl(Xe,Lt,Zt,_i,Xi,Ft||[0,0],s.a9(l.transform.zoom),fi,Kt,Qe||1,Ye,r,Tt,S?r.paint.get("raster-elevation"):0,2,Ge,Ke,B.range,je,rt,N),rs=l.isTileAffectedByFog(_e),Rr=l.getOrCreateProgram("raster",{defines:B.defines,overrideFog:rs});if(l.uploadCommonUniforms(P,Rr,Te),k instanceof s.aD){const wi=k.elevatedGlobeVertexBuffer,Ji=k.elevatedGlobeIndexBuffer;if(Z||!y)k.boundsBuffer&&k.boundsSegments&&Rr.draw(l,L.TRIANGLES,Le,li.disabled,q,ei.disabled,cr,r.id,k.boundsBuffer,l.quadTriangleIndexBuffer,k.boundsSegments);else if(wi&&Ji){const mr=ft.zoom<=s.c2?k.elevatedGlobeSegments:k.getSegmentsForLongitude(ft.center.lng);mr&&Rr.draw(l,L.TRIANGLES,Le,li.disabled,q,fe,cr,r.id,wi,Ji,mr)}}else if(I){Le=new Vt(L.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D);const wi=l.globeSharedBuffers;if(wi){const[Ji,mr,Ki]=wi.getGridBuffers(er,!1);Rr.draw(l,L.TRIANGLES,Le,he||He,l.colorModeForRenderPass(),fe,cr,r.id,Ji,mr,Ki)}}else{const{tileBoundsBuffer:wi,tileBoundsIndexBuffer:Ji,tileBoundsSegments:mr}=l.getTileBoundsBuffers(be);Rr.draw(l,L.TRIANGLES,Le,He,q,ei.disabled,cr,r.id,wi,Ji,mr)}}if(!(k instanceof s.aD)&&I)for(const _e of oe){const Te=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&kn(!0,_e,l,t,r,N,B,fe,he||li.disabled),Te&&kn(!1,_e,l,t,r,N,B,fe===ei.frontCW?ei.backCW:ei.frontCW,he||li.disabled)}};I?ae(ne,l.renderElevatedRasterBackface?ei.backCW:ei.frontCW,l.stencilModeFor3D()):ae(ne,ei.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,r,c,f,m){l.renderPass==="offscreen"&&function(y,S,I,P){if(!P.length)return;const L=y.context,k=L.gl,B=S.getSource();if(!(B instanceof oa))return;const N=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let q=I.particlePositionRGBAImage;if(!q||q.width!==N){const ne=function(ee){const ae=ee*ee,oe=new Uint8Array(4*ae),fe=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let _e=0;_e<ae;_e++){const Te=he*(fe(2*_e+0)+ks),be=he*(fe(2*_e+1)+ks),xe=255*Te%1,Re=255*be%1,Ge=xe,Ke=be-Re/255,je=Re;oe[4*_e+0]=255*(Te-xe/255),oe[4*_e+1]=255*Ge,oe[4*_e+2]=255*Ke,oe[4*_e+3]=255*je}return oe}(N);q=I.particlePositionRGBAImage=new s.r({width:N,height:N},ne)}let Z=I.particleFramebuffer;Z?Z.width!==N&&(Z.destroy(),Z=I.particleFramebuffer=L.createFramebuffer(N,N,!0,null)):Z=I.particleFramebuffer=L.createFramebuffer(N,N,!0,null);const H=[];for(const ne of P){const ee=S.getTile(ne);if(!(ee instanceof vc))continue;const ae=qf(ee,B,I);if(!ae)continue;const oe=[ee.tileSize,ee.tileSize];let fe=I.tileFramebuffer;fe||(fe=I.tileFramebuffer=L.createFramebuffer(oe[0],oe[1],!0,null));let he=ee.rasterParticleState;he||(he=ee.rasterParticleState=new Gf(L,ne,oe,q));const _e=he.update(I.lastInvalidatedAt);he.particleTextureDimension!==N&&he.updateParticleTexture(ne,q);const Te=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=Te;const be=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=be,H.push([ne,ae,he,_e])}if(H.length===0)return;const W=s.q.now(),ie=I.previousDrawTimestamp?.001*(W-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=W,I.hasColorMap()){L.activeTexture.set(k.TEXTURE0+2);let ne=I.colorRampTexture;ne||(ne=I.colorRampTexture=new s.T(L,I.colorRamp,k.RGBA8)),ne.bind(k.LINEAR,k.CLAMP_TO_EDGE)}L.bindFramebuffer.set(I.tileFramebuffer.framebuffer),function(ne,ee,ae){const oe=ne.context,fe=oe.gl,he=ee.tileFramebuffer;oe.activeTexture.set(fe.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(be=ee.paint.get("raster-particle-fade-opacity-factor"))/(be+.05)},Te=ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var be;for(const xe of ae){const[,,Re,Ge]=xe;he.colorAttachment.set(Re.targetColorTexture.texture),oe.viewport.set([0,0,he.width,he.height]),oe.clear({color:s.bz.transparent}),Ge&&(Re.backgroundColorTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE),Te.draw(ne,fe.TRIANGLES,Vt.disabled,li.disabled,bi.alphaBlended,ei.disabled,_e,ee.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments))}}(y,I,H),function(ne,ee,ae,oe){const fe=ne.context,he=fe.gl,_e=ae.tileFramebuffer,Te=ne.transform.projection.name==="globe",be=ae.paint.get("raster-particle-max-speed");for(const xe of oe){const[Re,Ge,Ke]=xe;fe.activeTexture.set(he.TEXTURE0+0),Ge.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),_e.colorAttachment.set(Ke.targetColorTexture.texture);const je=ne.getOrCreateProgram("rasterParticleDraw",{defines:Ge.defines,overrideFog:!1});fe.activeTexture.set(he.TEXTURE0+1);const rt=Ge.scalarData?[]:[0,1,2,3].map(He=>s.c$[He](Re));rt.push(Re);const Le=Re.canonical.x,Xe=Re.canonical.y;for(const He of rt){const st=ee.getTile(Te?He.wrapped():He);if(!st)continue;const at=st.rasterParticleState;if(!at)continue;const Ye=He.canonical.x+(1<<He.canonical.z)*(He.wrap-Re.wrap),Qe=He.canonical.y;at.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);const Ft=Xc(1,at.particleTexture0.size[0],[Ye-Le,Qe-Xe],0,Ge.texture.size,2,be,Ge.textureOffset,Ge.scale,Ge.offset);je.draw(ne,he.POINTS,Vt.disabled,li.disabled,bi.alphaBlended,ei.disabled,Ft,ae.id,at.particleIndexBuffer,void 0,at.particleSegment)}}}(y,S,I,H),L.bindFramebuffer.set(I.particleFramebuffer.framebuffer),function(ne,ee,ae,oe){const fe=ne.context,he=fe.gl,_e=ee.paint.get("raster-particle-max-speed"),Te=oe*ee.paint.get("raster-particle-speed-factor")*.15,be=function(Re){return Math.pow(Re,6)}(.01+1*ee.paint.get("raster-particle-reset-rate-factor")),xe=ee.particleFramebuffer;fe.viewport.set([0,0,xe.width,xe.height]);for(const Re of ae){const[,Ge,Ke]=Re;fe.activeTexture.set(he.TEXTURE0+0),Ge.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),fe.activeTexture.set(he.TEXTURE0+1);const je=Ke.particleTexture0;je.bind(he.NEAREST,he.CLAMP_TO_EDGE);const rt=Yc(1,je.size[0],0,Ge.texture.size,_e,Te,be,Ge.textureOffset,Ge.scale,Ge.offset);xe.colorAttachment.set(Ke.particleTexture1.texture),fe.clear({color:s.bz.transparent}),ne.getOrCreateProgram("rasterParticleUpdate",{defines:Ge.defines}).draw(ne,he.TRIANGLES,Vt.disabled,li.disabled,bi.unblended,ei.disabled,rt,ee.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments)}}(y,I,H,ie)}(l,t,r,c),l.renderPass==="translucent"&&(function(y,S,I,P,L){const k=y.context,B=k.gl,N=S.getSource().tileSize,q=5*(1-s.a7(s.bU,s.bU+1,y.transform.zoom))*N+I.paint.get("raster-particle-elevation"),Z=!y.options.moving,H=y.transform.projection.name==="globe";if(!P.length)return;const[W,ie]=y.stencilConfigForOverlap(P),ne=[];H&&ne.push("PROJECTION_GLOBE_VIEW");const ee=y.stencilModeFor3D();for(const ae of ie){const oe=ae.toUnwrapped(),fe=S.getTile(ae);if(!fe.rasterParticleState)continue;const he=fe.rasterParticleState,_e=100;fe.registerFadeDuration(_e);const Te=S.findLoadedParent(ae,0),be=qc(fe,Te,S,y.transform,_e);let xe,Re;y.terrain&&y.terrain.prepareDrawTile(),k.activeTexture.set(B.TEXTURE0),he.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),k.activeTexture.set(B.TEXTURE1),Te&&Te.rasterParticleState?(Te.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),xe=Math.pow(2,Te.tileID.overscaledZ-fe.tileID.overscaledZ),Re=[fe.tileID.canonical.x*xe%1,fe.tileID.canonical.y*xe%1]):he.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Ge=H?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(oe,Z),Ke=y.transform,je=$f(Ke),rt=s.cz(ae.canonical),Le=s.cA(rt.getCenter().lat);let Xe,He,st,at,Ye;H?(Xe=Float32Array.from(s.b5(s.cC(ae.canonical))),He=Float32Array.from(Ke.globeMatrix),st=Float32Array.from(s.cy(Ke)),at=[s.am(Ke.center.lng),s.at(Ke.center.lat)],Ye=Float32Array.from(s.cB(ae.canonical,rt,Le,Ke.worldSize/Ke._pixelsPerMercatorPixel))):(Xe=new Float32Array(16),He=new Float32Array(9),st=new Float32Array(16),at=[0,0],Ye=new Float32Array(9));const Qe=Nf(Ge,Xe,He,st,Ye,Re||[0,0],s.a9(y.transform.zoom),at,je,xe||1,be,q),Ft=y.isTileAffectedByFog(ae),ft=y.getOrCreateProgram("rasterParticle",{defines:ne,overrideFog:Ft});if(y.uploadCommonUniforms(k,ft,oe),H){const Tt=new Vt(B.LEQUAL,Vt.ReadOnly,y.depthRangeFor3D),Kt=0,Lt=y.globeSharedBuffers;if(Lt){const[Zt,_i,fi]=Lt.getGridBuffers(Le,Kt!==0);ft.draw(y,B.TRIANGLES,Tt,ee,bi.alphaBlended,y.renderElevatedRasterBackface?ei.frontCCW:ei.backCCW,Qe,I.id,Zt,_i,fi)}}else{const Tt=y.depthModeForSublayer(0,Vt.ReadOnly),Kt=W[ae.overscaledZ],{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:Zt,tileBoundsSegments:_i}=y.getTileBoundsBuffers(fe);ft.draw(y,B.TRIANGLES,Tt,Kt,bi.alphaBlended,ei.disabled,Qe,I.id,Lt,Zt,_i)}}y.resetStencilClippingMasks()}(l,t,r,c),l.style.map.triggerRepaint())},background:function(l,t,r,c){const f=r.paint.get("background-color"),m=r.paint.get("background-opacity"),y=r.paint.get("background-emissive-strength"),S=r.paint.get("background-pitch-alignment")==="viewport";if(m===0)return;const I=l.context,P=I.gl,L=l.transform,k=L.tileSize,B=r.paint.get("background-pattern");let N;if(B!==void 0&&(B===null||(N=l.imageManager.getPattern(B.toString(),r.scope,l.style.getLut(r.scope)),!N)))return;const q=!B&&f.a===1&&m===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==q)return;const Z=li.disabled,H=l.depthModeForSublayer(0,q==="opaque"?Vt.ReadWrite:Vt.ReadOnly),W=l.colorModeForDrapableLayerRenderPass(y),ie=B?"backgroundPattern":"background";let ne,ee=c;if(ee||(ne=l.getBackgroundTiles(),ee=Object.values(ne).map(ae=>ae.tileID)),B&&(I.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context,r.scope)),S){const ae=l.getOrCreateProgram(ie,{overrideFog:!1,overrideRtt:!0}),oe=new Float32Array(s.a6.mat4.identity([])),fe=new s.aA(0,0,0,0,0),he=B?qo(oe,y,m,l,0,r.scope,N,S,{tileID:fe,tileSize:k}):Vf(oe,y,m,f.toRenderColor(r.lut));ae.draw(l,P.TRIANGLES,H,Z,W,ei.disabled,he,r.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const ae of ee){const oe=l.isTileAffectedByFog(ae),fe=l.getOrCreateProgram(ie,{overrideFog:oe}),he=ae.toUnwrapped(),_e=c?ae.projMatrix:l.transform.calculateProjMatrix(he);l.prepareDrawTile();const Te=t?t.getTile(ae):ne?ne[ae.key]:new Ls(ae,k,L.zoom,l),be=B?qo(_e,y,m,l,0,r.scope,N,S,{tileID:ae,tileSize:k}):Vf(_e,y,m,f.toRenderColor(r.lut));l.uploadCommonUniforms(I,fe,he);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Re,tileBoundsSegments:Ge}=l.getTileBoundsBuffers(Te);fe.draw(l,P.TRIANGLES,H,Z,W,ei.disabled,be,r.id,xe,Re,Ge)}},sky:function(l,t,r){const c=l._atmosphere?s.a9(l.transform.zoom):1,f=r.paint.get("sky-opacity")*c;if(f===0)return;const m=l.context,y=r.paint.get("sky-type"),S=new Vt(m.gl.LEQUAL,Vt.ReadOnly,[0,1]),I=l.frameCounter/1e3%1;y==="atmosphere"?l.renderPass==="offscreen"?r.needsSkyboxCapture(l)&&(function(P,L,k,B){const N=P.context,q=N.gl;let Z=L.skyboxFbo;if(!Z){Z=L.skyboxFbo=N.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Vh(N),L.skyboxTexture=N.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,L.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let ne=0;ne<6;++ne)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(Z.framebuffer),N.viewport.set([0,0,32,32]);const H=L.getCenter(P,!0),W=P.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);s.a6.mat4.identity(ie),s.a6.mat4.rotateY(ie,ie,.5*-Math.PI),Zo(P,L,W,ie,H,0),s.a6.mat4.identity(ie),s.a6.mat4.rotateY(ie,ie,.5*Math.PI),Zo(P,L,W,ie,H,1),s.a6.mat4.identity(ie),s.a6.mat4.rotateX(ie,ie,.5*-Math.PI),Zo(P,L,W,ie,H,2),s.a6.mat4.identity(ie),s.a6.mat4.rotateX(ie,ie,.5*Math.PI),Zo(P,L,W,ie,H,3),s.a6.mat4.identity(ie),Zo(P,L,W,ie,H,4),s.a6.mat4.identity(ie),s.a6.mat4.rotateY(ie,ie,Math.PI),Zo(P,L,W,ie,H,5),N.viewport.set([0,0,P.width,P.height])}(l,r),r.markSkyboxValid(l)):l.renderPass==="sky"&&function(P,L,k,B,N){const q=P.context,Z=q.gl,H=P.transform,W=P.getOrCreateProgram("skybox");q.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture);const ie=((ne,ee,ae,oe,fe)=>({u_matrix:ne,u_sun_direction:ee,u_cubemap:0,u_opacity:oe,u_temporal_offset:fe}))(H.skyboxMatrix,L.getCenter(P,!1),0,B,N);P.uploadCommonUniforms(q,W),W.draw(P,Z.TRIANGLES,k,li.disabled,P.colorModeForRenderPass(),ei.backCW,ie,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(l,r,S,f,I):y==="gradient"&&l.renderPass==="sky"&&function(P,L,k,B,N){const q=P.context,Z=q.gl,H=P.transform,W=P.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Vh(q)),q.activeTexture.set(Z.TEXTURE0);let ie=L.colorRampTexture;ie||(ie=L.colorRampTexture=new s.T(q,L.colorRamp,Z.RGBA8)),ie.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const ne=((ee,ae,oe,fe,he)=>({u_matrix:ee,u_color_ramp:0,u_center_direction:ae,u_radius:s.bB(oe),u_opacity:fe,u_temporal_offset:he}))(H.skyboxMatrix,L.getCenter(P,!1),L.paint.get("sky-gradient-radius"),B,N);P.uploadCommonUniforms(q,W),W.draw(P,Z.TRIANGLES,k,li.disabled,P.colorModeForRenderPass(),ei.backCW,ne,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(l,r,S,f,I)},debug:function(l,t,r,c,f,m){for(let y=0;y<r.length;y++)if(f){const P=new s.bz(c.r*.8,c.g*.8,c.b*.8,1);ys(l,t,r[y],c,-1,-1,m),ys(l,t,r[y],c,-1,1,m),ys(l,t,r[y],c,1,1,m),ys(l,t,r[y],c,1,-1,m),ys(l,t,r[y],P,0,0,m)}else ys(l,t,r[y],c,0,0,m)},custom:function(l,t,r,c){const f=l.context,m=r.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&r.isDraped(t)){if(l.renderPass==="offscreen"){const y=m.prerender;if(y){if(l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const S=l.transform.pointMerc;y.call(m,f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.a9(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else y.call(m,f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const S=m.renderToTile;if(S){const I=c[0].canonical,P=new s.a5(I.x+c[0].wrap*(1<<I.z),I.y,I.z);f.setDepthMode(Vt.disabled),f.setStencilMode(li.disabled),f.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),S.call(m,f.gl,P),f.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),f.setStencilMode(li.disabled);const y=m.renderingMode==="3d"?new Vt(l.context.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Vt.ReadOnly);if(f.setDepthMode(y),l.transform.projection.name==="globe"){const S=l.transform.pointMerc;m.render(f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.a9(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else m.render(f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState(),f.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,r,c){if(l.renderPass==="opaque")return;const f=r.paint.get("model-opacity");if(f===0)return;const m=r.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!m||l.terrain&&f<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof s.a4))return;const y=l.shadowRenderer,S=r.paint.get("model-receive-shadows");y&&(y.useNormalOffset=!0,S||(y.enabled=!1));const I=()=>{y&&(y.useNormalOffset=!0,S||(y.enabled=!0))},P=t.getSource();if(l.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(W,ie,ne,ee,ae){const oe=W.transform;if(oe.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${oe.projection.name} projection is not yet implemented`);const fe=oe.getFreeCameraOptions().position;if(!W.modelManager)return;const he=W.modelManager;ne.modelManager=he;const _e=W.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Te=ne._unevaluatedLayout._values["model-id"],be={...ne.layout.get("model-id").parameters},xe=W.style.order.indexOf(ne.fqid);for(const Re of ee){const Ge=ie.getTile(Re).getBucket(ne);if(!Ge||Ge.projection.name!==oe.projection.name)continue;const Ke=Ge.getModelUris();Ke&&!Ge.modelsRequested&&(he.addModelsFromBucket(Ke,ae),Ge.modelsRequested=!0);const je=Jm(Re,oe);be.zoom=je;const rt=Te.possiblyEvaluate(be);if(Hf(W,Ge,Re),vs.shadowUniformsInitialized=!1,vs.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(Re.toUnwrapped())===0,W.renderPass==="shadow"&&_e){if(W.currentShadowCascade===1&&Ge.isInsideFirstShadowMapFrustum)continue;const He=oe.calculatePosMatrix(Re.toUnwrapped(),oe.worldSize);if(vs.tileMatrix.set(He),vs.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(He)),vs.aabb.min.fill(0),vs.aabb.max[0]=vs.aabb.max[1]=s.ab,vs.aabb.max[2]=0,jl(Ge,vs,W,ne.scope))continue}const Le=1<<Re.canonical.z,Xe=[((fe.x-Re.wrap)*Le-Re.canonical.x)*s.ab,(fe.y*Le-Re.canonical.y)*s.ab,fe.z*Le*s.ab];W.conflationActive&&Object.keys(Ge.instancesPerModel).length>0&&W.style.isLayerClipped(ne,ie.getSource())&&Ge.updateReplacement(Re,W.replacementSource,xe,ae)&&(Ge.uploaded=!1,Ge.upload(W.context));for(let He in Ge.instancesPerModel){const st=Ge.instancesPerModel[He];st.features.length>0&&(He=rt.evaluate(st.features[0].feature,{}));const at=he.getModel(He,ae);if(at&&at.uploaded)for(const Ye of at.nodes)gn(W,ne,Ye,st,Xe,Re,vs)}}}(l,t,r,c,P.type==="vector"?r.scope:""),void I();if(!P.loaded())return;if(P.type==="batched-model")return function(W,ie,ne,ee){ne.resetLayerRenderingStats(W);const ae=W.context,oe=W.transform,fe=W.style.fog,he=W.shadowRenderer;if(oe.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${oe.projection.name} projection is not yet implemented`);const _e=W.transform.getFreeCameraOptions().position,Te=s.a6.vec3.scale([],[_e.x,_e.y,_e.z],W.transform.worldSize),be=s.a6.vec3.negate([],Te),xe=s.a6.mat4.identity([]),Re=s.de(oe.center.lat,oe.zoom),Ge=s.a6.mat4.fromScaling([],[1,1,1/Re]);s.a6.mat4.translate(xe,xe,be);const Ke=ne.paint.get("model-opacity"),je=new Vt(ae.gl.LEQUAL,Vt.ReadWrite,W.depthRangeFor3D),rt=new Vt(ae.gl.LEQUAL,Vt.ReadOnly,W.depthRangeFor3D),Le=new s.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Xe=W.renderPass==="shadow",He=Xe&&he?he.getCurrentCascadeFrustum():oe.getFrustum(oe.scaleZoom(oe.worldSize)),st=ne.paint.get("model-front-cutoff"),at=st[2]<1,Ye=Zs(W,ne.paint.get("model-cutoff-fade-range")),Qe=ne.getLayerRenderingStats();(function(Ft,ft,Tt,Kt){const Lt=Ft.terrain?Ft.terrain.exaggeration():0,Zt=Ft.transform.zoom;for(const _i of Kt){const fi=ft.getTile(_i).getBucket(Tt);fi&&(Ft.conflationActive&&fi.updateReplacement(_i,Ft.replacementSource),fi.evaluateScale(Ft,Tt),Ft.terrain&&Lt>0&&fi.elevationUpdate(Ft.terrain,Lt,_i,Tt.source),fi.needsReEvaluation(Ft,Zt,Tt)&&fi.evaluate(Tt))}})(W,ie,ne,ee),function(){let Ft,ft,Tt;at?(Ft=ee.length-1,ft=-1,Tt=-1):(Ft=0,ft=ee.length,Tt=1);const Kt=new Float64Array(16),Lt=s.a6.vec3.create(),Zt=new s.P(0,0);for(let _i=Ft;_i!==ft;_i+=Tt){const fi=ee[_i],Xi=ie.getTile(fi).getBucket(ne);if(!Xi||!Xi.uploaded)continue;let er=!1;he&&(er=he.getMaxCascadeForTile(fi.toUnwrapped())===0);const cr=oe.calculatePosMatrix(fi.toUnwrapped(),oe.worldSize),rs=Xi.modelTraits;!Xe&&at&&(s.a6.mat4.invert(Kt,cr),s.a6.vec3.transformMat4(Lt,Te,Kt),Zt.x=Lt[0],Zt.y=Lt[1]);const Rr=[];for(const wi of Xi.getNodesInfo()){if(wi.hiddenByReplacement||!wi.node.meshes)continue;const Ji=wi.node;let mr=0;W.terrain&&Ji.elevation&&(mr=Ji.elevation*W.terrain.exaggeration());const Ki=(()=>{const sr=wi.aabb;return Le.min=[...sr.min],Le.max=[...sr.max],Le.min[2]+=mr,Le.max[2]+=mr,s.a6.vec3.transformMat4(Le.min,Le.min,cr),s.a6.vec3.transformMat4(Le.max,Le.max,cr),Le})(),pi=wi.evaluatedScale;if(pi[0]<=1&&pi[1]<=1&&pi[2]<=1&&Ki.intersects(He)===0)continue;if(!Xe&&at){const sr=.16666666666666666;wi.cameraCollisionOpacity=Te[0]>Ki.min[0]&&Te[0]<Ki.max[0]&&Te[1]>Ki.min[1]&&Te[1]<Ki.max[1]&&Te[2]*Re<Ki.max[2]&&Ji.footprint&&s.bu(Zt,Ji.footprint)?Math.max(wi.cameraCollisionOpacity-sr,0):Math.min(1,wi.cameraCollisionOpacity+sr)}const Bi=[...cr],$i=Ji.anchor?Ji.anchor[0]:0,Tr=Ji.anchor?Ji.anchor[1]:0;s.a6.mat4.translate(Bi,Bi,[$i*(pi[0]-1),Tr*(pi[1]-1),mr]),s.a6.vec3.exactEquals(pi,s.dh)||s.a6.mat4.scale(Bi,Bi,pi);const Lr=s.a6.mat4.multiply([],Bi,Ji.matrix),Pi=s.a6.mat4.multiply([],oe.expandedFarZProjMatrix,Lr),Zr=s.a6.mat4.multiply([],oe.expandedFarZProjMatrix,Bi),Qr=s.a6.vec4.transformMat4([],[$i,Tr,mr,1],Pi)[2];Ji.hidden=!1;let Hr=Ke;Xe||(at&&(Hr*=wi.cameraCollisionOpacity,Hr*=Oi(Bi,oe,wi.aabb,st)),Hr*=dr(Ye,Qr)),Hr!==0?Rr.push({nodeInfo:wi,depth:Qr,opacity:Hr,wvpForNode:Pi,wvpForTile:Zr,nodeModelMatrix:Lr,tileModelMatrix:Bi}):Ji.hidden=!0}Xe||Rr.sort((wi,Ji)=>!at||wi.opacity===1&&Ji.opacity===1?wi.depth<Ji.depth?-1:1:wi.opacity===1?-1:Ji.opacity===1?1:wi.depth>Ji.depth?-1:1);for(const wi of Rr){const Ji=wi.nodeInfo,mr=Ji.node;let Ki=s.a6.mat4.multiply([],Ge,wi.tileModelMatrix);s.a6.mat4.multiply(Ki,xe,Ki);const pi=s.a6.mat4.invert([],Ki);s.a6.mat4.transpose(pi,pi),s.a6.mat4.scale(pi,pi,Qm),Ki=s.a6.mat4.multiply(Ki,Ki,mr.matrix);const Bi=W.renderPass==="light-beam",$i=rs&s.dj.HasMapboxMeshFeatures,Tr=$i?0:Ji.evaluatedRMEA[0][2];for(let Lr=0;Lr<mr.meshes.length;++Lr){const Pi=mr.meshes[Lr],Zr=Lr===mr.lightMeshIndex;let Qr=wi.wvpForNode;if(Zr){if(!Bi&&!W.terrain&&W.shadowRenderer){W.currentLayer<W.firstLightBeamLayer&&(W.firstLightBeamLayer=W.currentLayer);continue}Qr=wi.wvpForTile}else if(Bi)continue;const Hr={defines:[]},sr=[];if(ou(Hr.defines,sr,Pi,W,ne.lut),$i||Hr.defines.push("DIFFUSE_SHADED"),er&&Hr.defines.push("SHADOWS_SINGLE_CASCADE"),Qe&&(Xe?Qe.numRenderedVerticesInShadowPass+=Pi.vertexArray.length:Qe.numRenderedVerticesInTransparentPass+=Pi.vertexArray.length),Xe){ka(Pi,wi.nodeModelMatrix,W,ne);continue}let En=null;if(fe){const Js=su(wi.nodeModelMatrix,W.transform);if(En=new Float32Array(Js),oe.projection.name!=="globe"){const Eo=Pi.aabb.min,Ns=Pi.aabb.max,[Ua,ja]=fe.getOpacityForBounds(Js,Eo[0],Eo[1],Ns[0],Ns[1]);Hr.overrideFog=Ua>=vt||ja>=vt}}const Sn=Pi.material;let ns;Sn.occlusionTexture&&Sn.occlusionTexture.offsetScale&&(ns=Sn.occlusionTexture.offsetScale,Hr.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Xe&&he&&(he.useNormalOffset=!!Pi.normalBuffer);const Kn=W.getOrCreateProgram("model",Hr);!Xe&&he&&he.setupShadowsFromMatrix(wi.tileModelMatrix,Kn,he.useNormalOffset),W.uploadCommonUniforms(ae,Kn,null,En);const On=Sn.pbrMetallicRoughness;On.metallicFactor=.9,On.roughnessFactor=.5;const ss=At(new Float32Array(Qr),new Float32Array(Ki),new Float32Array(pi),new Float32Array(mr.matrix),W,wi.opacity,On.baseColorFactor.toRenderColor(null),Sn.emissiveFactor,On.metallicFactor,On.roughnessFactor,Sn,Tr,ne,[0,0,0],ns);!Zr&&(Ji.hasTranslucentParts||wi.opacity<1)&&Kn.draw(W,ae.gl.TRIANGLES,je,li.disabled,bi.disabled,ei.backCCW,ss,ne.id,Pi.vertexBuffer,Pi.indexBuffer,Pi.segments,ne.paint,W.transform.zoom,void 0,sr),Kn.draw(W,ae.gl.TRIANGLES,Zr?rt:je,li.disabled,Zr||wi.opacity<1||Ji.hasTranslucentParts?bi.alphaBlended:bi.unblended,ei.backCCW,ss,ne.id,Pi.vertexBuffer,Pi.indexBuffer,Pi.segments,ne.paint,W.transform.zoom,void 0,sr)}}}}()}(l,t,r,c),void I();if(P.type!=="model")return;const L=P.getModels(),k=[],B=l.transform.getFreeCameraOptions().position,N=s.a6.vec3.scale([],[B.x,B.y,B.z],l.transform.worldSize);s.a6.vec3.negate(N,N);const q=[],Z=[];let H=0;for(const W of L){const ie=r.paint.get("model-rotation").constantOr(null),ne=r.paint.get("model-scale").constantOr(null),ee=r.paint.get("model-translation").constantOr(null);W.computeModelMatrix(l,ie,ne,ee,!0,!0,!1);const ae=s.a6.mat4.identity([]),oe=s.de(W.position.lat,l.transform.zoom),fe=s.a6.mat4.fromScaling([],[1,1,1/oe]);s.a6.mat4.translate(ae,ae,N),k.push({zScaleMatrix:fe,negCameraPosMatrix:ae});for(const he of W.nodes)Ul(l.transform,he,W.matrix,l.transform.expandedFarZProjMatrix,H,q,Z);H++}if(q.sort((W,ie)=>ie.depth-W.depth),l.renderPass!=="shadow"){if(f===1)for(const W of Z)Vl(W,l,r,k[W.modelIndex],li.disabled,l.colorModeForRenderPass());else{for(const W of Z)Vl(W,l,r,k[W.modelIndex],li.disabled,bi.disabled);for(const W of Z)Vl(W,l,r,k[W.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}for(const W of q)Vl(W,l,r,k[W.modelIndex],li.disabled,l.colorModeForRenderPass());I()}else{for(const W of Z)ka(W.mesh,W.nodeModelMatrix,l,r);for(const W of q)ka(W.mesh,W.nodeModelMatrix,l,r);I()}}},lu={model:function(l,t,r){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,c.type==="vector"?l.scope:""));if(c.type==="batched-model"||c.type!=="model")return;const f=c.getModels();for(const m of f)m.upload(r.context)},raster:function(l,t,r){const c=t.getSource();if(!(c instanceof oa&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const m=l.paint.get("raster-array-band")||c.getInitialBand(f);if(m==null)return;const y=t.getIds().map(S=>t.getTileByID(S));for(const S of y)S.updateNeeded(f,m)&&c.prepareTile(S,f,m)},"raster-particle":function(l,t,r){const c=t.getSource();if(!(c instanceof oa&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const m=l.paint.get("raster-particle-array-band")||c.getInitialBand(f);if(m==null)return;const y=t.getIds().map(S=>t.getTileByID(S));for(const S of y)S.updateNeeded(f,m)&&c.prepareTile(S,f,m)}};class Uh{constructor(t,r,c,f){this.context=new Zm(t,r),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=f,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const m=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const S of m)this._debugParams.enabledLayers[S]=!0;f.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),f.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),f.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),f.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),f.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const S of m)f.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.occlusionParams=new au(f),this.setup(),this.numSublayers=Rn.maxUnderzooming+Rn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new uf(this),this._wireframeDebugCache=new xo,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const y=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,y,t.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(t,r){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Sh(this,t));const f=this._terrain;this.transform.elevation=c?f:null,f.update(t,this.transform,r),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,f]=r.getFovAdjustedRange(this.transform._fov);if(c>f)return void(this.transform.fogCullDistSq=null);const m=c+.78*(f-c);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Sh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*s.q.devicePixelRatio,this.height=r*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,r=new s.a_;r.emplaceBack(0,0),r.emplaceBack(s.ab,0),r.emplaceBack(0,s.ab),r.emplaceBack(s.ab,s.ab),this.tileExtentBuffer=t.createVertexBuffer(r,s.b0.members),this.tileExtentSegments=s.b1.simpleSegment(0,0,4,2);const c=new s.a_;c.emplaceBack(0,0),c.emplaceBack(s.ab,0),c.emplaceBack(0,s.ab),c.emplaceBack(s.ab,s.ab),this.debugBuffer=t.createVertexBuffer(c,s.b0.members),this.debugSegments=s.b1.simpleSegment(0,0,4,5);const f=new s.a_;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,s.b0.members),this.viewportSegments=s.b1.simpleSegment(0,0,4,2);const m=new s.aN;m.emplaceBack(0,0,0,0),m.emplaceBack(s.ab,0,s.ab,0),m.emplaceBack(0,s.ab,0,s.ab),m.emplaceBack(s.ab,s.ab,s.ab,s.ab),this.mercatorBoundsBuffer=t.createVertexBuffer(m,s.b3.members),this.mercatorBoundsSegments=s.b1.simpleSegment(0,0,4,2);const y=new s.aO;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const S=new s.a$;for(const P of[0,1,3,2,0])S.emplaceBack(P);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.a6.mat4.create();const I=this.context.gl;this.stencilClearMode=new li({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Vt.disabled,this.stencilClearMode,bi.disabled,ei.disabled,Dl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,c){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const I of c)if(this._tileClippingMaskIDs[I.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=r.id;const f=this.context,m=f.gl;this.nextStencilID+c.length>256&&this.clearStencil(),f.setColorMode(bi.disabled),f.setDepthMode(Vt.disabled);const y=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of c){const I=r.getTile(S),P=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:k,tileBoundsSegments:B}=this.getTileBoundsBuffers(I);y.draw(this,m.TRIANGLES,Vt.disabled,new li({func:m.ALWAYS,mask:0},P,255,m.KEEP,m.KEEP,m.REPLACE),bi.disabled,ei.disabled,Dl(S.projMatrix),"$clipping",L,k,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new li({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new li({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,c=t.sort((y,S)=>S.overscaledZ-y.overscaledZ),f=c[c.length-1].overscaledZ,m=c[0].overscaledZ-f+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let S=0;S<m;S++)y[S+f]=new li({func:r.GEQUAL,mask:255},S+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=m,[y,c]}return[{[f]:li.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new bi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bi.unblended:bi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new bi([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new s.bz(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,c,f=!1){if(this.depthOcclusion)return new Vt(this.context.gl.GREATER,Vt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!f)return Vt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Vt(c||this.context.gl.LEQUAL,r,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),c=Math.ceil(this.height),f=this.context.bindFramebuffer.get(),m=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&c!==0&&(this.depthFBO=new Jc(this.context,r,c,!1,"texture"),this.depthTexture=new s.T(this.context,{width:r,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(f),t.bindTexture(t.TEXTURE_2D,m),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,c,0,0,r,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,r)=>t+r/this._fpsHistory.length,0))}render(t,r){const c=s.q.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const f=this.style._mergedLayers,m=this.style.order.filter(be=>{const xe=f[be];return!(xe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[xe.type]});let y=!1,S=!1;for(const be of m){const xe=f[be];xe.type==="circle"&&(y=!0),xe.type==="symbol"&&(xe.hasInitialOcclusionOpacityProperties?S=!0:y=!0)}const I=m.map(be=>f[be]),P=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let L=0,k=!1;for(const be in P){const xe=P[be];xe.used&&(xe.prepare(this.context),xe.getSource().usedInConflation&&++L)}let B=!1;for(const be of I)be.isHidden(this.transform.zoom)||(be.type==="clip"&&(B=!0),this.prepareLayer(be));const N={},q={},Z={},H={},W={};for(const be in P){const xe=P[be];N[be]=xe.getVisibleCoordinates(),q[be]=N[be].slice().reverse(),Z[be]=xe.getVisibleCoordinates(!0).reverse(),H[be]=xe.getShadowCasterCoordinates(),W[be]=xe.sortCoordinatesByDistance(N[be])}const ie=be=>{const xe=this.style.getLayerSourceCache(be);return xe&&xe.used?xe.getSource():null};if(L||B||this._clippingActiveLastFrame){const be=[],xe=[];let Re=0;for(const Ge of I)this.isSourceForClippingOrConflation(Ge,ie(Ge))&&(be.push(Ge),xe.push(Re)),Re++;if(be&&(B||be.length>1)||this._clippingActiveLastFrame){B=!1;const Ge=[];for(let Ke=0;Ke<be.length;Ke++){const je=be[Ke],rt=xe[Ke],Le=this.style.getLayerSourceCache(je);if(!Le||!Le.used||!Le.getSource().usedInConflation&&je.type!=="clip")continue;let Xe=s.dn,He=s.bs.None;const st=[];let at=!0;if(je.type==="clip"){Xe=rt;for(const Ye of je.layout.get("clip-layer-types"))He|=Ye==="model"?s.bs.Model:Ye==="symbol"?s.bs.Symbol:s.bs.FillExtrusion;for(const Ye of je.layout.get("clip-layer-scope"))st.push(Ye);je.isHidden(this.transform.zoom)?at=!1:B=!0}at&&Ge.push({layer:je.fqid,cache:Le,order:Xe,clipMask:He,clipScope:st})}this.replacementSource.setSources(Ge),k=!0}}this._clippingActiveLastFrame=B,k||this.replacementSource.clear(),this.conflationActive=k,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let be=0;be<I.length;be++){const xe=I[be],Re=xe.cutoffRange();if(this.longestCutoffRange=Math.max(Re,this.longestCutoffRange),Re>0){const Ge=ie(xe);Ge&&(this.minCutoffZoom=Math.max(Ge.minzoom,this.minCutoffZoom)),xe.minzoom&&(this.minCutoffZoom=Math.max(xe.minzoom,this.minCutoffZoom))}xe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=be),this._lastOcclusionLayer=be)}const ne=this.style&&this.style.fog;ne?(this._fogVisible=ne.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ne.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Z),this.opaquePassCutoff=0);const ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const be in P)for(const xe of N[be]){let Re={min:0,max:0};this.terrain&&(Re=this.terrain.getMinMaxForTile(xe)||Re),ee.addShadowReceiver(xe.toUnwrapped(),Re.min,Re.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new nu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!nr.has(this.context.gl))return;this.renderPass="offscreen";for(const be of I){const xe=t.getLayerSourceCache(be);if(!be.hasOffscreenPass()||be.isHidden(this.transform.zoom))continue;const Re=xe?q[xe.id]:void 0;(be.type==="custom"||be.type==="raster"||be.type==="raster-particle"||be.isSky()||Re&&Re.length)&&this.renderLayer(this,xe,be,Re)}this.depthRangeFor3D=[0,1-(I.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,H)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),oe=(()=>{if(r.showOverdrawInspector)return s.bz.black;const be=this.style.fog;if(be&&this.transform.projection.supportsFog){const xe=this.style.getLut(be.scope);if(!ae){const Re=be.properties.get("color").toRenderColor(xe).toArray01();return new s.bz(...Re)}if(ae){const Re=be.properties.get("space-color").toRenderColor(xe).toArray01();return new s.bz(...Re)}}return s.bz.transparent})();if(this.context.clear({color:oe,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const be=I[this.currentLayer],xe=t.getLayerSourceCache(be);if(be.isSky())continue;const Re=xe?(be.is3D()?W:q)[xe.id]:void 0;this._renderTileClippingMasks(be,xe,Re),this.renderLayer(this,xe,be,Re)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const be=I[this.currentLayer],xe=t.getLayerSourceCache(be);be.isSky()&&this.renderLayer(this,xe,be,xe?q[xe.id]:void 0)}function fe(be,xe){let Re;return xe&&(Re=(be.type==="symbol"?Z:be.is3D()?W:q)[xe.id]),Re}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<m.length;){const be=I[this.currentLayer];if(be.type==="raster"||be.type==="raster-particle"){const xe=t.getLayerSourceCache(be);this.renderLayer(this,xe,be,fe(be,xe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let he=0;ee&&(he=ee.getShadowCastingLayerCount());let _e=!1,Te=-1;for(let be=0;be<m.length;++be){const xe=I[be];xe.isHidden(this.transform.zoom)||xe.is3D()&&(Te=be)}for(S&&Te===-1&&(y=!0);this.currentLayer<m.length;){const be=I[this.currentLayer],xe=t.getLayerSourceCache(be);if(be.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(be)){if(be.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(y&&!_e&&this.terrain&&!this.transform.isOrthographic&&(_e=!0,this.blitDepth()),S&&Te!==-1&&this.currentLayer===Te+1&&!this.transform.isOrthographic&&this.blitDepth(),be.is3D()||this.terrain||this._renderTileClippingMasks(be,xe,xe?N[xe.id]:void 0),this.renderLayer(this,xe,be,fe(be,xe)),!this.terrain&&ee&&he>0&&be.hasShadowPass()&&--he==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Re=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Re;this.currentLayer++){const Ge=I[this.currentLayer];if(!Ge.hasLightBeamPass())continue;const Ke=t.getLayerSourceCache(Ge);this.renderLayer(this,Ke,Ge,Ke?q[Ke.id]:void 0)}this.currentLayer=Re,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Re=this.currentLayer;this.depthOcclusion=!0;for(const Ge of this.layersWithOcclusionOpacity){this.currentLayer=Ge;const Ke=I[this.currentLayer],je=t.getLayerSourceCache(Ke),rt=je?q[je.id]:void 0;Ke.is3D()||this.terrain||this._renderTileClippingMasks(Ke,je,je?N[je.id]:void 0),this.renderLayer(this,je,Ke,rt)}this.depthOcclusion=!1,this.currentLayer=Re,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let be=null;I.forEach(xe=>{const Re=t.getLayerSourceCache(xe);Re&&!xe.isHidden(this.transform.zoom)&&Re.getVisibleCoordinates().length&&(!be||be.getSource().maxzoom<Re.getSource().maxzoom)&&(be=Re)}),be&&this.options.showTileBoundaries&&vo.debug(this,be,be.getVisibleCoordinates(),s.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&vo.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(be){const xe=be.transform.padding;pr(be,be.transform.height-(xe.top||0),3,Xm),pr(be,xe.bottom||0,3,La),Oe(be,xe.left||0,3,Da),Oe(be,be.transform.width-(xe.right||0),3,ut);const Re=be.transform.centerPoint;(function(Ge,Ke,je,rt){Nl(Ge,Ke-1,je-10,2,20,rt),Nl(Ge,Ke-10,je-1,20,2,rt)})(be,Re.x,be.transform.height-Re.y,Bt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),k||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,c=!r||!r.includes(t.type);if(lu[t.type]&&(c||this.terrain&&t.type==="custom")){const f=this.style.getLayerSourceCache(t);lu[t.type](t,f,this)}this.gpuTimingEnd()}renderLayer(t,r,c,f){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||f&&f.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||vo[c.type](t,r,c,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,c=this.context.gl;let f=this.gpuTimers[t.id];f||(f=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),f.calls++,c.beginQuery(r.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,c=r.createQuery();this.deferredRenderGpuTimeQueries.push(c),r.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const c in t){const f=t[c],m=this.context.extTimerQuery,y=m.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;m.deleteQueryEXT(f.query),r[c]=y}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.extTimerQuery,c=this.context.gl;let f=0;for(const m of t)f+=r.getQueryParameter(m,c.QUERY_RESULT)/1e6,r.deleteQueryEXT(m);return f}translatePosMatrix(t,r,c,f,m){if(!c[0]&&!c[1])return t;const y=m?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(y){const P=Math.sin(y),L=Math.cos(y);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}const S=[m?c[0]:s.ak(r,c[0],this.transform.zoom),m?c[1]:s.ak(r,c[1],this.transform.zoom),0],I=new Float32Array(16);return s.a6.mat4.translate(I,t,S),I}saveTileTexture(t){const r=t.size[0],c=this._tileTextures[r];c?c.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,c){const f=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,m=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(m.push("LIGHTING_3D_MODE"),m.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||m.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||m.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?m.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):m.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(m.push("TERRAIN"),this.linearFloatFilteringSupported()&&m.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&m.push("GLOBE"),!this._fogVisible||f||r!==void 0&&!r||m.push("FOG","FOG_DITHERING"),f&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}getOrCreateProgram(t,r){this.cache=this.cache||{};const c=r&&r.defines||[],f=r&&r.config,m=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(c),y=go.cacheKey(mo[t],t,m,f);return this.cache[y]||(this.cache[y]=new go(this.context,t,mo[t],f,Uf[t],m)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const c=this.style.directionalLight,f=this.style.ambientLight;if(c&&f){const m=((y,S,I)=>{const P=y.properties.get("direction"),L=y.properties.get("color").toRenderColor(I.getLut(y.scope)).toArray01(),k=y.properties.get("intensity"),B=S.properties.get("color").toRenderColor(I.getLut(S.scope)).toArray01(),N=S.properties.get("intensity"),q=[P.x,P.y,P.z],Z=s.cH(B,N),H=s.cH(L,k);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:q,u_lighting_directional_color:H,u_ground_radiance:Mh(q,H,Z)}})(c,f,this.style);r.setLightsUniformValues(t,m)}}}uploadCommonUniforms(t,r,c,f,m){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const S=y.getOpacity(this.transform.pitch),I=((P,L,k,B,N,q,Z,H,W,ie,ne,ee)=>{const ae=P.transform,oe=L.properties.get("color").toRenderColor(P.style.getLut(L.scope)).toArray01();oe[3]=B;const fe=P.frameCounter/1e3%1,[he,_e]=L.properties.get("vertical-range");return{u_fog_matrix:k?ae.calculateFogTileMatrix(k):ee||P.identityMat,u_fog_range:L.getFovAdjustedRange(ae._fov),u_fog_color:oe,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,_e),_e],u_fog_temporal_offset:fe,u_frustum_tl:N,u_frustum_tr:q,u_frustum_br:Z,u_frustum_bl:H,u_globe_pos:W,u_globe_radius:ie,u_viewport:ne,u_globe_transition:s.a9(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,y,c,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],f);r.setFogUniformValues(t,I)}m&&r.setCutoffUniformValues(t,m.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const f of c)r[f.key]=t[f.key]||new Ls(f,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=vt||r[1]>=vt}setupDepthForOcclusion(t,r,c){const f=this.context,m=f.gl,y=!!c;var S;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),f.activeTexture.set(m.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),f.activeTexture.set(m.TEXTURE0),y||r.setTerrainUniformValues(f,c)}}function Ws(l,t){let r=!1,c=null;const f=()=>{c=null,r&&(l(),c=setTimeout(f,t),r=!1)};return()=>(r=!0,c||f(),c)}class bo{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ws(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=Xs(t);if(this._hashName){const c=this._hashName;let f=!1;const m=location.hash.slice(1).split("&").map(y=>{const S=y.split("=")[0];return S===c?(f=!0,`${S}=${r}`):y}).filter(y=>y);return f||m.push(`${c}=${r}`),`#${m.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(r=c)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(c=>isNaN(c))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Xs(l,t){const r=l.getCenter(),c=Math.round(100*l.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,f),y=Math.round(r.lng*m)/m,S=Math.round(r.lat*m)/m,I=l.getBearing(),P=l.getPitch();let L=t?`/${y}/${S}/${c}`:`${c}/${S}/${y}`;return(I||P)&&(L+="/"+Math.round(10*I)/10),P&&(L+=`/${Math.round(P)}`),L}const Ho={linearity:.3,easing:s.dp(0,0,.3,1)},cu=s.l({deceleration:2500,maxSpeed:1400},Ho),jh=s.l({deceleration:20,maxSpeed:1400},Ho),Gh=s.l({deceleration:1e3,maxSpeed:360},Ho),qh=s.l({deceleration:1e3,maxSpeed:90},Ho);class wo{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=s.q.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)r.zoom+=m.zoomDelta||0,r.bearing+=m.bearingDelta||0,r.pitch+=m.pitchDelta||0,m.panDelta&&r.pan._add(m.panDelta),m.around&&(r.around=m.around),m.pinchAround&&(r.pinchAround=m.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(r.pan.mag()){const m=Wo(r.pan.mag(),c,s.l({},cu,t||{}));f.offset=r.pan.mult(m.amount/r.pan.mag()),f.center=this._map.transform.center,Oa(f,m)}if(r.zoom){const m=Wo(r.zoom,c,jh);f.zoom=this._map.transform.zoom+m.amount,Oa(f,m)}if(r.bearing){const m=Wo(r.bearing,c,Gh);f.bearing=this._map.transform.bearing+s.ap(m.amount,-179,179),Oa(f,m)}if(r.pitch){const m=Wo(r.pitch,c,qh);f.pitch=this._map.transform.pitch+m.amount,Oa(f,m)}if(f.zoom||f.bearing){const m=r.pinchAround===void 0?r.around:r.pinchAround;f.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function Oa(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Wo(l,t,r){const{maxSpeed:c,linearity:f,deceleration:m}=r,y=s.ap(l*f/(t/1e3),-c,c),S=Math.abs(y)/(m*f);return{easing:r.easing,duration:1e3*S,amount:y*(S/2)}}class Tn extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c,f={}){const m=lr(r.getCanvasContainer(),c),y=r.unproject(m);super(t,s.l({point:m,lngLat:y,originalEvent:c},f)),this._defaultPrevented=!1,this.target=r}}class Ba extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){const f=t==="touchend"?c.changedTouches:c.touches,m=Sr(r.getCanvasContainer(),f),y=m.map(I=>r.unproject(I)),S=m.reduce((I,P,L,k)=>I.add(P.div(k.length)),new s.P(0,0));super(t,{points:m,point:S,lngLats:y,lngLat:r.unproject(S),originalEvent:c}),this._defaultPrevented=!1}}class ln extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class $h{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new ln(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Tn(t.type,this._map,t))}mouseup(t){this._map.fire(new Tn(t.type,this._map,t))}preclick(t){const r=s.l({},t);r.type="preclick",this._map.fire(new Tn(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Tn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Tn(t.type,this._map,t))}mouseover(t){this._map.fire(new Tn(t.type,this._map,t))}mouseout(t){this._map.fire(new Tn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ba(t.type,this._map,t))}touchmove(t){this._map.fire(new Ba(t.type,this._map,t))}touchend(t){this._map.fire(new Ba(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ba(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Tn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Tn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fa{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Rt(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const c=r,f=this._startPos,m=this._lastPos;if(!f||!m||m.equals(c)||!this._box&&c.dist(f)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=ct("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(f.x,c.x),S=Math.max(f.x,c.x),I=Math.min(f.y,c.y),P=Math.max(f.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${I}px)`,this._box.style.width=S-y+"px",this._box.style.height=P-I+"px")})}mouseupWindow(t,r){if(!this._active)return;const c=this._startPos,f=r;if(c&&t.button===0){if(this.reset(),kt(),c.x!==f.x||c.y!==f.y)return this._map.fire(new s.x("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(c,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),yi(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new s.x(t,{originalEvent:r}))}}function Ys(l,t){const r={};for(let c=0;c<l.length;c++)r[l[c].identifier]=t[c];return r}class Hh{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(f){const m=new s.P(0,0);for(const y of f)m._add(y);return m.div(f.length)}(r),this.touches=Ys(c,r)))}touchmove(t,r,c){if(this.aborted||!this.centroid)return;const f=Ys(c,r);for(const m in this.touches){const y=f[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,r,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Gl{constructor(t){this.singleTap=new Hh(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,c){this.singleTap.touchstart(t,r,c)}touchmove(t,r,c){this.singleTap.touchmove(t,r,c)}touchend(t,r,c){const f=this.singleTap.touchend(t,r,c);if(f){const m=t.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(f)<30;if(m&&y||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Wh{constructor(){this._zoomIn=new Gl({numTouches:1,numTaps:2}),this._zoomOut=new Gl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,c){this._zoomIn.touchstart(t,r,c),this._zoomOut.touchstart(t,r,c)}touchmove(t,r,c){this._zoomIn.touchmove(t,r,c),this._zoomOut.touchmove(t,r,c)}touchend(t,r,c){const f=this._zoomIn.touchend(t,r,c),m=this._zoomOut.touchend(t,r,c);return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(f)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ql={0:1,2:2};class $l{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const c=qt(t);this._correctButton(t,c)&&(this._lastPoint=r,this._eventButton=c)}mousemoveWindow(t,r){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&function(f,m){const y=ql[m];return f.buttons===void 0||(f.buttons&y)!==y}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(c,r)}}mouseupWindow(t){this._lastPoint&&qt(t)===this._eventButton&&(this._moved&&kt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uu extends $l{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class hu extends $l{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const c=.8*(r.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){t.preventDefault()}}class du extends $l{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const c=-.5*(r.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){t.preventDefault()}}class Xf{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),s.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,r,c){return this._calculateTransform(t,r,c)}touchmove(t,r,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!s.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,c)}}touchend(t,r,c){this._calculateTransform(t,r,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,c){c.length>0&&(this._active=!0);const f=Ys(c,r),m=new s.P(0,0),y=new s.P(0,0);let S=0;for(const P in f){const L=f[P],k=this._touches[P];k&&(m._add(L),y._add(L.sub(k)),S++,f[P]=L)}if(this._touches=f,S<this._minTouches||!y.mag())return;const I=y.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(S),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ct("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class fu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,c){return{}}touchstart(t,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,c){const f=this._firstTwoTouches;if(!f)return;t.preventDefault();const[m,y]=f,S=Zl(c,r,m),I=Zl(c,r,y);if(!S||!I)return;const P=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],P,t)}touchend(t,r,c){if(!this._firstTwoTouches)return;const[f,m]=this._firstTwoTouches,y=Zl(c,r,f),S=Zl(c,r,m);y&&S||(this._active&&kt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zl(l,t,r){for(let c=0;c<l.length;c++)if(l[c].identifier===r)return t[c]}function Xh(l,t){return Math.log(l/t)/Math.LN2}class Yf extends fu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xh(this._distance,c),pinchAround:r}}}function Yh(l,t){return 180*l.angleWith(t)/Math.PI}class Kf extends fu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Yh(this._vector,c),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const f=Yh(t,c);return Math.abs(f)<r}}function pu(l){return Math.abs(l.y)>Math.abs(l.x)}class Jf extends fu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,pu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,c){const f=this._lastPoints;if(!f)return;const m=t[0].sub(f[0]),y=t[1].sub(f[1]);return this._map._cooperativeGestures&&!s.dq()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(m,y,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5})}gestureBeginsVertically(t,r,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,m=r.mag()>=2;if(!f&&!m)return;if(!f||!m)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const y=t.y>0==r.y>0;return pu(t)&&pu(r)&&y}}const Qf={panStep:100,bearingStep:15,pitchStep:10};class ep{constructor(){const t=Qf;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,c=0,f=0,m=0,y=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),y=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:S=>{const I=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:tp,zoom:r?Math.round(I)+r*(t.shiftKey?2:1):I,bearing:S.getBearing()+c*this._bearingStep,pitch:S.getPitch()+f*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tp(l){return l*(2-l)}const Kh=4.000244140625,e_=1/450;class t_{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=e_,s.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=s.q.now(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%Kh==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=lr(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Kh?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&L!==0&&(L=1/L);const k=r(),B=Math.pow(2,k),N=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(N*L))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:r(),f=this._startZoom,m=this._easing;let y,S=!1;if(this._type==="wheel"&&f&&m){const P=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),L=m(P);y=s.aa(f,c,L),P<1?this._frameId||(this._frameId=!0):S=!0}else y=c,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=y-r();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=s.dr;if(this._prevEase){const c=this._prevEase,f=(s.q.now()-c.start)/c.duration,m=c.easing(f+.01)-c.easing(f),y=.27/Math.sqrt(m*m+1e-4)*.01,S=Math.sqrt(.0729-y*y);r=s.dp(y,S,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ct("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class wr{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ip{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class i_{constructor(){this._tap=new Gl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=r[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,r,c))}touchmove(t,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=r[0],m=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,r,c)}touchend(t,r,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,r,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r_{constructor(t,r,c){this._el=t,this._mousePan=r,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hl{constructor(t,r,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rp{constructor(t,r,c,f){this._el=t,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Na=l=>l.zoom||l.drag||l.pitch||l.rotate;class mu extends s.x{}class Ks{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const c=s.a6.vec3.sub([],r,t);this.radius=s.a6.vec3.length(c[2]<0?s.a6.vec3.div([],c,this.constants):[c[0],c[1],0])}projectRay(t){s.a6.vec3.div(t,t,this.constants),s.a6.vec3.normalize(t,t),s.a6.vec3.mul(t,t,this.constants);const r=s.a6.vec3.scale([],t,this.radius);if(r[2]>0){const c=s.a6.vec3.scale([],[0,0,1],s.a6.vec3.dot(r,[0,0,1])),f=s.a6.vec3.scale([],s.a6.vec3.normalize([],[r[0],r[1],0]),this.radius),m=s.a6.vec3.add([],r,s.a6.vec3.scale([],s.a6.vec3.sub([],s.a6.vec3.add([],f,c),r),2));r[0]=m[0],r[1]=m[1]}return r}}function Xo(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class yn{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wo(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ks,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),s.aJ(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,m,y]of this._listeners){const S=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(m,S,y)}}destroy(){for(const[t,r,c]of this._listeners){const f=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,f,c)}}_addDefaultHandlers(t){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new $h(r,t));const f=r.boxZoom=new Fa(r,t);this._add("boxZoom",f);const m=new Wh,y=new ip;r.doubleClickZoom=new wr(y,m),this._add("tapZoom",m),this._add("clickZoom",y);const S=new i_;this._add("tapDragZoom",S);const I=r.touchPitch=new Jf(r);this._add("touchPitch",I);const P=new hu(t),L=new du(t);r.dragRotate=new Hl(t,P,L),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const k=new uu(t),B=new Xf(r,t);r.dragPan=new r_(c,k,B),this._add("mousePan",k),this._add("touchPan",B,["touchZoom","touchRotate"]);const N=new Kf,q=new Yf;r.touchZoomRotate=new rp(c,q,N,S),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zh(r));const Z=r.scrollZoom=new t_(r,this);this._add("scrollZoom",Z,["mousePan"]);const H=r.keyboard=new ep;this._add("keyboard",H);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[W]&&r[W].enable(t[W])}_add(t,r,c){this._handlers.push({handlerName:t,handler:r,allowed:c}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Na(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,c){for(const f in t)if(f!==c&&(!r||r.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const c of t)this._el.contains(c.target)&&r.push(c);return r}handleEvent(t,r){this._updatingCamera=!0;const c=t.type==="renderFrame",f=c?void 0:t,m={needsRenderFrame:!1},y={},S={},I=t.touches?this._getMapTouches(t.touches):void 0,P=I?Sr(this._el,I):c?void 0:lr(this._el,t);for(const{handlerName:B,handler:N,allowed:q}of this._handlers){if(!N.isEnabled())continue;let Z;this._blockedByActive(S,q,B)?N.reset():N[r||t.type]&&(Z=N[r||t.type](t,P,I),this.mergeHandlerResult(m,y,Z,B,f),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||N.isActive())&&(S[B]=N)}const L={};for(const B in this._previousActiveHandlers)S[B]||(L[B]=f);this._previousActiveHandlers=S,(Object.keys(L).length||Xo(m))&&(this._changes.push([m,y,L]),this._triggerRenderFrame()),(Object.keys(S).length||Xo(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=m;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,r,c,f,m){if(!c)return;s.l(t,c);const y={handlerName:f,originalEvent:c.originalEvent||m};c.zoomDelta!==void 0&&(r.zoom=y),c.panDelta!==void 0&&(r.drag=y),c.pitchDelta!==void 0&&(r.pitch=y),c.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){const t={},r={},c={};for(const[f,m,y]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.aroundCoord!==void 0&&(t.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),s.l(r,m),s.l(c,y);this._updateMapTransform(t,r,c),this._changes=[]}_updateMapTransform(t,r,c){const f=this._map,m=f.transform,y=ie=>[ie.x,ie.y,ie.z];if((ie=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Xo(t)){const ie=m.zoom;m.cameraElevationReference="sea",this._originalZoom!=null&&m._orthographicProjectionAtLowPitch&&m.projection.name!=="globe"&&m.pitch===0?(m.cameraElevationReference="ground",m.zoom=this._originalZoom):(m.recenterOnTerrain(),m.cameraElevationReference="ground"),ie!==m.zoom&&this._map._update(!0)}if(m._isCameraConstrained&&f._stop(!0),!Xo(t))return void this._fireEvents(r,c,!0);let{panDelta:S,zoomDelta:I,bearingDelta:P,pitchDelta:L,around:k,aroundCoord:B,pinchAround:N}=t;m._isCameraConstrained&&(I>0&&(I=0),m._isCameraConstrained=!1),N!==void 0&&(k=N),(I||(ie=>r[ie]&&!this._eventsInProgress[ie])("drag"))&&k&&(this._dragOrigin=y(m.pointCoordinate3D(k)),this._originalZoom=m.zoom,this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",f._stop(!0),k=k||f.transform.centerPoint,P&&(m.bearing+=P),L&&(m.pitch+=L),m._updateCameraState();const q=[0,0,0];if(S)if(m.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(k).dir),ne=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(k.sub(S)).dir);q[0]=ne[0]-ie[0],q[1]=ne[1]-ie[1]}else{const ie=m.pointCoordinate(k);if(m.projection.name==="globe"){S=S.rotate(-m.angle);const ne=m._pixelsPerMercatorPixel/m.worldSize;q[0]=-S.x*s.ds(s.aM(ie.y))*ne,q[1]=-S.y*s.ds(m.center.lat)*ne}else{const ne=m.pointCoordinate(k.sub(S));ie&&ne&&(q[0]=ne.x-ie.x,q[1]=ne.y-ie.y)}}const Z=m.zoom,H=[0,0,0];if(I){const ie=y(B||m.pointCoordinate3D(k)),ne={dir:s.a6.vec3.normalize([],s.a6.vec3.sub([],ie,m._camera.position))};if(ne.dir[2]<0){const ee=m.zoomDeltaToMovement(ie,I);s.a6.vec3.scale(H,ne.dir,ee)}}const W=s.a6.vec3.add(q,q,H);m._translateCameraConstrained(W),I&&Math.abs(m.zoom-Z)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,c,!0)}_fireEvents(t,r,c){const f=Na(this._eventsInProgress),m=Na(t),y={};for(const L in t){const{originalEvent:k}=t[L];this._eventsInProgress[L]||(y[`${L}start`]=k),this._eventsInProgress[L]=t[L]}!f&&m&&this._fireEvent("movestart",m.originalEvent);for(const L in y)this._fireEvent(L,y[L]);m&&this._fireEvent("move",m.originalEvent);for(const L in t){const{originalEvent:k}=t[L];this._fireEvent(L,k)}const S={};let I;for(const L in this._eventsInProgress){const{handlerName:k,originalEvent:B}=this._eventsInProgress[L];this._handlersById[k].isActive()||(delete this._eventsInProgress[L],I=r[k]||B,S[`${L}end`]=I)}for(const L in S)this._fireEvent(L,S[L]);const P=Na(this._eventsInProgress);if(c&&(f||m)&&!P){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(k(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:I})):(this._map.fire(new s.x("moveend",{originalEvent:I})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new s.x(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new mu("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Os="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Jh extends s.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,s.aJ(["_renderFrameCallback"],this)}getCenter(){return new s.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,c){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.l({offset:t},r),c)}panTo(t,r,c){return this.easeTo(s.l({center:t},r),c)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,c){return this.easeTo(s.l({zoom:t},r),c)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,c){return this.easeTo(s.l({bearing:t},r),c)}resetNorth(t,r){return this.rotateTo(0,s.l({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=s.as.convert(t);const c=r&&r.bearing||0,f=r&&r.pitch||0,m=t.getNorthWest(),y=t.getSouthEast();return this._cameraForBounds(this.transform,m,y,c,f,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?s.l({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.l({},r,t)}_extendCameraOptions(t){return(t=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const c=r.max[0]-r.min[0],f=r.max[1]-r.min[1];return c/f>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):f/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,c,f,m,y){const S=t.clone(),I=this._extendCameraOptions(y);S.bearing=f,S.pitch=m;const P=s.bK.convert(r),L=s.bK.convert(c),k=.5*(P.lat+L.lat),B=.5*(P.lng+L.lng),N=s.dt(k,B),q=s.a6.vec3.normalize([],N),Z=s.a6.vec3.normalize([],s.a6.vec3.cross([],q,[0,1,0])),H=s.a6.vec3.cross([],Z,q),W=[Z[0],Z[1],Z[2],0,H[0],H[1],H[2],0,q[0],q[1],q[2],0,0,0,0,1],ie=[N,s.dt(P.lat,P.lng),s.dt(L.lat,P.lng),s.dt(L.lat,L.lng),s.dt(P.lat,L.lng),s.dt(k,P.lng),s.dt(k,L.lng),s.dt(P.lat,B),s.dt(L.lat,B)];let ne=s.c9.fromPoints(ie.map(He=>[s.a6.vec3.dot(Z,He),s.a6.vec3.dot(H,He),s.a6.vec3.dot(q,He)]));const ee=s.a6.vec3.transformMat4([],ne.center,W);s.a6.vec3.squaredLength(ee)===0&&s.a6.vec3.set(ee,0,0,1),s.a6.vec3.normalize(ee,ee),s.a6.vec3.scale(ee,ee,s.aq),S.center=s.du(ee);const ae=S.getWorldToCameraMatrix(),oe=s.a6.mat4.invert(new Float64Array(16),ae);ne=s.c9.applyTransform(ne,s.a6.mat4.multiply([],ae,W));const fe=this._extendAABB(ne,S,I,f);if(!fe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=fe,s.a6.vec3.transformMat4(ee,ee,ae);const he=.5*(ne.max[2]-ne.min[2]),_e=this._minimumAABBFrustumDistance(S,ne),Te=s.a6.vec3.scale([],[0,0,1],he),be=s.a6.vec3.add(Te,ee,Te),xe=_e+(S.pitch===0?0:s.a6.vec3.distance(ee,be)),Re=S.globeCenterInViewSpace,Ge=s.a6.vec3.sub([],ee,[Re[0],Re[1],Re[2]]);s.a6.vec3.normalize(Ge,Ge),s.a6.vec3.scale(Ge,Ge,xe);const Ke=s.a6.vec3.add([],ee,Ge);s.a6.vec3.transformMat4(Ke,Ke,oe);const je=s.dw/s.aq,rt=s.a6.vec3.length(Ke),Le=s.bD(Math.max(rt*je-s.dw,Number.EPSILON),0),Xe=Math.min(S.zoomFromMercatorZAdjusted(Le),I.maxZoom);return Xe>.5*(s.c2+s.bU)?(S.setProjection({name:"mercator"}),S.zoom=Xe,this._cameraForBounds(S,r,c,f,m,y)):{center:S.center,zoom:Xe,bearing:f,pitch:m}}_extendAABB(t,r,c,f){const m=.5*((c.padding.left||0)+(c.padding.right||0)),y=.5*((c.padding.top||0)+(c.padding.bottom||0)),S=y,I=m,P=m,L=y,k=r.width-(I+P),B=r.height-(S+L),N=s.a6.vec3.sub([],t.max,t.min),q=Math.min(k/N[0],B/N[1]),Z=Math.min(r.scaleZoom(r.scale*q),c.maxZoom);if(isNaN(Z))return null;const H=r.scale/r.zoomScale(Z),W=new s.c9([t.min[0]-I*H,t.min[1]-L*H,t.min[2]],[t.max[0]+P*H,t.max[1]+S*H,t.max[2]]),ie=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new s.P(c.offset.x,c.offset.y):s.P.convert(c.offset)).rotate(-s.bB(f));return W.center[0]-=ie.x*H,W.center[1]+=ie.y*H,W}queryTerrainElevation(t,r){const c=this.transform.elevation;return c?(r=s.l({},{exaggerated:!0},r),c.getAtPoint(s.a5.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,c,f,m,y){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,c,f,m,y);const S=t.clone(),I=this._extendCameraOptions(y);S.bearing=f,S.pitch=m;const P=s.bK.convert(r),L=s.bK.convert(c),k=new s.bK(P.lng,L.lat),B=new s.bK(L.lng,P.lat),N=S.project(P),q=S.project(L),Z=this.queryTerrainElevation(P),H=this.queryTerrainElevation(L),W=this.queryTerrainElevation(k),ie=this.queryTerrainElevation(B),ne=[[N.x,N.y,Math.min(Z||0,H||0,W||0,ie||0)],[q.x,q.y,Math.max(Z||0,H||0,W||0,ie||0)]];let ee=s.c9.fromPoints(ne);const ae=S.getWorldToCameraMatrix(),oe=s.a6.mat4.invert(new Float64Array(16),ae);ee=s.c9.applyTransform(ee,ae);const fe=this._extendAABB(ee,S,I,f);if(!fe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=fe;const he=.5*s.a6.vec3.sub([],ee.max,ee.min)[2],_e=this._minimumAABBFrustumDistance(S,ee),Te=[0,0,1,0];s.a6.vec4.transformMat4(Te,Te,ae),s.a6.vec4.normalize(Te,Te);const be=s.a6.vec3.scale([],Te,_e+he),xe=s.a6.vec3.add([],ee.center,be);s.a6.vec3.transformMat4(ee.center,ee.center,oe),s.a6.vec3.transformMat4(xe,xe,oe);const Re=S.unproject(new s.P(ee.center[0],ee.center[1])),Ge=s.dv(S.projection,Re),Ke=Math.pow(2,Ge),je=Math.min(S._zoomFromMercatorZ(xe[2]*S.pixelsPerMeter*Ke/S.worldSize),I.maxZoom);return S.mercatorFromTransition&&je<.5*(s.c2+s.bU)?(S.setProjection({name:"globe"}),S.zoom=je,this._cameraForBounds(S,r,c,f,m,y)):{center:Re,zoom:je,bearing:f,pitch:m}}fitBounds(t,r,c){const f=this.cameraForBounds(t,r);return this._fitInternal(f,r,c)}fitScreenCoordinates(t,r,c,f,m){const y=s.P.convert(t),S=s.P.convert(r),I=new s.P(Math.min(y.x,S.x),Math.min(y.y,S.y)),P=new s.P(Math.max(y.x,S.x),Math.max(y.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(y,S))return this;const L=this.transform.pointLocation3D(I),k=this.transform.pointLocation3D(P),B=this.transform.pointLocation3D(new s.P(I.x,P.y)),N=this.transform.pointLocation3D(new s.P(P.x,I.y)),q=[Math.min(L.lng,k.lng,B.lng,N.lng),Math.min(L.lat,k.lat,B.lat,N.lat)],Z=[Math.max(L.lng,k.lng,B.lng,N.lng),Math.max(L.lat,k.lat,B.lat,N.lat)],H=f&&f.pitch?f.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,q,Z,c,H,f);return this._fitInternal(W,f,m)}_fitInternal(t,r,c){return t?(r=s.l(t,r)).linear?this.easeTo(r,c):this.flyTo(r,c):this}jumpTo(t,r){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let f=!1,m=!1,y=!1;"zoom"in t&&c.zoom!==+t.zoom&&(f=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=s.bK.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(m=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(y=!0,c.pitch=+t.pitch);const S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(S))if(t.retainPadding===!1){const I=c.clone();I.padding=S,c.setLocationAtPoint(c.center,I.centerPoint)}else c.padding=S;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new s.x("movestart",r)).fire(new s.x("move",r)),f&&this.fire(new s.x("zoomstart",r)).fire(new s.x("zoom",r)).fire(new s.x("zoomend",r)),m&&this.fire(new s.x("rotatestart",r)).fire(new s.x("rotate",r)).fire(new s.x("rotateend",r)),y&&this.fire(new s.x("pitchstart",r)).fire(new s.x("pitch",r)).fire(new s.x("pitchend",r)),this.fire(new s.x("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Os),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const c=this.transform;if(!c.projection.supportsFreeCamera)return s.w(Os),this;this.stop();const f=c.zoom,m=c.pitch,y=c.bearing;c.setFreeCameraOptions(t);const S=f!==c.zoom,I=m!==c.pitch,P=y!==c.bearing;return this.fire(new s.x("movestart",r)).fire(new s.x("move",r)),S&&this.fire(new s.x("zoomstart",r)).fire(new s.x("zoom",r)).fire(new s.x("zoomend",r)),P&&this.fire(new s.x("rotatestart",r)).fire(new s.x("rotate",r)).fire(new s.x("rotateend",r)),I&&this.fire(new s.x("pitchstart",r)).fire(new s.x("pitch",r)).fire(new s.x("pitchend",r)),this.fire(new s.x("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=s.l({offset:[0,0],duration:500,easing:s.dr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,f=this.getZoom(),m=this.getBearing(),y=this.getPitch(),S=this.getPadding(),I="zoom"in t?+t.zoom:f,P="bearing"in t?this._normalizeBearing(t.bearing,m):m,L="pitch"in t?+t.pitch:y,k=this._extendPadding(t.padding),B=s.P.convert(t.offset);let N,q,Z;if(c.projection.name==="globe"){const Te=s.a5.fromLngLat(c.center),be=B.rotate(-c.angle);Te.x+=be.x/c.worldSize,Te.y+=be.y/c.worldSize;const xe=Te.toLngLat(),Re=s.bK.convert(t.center||xe);this._normalizeCenter(Re),N=c.centerPoint.add(be),q=new s.P(Te.x,Te.y).mult(c.worldSize),Z=new s.P(s.am(Re.lng),s.at(Re.lat)).mult(c.worldSize).sub(q)}else{N=c.centerPoint.add(B);const Te=c.pointLocation(N),be=s.bK.convert(t.center||Te);this._normalizeCenter(be),q=c.project(Te),Z=c.project(be).sub(q)}const H=c.zoomScale(I-f);let W,ie;t.around&&(W=s.bK.convert(t.around),ie=c.locationPoint(W));const ne=this._zooming||I!==f,ee=this._rotating||m!==P,ae=this._pitching||L!==y,oe=!c.isPaddingEqual(k),fe=t.retainPadding===!1?c.clone():c,he=Te=>be=>{if(ne&&(Te.zoom=s.aa(f,I,be)),ee&&(Te.bearing=s.aa(m,P,be)),ae&&(Te.pitch=s.aa(y,L,be)),oe&&(fe.interpolatePadding(S,k,be),N=fe.centerPoint.add(B)),W)Te.setLocationAtPoint(W,ie);else{const xe=Te.zoomScale(Te.zoom-f),Re=I>f?Math.min(2,H):Math.max(.5,H),Ge=Math.pow(Re,1-be),Ke=Te.unproject(q.add(Z.mult(be*Ge)).mult(xe));Te.setLocationAtPoint(Te.renderWorldCopies?Ke.wrap():Ke,N)}return t.preloadOnly||this._fireMoveEvents(r),Te};if(t.preloadOnly){const Te=this._emulate(he,t.duration,c);return this._preloadTiles(Te),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ee,this._pitching=ae,this._padding=oe,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,_e),this._ease(he(c),Te=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(r,Te)},t),this}_prepareEase(t,r,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||c.moving||this.fire(new s.x("movestart",t)),this._zooming&&!c.zooming&&this.fire(new s.x("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new s.x("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new s.x("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.x("move",t)),this._zooming&&this.fire(new s.x("zoom",t)),this._rotating&&this.fire(new s.x("rotate",t)),this._pitching&&this.fire(new s.x("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,f=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new s.x("zoomend",t)),f&&this.fire(new s.x("rotateend",t)),m&&this.fire(new s.x("pitchend",t)),this.fire(new s.x("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const He=s.ar(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(He,r)}this.stop(),t=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dr},t);const c=this.transform,f=this.getZoom(),m=this.getBearing(),y=this.getPitch(),S=this.getPadding(),I="zoom"in t?s.ap(+t.zoom,c.minZoom,c.maxZoom):f,P="bearing"in t?this._normalizeBearing(t.bearing,m):m,L="pitch"in t?+t.pitch:y,k=this._extendPadding(t.padding),B=c.zoomScale(I-f),N=s.P.convert(t.offset);let q=c.centerPoint.add(N);const Z=c.pointLocation(q),H=s.bK.convert(t.center||Z);this._normalizeCenter(H);const W=c.project(Z),ie=c.project(H).sub(W);let ne=t.curve;const ee=Math.max(c.width,c.height),ae=ee/B,oe=ie.mag();if("minZoom"in t){const He=s.ap(Math.min(t.minZoom,f,I),c.minZoom,c.maxZoom),st=ee/c.zoomScale(He-f);ne=Math.sqrt(st/oe*2)}const fe=ne*ne;function he(He){const st=(ae*ae-ee*ee+(He?-1:1)*fe*fe*oe*oe)/(2*(He?ae:ee)*fe*oe);return Math.log(Math.sqrt(st*st+1)-st)}function _e(He){return(Math.exp(He)-Math.exp(-He))/2}function Te(He){return(Math.exp(He)+Math.exp(-He))/2}const be=he(0);let xe=function(He){return Te(be)/Te(be+ne*He)},Re=function(He){return ee*((Te(be)*(_e(st=be+ne*He)/Te(st))-_e(be))/fe)/oe;var st},Ge=(he(1)-be)/ne;if(Math.abs(oe)<1e-6||!isFinite(Ge)){if(Math.abs(ee-ae)<1e-6)return this.easeTo(t,r);const He=ae<ee?-1:1;Ge=Math.abs(Math.log(ae/ee))/ne,Re=function(){return 0},xe=function(st){return Math.exp(He*ne*st)}}t.duration="duration"in t?+t.duration:1e3*Ge/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ke=m!==P,je=L!==y,rt=!c.isPaddingEqual(k),Le=t.retainPadding===!1?c.clone():c,Xe=He=>st=>{const at=st*Ge,Ye=1/xe(at);He.zoom=st===1?I:f+He.scaleZoom(Ye),Ke&&(He.bearing=s.aa(m,P,st)),je&&(He.pitch=s.aa(y,L,st)),rt&&(Le.interpolatePadding(S,k,st),q=Le.centerPoint.add(N));const Qe=st===1?H:He.unproject(W.add(ie.mult(Re(at))).mult(Ye));return He.setLocationAtPoint(He.renderWorldCopies?Qe.wrap():Qe,q),He._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),He};if(t.preloadOnly){const He=this._emulate(Xe,t.duration,c);return this._preloadTiles(He),this}return this._zooming=!0,this._rotating=Ke,this._pitching=je,this._padding=rt,this._prepareEase(r,!1),this._ease(Xe(c),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,r)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,r,c){c.animate===!1||c.duration===0?(t(1),r()):(this._easeStart=s.q.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=s.bA(t,-180,180);const c=Math.abs(t-r);return Math.abs(t-360-r)<c&&(t-=360),Math.abs(t+360-r)<c&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const c=t.lng-r.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,c){const f=Math.ceil(15*r/1e3),m=[],y=t(c.clone());for(let S=0;S<=f;S++){const I=y(S/f);m.push(I.clone())}return m}_preloadTiles(t,r){}}class _u{constructor(t={}){this.options=t,s.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ct("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const f=ct("span","mapboxgl-ctrl-icon",this._compactButton);return f.setAttribute("aria-hidden","true"),f.setAttribute("title",c),this._innerContainer=ct("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const c=r.reduce((f,m,y)=>(m.value&&(f+=`${m.key}=${m.value}${y<r.length-1?"&":""}`),f),"?");t.href=`${s.e.FEEDBACK_URL}/${c}#${Xs(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const r=this._map.style._mergedSourceCaches;for(const f in r){const m=r[f];if(m.used){const y=m.getSource();y.attribution&&t.indexOf(y.attribution)<0&&t.push(y.attribution)}}t.sort((f,m)=>f.length-m.length),t=t.filter((f,m)=>{for(let y=m+1;y<t.length;y++)if(t[y].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Qh{constructor(){s.aJ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ct("div","mapboxgl-ctrl");const r=ct("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const c=t[r].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class np{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Wl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=s.cw((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,c){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+c}}const n_={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class s_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ed{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const{type:c,filter:f}=r;if(f){const y=s.M(f,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(y.result==="error")throw new Error(y.value.map(S=>`${S.key}: ${S.message}`).join(", "));this.filters.set(t,y.value)}const m=this.interactionsByType.get(c)||new Map;m.size===0&&(this.map.on(c,this.handleType),this.interactionsByType.set(c,m)),m.set(t,r),this.typeById.set(t,c)}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(r);c&&(c.delete(t),c.size===0&&this.map.off(r,this.handleType))}handleType(t){const r=t.features||this.map.queryRenderedFeatures(t.point);if(!r)return;const c=this.interactionsByType.get(t.type),f={zoom:0};for(const[m,y]of c){const S=this.filters.get(m),{handler:I,layers:P}=y;for(const L of r)if((!P||P.includes(L.layer.id))&&(!S||S.evaluate(f,L))&&I({id:m,feature:L,interaction:y})!==!1)break}}}const td={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Xl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Va{constructor(t,r,c=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new hu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new du({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),Rt()}move(t,r){const c=this.map,f=this.mouseRotate.mousemoveWindow(t,r),m=f&&f.bearingDelta;if(m&&c.setBearing(c.getBearing()+m),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,r),S=y&&y.pitchDelta;S&&c.setPitch(c.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){yi(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),lr(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,lr(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Sr(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Sr(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Bs(l,t,r){if(l=new s.bK(l.lng,l.lat),t){const c=new s.bK(l.lng-360,l.lat),f=new s.bK(l.lng+360,l.lat),m=360*Math.ceil(Math.abs(l.lng-r.center.lng)/360),y=r.locationPoint(l).distSqr(t),S=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint(c).distSqr(t)<y&&(S||Math.abs(c.lng-r.center.lng)<m)?l=c:r.locationPoint(f).distSqr(t)<y&&(S||Math.abs(f.lng-r.center.lng)<m)&&(l=f)}for(;Math.abs(l.lng-r.center.lng)>180;){const c=r.locationPoint(l);if(c.x>=0&&c.y>=0&&c.x<=r.width&&c.y<=r.height)break;l.lng>r.center.lng?l.lng-=360:l.lng+=360}return l}const Yn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Fs extends s.E{constructor(t,r){if(super(),(t instanceof HTMLElement||r)&&(t=s.l({element:t},r)),s.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ct("div");const m=41,y=27,S=St("svg",{display:"block",height:m*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${m}`},this._element),I=St("radialGradient",{id:"shadowGradient"},St("defs",{},S));St("stop",{offset:"10%","stop-opacity":.4},I),St("stop",{offset:"100%","stop-opacity":.05},I),St("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),St("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),St("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),St("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=s.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const c=this._element.classList;for(const m in Yn)c.remove(`mapboxgl-marker-anchor-${m}`);c.add(`mapboxgl-marker-anchor-${this._anchor}`);const f=t&&t.className?t.className.trim().split(/\s+/):[];c.add(...f),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.bK.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,c=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,c=this._element;this._popup&&(r===c||c.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const c=t.unproject(r),f=t.getFreeCameraOptions();if(!f.position)return!1;const m=f.position.toLngLat();return m.distanceTo(c)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(r);let f;t._showingGlobe()&&s.dz(t.transform,this._lngLat)?f=0:(f=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Yn[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,c=this.getPitchAlignment();if(!r||!t||c!=="map")return"";if(!r._showingGlobe()){const I=r.getPitch();return I?`rotateX(${I}deg)`:""}const f=s.c0(s.dA(r.transform,this._lngLat)),m=t.sub(s.dB(r.transform)),y=Math.abs(m.x)+Math.abs(m.y);if(y===0)return"";const S=f/y;return`rotateX(${-m.y*S}deg) rotateY(${m.x*S}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let c=0;const f=this.getRotationAlignment();if(f==="map")if(r._showingGlobe()){const m=r.project(new s.bK(this._lngLat.lng,this._lngLat.lat+.001)),y=r.project(new s.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(m);c=s.c0(Math.atan2(y.y,y.x))-90}else c=-r.getBearing();else if(f==="horizon"){const m=s.a7(4,6,r.getZoom()),y=s.dB(r.transform);y.y+=m*r.transform.height;const S=t.sub(y),I=s.c0(Math.atan2(S.y,S.x));c=(I>90?I-270:I+90)*(1-m)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=Bs(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const c=this._pointerdownPos,f=this._positionDelta;if(c&&f){if(!this._isDragging){const m=this._clickTolerance||r._clickTolerance;if(t.point.dist(c)<m)return;this._isDragging=!0}this._pos=t.point.sub(f),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.x("dragstart"))),this.fire(new s.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.x("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,c=this._pos;r&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Yo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},To={maxWidth:100,unit:"metric"},o_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},a_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},l_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sp(l=new s.P(0,0),t="bottom"){if(typeof l=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new s.P(0,l);case"top-left":return new s.P(r,r);case"top-right":return new s.P(-r,r);case"bottom":return new s.P(0,-l);case"bottom-left":return new s.P(r,-r);case"bottom-right":return new s.P(-r,-r);case"left":return new s.P(l,0);case"right":return new s.P(-l,0)}return new s.P(0,0)}return l instanceof s.P||Array.isArray(l)?s.P.convert(l):s.P.convert(l[t]||[0,0])}return{version:ce,supported:et.supported,setRTLTextPlugin:s.dC,getRTLTextPluginStatus:s.dD,Map:class extends Jh{constructor(l){me.mark(pe.create);const t=l;if((l=s.l({},td,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&s.dx(window)&&(l.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cc(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new np,this._domRenderTaskQueue=new np,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aP(),this._locale=s.l({},n_,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Wl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new hs(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?{...l.contextCreateOptions}:{},typeof l.container=="string"){const r=document.getElementById(l.container);if(!r)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=r}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),s.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new s_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new yn(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||s.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),l.hash&&(this._hash=new bo(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const r=l.bounds;r&&(this.resize(),this.fitBounds(r,s.l({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new _u({customAttribution:l.customAttribution})),this._logoControl=new Qh,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new s.x(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new s.x(`${r.dataType}dataloading`,r))}),this._interactions=new ed(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new s.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new s.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.x("movestart",l)).fire(new s.x("move",l)),this.fire(new s.x("resize",l)),t&&this.fire(new s.x("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(s.as.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let r;t==="globe"&&l.zoom>=s.bU?(l.setMercatorFromTransition(),r=!0):t==="mercator"&&l.zoom<s.bU&&(l.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;return t=l.name==="globe"&&this.transform.zoom>=s.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l){return this.transform.locationPoint3D(s.bK.convert(l))}unproject(l){return this.transform.pointLocation3D(s.P.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,r){if(l==="mouseenter"||l==="mouseover"){let c=!1;const f=y=>{const S=t.filter(P=>this.getLayer(P)),I=S.length?this.queryRenderedFeatures(y.point,{layers:S}):[];I.length?c||(c=!0,r.call(this,new Tn(l,this,y.originalEvent,{features:I}))):c=!1},m=()=>{c=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:f,mouseout:m}}}if(l==="mouseleave"||l==="mouseout"){let c=!1;const f=y=>{const S=t.filter(I=>this.getLayer(I));(S.length?this.queryRenderedFeatures(y.point,{layers:S}):[]).length?c=!0:c&&(c=!1,r.call(this,new Tn(l,this,y.originalEvent)))},m=y=>{c&&(c=!1,r.call(this,new Tn(l,this,y.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:f,mouseout:m}}}{const c=f=>{const m=t.filter(S=>this.getLayer(S)),y=m.length?this.queryRenderedFeatures(f.point,{layers:m}):[];y.length&&(f.features=y,r.call(this,f),delete f.features)};return{layers:new Set(t),listener:r,delegates:{[l]:c}}}}on(l,t,r){if(typeof t=="function"||r===void 0)return super.on(l,t);if(Array.isArray(t)||(t=[t]),t){for(const f of t)if(!this._isValidId(f))return this}const c=this._createDelegatedListener(l,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const f in c.delegates)this.on(f,c.delegates[f]);return this}once(l,t,r){if(typeof t=="function"||r===void 0)return super.once(l,t);if(Array.isArray(t)||(t=[t]),t){for(const f of t)if(!this._isValidId(f))return this}const c=this._createDelegatedListener(l,t,r);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(l,t,r){if(typeof t=="function"||r===void 0)return super.off(l,t);const c=new Set(Array.isArray(t)?t:[t]);for(const y of c)if(!this._isValidId(y))return this;const f=(y,S)=>{if(y.size!==S.size)return!1;for(const I of y)if(!S.has(I))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[l]:void 0;return m&&(y=>{for(let S=0;S<y.length;S++){const I=y[S];if(I.listener===r&&f(I.layers,c)){for(const P in I.delegates)this.off(P,I.delegates[P]);return y.splice(S,1),this}}})(m),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(t!==void 0||l===void 0||l instanceof s.P||Array.isArray(l)||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(const r of t.layers)if(!this._isValidId(r))return[]}return this.style.queryRenderedFeatures(l,t,this.transform)}querySourceFeatures(l,t){return this._isValidId(l)?this.style.querySourceFeatures(l,t):[]}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}setStyle(l,t){return t=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(r,c)=>{r?(s.w(`Unable to perform style diff: ${String(r.message||r.error||r)}. Rebuilding the style from scratch.`),this._updateStyle(l,t)):c&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const r=s.l({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Wn(this,r).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new s.t(new Error("IDs can't be empty."))),!1):!s.cn(l)||(this.fire(new s.t(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,r)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:r=1,sdf:c=!1,stretchX:f,stretchY:m,content:y}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:S,height:I,data:P}=s.q.getImageData(t);this.style.addImage(l,{data:new s.r({width:S,height:I},P),pixelRatio:r,stretchX:f,stretchY:m,content:y,sdf:c,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new s.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:I}=t,P=t;this.style.addImage(l,{data:new s.r({width:S,height:I},new Uint8Array(P.data)),pixelRatio:r,stretchX:f,stretchY:m,content:y,sdf:c,version:0,userImage:P}),P.onAdd&&P.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const r=this.style.getImage(l);if(!r)return void this.fire(new s.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:f,height:m,data:y}=c;if(f===void 0||m===void 0)return void this.fire(new s.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==r.data.width||m!==r.data.height)return void this.fire(new s.t(new Error(`The width and height of the updated image (${f}, ${m})
                must be that same as the previous version of the image
                (${r.data.width}, ${r.data.height})`)));const S=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);r.data.replace(y,S),this.style.updateImage(l,r)}hasImage(l){return l?!!this.style&&!!this.style.getImage(l):(this.fire(new s.t(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){s.o(this._requestManager.transformRequest(l,s.R.Image),(r,c)=>{t(r,c instanceof HTMLImageElement?s.q.getImageData(c):c)})}listImages(){return this.style.listImages()}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new s.t(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,r){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,r),this._update(!0)):this}setFilter(l,t,r={}){return this._isValidId(l)?(this.style.setFilter(l,t,r),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,r,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,r,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,r,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,r,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,r){return this.style.setConfigProperty(l,t,r),this._update(!0)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bK.convert(l),this.transform):0}setFeatureState(l,t){return this._isValidId(l.source)?(this.style.setFeatureState(l,t),this._update()):this}removeFeatureState(l,t){return this._isValidId(l.source)?(this.style.removeFeatureState(l,t),this._update()):this}getFeatureState(l){return this._isValidId(l.source)?this.style.getFeatureState(l):null}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,c,f,m=this._container;for(;m&&(!c||!f);){const y=window.getComputedStyle(m).transform;y&&y!=="none"&&(r=y.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(c=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(f=r[3])),m=m.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=f?Math.abs(t/f):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=ct("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ct("div","mapboxgl-canvas-container",l);this._canvas=ct("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=ct("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(f=>{c[f]=ct("div",`mapboxgl-ctrl-${f}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const r=s.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(l),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=s.l({},et.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(Ae(t,!0),this.painter=new Uh(t,this._contextCreateOptions,this.transform,this._tp),this.on("data",r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(t)):this.fire(new s.t(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.x("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new s.x("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new s.x("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,c=s.q.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=f.createQuery(),f.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const m=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,L=this.transform.pitch,k=s.q.now(),B=new s.a3(P,{now:k,fadeDuration:m,pitch:L,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(c),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(c);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,this.painter.replacementSource);if(S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,me.mark(pe.load),this.fire(new s.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const P=s.q.now()-c;f.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const L=f.getQueryParameter(t,f.QUERY_RESULT)/1e6;f.deleteQuery(t),this.fire(new s.x("gpu-timing-frame",{cpuTime:P,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(P);this.fire(new s.x("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(P);this.fire(new s.x("gpu-timing-deferred-render",{gpuTime:L}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(I||this._repaint)this.triggerRepaint();else{const P=this.idle();if(P&&(y=this._updateAverageElevation(c,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new s.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new s.x("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,me.mark(pe.fullLoad),this._performanceMetricsCollection&&jt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const r=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const f=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=l;const y=Math.abs(f-m);if(y>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(m),r(m);this._averageElevation.easeTo(m,l,300)}else if(y>1e-4)return this._averageElevation.jumpTo(m),r(m)}return!!this._averageElevation.isEasing(l)&&r(this._averageElevation.getValue(l))}_authenticate(){ge(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===Cn||l.status===401)){const t=this.painter.context.gl;Ae(t,!1),this._logoControl instanceof Qh&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Is(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ht(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,c=r.createFramebuffer();function f(m){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,m,0);const y=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,y),y}return r.bindFramebuffer(r.FRAMEBUFFER,c),this._canvasPixelComparison(f(l),t.canvasCopies.map(f),t.timeStamps)}_canvasPixelComparison(l,t,r){let c=r[1]-r[0];const f=l.length/4;for(let m=0;m<t.length;m++){const y=t[m];let S=0;for(let I=0;I<y.length;I+=4)y[I]===l[I]&&y[I+1]===l[I+1]&&y[I+2]===l[I+2]&&y[I+3]===l[I+3]&&(S+=1);c+=(r[m+2]-r[m+1])*(1-S/f)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),nr.delete(this.painter.context.gl),ni.remove(),Jt.remove(),this._removed=!0,this.fire(new s.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return s.bf(t,(r,c)=>r._preloadTiles(l,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){s.dy(l,t)}get version(){return ce}},NavigationControl:class{constructor(l={}){this.options=s.l({},Xl,l),this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ct("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ct("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=ct("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),r=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Va(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const r=ct("button",l,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(l,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",r),l.firstElementChild&&l.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends s.E{constructor(l={}){super();const t=navigator.geolocation;this.options=s.l({geolocation:t},Yo,l),s.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ws(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,l(r)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(r=>t(r.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),r=l.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.x("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("geolocate",l)),this._finish()}}_updateCamera(l){const t=new s.bK(l.coords.longitude,l.coords.latitude),r=l.coords.accuracy,c=this._map.getBearing(),f=s.l({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),f,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new s.bK(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=s.bD(1,l._center.lat)*l.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ct("button","mapboxgl-ctrl-geolocate",this._container),ct("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ct("div","mapboxgl-user-location"),this._dotElement.appendChild(ct("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ct("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Fs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ct("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.x("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_u,ScaleControl:class{constructor(l={}){this.options=s.l({},To,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,c=t._containerWidth/2-l/2,f=t.unproject([c,r]),m=t.unproject([c+l,r]),y=f.distanceTo(m);if(this.options.unit==="imperial"){const S=3.2808*y;S>5280?this._setScale(l,S/5280,"mile"):this._setScale(l,S,"foot")}else this.options.unit==="nautical"?this._setScale(l,y/1852,"nautical-mile"):y>=1e3?this._setScale(l,y/1e3,"kilometer"):this._setScale(l,y,"meter")}_setScale(l,t,r){this._map._requestDomTask(()=>{const c=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let S=m/y;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(I){const P=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*P)/P}(S),y*S}(t),f=c/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(c):`${c}&nbsp;${o_[r]}`,this._container.style.width=l*f+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:s.w("Full screen control 'container' must be a DOM element.")),s.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=ct("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ct("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(l){super(),this.options=s.l(Object.create(a_),l),s.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new s.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new s.x("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=s.bK.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=l;c=r.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ct("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const r=this._closeButton=ct("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.setAttribute("aria-hidden","true"),r.innerHTML="&#215;",r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,c=this._pos;if(!t||!r||!c)return"bottom";const f=r.offsetWidth,m=r.offsetHeight,y=c.x<f/2,S=c.x>t.transform.width-f/2;if(c.y+l<m)return y?"top-left":S?"top-right":"top";if(c.y>t.transform.height-m){if(y)return"bottom-left";if(S)return"bottom-right"}return y?"left":S?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let c=this._container;if(c||(c=this._container=ct("div","mapboxgl-popup",t.getContainer()),this._tip=ct("div","mapboxgl-popup-tip",c),c.appendChild(r)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bs(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const f=this._pos=this._trackPointer&&l instanceof s.P?l:t.project(this._lngLat),m=sp(this.options.offset),y=this._anchor=this._getAnchor(m.y),S=sp(this.options.offset,y),I=f.add(S).round();t._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${Yn[y]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&t._showingGlobe()){const f=s.dz(t.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(l_);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:Fs,Style:Wn,LngLat:s.bK,LngLatBounds:s.as,Point:s.P,MercatorCoordinate:s.a5,FreeCameraOptions:po,Evented:s.E,config:s.e,prewarm:s.dE,clearPrewarmedResources:s.dF,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(l){s.e.ACCESS_TOKEN=l},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(l){s.e.API_URL=l},get workerCount(){return s.dG.workerCount},set workerCount(l){s.dG.workerCount=l},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){s.dH(l)},get workerUrl(){return s.dI.workerUrl},set workerUrl(l){s.dI.workerUrl=l},get workerClass(){return s.dI.workerClass},set workerClass(l){s.dI.workerClass=l},get workerParams(){return s.dI.workerParams},set workerParams(l){s.dI.workerParams=l},get dracoUrl(){return s.dJ()},set dracoUrl(l){s.dK(l)},get meshoptUrl(){return s.dL()},set meshoptUrl(l){s.dM(l)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var K=U;return K})})(Hw);var pP=Hw.exports;const ko=Zw(pP);var Wu=_P,mP=Object.prototype.hasOwnProperty;function _P(){for(var d={},g=0;g<arguments.length;g++){var M=arguments[g];for(var R in M)mP.call(M,R)&&(d[R]=M[R])}return d}var Xw={exports:{}};(function(d,g){(function(){var M={};d.exports=M,M.simpleFilter=function(R,O){return O.filter(function(U){return M.test(R,U)})},M.test=function(R,O){return M.match(R,O)!==null},M.match=function(R,O,U){U=U||{};var $=0,K=[],s=O.length,ce=0,pe=0,me=U.pre||"",ke=U.post||"",qe=U.caseSensitive&&O||O.toLowerCase(),it;R=U.caseSensitive&&R||R.toLowerCase();for(var et=0;et<s;et++)it=O[et],qe[et]===R[$]?(it=me+it+ke,$+=1,pe+=1+pe):pe=0,ce+=pe,K[K.length]=it;return $===R.length?(ce=qe===R?1/0:ce,{rendered:K.join(""),score:ce}):null},M.filter=function(R,O,U){return!O||O.length===0?[]:typeof R!="string"?O:(U=U||{},O.reduce(function($,K,s,ce){var pe=K;U.extract&&(pe=U.extract(K));var me=M.match(R,pe,U);return me!=null&&($[$.length]={string:me.rendered,score:me.score,index:s,original:K}),$},[]).sort(function($,K){var s=K.score-$.score;return s||$.index-K.index}))}})()})(Xw);var gP=Xw.exports,us=function(d){return this.component=d,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,d.el.parentNode.insertBefore(this.wrapper,d.el.nextSibling),this};us.prototype.show=function(){this.element.style.display="block"};us.prototype.hide=function(){this.element.style.display="none"};us.prototype.add=function(d){this.items.push(d)};us.prototype.clear=function(){this.items=[],this.active=0};us.prototype.isEmpty=function(){return!this.items.length};us.prototype.isVisible=function(){return this.element.style.display==="block"};us.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var d=0;d<this.items.length;d++)this.drawItem(this.items[d],this.active===d);this.show()};us.prototype.drawItem=function(d,g){var M=document.createElement("li"),R=document.createElement("a");g&&(M.className+=" active"),R.innerHTML=d.string,M.appendChild(R),this.element.appendChild(M),M.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),M.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,d)}).bind(this))};us.prototype.handleMouseUp=function(d){this.selectingListItem=!1,this.component.value(d.original),this.clear(),this.draw()};us.prototype.move=function(d){this.active=d,this.draw()};us.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};us.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};us.prototype.drawError=function(d){var g=document.createElement("li");g.innerHTML=d,this.element.appendChild(g),this.show()};var yP=us,xP=Wu,vP=gP,bP=yP,jn=function(d,g,M){return M=M||{},this.options=xP({minLength:2,limit:5,filter:!0,hideOnBlur:!0},M),this.el=d,this.data=g||[],this.list=new bP(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(R){this.handleKeyUp(R.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(R){this.handleKeyDown(R)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(R){this.handlePaste(R)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};jn.prototype.handleKeyUp=function(d){d===40||d===38||d===27||d===13||d===9||this.handleInputChange(this.el.value)};jn.prototype.handleKeyDown=function(d){switch(d.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&d.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};jn.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};jn.prototype.handlePaste=function(d){if(d.clipboardData)this.handleInputChange(d.clipboardData.getData("Text"));else{var g=this;setTimeout(function(){g.handleInputChange(d.target.value)},100)}};jn.prototype.handleInputChange=function(d){if(this.query=this.normalize(d),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(g){for(var M=0;M<g.length&&(this.list.add(g[M]),M!==this.options.limit-1);M++);this.list.draw()}).bind(this))};jn.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};jn.prototype.update=function(d){this.data=d,this.handleKeyUp()};jn.prototype.clear=function(){this.data=[],this.list.clear()};jn.prototype.normalize=function(d){return d=d.toLowerCase(),d};jn.prototype.match=function(d,g){return d.indexOf(g)>-1};jn.prototype.value=function(d){if(this.selected=d,this.el.value=this.getItemValue(d),document.createEvent){var g=document.createEvent("HTMLEvents");g.initEvent("change",!0,!1),this.el.dispatchEvent(g)}else this.el.fireEvent("onchange")};jn.prototype.getCandidates=function(d){var g={pre:"<strong>",post:"</strong>",extract:(function(R){return this.getItemValue(R)}).bind(this)},M;this.options.filter?(M=vP.filter(this.query,this.data,g),M=M.map((function(R){return{original:R.original,string:this.render(R.original,R.string)}}).bind(this))):M=this.data.map((function(R){var O=this.render(R);return{original:R,string:O}}).bind(this)),d(M)};jn.prototype.getItemValue=function(d){return d};jn.prototype.render=function(d,g){if(g)return g;for(var M=d.original?this.getItemValue(d.original):this.getItemValue(d),R=this.normalize(M),O=R.lastIndexOf(this.query);O>-1;){var U=O+this.query.length;M=M.slice(0,O)+"<strong>"+M.slice(O,U)+"</strong>"+M.slice(U),O=R.slice(0,O).lastIndexOf(this.query)}return M};jn.prototype.renderError=function(d){this.list.drawError(d)};var wP=jn,Yw=wP,TP=Yw;typeof window<"u"&&(window.Suggestions=Yw);var EP="Expected a function",rb=NaN,SP="[object Symbol]",MP=/^\s+|\s+$/g,AP=/^[-+]0x[0-9a-f]+$/i,IP=/^0b[01]+$/i,CP=/^0o[0-7]+$/i,PP=parseInt,RP=typeof so=="object"&&so&&so.Object===Object&&so,LP=typeof self=="object"&&self&&self.Object===Object&&self,DP=RP||LP||Function("return this")(),zP=Object.prototype,kP=zP.toString,OP=Math.max,BP=Math.min,Bg=function(){return DP.Date.now()};function FP(d,g,M){var R,O,U,$,K,s,ce=0,pe=!1,me=!1,ke=!0;if(typeof d!="function")throw new TypeError(EP);g=nb(g)||0,oy(M)&&(pe=!!M.leading,me="maxWait"in M,U=me?OP(nb(M.maxWait)||0,g):U,ke="trailing"in M?!!M.trailing:ke);function qe(yi){var Ti=R,kt=O;return R=O=void 0,ce=yi,$=d.apply(kt,Ti),$}function it(yi){return ce=yi,K=setTimeout(St,g),pe?qe(yi):$}function et(yi){var Ti=yi-s,kt=yi-ce,lr=g-Ti;return me?BP(lr,U-kt):lr}function ct(yi){var Ti=yi-s,kt=yi-ce;return s===void 0||Ti>=g||Ti<0||me&&kt>=U}function St(){var yi=Bg();if(ct(yi))return _t(yi);K=setTimeout(St,et(yi))}function _t(yi){return K=void 0,ke&&R?qe(yi):(R=O=void 0,$)}function zt(){K!==void 0&&clearTimeout(K),ce=0,R=s=O=K=void 0}function Gt(){return K===void 0?$:_t(Bg())}function Rt(){var yi=Bg(),Ti=ct(yi);if(R=arguments,O=this,s=yi,Ti){if(K===void 0)return it(s);if(me)return K=setTimeout(St,g),qe(s)}return K===void 0&&(K=setTimeout(St,g)),$}return Rt.cancel=zt,Rt.flush=Gt,Rt}function oy(d){var g=typeof d;return!!d&&(g=="object"||g=="function")}function NP(d){return!!d&&typeof d=="object"}function VP(d){return typeof d=="symbol"||NP(d)&&kP.call(d)==SP}function nb(d){if(typeof d=="number")return d;if(VP(d))return rb;if(oy(d)){var g=typeof d.valueOf=="function"?d.valueOf():d;d=oy(g)?g+"":g}if(typeof d!="string")return d===0?d:+d;d=d.replace(MP,"");var M=IP.test(d);return M||CP.test(d)?PP(d.slice(2),M?2:8):AP.test(d)?rb:+d}var UP=FP,ky={exports:{}},Uu=typeof Reflect=="object"?Reflect:null,sb=Uu&&typeof Uu.apply=="function"?Uu.apply:function(g,M,R){return Function.prototype.apply.call(g,M,R)},sm;Uu&&typeof Uu.ownKeys=="function"?sm=Uu.ownKeys:Object.getOwnPropertySymbols?sm=function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:sm=function(g){return Object.getOwnPropertyNames(g)};function jP(d){console&&console.warn&&console.warn(d)}var Kw=Number.isNaN||function(g){return g!==g};function Er(){Er.init.call(this)}ky.exports=Er;ky.exports.once=ZP;Er.EventEmitter=Er;Er.prototype._events=void 0;Er.prototype._eventsCount=0;Er.prototype._maxListeners=void 0;var ob=10;function Im(d){if(typeof d!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof d)}Object.defineProperty(Er,"defaultMaxListeners",{enumerable:!0,get:function(){return ob},set:function(d){if(typeof d!="number"||d<0||Kw(d))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+d+".");ob=d}});Er.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Er.prototype.setMaxListeners=function(g){if(typeof g!="number"||g<0||Kw(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this};function Jw(d){return d._maxListeners===void 0?Er.defaultMaxListeners:d._maxListeners}Er.prototype.getMaxListeners=function(){return Jw(this)};Er.prototype.emit=function(g){for(var M=[],R=1;R<arguments.length;R++)M.push(arguments[R]);var O=g==="error",U=this._events;if(U!==void 0)O=O&&U.error===void 0;else if(!O)return!1;if(O){var $;if(M.length>0&&($=M[0]),$ instanceof Error)throw $;var K=new Error("Unhandled error."+($?" ("+$.message+")":""));throw K.context=$,K}var s=U[g];if(s===void 0)return!1;if(typeof s=="function")sb(s,this,M);else for(var ce=s.length,pe=rT(s,ce),R=0;R<ce;++R)sb(pe[R],this,M);return!0};function Qw(d,g,M,R){var O,U,$;if(Im(M),U=d._events,U===void 0?(U=d._events=Object.create(null),d._eventsCount=0):(U.newListener!==void 0&&(d.emit("newListener",g,M.listener?M.listener:M),U=d._events),$=U[g]),$===void 0)$=U[g]=M,++d._eventsCount;else if(typeof $=="function"?$=U[g]=R?[M,$]:[$,M]:R?$.unshift(M):$.push(M),O=Jw(d),O>0&&$.length>O&&!$.warned){$.warned=!0;var K=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");K.name="MaxListenersExceededWarning",K.emitter=d,K.type=g,K.count=$.length,jP(K)}return d}Er.prototype.addListener=function(g,M){return Qw(this,g,M,!1)};Er.prototype.on=Er.prototype.addListener;Er.prototype.prependListener=function(g,M){return Qw(this,g,M,!0)};function GP(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function eT(d,g,M){var R={fired:!1,wrapFn:void 0,target:d,type:g,listener:M},O=GP.bind(R);return O.listener=M,R.wrapFn=O,O}Er.prototype.once=function(g,M){return Im(M),this.on(g,eT(this,g,M)),this};Er.prototype.prependOnceListener=function(g,M){return Im(M),this.prependListener(g,eT(this,g,M)),this};Er.prototype.removeListener=function(g,M){var R,O,U,$,K;if(Im(M),O=this._events,O===void 0)return this;if(R=O[g],R===void 0)return this;if(R===M||R.listener===M)--this._eventsCount===0?this._events=Object.create(null):(delete O[g],O.removeListener&&this.emit("removeListener",g,R.listener||M));else if(typeof R!="function"){for(U=-1,$=R.length-1;$>=0;$--)if(R[$]===M||R[$].listener===M){K=R[$].listener,U=$;break}if(U<0)return this;U===0?R.shift():qP(R,U),R.length===1&&(O[g]=R[0]),O.removeListener!==void 0&&this.emit("removeListener",g,K||M)}return this};Er.prototype.off=Er.prototype.removeListener;Er.prototype.removeAllListeners=function(g){var M,R,O;if(R=this._events,R===void 0)return this;if(R.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):R[g]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete R[g]),this;if(arguments.length===0){var U=Object.keys(R),$;for(O=0;O<U.length;++O)$=U[O],$!=="removeListener"&&this.removeAllListeners($);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(M=R[g],typeof M=="function")this.removeListener(g,M);else if(M!==void 0)for(O=M.length-1;O>=0;O--)this.removeListener(g,M[O]);return this};function tT(d,g,M){var R=d._events;if(R===void 0)return[];var O=R[g];return O===void 0?[]:typeof O=="function"?M?[O.listener||O]:[O]:M?$P(O):rT(O,O.length)}Er.prototype.listeners=function(g){return tT(this,g,!0)};Er.prototype.rawListeners=function(g){return tT(this,g,!1)};Er.listenerCount=function(d,g){return typeof d.listenerCount=="function"?d.listenerCount(g):iT.call(d,g)};Er.prototype.listenerCount=iT;function iT(d){var g=this._events;if(g!==void 0){var M=g[d];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}Er.prototype.eventNames=function(){return this._eventsCount>0?sm(this._events):[]};function rT(d,g){for(var M=new Array(g),R=0;R<g;++R)M[R]=d[R];return M}function qP(d,g){for(;g+1<d.length;g++)d[g]=d[g+1];d.pop()}function $P(d){for(var g=new Array(d.length),M=0;M<g.length;++M)g[M]=d[M].listener||d[M];return g}function ZP(d,g){return new Promise(function(M,R){function O($){d.removeListener(g,U),R($)}function U(){typeof d.removeListener=="function"&&d.removeListener("error",O),M([].slice.call(arguments))}nT(d,g,U,{once:!0}),g!=="error"&&HP(d,O,{once:!0})})}function HP(d,g,M){typeof d.on=="function"&&nT(d,"error",g,M)}function nT(d,g,M,R){if(typeof d.on=="function")R.once?d.once(g,M):d.on(g,M);else if(typeof d.addEventListener=="function")d.addEventListener(g,function O(U){R.once&&d.removeEventListener(g,O),M(U)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof d)}var WP=ky.exports,XP={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function YP(d){var g=d.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return g?{key:g[1],value:g[2]}:null}function KP(d){var g=d.match(/<?([^>]*)>(.*)/);if(!g)return null;var M=g[1],R=g[2].split(";"),O=null,U=R.reduce(function($,K){var s=YP(K);return s?s.key==="rel"?(O||(O=s.value),$):($[s.key]=s.value,$):$},{});return O?{url:M,rel:O,params:U}:null}function JP(d){return d?d.split(/,\s*</).reduce(function(g,M){var R=KP(M);if(!R)return g;var O=R.rel.split(/\s+/);return O.forEach(function(U){g[U]||(g[U]={url:R.url,params:R.params})}),g},{}):{}}var QP=JP,e4=QP;function Oy(d,g){this.request=d,this.headers=g.headers,this.rawBody=g.body,this.statusCode=g.statusCode;try{this.body=JSON.parse(g.body||"{}")}catch{this.body=g.body}this.links=e4(this.headers.link)}Oy.prototype.hasNextPage=function(){return!!this.links.next};Oy.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var t4=Oy,Cm={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},ab=Cm;function i4(d){var g=d.type||ab.ERROR_HTTP,M;if(d.body)try{M=JSON.parse(d.body)}catch{M=d.body}else M=null;var R=d.message||null;R||(typeof M=="string"?R=M:M&&typeof M.message=="string"?R=M.message:g===ab.ERROR_REQUEST_ABORTED&&(R="Request aborted")),this.message=R,this.type=g,this.statusCode=d.statusCode||null,this.request=d.request,this.body=M}var r4=i4;function n4(d){var g=d.indexOf(":"),M=d.substring(0,g).trim().toLowerCase(),R=d.substring(g+1).trim();return{name:M,value:R}}function s4(d){var g={};return d&&d.trim().split(/[\r|\n]+/).forEach(function(M){var R=n4(M);g[R.name]=R.value}),g}var o4=s4,a4=t4,lb=r4,Fg=Cm,l4=o4,dm={};function c4(d){var g=dm[d.id];g&&(g.abort(),delete dm[d.id])}function u4(d,g){return new a4(d,{body:g.response,headers:l4(g.getAllResponseHeaders()),statusCode:g.status})}function cb(d){var g=d.total,M=d.loaded,R=100*M/g;return{total:g,transferred:M,percent:R}}function sT(d,g){return new Promise(function(M,R){g.onprogress=function($){d.emitter.emit(Fg.EVENT_PROGRESS_DOWNLOAD,cb($))};var O=d.file;O&&(g.upload.onprogress=function($){d.emitter.emit(Fg.EVENT_PROGRESS_UPLOAD,cb($))}),g.onerror=function($){R($)},g.onabort=function(){var $=new lb({request:d,type:Fg.ERROR_REQUEST_ABORTED});R($)},g.onload=function(){if(delete dm[d.id],g.status<200||g.status>=400){var $=new lb({request:d,body:g.response,statusCode:g.status});R($);return}M(g)};var U=d.body;typeof U=="string"?g.send(U):U?g.send(JSON.stringify(U)):O?g.send(O):g.send(),dm[d.id]=g}).then(function(M){return u4(d,M)})}function oT(d,g){var M=d.url(g),R=new window.XMLHttpRequest;return R.open(d.method,M),Object.keys(d.headers).forEach(function(O){R.setRequestHeader(O,d.headers[O])}),R}function h4(d){return Promise.resolve().then(function(){var g=oT(d,d.client.accessToken);return sT(d,g)})}var d4={browserAbort:c4,sendRequestXhr:sT,browserSend:h4,createRequestXhr:oT},fm={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */fm.exports;(function(d,g){(function(M){var R=g,O=d&&d.exports==R&&d,U=typeof so=="object"&&so;(U.global===U||U.window===U)&&(M=U);var $=function(it){this.message=it};$.prototype=new Error,$.prototype.name="InvalidCharacterError";var K=function(it){throw new $(it)},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ce=/[\t\n\f\r ]/g,pe=function(it){it=String(it).replace(ce,"");var et=it.length;et%4==0&&(it=it.replace(/==?$/,""),et=it.length),(et%4==1||/[^+a-zA-Z0-9/]/.test(it))&&K("Invalid character: the string to be decoded is not correctly encoded.");for(var ct=0,St,_t,zt="",Gt=-1;++Gt<et;)_t=s.indexOf(it.charAt(Gt)),St=ct%4?St*64+_t:_t,ct++%4&&(zt+=String.fromCharCode(255&St>>(-2*ct&6)));return zt},me=function(it){it=String(it),/[^\0-\xFF]/.test(it)&&K("The string to be encoded contains characters outside of the Latin1 range.");for(var et=it.length%3,ct="",St=-1,_t,zt,Gt,Rt,yi=it.length-et;++St<yi;)_t=it.charCodeAt(St)<<16,zt=it.charCodeAt(++St)<<8,Gt=it.charCodeAt(++St),Rt=_t+zt+Gt,ct+=s.charAt(Rt>>18&63)+s.charAt(Rt>>12&63)+s.charAt(Rt>>6&63)+s.charAt(Rt&63);return et==2?(_t=it.charCodeAt(St)<<8,zt=it.charCodeAt(++St),Rt=_t+zt,ct+=s.charAt(Rt>>10)+s.charAt(Rt>>4&63)+s.charAt(Rt<<2&63)+"="):et==1&&(Rt=it.charCodeAt(St),ct+=s.charAt(Rt>>2)+s.charAt(Rt<<4&63)+"=="),ct},ke={encode:me,decode:pe,version:"0.1.0"};if(R&&!R.nodeType)if(O)O.exports=ke;else for(var qe in ke)ke.hasOwnProperty(qe)&&(R[qe]=ke[qe]);else M.base64=ke})(so)})(fm,fm.exports);var f4=fm.exports,p4=f4,Ng={};function m4(d){if(Ng[d])return Ng[d];var g=d.split("."),M=g[0],R=g[1];if(!R)throw new Error("Invalid token");var O=_4(R),U={usage:M,user:O.u};return ac(O,"a")&&(U.authorization=O.a),ac(O,"exp")&&(U.expires=O.exp*1e3),ac(O,"iat")&&(U.created=O.iat*1e3),ac(O,"scopes")&&(U.scopes=O.scopes),ac(O,"client")&&(U.client=O.client),ac(O,"ll")&&(U.lastLogin=O.ll),ac(O,"iu")&&(U.impersonator=O.iu),Ng[d]=U,U}function _4(d){try{return JSON.parse(p4.decode(d))}catch{throw new Error("Invalid token")}}function ac(d,g){return Object.prototype.hasOwnProperty.call(d,g)}var aT=m4,lT={exports:{}};(function(d){var g=Object.prototype.hasOwnProperty,M="~";function R(){}Object.create&&(R.prototype=Object.create(null),new R().__proto__||(M=!1));function O(s,ce,pe){this.fn=s,this.context=ce,this.once=pe||!1}function U(s,ce,pe,me,ke){if(typeof pe!="function")throw new TypeError("The listener must be a function");var qe=new O(pe,me||s,ke),it=M?M+ce:ce;return s._events[it]?s._events[it].fn?s._events[it]=[s._events[it],qe]:s._events[it].push(qe):(s._events[it]=qe,s._eventsCount++),s}function $(s,ce){--s._eventsCount===0?s._events=new R:delete s._events[ce]}function K(){this._events=new R,this._eventsCount=0}K.prototype.eventNames=function(){var ce=[],pe,me;if(this._eventsCount===0)return ce;for(me in pe=this._events)g.call(pe,me)&&ce.push(M?me.slice(1):me);return Object.getOwnPropertySymbols?ce.concat(Object.getOwnPropertySymbols(pe)):ce},K.prototype.listeners=function(ce){var pe=M?M+ce:ce,me=this._events[pe];if(!me)return[];if(me.fn)return[me.fn];for(var ke=0,qe=me.length,it=new Array(qe);ke<qe;ke++)it[ke]=me[ke].fn;return it},K.prototype.listenerCount=function(ce){var pe=M?M+ce:ce,me=this._events[pe];return me?me.fn?1:me.length:0},K.prototype.emit=function(ce,pe,me,ke,qe,it){var et=M?M+ce:ce;if(!this._events[et])return!1;var ct=this._events[et],St=arguments.length,_t,zt;if(ct.fn){switch(ct.once&&this.removeListener(ce,ct.fn,void 0,!0),St){case 1:return ct.fn.call(ct.context),!0;case 2:return ct.fn.call(ct.context,pe),!0;case 3:return ct.fn.call(ct.context,pe,me),!0;case 4:return ct.fn.call(ct.context,pe,me,ke),!0;case 5:return ct.fn.call(ct.context,pe,me,ke,qe),!0;case 6:return ct.fn.call(ct.context,pe,me,ke,qe,it),!0}for(zt=1,_t=new Array(St-1);zt<St;zt++)_t[zt-1]=arguments[zt];ct.fn.apply(ct.context,_t)}else{var Gt=ct.length,Rt;for(zt=0;zt<Gt;zt++)switch(ct[zt].once&&this.removeListener(ce,ct[zt].fn,void 0,!0),St){case 1:ct[zt].fn.call(ct[zt].context);break;case 2:ct[zt].fn.call(ct[zt].context,pe);break;case 3:ct[zt].fn.call(ct[zt].context,pe,me);break;case 4:ct[zt].fn.call(ct[zt].context,pe,me,ke);break;default:if(!_t)for(Rt=1,_t=new Array(St-1);Rt<St;Rt++)_t[Rt-1]=arguments[Rt];ct[zt].fn.apply(ct[zt].context,_t)}}return!0},K.prototype.on=function(ce,pe,me){return U(this,ce,pe,me,!1)},K.prototype.once=function(ce,pe,me){return U(this,ce,pe,me,!0)},K.prototype.removeListener=function(ce,pe,me,ke){var qe=M?M+ce:ce;if(!this._events[qe])return this;if(!pe)return $(this,qe),this;var it=this._events[qe];if(it.fn)it.fn===pe&&(!ke||it.once)&&(!me||it.context===me)&&$(this,qe);else{for(var et=0,ct=[],St=it.length;et<St;et++)(it[et].fn!==pe||ke&&!it[et].once||me&&it[et].context!==me)&&ct.push(it[et]);ct.length?this._events[qe]=ct.length===1?ct[0]:ct:$(this,qe)}return this},K.prototype.removeAllListeners=function(ce){var pe;return ce?(pe=M?M+ce:ce,this._events[pe]&&$(this,pe)):(this._events=new R,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=M,K.EventEmitter=K,d.exports=K})(lT);var g4=lT.exports;function y4(d){return d.map(encodeURIComponent).join(",")}function cT(d){return Array.isArray(d)?y4(d):encodeURIComponent(String(d))}function uT(d,g,M){if(M===!1||M===null)return d;var R=/\?/.test(d)?"&":"?",O=encodeURIComponent(g);return M!==void 0&&M!==""&&M!==!0&&(O+="="+cT(M)),""+d+R+O}function x4(d,g){if(!g)return d;var M=d;return Object.keys(g).forEach(function(R){var O=g[R];O!==void 0&&(Array.isArray(O)&&(O=O.filter(function(U){return U!=null}).join(",")),M=uT(M,R,O))}),M}function v4(d,g){if(!g||d.slice(0,4)==="http")return d;var M=d[0]==="/"?"":"/";return""+g.replace(/\/$/,"")+M+d}function b4(d,g){return g?d.replace(/\/:([a-zA-Z0-9]+)/g,function(M,R){var O=g[R];if(O===void 0)throw new Error("Unspecified route parameter "+R);var U=cT(O);return"/"+U}):d}var w4={appendQueryObject:x4,appendQueryParam:uT,prependOrigin:v4,interpolateRouteParams:b4},T4=aT,By=Wu,E4=g4,em=w4,ub=Cm,S4=1;function ul(d,g){if(!d)throw new Error("MapiRequest requires a client");if(!g||!g.path||!g.method)throw new Error("MapiRequest requires an options object with path and method properties");var M={};g.body&&(M["content-type"]="application/json");var R=By(M,g.headers),O=Object.keys(R).reduce(function(U,$){return U[$.toLowerCase()]=R[$],U},{});this.id=S4++,this._options=g,this.emitter=new E4,this.client=d,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=g.path,this.method=g.method,this.origin=g.origin||d.origin,this.query=g.query||{},this.params=g.params||{},this.body=g.body||null,this.file=g.file||null,this.encoding=g.encoding||"utf8",this.sendFileAs=g.sendFileAs||null,this.headers=O}ul.prototype.url=function(g){var M=em.prependOrigin(this.path,this.origin);M=em.appendQueryObject(M,this.query);var R=this.params,O=g??this.client.accessToken;if(O){M=em.appendQueryParam(M,"access_token",O);var U=T4(O).user;R=By({ownerId:U},R)}return M=em.interpolateRouteParams(M,R),M};ul.prototype.send=function(){var g=this;if(g.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return g.sent=!0,g.client.sendRequest(g).then(function(M){return g.response=M,g.emitter.emit(ub.EVENT_RESPONSE,M),M},function(M){throw g.error=M,g.emitter.emit(ub.EVENT_ERROR,M),M})};ul.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};ul.prototype.eachPage=function(g){var M=this;function R($){function K(){delete M._nextPageRequest;var s=$.nextPage();s&&(M._nextPageRequest=s,U(s))}g(null,$,K)}function O($){g($,null,function(){})}function U($){$.send().then(R,O)}U(this)};ul.prototype.clone=function(){return this._extend()};ul.prototype._extend=function(g){var M=By(this._options,g);return new ul(this.client,M)};var M4=ul,A4=aT,I4=M4,C4=Cm;function hT(d){if(!d||!d.accessToken)throw new Error("Cannot create a client without an access token");A4(d.accessToken),this.accessToken=d.accessToken,this.origin=d.origin||C4.API_ORIGIN}hT.prototype.createRequest=function(g){return new I4(this,g)};var dT=hT,fT=d4,pT=dT;function Zu(d){pT.call(this,d)}Zu.prototype=Object.create(pT.prototype);Zu.prototype.constructor=Zu;Zu.prototype.sendRequest=fT.browserSend;Zu.prototype.abortRequest=fT.browserAbort;function P4(d){return new Zu(d)}var mT=P4,R4=mT,L4=R4,D4=Object.prototype.toString,z4=function(d){var g;return D4.call(d)==="[object Object]"&&(g=Object.getPrototypeOf(d),g===null||g===Object.getPrototypeOf({}))},k4=z4,O4=Wu,_T="value",Vg=`
  `,kr={};kr.assert=function(d,g){return g=g||{},function(M){var R=hl(d,M);if(R){var O=Fy(R,g);throw g.apiName&&(O=g.apiName+": "+O),new Error(O)}}};kr.shape=function(g){var M=V4(g);return function(O){var U=hl(kr.plainObject,O);if(U)return U;for(var $,K,s=[],ce=0;ce<M.length;ce++)$=M[ce].key,K=M[ce].value,U=hl(K,O[$]),U&&s.push([$].concat(U));return s.length<2?s[0]:function(pe){s=s.map(function(qe){var it=qe[0],et=Fy(qe,pe).split(`
`).join(Vg);return"- "+it+": "+et});var me=pe.path.join("."),ke=me===_T?"":" of "+me;return"The following properties"+ke+" have invalid values:"+Vg+s.join(Vg)}}};kr.strictShape=function(g){var M=kr.shape(g);return function(O){var U=M(O);if(U)return U;var $=Object.keys(O).reduce(function(K,s){return g[s]===void 0&&K.push(s),K},[]);if($.length!==0)return function(){return"The following keys are invalid: "+$.join(", ")}}};kr.arrayOf=function(g){return gT(g)};kr.tuple=function(){var g=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return gT(g)};function gT(d){var g=Array.isArray(d),M=function(R){return g?d[R]:d};return function(O){var U=hl(kr.plainArray,O);if(U)return U;if(g&&O.length!==d.length)return"an array with "+d.length+" items";for(var $=0;$<O.length;$++)if(U=hl(M($),O[$]),U)return[$].concat(U)}}kr.required=function(g){function M(R){return R==null?function(O){return yT(O,xT(O.path)?"cannot be undefined/null.":"is required.")}:g.apply(this,arguments)}return M.__required=!0,M};kr.oneOfType=function(){var g=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(R){var O=g.map(function(U){return hl(U,R)}).filter(Boolean);if(O.length===g.length)return O.every(function(U){return U.length===1&&typeof U[0]=="string"})?B4(O.map(function(U){return U[0]})):O.reduce(function(U,$){return $.length>U.length?$:U})}};kr.equal=function(g){return function(R){if(R!==g)return JSON.stringify(g)}};kr.oneOf=function(){var g=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),M=g.map(function(R){return kr.equal(R)});return kr.oneOfType.apply(this,M)};kr.range=function(g){var M=g[0],R=g[1];return function(U){var $=hl(kr.number,U);if($||U<M||U>R)return"number between "+M+" & "+R+" (inclusive)"}};kr.any=function(){};kr.boolean=function(g){if(typeof g!="boolean")return"boolean"};kr.number=function(g){if(typeof g!="number")return"number"};kr.plainArray=function(g){if(!Array.isArray(g))return"array"};kr.plainObject=function(g){if(!k4(g))return"object"};kr.string=function(g){if(typeof g!="string")return"string"};kr.func=function(g){if(typeof g!="function")return"function"};function hl(d,g){if(!(g==null&&!d.hasOwnProperty("__required"))){var M=d(g);if(M)return Array.isArray(M)?M:[M]}}function Fy(d,g){var M=d.length,R=d[M-1],O=d.slice(0,M-1);return O.length===0&&(O=[_T]),g=O4(g,{path:O}),typeof R=="function"?R(g):yT(g,F4(R))}function B4(d){return d.length<2?d[0]:d.length===2?d.join(" or "):d.slice(0,-1).join(", ")+", or "+d.slice(-1)}function F4(d){return"must be "+N4(d)+"."}function N4(d){return/^an? /.test(d)?d:/^[aeiou]/i.test(d)?"an "+d:/^[a-z]/i.test(d)?"a "+d:d}function yT(d,g){var M=xT(d.path),R=d.path.join(".")+" "+g,O=M?"Item at position ":"";return O+R}function xT(d){return typeof d[d.length-1]=="number"||typeof d[0]=="number"}function V4(d){return Object.keys(d||{}).map(function(g){return{key:g,value:d[g]}})}kr.validate=hl;kr.processMessage=Fy;var U4=kr,j4=Wu,ju=U4;function G4(d){if(typeof window<"u")return d instanceof so.Blob||d instanceof so.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof d=="string"||d.pipe!==void 0))return"Filename or Readable stream"}function q4(d,g){return ju.assert(ju.strictShape(d),g)}function $4(d){var g="date";if(typeof d=="boolean")return g;try{var M=new Date(d);if(M.getTime&&isNaN(M.getTime()))return g}catch{return g}}function Z4(d){return ju.tuple(ju.number,ju.number)(d)}var H4=j4(ju,{file:G4,date:$4,coordinates:Z4,assertShape:q4});function W4(d,g){var M=function(R,O){return g.indexOf(R)!==-1&&O!==void 0};return typeof g=="function"&&(M=g),Object.keys(d).filter(function(R){return M(R,d[R])}).reduce(function(R,O){return R[O]=d[O],R},{})}var X4=W4;function Y4(d,g){return Object.keys(d).reduce(function(M,R){return M[R]=g(R,d[R]),M},{})}var K4=Y4,J4=K4;function Q4(d){return J4(d,function(g,M){return typeof M=="boolean"?JSON.stringify(M):M})}var eR=Q4,tR=dT,iR=mT;function rR(d){return function(g){var M;tR.prototype.isPrototypeOf(g)?M=g:M=iR(g);var R=Object.create(d);return R.client=M,R}}var nR=rR,vT=Wu,ir=H4,pm=X4,bT=eR,sR=nR,Ny={},wT=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Ny.forwardGeocode=function(d){ir.assertShape({query:ir.required(ir.string),mode:ir.oneOf("mapbox.places","mapbox.places-permanent"),countries:ir.arrayOf(ir.string),proximity:ir.oneOf(ir.coordinates,"ip"),types:ir.arrayOf(ir.oneOf(wT)),autocomplete:ir.boolean,bbox:ir.arrayOf(ir.number),limit:ir.number,language:ir.arrayOf(ir.string),routing:ir.boolean,fuzzyMatch:ir.boolean,worldview:ir.string,session_token:ir.string})(d),d.mode=d.mode||"mapbox.places";var g=bT(vT({country:d.countries},pm(d,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pm(d,["mode","query"]),query:g})};Ny.reverseGeocode=function(d){ir.assertShape({query:ir.required(ir.coordinates),mode:ir.oneOf("mapbox.places","mapbox.places-permanent"),countries:ir.arrayOf(ir.string),types:ir.arrayOf(ir.oneOf(wT)),bbox:ir.arrayOf(ir.number),limit:ir.number,language:ir.arrayOf(ir.string),reverseMode:ir.oneOf("distance","score"),routing:ir.boolean,worldview:ir.string,session_token:ir.string})(d),d.mode=d.mode||"mapbox.places";var g=bT(vT({country:d.countries},pm(d,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pm(d,["mode","query"]),query:g})};var oR=sR(Ny);let aR="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",TT=d=>crypto.getRandomValues(new Uint8Array(d)),ET=(d,g,M)=>{let R=(2<<Math.log(d.length-1)/Math.LN2)-1,O=-~(1.6*R*g/d.length);return(U=g)=>{let $="";for(;;){let K=M(O),s=O;for(;s--;)if($+=d[K[s]&R]||"",$.length===U)return $}}},lR=(d,g=21)=>ET(d,g,TT),cR=(d=21)=>crypto.getRandomValues(new Uint8Array(d)).reduce((g,M)=>(M&=63,M<36?g+=M.toString(36):M<62?g+=(M-26).toString(36).toUpperCase():M>62?g+="-":g+="_",g),"");const uR=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:lR,customRandom:ET,nanoid:cR,random:TT,urlAlphabet:aR},Symbol.toStringTag,{value:"Module"})),hR=fP(uR);var dR=hR.nanoid;function ST(d){this.origin=d.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=d.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=d,this.send=this.send.bind(this),this.countries=d.countries?d.countries.split(","):null,this.types=d.types?d.types.split(","):null,this.bbox=d.bbox?d.bbox:null,this.language=d.language?d.language.split(","):null,this.limit=d.limit?+d.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(d),this.eventQueue=new Array,this.flushInterval=d.flushInterval||1e3,this.maxQueueSize=d.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}ST.prototype={select:function(d,g){var M=this.getEventPayload("search.select",g,{selectedFeature:d});if(M&&!(M.resultIndex===this.lastSentIndex&&M.queryString===this.lastSentInput||M.resultIndex==-1))return this.lastSentIndex=M.resultIndex,this.lastSentInput=M.queryString,this.push(M)},start:function(d){var g=this.getEventPayload("search.start",d);if(g)return this.push(g)},keyevent:function(d,g){if(d.key&&!(d.metaKey||[9,27,37,39,13,38,40].indexOf(d.keyCode)!==-1)){var M=this.getEventPayload("search.keystroke",g,{key:d.key});if(M)return this.push(M)}},send:function(d,g){if(!this.enableEventLogging)return g?g():void 0;var M=this.getRequestOptions(d);this.request(M,(function(R){if(R)return this.handleError(R,g);if(g)return g()}).bind(this))},getRequestOptions:function(d){Array.isArray(d)||(d=[d]);var g={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)};return g},getEventPayload:function(d,g,M={}){if(d==="search.select"&&!M.selectedFeature||d==="search.keystroke"&&!M.key)return null;var R;if(!g.options.proximity)R=null;else if(typeof g.options.proximity=="object")R=[g.options.proximity.longitude,g.options.proximity.latitude];else if(g.options.proximity==="ip"){var O=g._headers?g._headers["ip-proximity"]:null;O&&typeof O=="string"?R=O.split(",").map(parseFloat):R=[999,999]}else R=g.options.proximity;var U=g._map?g._map.getZoom():void 0,$={event:d,version:this.getEventSchemaVersion(d),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:g.options.autocomplete,fuzzyMatch:g.options.fuzzyMatch,proximity:R,limit:g.options.limit,routing:g.options.routing,worldview:g.options.worldview,mapZoom:U,keyboardLocale:this.locale};if(d==="search.select"?$.queryString=g.inputString:d!="search.select"&&g._inputEl?$.queryString=g._inputEl.value:$.queryString=g.inputString,["search.keystroke","search.select"].includes(d)&&($.path="geocoding/v5/mapbox.places"),d==="search.keystroke"&&M.key)$.lastAction=M.key;else if(d==="search.select"&&M.selectedFeature){var K=M.selectedFeature,s=this.getSelectedIndex(K,g);if($.resultIndex=s,$.resultPlaceName=K.place_name,$.resultId=K.id,K.properties&&($.resultMapboxId=K.properties.mapbox_id),g._typeahead){var ce=g._typeahead.data;ce&&ce.length>0&&($.suggestionIds=this.getSuggestionIds(ce),$.suggestionNames=this.getSuggestionNames(ce),$.suggestionTypes=this.getSuggestionTypes(ce),$.suggestionSources=this.getSuggestionSources(ce))}}return this.validatePayload($)?$:null},request:function(d,g){var M=new XMLHttpRequest;M.onreadystatechange=function(){if(this.readyState==4)return this.status==204?g(null):g(this.statusText)},M.open(d.method,d.host+"/"+d.path,!0);for(var R in d.headers){var O=d.headers[R];M.setRequestHeader(R,O)}M.send(d.body)},handleError:function(d,g){if(g)return g(d)},generateSessionID:function(){return dR()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(d,g){if(g._typeahead){var M=g._typeahead.data,R=d.id,O=M.map(function($){return $.id}),U=O.indexOf(R);return U}},getSuggestionIds:function(d){return d.map(function(g){return g.properties?g.properties.mapbox_id||"":g.id||""})},getSuggestionNames:function(d){return d.map(function(g){return g.place_name||""})},getSuggestionTypes:function(d){return d.map(function(g){return g.place_type&&Array.isArray(g.place_type)&&g.place_type[0]||""})},getSuggestionSources:function(d){return d.map(function(g){return g._source||""})},getEventSchemaVersion:function(d){return["search.keystroke","search.select"].includes(d)?"2.2":"2.0"},validatePayload:function(d){if(!d||!d.event)return!1;var g=["event","created","sessionIdentifier","queryString"],M=["event","created","sessionIdentifier","queryString","lastAction"],R=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],O=d.event;return O==="search.start"?this.objectHasRequiredProps(d,g):O==="search.keystroke"?this.objectHasRequiredProps(d,M):O==="search.select"?this.objectHasRequiredProps(d,R):!0},objectHasRequiredProps:function(d,g){return g.every(function(M){return M==="queryString"?typeof d[M]=="string"&&d[M].length>0:d[M]!==void 0})},shouldEnableLogging:function(d){return!(d.enableEventLogging===!1||d.origin&&d.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(d,g){this.eventQueue.push(d),(this.eventQueue.length>=this.maxQueueSize||g)&&this.flush()},remove:function(){this.flush()}};var fR=ST,pR={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},mR={placeholder:pR},MT={exports:{}};(function(d){(function(g,M,R){d.exports?d.exports=R():g[M]=R()})(so,"subtag",function(){var g="",M=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function R(s){return s.match(M)||[]}function O(s){return R(s).filter(function(ce,pe){return ce&&pe})}function U(s){return s=R(s),{language:s[1]||g,extlang:s[2]||g,script:s[3]||g,region:s[4]||g}}function $(s,ce,pe){Object.defineProperty(s,ce,{value:pe,enumerable:!0})}function K(s,ce,pe){function me(ke){return R(ke)[s]||g}$(me,"pattern",ce),$(U,pe,me)}return K(1,/^[a-zA-Z]{2,3}$/,"language"),K(2,/^[a-zA-Z]{3}$/,"extlang"),K(3,/^[a-zA-Z]{4}$/,"script"),K(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),$(U,"split",O),U})})(MT);var _R=MT.exports;function AT(){}AT.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const d={enableHighAccuracy:!0};return new Promise(function(g,M){window.navigator.geolocation.getCurrentPosition(g,M,d)})}};var gR=AT;function yR(d,g){const M=IT(d),R=["address","street","place","country"];var O;if(typeof g=="function")return g(M);const U=R.indexOf(g);return U===-1?O=R:O=R.slice(U),O.reduce(function($,K){return M[K]?($!==""&&($=$+", "),$+M[K]):$},"")}function IT(d){const g=d.address||"",M=d.text||"",R=d.place_name||"",U={address:R.split(",")[0],houseNumber:g,street:M,placeName:R};return d.context.forEach(function($){const K=$.id.split(".")[0];U[K]=$.text}),U}const xR=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var vR={transformFeatureToGeolocationText:yR,getAddressInfo:IT,REVERSE_GEOCODE_COORD_RGX:xR},bR=TP,wR=UP,cc=Wu,TR=WP.EventEmitter,hb=XP,Ug=L4,jg=oR,ER=fR,SR=mR,MR=_R,AR=gR,db=vR;const il={FORWARD:0,LOCAL:1,REVERSE:2};function IR(){var d=document.createElement("div");return d.className="mapboxgl-ctrl-geocoder--powered-by",d.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',d}function CT(d){this._eventEmitter=new TR,this.options=cc({},this.options,d),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new AR}CT.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(d){return d.place_name},render:function(d){var g=d.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+g[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+g.splice(1,g.length).join(",")+"</div></div>"}},_headers:{},addTo:function(d){function g(M,R){if(!document.body.contains(R))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const O=M.onAdd();R.appendChild(O)}if(d._controlContainer)d.addControl(this);else if(d instanceof HTMLElement)g(this,d);else if(typeof d=="string"){const M=document.querySelectorAll(d);if(M.length===0)throw new Error("Element ",d,"not found.");if(M.length>1)throw new Error("Geocoder can only be added to a single html element");g(this,M[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(d){if(d&&typeof d!="string"&&(this._map=d),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=jg(Ug({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ER(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var g=this.container=document.createElement("div");g.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var M=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",wR(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(ce){this.eventManager.keyevent(ce,this)}).bind(this));var R=document.createElement("div");R.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var O=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(O),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),R.appendChild(this._clearEl),R.appendChild(this._loadingEl),g.appendChild(M),g.appendChild(this._inputEl),g.appendChild(R),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var U=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(U),R.appendChild(this._geolocateEl),this._showGeolocateButton()}var $=this._typeahead=new bR(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),$.getItemValue=this.options.getItemValue;var K=$.list.draw,s=this._footerNode=IR();return $.list.draw=function(){K.call(this),s.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),s.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(s)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),g},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(d){this._hideLoadingIcon();const g={geometry:{type:"Point",coordinates:[d.coords.longitude,d.coords.latitude]}};this._handleMarker(g),this._fly(g),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(g),this._showClearButton(),this.fresh=!1;const M={limit:1,language:[this.options.language],query:g.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const R=g.geometry.coordinates[0]+","+g.geometry.coordinates[1];this._setInputValue(R),this._eventEmitter.emit("result",{result:g})}else this.geocoderService.reverseGeocode(M).send().then((function(R){const O=R.body.features[0];if(O){const U=db.transformFeatureToGeolocationText(O,this.options.addressAccuracy);this._setInputValue(U),O.user_coordinates=g.geometry.coordinates,this._eventEmitter.emit("result",{result:O})}else this._eventEmitter.emit("result",{result:{user_coordinates:g.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(d){d.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(d,g){var M=document.createElementNS("http://www.w3.org/2000/svg","svg");return M.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+d),M.setAttribute("viewBox","0 0 18 18"),M.setAttribute("xml:space","preserve"),M.setAttribute("width",18),M.setAttribute("height",18),M.innerHTML=g,M},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(d){this._inputEl.value=d,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(d){var g=(d.clipboardData||window.clipboardData).getData("text");g.length>=this.options.minLength&&this._geocode(g)},_onKeyDown:function(d){var g=27,M=9;if(d.keyCode===g&&this.options.clearAndBlurOnEsc)return this._clear(d),this._inputEl.blur();var R=d.target&&d.target.shadowRoot?d.target.shadowRoot.activeElement:d.target,O=R?R.value:"";if(!O)return this.fresh=!0,d.keyCode!==M&&this.clear(d),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(d.metaKey||[M,g,37,39,13,38,40].indexOf(d.keyCode)!==-1)&&R.value.length>=this.options.minLength&&this._geocode(R.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(d){this.options.clearOnBlur&&this._clearOnBlur(d),this.options.collapsed&&this._collapse()},_onChange:function(){var d=this._typeahead.selected;d&&JSON.stringify(d)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(d),this.options.marker&&this._mapboxgl&&this._handleMarker(d),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(d),this._eventEmitter.emit("result",{result:d}),this.eventManager.select(d,this))},_fly:function(d){var g;if(d.properties&&hb[d.properties.short_code])g=cc({},this.options.flyTo),this._map&&this._map.fitBounds(hb[d.properties.short_code].bbox,g);else if(d.bbox){var M=d.bbox;g=cc({},this.options.flyTo),this._map&&this._map.fitBounds([[M[0],M[1]],[M[2],M[3]]],g)}else{var R={zoom:this.options.zoom};g=cc({},R,this.options.flyTo),d.center?g.center=d.center:d.geometry&&d.geometry.type&&d.geometry.type==="Point"&&d.geometry.coordinates&&(g.center=d.geometry.coordinates),this._map&&this._map.flyTo(g)}},_requestType:function(d,g){var M;return d.localGeocoderOnly?M=il.LOCAL:d.reverseGeocode&&db.REVERSE_GEOCODE_COORD_RGX.test(g)?M=il.REVERSE:M=il.FORWARD,M},_setupConfig:function(d,g){const M=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],R=/[\s,]+/;var O=this,U=M.reduce(function(K,s){if(O.options[s]===void 0||O.options[s]===null)return K;["countries","types","language"].indexOf(s)>-1?K[s]=O.options[s].split(R):K[s]=O.options[s];const ce=typeof O.options[s].longitude=="number"&&typeof O.options[s].latitude=="number";if(s==="proximity"&&ce){const pe=O.options[s].longitude,me=O.options[s].latitude;K[s]=[pe,me]}return K},{});switch(d){case il.REVERSE:{var $=g.split(R).map(function(K){return parseFloat(K,10)});O.options.flipCoordinates||$.reverse(),U.types&&U.types[0],U=cc(U,{query:$,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(K){K in U&&delete U[K]})}break;case il.FORWARD:{const K=g.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(K)&&(g=g.replace(/,/g," ")),U=cc(U,{query:g})}break}return U.session_token=this.eventManager.getSessionId(),U},_geocode:function(d){this.inputString=d,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:d});const g=this._requestType(this.options,d),M=this._setupConfig(g,d);var R;switch(g){case il.LOCAL:R=Promise.resolve();break;case il.FORWARD:R=this.geocoderService.forwardGeocode(M).send();break;case il.REVERSE:R=this.geocoderService.reverseGeocode(M).send();break}var O=this.options.localGeocoder?this.options.localGeocoder(d)||[]:[],U=[],$=null;return R.catch((function(K){$=K}).bind(this)).then((function(K){this._hideLoadingIcon();var s={};return K?K.statusCode=="200"&&(s=K.body,s.request=K.request,s.headers=K.headers,this._headers=K.headers):s={type:"FeatureCollection",features:[]},s.config=M,this.fresh&&(this.eventManager.start(this),this.fresh=!1),s.features&&s.features.length&&s.features.map(function(ce){ce._source="mapbox"}),s.features=s.features?O.concat(s.features):O,this.options.externalGeocoder?(U=this.options.externalGeocoder(d,s.features)||Promise.resolve([]),U.then(function(ce){return s.features=s.features?ce.concat(s.features):ce,s},function(){return s})):s}).bind(this)).then((function(K){if($)throw $;this.options.filter&&K.features.length&&(K.features=K.features.filter(this.options.filter)),K.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",K),this._typeahead.update(K.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",K))}).bind(this)).catch((function(K){this._hideLoadingIcon(),this._hideAttribution(),O.length&&this.options.localGeocoder||U.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(O)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:O}),this._eventEmitter.emit("error",{error:K})}).bind(this)),R},_clear:function(d){d&&d.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(d){this._clear(d),this._inputEl.focus()},_clearOnBlur:function(d){var g=this;d.relatedTarget&&g._clear(d)},_onQueryResult:function(d){var g=d.body;if(g.features.length){var M=g.features[0];this._typeahead.selected=M,this._inputEl.value=M.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var d=this._map.getCenter().wrap();this.setProximity({longitude:d.lng,latitude:d.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(d){return this._geocode(d).then(this._onQueryResult),this},_renderError:function(){var d="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(d)},_renderLocationError:function(){var d="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(d)},_renderNoResults:function(){var d="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(d)},_renderUserDeniedGeolocationError:function(){var d="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(d)},_renderMessage:function(d){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(d)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var d=this.options.language.split(",")[0],g=MR.language(d),M=SR.placeholder[g];if(M)return M}return"Search"},setInput:function(d,g){return g===void 0&&(g=!1),this._inputEl.value=d,this._typeahead.selected=null,this._typeahead.clear(),d.length>=this.options.minLength&&(g?this._geocode(d):this._onChange()),this},setProximity:function(d,g=!0){return this.options.proximity=d,g&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(d){return d&&typeof d=="function"&&(this._typeahead.render=d),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(d){var g=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=d||this.options.language||g,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(d){return this.options.zoom=d,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(d){return this.options.flyTo=d,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(d){return this.options.placeholder=d||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(d){return this.options.bbox=d,this},getCountries:function(){return this.options.countries},setCountries:function(d){return this.options.countries=d,this},getTypes:function(){return this.options.types},setTypes:function(d){return this.options.types=d,this},getMinLength:function(){return this.options.minLength},setMinLength:function(d){return this.options.minLength=d,this._typeahead&&(this._typeahead.options.minLength=d),this},getLimit:function(){return this.options.limit},setLimit:function(d){return this.options.limit=d,this._typeahead&&(this._typeahead.options.limit=d),this},getFilter:function(){return this.options.filter},setFilter:function(d){return this.options.filter=d,this},setOrigin:function(d){return this.options.origin=d,this.geocoderService=jg(Ug({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(d){return this.options.accessToken=d,this.geocoderService=jg(Ug({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(d){return this.options.autocomplete=d,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(d){return this.options.fuzzyMatch=d,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(d){return this.options.routing=d,this},getRouting:function(){return this.options.routing},setWorldview:function(d){return this.options.worldview=d,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(d){if(this._map){this._removeMarker();var g={color:"#4668F2"},M=cc({},g,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(M),d.center?this.mapMarker.setLngLat(d.center).addTo(this._map):d.geometry&&d.geometry.type&&d.geometry.type==="Point"&&d.geometry.coordinates&&this.mapMarker.setLngLat(d.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(d,g){return this._eventEmitter.on(d,g),this},off:function(d,g){return this._eventEmitter.removeListener(d,g),this.eventManager.remove(),this}};var CR=CT;const PR=Zw(CR);function Vy(){return{map:Lo("mapbox-map",null)}}var Gg=new Map,RR=/onMb([A-Z])(.+)/;function LR(d){return Gg.has(d)||Gg.set(d,d.replace(RR,(g,M,R)=>M.toLowerCase()+R)),Gg.get(d)}function Pm(d,g,M=[],R=null){const O=bA(),U=zr(()=>Object.entries(O).filter(([ce,pe])=>ce.startsWith("on")&&typeof pe=="function").map(([ce])=>ce)),$=new Map;function K(ce){Array.isArray(ce)&&ce.forEach(pe=>{const me=$.get(pe);typeof me=="function"&&me()})}function s(ce){Array.isArray(ce)&&ce.forEach(pe=>{const me=LR(pe);if(!M.includes(me))return;const ke=(...qe)=>{d(`mb-${me}`,...qe)};R?(Hi(g).on(me,R,ke),$.set(pe,()=>{Hi(g).off(me,R,ke)})):(Hi(g).on(me,ke),$.set(pe,()=>{Hi(g).off(me,ke)}))})}Do(U,(ce,pe)=>{const me=Array.isArray(ce)?(pe??[]).filter(qe=>!ce.includes(qe)):pe??[],ke=Array.isArray(pe)?(ce??[]).filter(qe=>!pe.includes(qe)):ce??[];if(Hi(g))K(me),s(ke);else{const qe=Do(g,it=>{it&&(K(me),s(ke),qe())})}},{immediate:!0})}function DR(d){return d.charAt(0).toUpperCase()+d.slice(1)}function Rm(d,g,M){function R(O){Object.keys(d).filter(U=>d[U]!==void 0&&d[U]!==null).forEach(U=>{var $,K;const s=U==="mapStyle"?"setStyle":`set${DR(U)}`,ce=typeof O[s]=="function",pe=typeof M[U]>"u"||"bind"in M[U]?(K=($=M[U])==null?void 0:$.bind)!=null?K:!1:!0;if(!ce||!pe)return;const{type:me}=d[U],ke={deep:me===Object||Array.isArray(me)&&me.includes(Object)};Do(()=>d[U],qe=>{O[s](qe)},ke)})}if(Hi(g))R(Hi(g));else{const O=Do(g,U=>{U&&(R(U),O())})}}function zR(d,{propsConfig:g,props:M,emit:R,events:O=[]}){const{map:U}=Vy(),$=fn();return Array.isArray(O)&&O.length&&Pm(R,$,O),typeof g<"u"&&Rm(M,$,g),Do(()=>M.position,K=>{Hi(U)&&Hi(U).removeControl(Hi($)).addControl(Hi($),K)}),Hu(async()=>{const K=new d(M);if(Hi(U)&&Hi(U).addControl(K,M.position),await Ty(),d===ko.GeolocateControl&&!K._setup){const s=yy(K),ce=Do(s,pe=>{pe._setup&&($.value=K,ce())})}else $.value=K}),_c(()=>{Hi($)&&Hi(U)&&Hi(U).removeControl(Hi($))}),{control:$,map:U}}var Lm=(d,g)=>{const M=d.__vccOpts||d;for(const[R,O]of g)M[R]=O;return M};if(!ko)throw new Error("mapboxgl is not installed.");if(!PR)throw new Error("MapboxGeocoder is not installed.");var kR={key:0},OR={key:1};if(!ko)throw new Error("mapboxgl is not installed.");var{LngLatBounds:fb,LngLat:BR}=ko,pb={accessToken:{type:String,default:"no-token"},container:{type:[typeof HTMLElement<"u"&&HTMLElement,String],default:void 0},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],required:!0},hash:{type:Boolean,default:!1},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number,default:7},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number,default:3},attributionControl:{type:Boolean,default:!0},customAttribution:{type:[String,Array],default:null},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean,default:!1},preserveDrawingBuffer:{type:Boolean,default:!1},antialias:{type:Boolean,default:!1},refreshExpiredTiles:{type:Boolean,default:!0},maxBounds:{type:[fb,Array],default:void 0},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean,default:!0},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Boolean,Object],default:!0},keyboard:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{type:[BR,Array,Object],default:()=>[0,0]},zoom:{type:Number,default:0},bearing:{type:Number,default:0},pitch:{type:Number,default:0},bounds:{type:[fb,Array],default:void 0},fitBoundsOptions:{type:Object,default:null},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0},cooperativeGestures:{type:Boolean},language:{type:[String,Array],default:null},locale:{type:Object,default:null},localFontFamily:{type:[Boolean,String],default:!1},minTileCacheSize:{type:Number,default:null},optimizeForTerrain:{type:Boolean,default:!0},performanceMetricsCollection:{type:Boolean,default:!0},projection:{type:[String,Object],default:"mercator"},testMode:{type:Boolean,default:!1},touchPitch:{type:[Boolean,Object],default:!0},useWebGL2:{type:Boolean,default:!1},worldview:{type:String,default:null}},FR=["boxzoomcancel","boxzoomend","boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","render","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchmove","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],NR={inheritAttrs:!1},VR=Object.assign(NR,{__name:"MapboxMap",props:pb,setup(d,{expose:g,emit:M}){const R=d,O=M,U=fn();Gd("mapbox-map",U);const $=fn(),K=fn(!1),s=zr(()=>{const{accessToken:ce,mapStyle:pe,...me}=R;return!me.container&&$.value&&(me.container=$.value),{style:pe,...me}});return Pm(O,U,FR),Rm(R,U,pb),Hu(()=>{ko.accessToken=R.accessToken,U.value=new ko.Map(s.value),U.value.on("load",()=>{K.value=!0}),O("mb-created",U.value);const ce=new ResizeObserver(()=>{U.value.resize()});ce.observe(s.value.container),_c(()=>{ce.disconnect(),U.value.remove()})}),g({map:U}),(ce,pe)=>(Si(),hr(Fn,null,[Ut("div",Sm({ref_key:"root",ref:$},ce.$attrs),null,16),K.value?(Si(),hr("div",kR,[Ms(ce.$slots,"default")])):(Si(),hr("div",OR,[Ms(ce.$slots,"loader")]))],64))}}),UR=Lm(VR,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMap.vue"]]);if(!ko)throw new Error("mapboxgl is not installed.");var{Popup:jR,Point:GR,LngLat:qR}=ko,mb={lngLat:{type:[qR,Array,Object],required:!0},closeButton:{type:Boolean,default:!0},closeOnClick:{type:Boolean,default:!0},closeOnMove:{type:Boolean,default:!1},anchor:{type:String,default:null},offset:{type:[Number,GR,Array,Object],default:0},className:{type:String,default:null},maxWidth:{type:String,default:"240px"},renderless:{type:Boolean,default:!1,bind:!1}},$R=["open","close"],ZR={__name:"MapboxPopup",props:mb,setup(d,{expose:g,emit:M}){const R=d,O=M,U=fn(),$=fn(),K=zr(()=>{const{lngLat:s,...ce}=R;return ce});return Rm(R,U,mb),Pm(O,U,$R),Hu(()=>{const{map:s}=Vy();U.value=new jR(K.value).setLngLat(R.lngLat).setDOMContent($.value),R.renderless||U.value.addTo(s.value),O("mb-open",U.value)}),_c(()=>{U.value&&U.value.remove()}),g({popup:U}),(s,ce)=>(Si(),hr("div",{ref_key:"root",ref:$},[Ms(s.$slots,"default")],512))}},HR=Lm(ZR,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxPopup.vue"]]),{Marker:WR,Point:XR}=ko,_b={lngLat:{type:Array,required:!0},popup:{type:[Object,Boolean],default:!1,bind:!1},element:{type:typeof HTMLElement<"u"?HTMLElement:Object,default:null},offset:{type:[XR,Array],default:null},anchor:{type:String,default:"center"},color:{type:String,default:null},scale:{type:Number,default:1},draggable:{type:Boolean,default:!1},rotation:{type:Number,default:0},pitchAlignment:{type:String,default:"auto"},rotationAlignment:{type:String,default:"auto"}},YR=["dragstart","drag","dragend"],KR={__name:"MapboxMarker",props:_b,setup(d,{emit:g}){const M=d,R=g,O=vA(),U=fn(),$=fn(),K=fn(),s=zr(()=>typeof O.popup<"u"),ce=zr(()=>s.value?K.value.popup:null),pe=zr(()=>({lngLat:M.lngLat,...M.popup?M.popup:{},renderless:!0})),me=zr(()=>{const{lngLat:ke,popup:qe,...it}=M;return O.default&&(it.element=$.value),it});return Rm(M,U,_b),Pm(R,U,YR),Hu(()=>{const{map:ke}=Vy();U.value=new WR(me.value).setLngLat(M.lngLat).addTo(ke.value),s.value&&U.value.setPopup(ce.value)}),_c(()=>{U.value&&U.value.remove()}),(ke,qe)=>(Si(),hr("div",null,[Ut("div",{ref_key:"contentRef",ref:$},[Ms(ke.$slots,"default")],512),s.value?(Si(),ts(HR,Sm({key:0,ref_key:"popupRef",ref:K},pe.value),{default:nn(()=>[Ms(ke.$slots,"popup")]),_:3},16)):Kd("v-if",!0)]))}},JR=Lm(KR,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMarker.vue"]]),gb={showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:{type:Boolean,default:!1},position:{type:String,default:"top-right",bind:!1}},QR={__name:"MapboxNavigationControl",props:gb,setup(d,{expose:g}){const{NavigationControl:M}=ko,R=d,{control:O}=zR(M,{props:R,propsConfig:gb});return g({control:O}),(U,$)=>(Si(),hr("div"))}},eL=Lm(QR,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxNavigationControl.vue"]]);const tL="pk.eyJ1Ijoic2VyaGllaWUiLCJhIjoiY2x3b2szcGFqMWxwazJqcDgxanFneDNyeCJ9.C8eKaDA21mpuVRBRRj-Y3w",qg={style:"mapbox://styles/mapbox/streets-v11",apiToken:tL,projection:"globe",pitch:0,bearing:0},iL={},rL={class:"text-grey cursor-pointer hover:text-primary"};function nL(d,g){return Si(),hr("button",rL,[Ms(d.$slots,"default")])}const yb=As(iL,[["render",nL]]),sL={},oL={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function aL(d,g){return Si(),hr("svg",oL,g[0]||(g[0]=[Ut("path",{d:"M6 2H10",stroke:"currentColor","stroke-width":"1.3","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Ut("path",{d:"M2 4H14",stroke:"currentColor","stroke-width":"1.3","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Ut("path",{d:"M3.3335 4L3.73409 10.0089C3.80846 11.1245 3.84565 11.6823 4.02795 12.1304C4.35894 12.9441 5.02988 13.5718 5.86373 13.8479C6.32301 14 6.88206 14 8.00016 14V14C9.11826 14 9.67731 14 10.1366 13.8479C10.9704 13.5718 11.6414 12.9441 11.9724 12.1304C12.1547 11.6823 12.1919 11.1245 12.2662 10.0089L12.6668 4",stroke:"currentColor","stroke-width":"1.3","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const lL=As(sL,[["render",aL]]),cL={},uL={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function hL(d,g){return Si(),hr("svg",uL,g[0]||(g[0]=[Ut("path",{d:"M1.6665 14.3334L5.36602 12.9105C5.60264 12.8195 5.72096 12.774 5.83165 12.7146C5.92997 12.6618 6.0237 12.6009 6.11186 12.5324C6.21112 12.4554 6.30075 12.3658 6.48002 12.1865L13.9999 4.66671C14.7362 3.93033 14.7362 2.73642 13.9999 2.00004C13.2635 1.26366 12.0696 1.26366 11.3332 2.00004L3.81336 9.51985C3.63409 9.69912 3.54445 9.78876 3.46743 9.88801C3.39902 9.97617 3.33811 10.0699 3.28533 10.1682C3.22591 10.2789 3.1804 10.3972 3.08939 10.6339L1.6665 14.3334ZM1.6665 14.3334L3.03858 10.766C3.13677 10.5107 3.18586 10.3831 3.27006 10.3246C3.34365 10.2735 3.43471 10.2542 3.5227 10.271C3.62339 10.2902 3.72009 10.3869 3.91349 10.5803L5.41955 12.0864C5.61295 12.2798 5.70965 12.3765 5.72888 12.4772C5.74568 12.5652 5.72636 12.6562 5.67527 12.7298C5.6168 12.814 5.48916 12.8631 5.23388 12.9613L1.6665 14.3334Z",stroke:"currentColor","stroke-width":"1.3","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const dL=As(cL,[["render",hL]]),fL={class:"text-grey cursor-pointer mb-6 last:mb-0"},pL={class:"flex gap-4"},mL=["src"],_L={class:"w-full"},gL={class:"flex justify-between items-center mb-2"},yL={class:"font-bold text-border"},xL={class:"flex gap-2"},vL={class:"text-xs line-clamp-3"},bL={__name:"FavoritePlace",props:{title:{required:!0,type:String},description:{required:!0,type:String},img:String,isActive:{required:!0,type:Boolean}},setup(d){const g=d;return(M,R)=>(Si(),hr("section",fL,[Ut("div",pL,[Ut("img",{class:"w-[76px] h-[76px] shrink-0",src:g.img,alt:""},null,8,mL),Ut("div",_L,[Ut("div",gL,[Ut("h2",yL,ll(g.title),1),Ut("div",xL,[Ei(yb,null,{default:nn(()=>[Ei(dL)]),_:1}),Ei(yb,null,{default:nn(()=>[Ei(lL)]),_:1})])]),Ut("p",vL,ll(g.description),1)])]),Ut("div",{class:lo(["h-[1px] w-full mt-4",{"bg-primary":g.isActive,"bg-[#2C2C2C1A]":!g.isActive}])},null,2)]))}},wL={class:"px-6"},TL={__name:"FavoritePlaces",props:{items:{required:!0,type:Array},activeId:{required:!0,type:[Number,null]}},emits:["place-clicked"],setup(d,{emit:g}){const M=d,R=g;return(O,U)=>(Si(),hr("div",wL,[U[1]||(U[1]=Ut("div",{class:"text-grey mb-4"},"Added markers",-1)),Ms(O.$slots,"label"),Ms(O.$slots,"list",{},()=>[(Si(!0),hr(Fn,null,sw(M.items,$=>(Si(),ts(bL,{key:$.id,title:$.title,description:$.description,img:$.img,"is-active":$.id===M.activeId,onClick:K=>R("place-clicked",$.id)},null,8,["title","description","img","is-active","onClick"]))),128))]),Ms(O.$slots,"default"),Ei(rf,{class:"w-full mt-10",variant:"gradient"},{default:nn(()=>U[0]||(U[0]=[cs("Add new marker")])),_:1})]))}},EL={class:"relative flex items-center justify-center"},SL={key:0,class:"absolute w-10 h-10 rounded-full bg-orange-300 opacity-40 ripple"},ML={__name:"MarkerIcon",props:{isActive:{type:Boolean,default:!1}},setup(d){return(g,M)=>(Si(),hr("div",EL,[d.isActive?(Si(),hr("div",SL)):Kd("",!0),(Si(),hr("svg",{class:lo(["marker-icon",{"active-marker":d.isActive}]),width:"25",height:"32",viewBox:"0 0 20 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},M[0]||(M[0]=[Ut("path",{d:"M10.0002 -5.11874e-05C8.72364 -0.0599241 7.44863 0.147406 6.25679 0.608668C5.06496 1.06993 3.98256 1.77496 3.0789 2.67863C2.17523 3.5823 1.4702 4.66469 1.00894 5.85652C0.547675 7.04836 0.340344 8.32337 0.400217 9.59995C0.400217 12.6239 2.80022 15.5999 4.00022 16.7999C5.20022 17.9999 10.0002 23.9999 10.0002 23.9999C10.0002 23.9999 14.8002 17.9999 16.0002 16.7999C17.2002 15.5999 19.6002 12.6239 19.6002 9.59995C19.6601 8.32337 19.4528 7.04836 18.9915 5.85652C18.5302 4.66469 17.8252 3.5823 16.9215 2.67863C16.0179 1.77496 14.9355 1.06993 13.7436 0.608668C12.5518 0.147406 11.2768 -0.0599241 10.0002 -5.11874e-05ZM10.0002 13.4999C9.22887 13.4999 8.47484 13.2712 7.83349 12.8427C7.19214 12.4141 6.69227 11.805 6.39709 11.0924C6.10191 10.3798 6.02467 9.59562 6.17515 8.8391C6.32564 8.08257 6.69708 7.38766 7.2425 6.84223C7.78793 6.29681 8.48284 5.92537 9.23936 5.77489C9.99589 5.6244 10.7801 5.70164 11.4927 5.99682C12.2053 6.292 12.8144 6.79187 13.2429 7.43322C13.6715 8.07458 13.9002 8.8286 13.9002 9.59995C13.9002 10.1121 13.7993 10.6192 13.6033 11.0924C13.4074 11.5656 13.1201 11.9955 12.7579 12.3577C12.3958 12.7198 11.9659 13.0071 11.4927 13.2031C11.0195 13.3991 10.5124 13.4999 10.0002 13.4999Z",fill:"url(#paint0_linear_17_758)",stroke:"white"},null,-1),Ut("defs",null,[Ut("linearGradient",{id:"paint0_linear_17_758",x1:"0.390137",y1:"10.3942",x2:"19.6104",y2:"10.4008",gradientUnits:"userSpaceOnUse"},[Ut("stop",{"stop-color":"#FFA279"}),Ut("stop",{offset:"1","stop-color":"#F3743D"})])],-1)]),2))]))}},PT=As(ML,[["__scopeId","data-v-34725564"]]),AL={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},IL={transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)"},CL=["fill"],PL=["fill"],RL=["fill"],LL={__name:"Toggle3DButton",props:{is3DEnabled:Boolean},emits:["toggle3D"],setup(d,{emit:g}){const M=g,R=()=>{M("toggle3D")};return(O,U)=>(Si(),hr("button",{onClick:R,class:"absolute top-[10px] right-[10px] bg-transparent rounded border-none cursor-pointer flex flex-col items-center gap-2 hover:bg-white"},[Ut("div",{class:lo(["icon",["w-[40px] h-[40px] p-[2.5px] rounded border shadow-md",d.is3DEnabled?"border-orange-300":"border-gray-200"]]),style:{"backdrop-filter":"blur(10px)","background-color":"rgba(255, 255, 255, 0.88)"}},[(Si(),hr("svg",AL,[U[0]||(U[0]=Ut("defs",null,[Ut("linearGradient",{id:"grad3dOn",x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[Ut("stop",{offset:"0%",style:{"stop-color":"#ffa279","stop-opacity":"1"}}),Ut("stop",{offset:"100%",style:{"stop-color":"#f3743d","stop-opacity":"1"}})])],-1)),Ut("g",IL,[Ut("path",{fill:d.is3DEnabled?"url(#grad3dOn)":"#5e5e5e",d:`M1280 4646 l-1275 -473 0 -1613 0 -1612 845 -314 c465 -172 848 -313
            853 -314 4 0 6 96 5 212 l-3 213 -650 241 -650 240 -3 1258 -2 1258 22 -6 c13
            -3 453 -165 978 -359 l955 -354 3 -402 2 -401 200 0 200 0 2 401 3 401 955
            354 c525 195 965 357 978 360 l22 6 0 -785 0 -784 63 -23 c92 -33 172 -76 260
            -136 l77 -55 -2 1108 -3 1107 -1275 473 c-701 260 -1277 472 -1280 472 -3 0
            -579 -213 -1280 -473z m2184 -287 c839 -310 875 -325 846 -337 -101 -42 -1734
            -642 -1748 -642 -9 0 -415 147 -901 327 -708 262 -879 329 -860 335 13 5 411
            152 884 328 473 176 870 318 882 316 12 -2 416 -149 897 -327z`},null,8,CL),Ut("path",{fill:d.is3DEnabled?"url(#grad3dOn)":"#5e5e5e",d:`M2120 1620 l0 -200 288 -1 287 0 -132 -127 -133 -128 0 -117 c0 -71
          4 -117 10 -117 18 0 254 -113 350 -168 111 -63 235 -153 250 -182 22 -42 -34
          -128 -105 -161 -37 -17 -72 -19 -427 -19 l-388 0 0 -200 0 -200 403 0 c371 0
          410 2 482 20 211 54 372 217 426 431 29 112 23 193 -20 284 -52 112 -209 252
          -426 380 -15 9 11 38 189 210 l206 199 0 148 0 148 -630 0 -630 0 0 -200z`},null,8,PL),Ut("path",{fill:d.is3DEnabled?"url(#grad3dOn)":"#5e5e5e",d:`M3780 910 l0 -911 378 3 377 4 80 27 c115 38 199 91 290 182 91 91
          143 174 183 290 l27 80 0 325 0 325 -27 80 c-40 116 -92 199 -183 290 -91 91
          -175 144 -290 182 l-80 27 -377 4 -378 3 0 -911z m768 471 c70 -38 100 -69
          140 -145 l27 -51 0 -275 0 -275 -27 -51 c-40 -76 -70 -107 -140 -145 -62 -33
          -64 -34 -215 -37 l-153 -4 0 512 0 512 153 -4 c151 -3 153 -4 215 -37z`},null,8,RL)])])),Ut("span",{class:lo([d.is3DEnabled?"text-orange-600":"text-gray-600","text-xs font-bold tracking-wider"])},ll(d.is3DEnabled?"3D On":"3D Off"),3)],2)]))}},DL=As(LL,[["__scopeId","data-v-b4c8c5e0"]]),zL={style:{width:"100%",height:"100%","border-radius":"50%",display:"flex","justify-content":"center","align-items":"center"}},kL={__name:"ResetZoomButton",props:{mapInstance:Object,defaultZoom:{type:Number,default:10}},setup(d){const g=fn(!1),M=d,R=()=>{M.mapInstance&&(g.value=!0,M.mapInstance.flyTo({zoom:M.defaultZoom,bearing:0,pitch:0}),setTimeout(()=>{g.value=!1},1e3))};return(O,U)=>(Si(),hr("button",{onClick:R,class:"fixed right-[10px] bottom-[100px] z-10 w-10 h-10 bg-white rounded-[50%] border border-slate-300 shadow-md hover:bg-gray-100 transition transform"},[Ut("div",zL,[(Si(),hr("svg",{width:"32",height:"32",viewBox:"0 0 512 512",class:lo(["mx-auto",g.value?"rotate-animation":""])},U[0]||(U[0]=[JA('<g transform="translate(0, 512) scale(0.1, -0.1)" fill="black" data-v-42b56665><path d="M2320 5109 c-487 -46 -966 -239 -1344 -538 -183 -146 -397 -368 -417 -433 -34 -110 69 -218 179 -189 30 9 63 37 156 136 210 224 411 374 668 500 475 234 1006 294 1523 173 207 -48 477 -160 664 -277 97 -60 255 -177 290 -215 l24 -26 -127 0 c-140 0 -165 -7 -210 -60 -21 -25 -26 -42 -26 -83 0 -69 27 -112 85 -138 43 -19 64 -20 364 -17 305 3 321 4 347 24 15 11 37 33 48 48 20 26 21 40 21 366 0 326 -1 340 -21 366 -37 50 -72 69 -124 69 -52 0 -87 -19 -124 -69 -18 -23 -22 -47 -26 -151 l-5 -123 -85 70 c-161 132 -382 268 -581 358 -381 172 -857 249 -1279 209z" data-v-42b56665></path><path d="M2473 3219 c-214 -36 -353 -184 -353 -379 0 -88 27 -163 81 -224 53 -60 89 -80 294 -162 167 -67 235 -109 235 -146 0 -27 -39 -75 -75 -92 -30 -14 -55 -17 -115 -14 -90 5 -142 27 -218 92 -67 57 -114 67 -177 36 -74 -36 -103 -117 -71 -193 32 -77 197 -187 332 -221 81 -21 234 -21 305 0 157 46 279 172 309 321 31 149 -49 313 -195 398 -26 16 -127 61 -224 100 -183 74 -190 79 -177 131 10 39 58 57 141 52 60 -3 85 -10 147 -42 68 -35 81 -38 132 -34 41 3 63 11 82 29 85 80 67 182 -45 257 -126 84 -265 115 -408 91z" data-v-42b56665></path><path d="M70 3198 c-72 -48 -70 -30 -70 -638 0 -499 2 -548 18 -580 50 -100 197 -108 259 -13 14 22 19 55 23 167 l5 141 142 -161 c182 -207 190 -214 256 -214 84 0 133 41 151 127 11 51 -21 105 -152 253 l-120 135 52 28 c155 84 245 262 216 425 -24 139 -109 251 -237 314 l-68 33 -220 3 c-217 3 -221 3 -255 -20z m439 -303 c16 -14 35 -41 41 -60 10 -30 9 -41 -7 -72 -26 -53 -71 -73 -165 -73 l-78 0 0 115 0 115 89 0 c81 0 92 -2 120 -25z" data-v-42b56665></path><path d="M1179 3197 c-72 -48 -70 -27 -67 -649 3 -548 3 -557 24 -585 12 -15 36 -37 55 -48 32 -19 52 -20 289 -20 248 0 256 1 291 23 90 55 92 198 4 252 -29 18 -49 20 -199 20 l-166 0 0 110 0 110 143 0 c156 0 191 10 232 64 28 38 28 134 0 172 -41 54 -76 64 -232 64 l-143 0 0 104 0 104 163 4 c147 3 166 6 199 26 89 55 91 198 3 252 -30 19 -49 20 -297 20 -259 0 -266 -1 -299 -23z" data-v-42b56665></path><path d="M3370 3213 c-8 -3 -26 -15 -38 -27 -53 -47 -52 -34 -52 -626 0 -592 -1 -578 52 -627 12 -12 43 -26 68 -32 58 -14 432 -14 490 0 126 29 161 169 65 259 -26 24 -31 25 -201 28 l-174 3 0 110 0 109 140 0 c119 0 147 3 178 19 43 22 82 84 82 131 0 47 -39 109 -82 131 -31 16 -59 19 -178 19 l-140 0 0 105 0 105 133 0 c149 1 211 11 245 43 71 66 69 159 -3 227 l-27 25 -271 2 c-150 1 -279 -1 -287 -4z" data-v-42b56665></path><path d="M4319 3197 c-93 -62 -88 -193 10 -251 21 -12 60 -20 116 -24 l84 -5 3 -456 c3 -436 4 -457 23 -489 57 -95 195 -98 256 -6 18 27 19 55 19 490 l0 461 89 5 c62 4 100 11 122 24 98 58 103 189 10 251 -34 23 -37 23 -366 23 -329 0 -332 0 -366 -23z" data-v-42b56665></path><path d="M615 1160 c-82 -41 -80 -32 -83 -410 -3 -385 -3 -385 81 -428 58 -30 113 -23 163 20 43 38 54 79 54 206 l0 102 103 -83 c368 -298 808 -484 1297 -549 144 -19 509 -16 655 5 536 78 1025 313 1405 674 152 144 237 244 250 294 24 87 -45 181 -133 183 -67 1 -99 -19 -182 -115 -276 -319 -692 -575 -1115 -685 -628 -163 -1311 -46 -1840 317 -99 68 -224 166 -228 179 -2 6 48 10 125 10 110 0 133 3 161 20 51 31 74 76 69 136 -4 61 -28 97 -83 124 -38 19 -60 20 -350 20 -290 0 -311 -1 -349 -20z" data-v-42b56665></path></g>',1)]),2))])]))}},OL=As(kL,[["__scopeId","data-v-42b56665"]]),BL={},FL={xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",stroke:"currentColor"};function NL(d,g){return Si(),hr("svg",FL,g[0]||(g[0]=[Ut("path",{d:"M21 7L7 21","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Ut("path",{d:"M7 7L21 21","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const VL=As(BL,[["render",NL]]),UL={class:"relative bg-white min-w-[350px] m-auto p-10 text-black rounded-2xl"},jL={class:"absolute right-6 top-6"},GL={__name:"IModal",emits:["close"],setup(d,{emit:g}){const M=g,R=$=>{$.key==="Escape"&&M("close")},O=()=>{const $=window.innerWidth-document.documentElement.clientWidth;document.body.style.overflow="hidden",document.body.style.paddingRight=`${$}px`},U=()=>{document.body.style.overflow="",document.body.style.paddingRight=""};return Hu(()=>{O(),window.addEventListener("keydown",R)}),_c(()=>{U(),window.removeEventListener("keydown",R)}),($,K)=>(Si(),ts(sA,{to:"body"},[Ut("div",{class:"flex w-full h-full fixed top-0 left-0 overflow-auto bg-[rgba(0,0,0,0.3)]",onClick:K[1]||(K[1]=Am(s=>M("close"),["self"]))},[Ut("div",UL,[Ut("button",jL,[Ei(VL,{class:"w-7 h-7",onClick:K[0]||(K[0]=s=>M("close"))})]),Ms($.$slots,"default")])])]))}},qL={},$L={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18"};function ZL(d,g){return Si(),hr("svg",$L,g[0]||(g[0]=[Ut("path",{d:"M15.8061 10.6312L7.36856 2.19373C5.96231 0.731231 3.65605 0.731231 2.19355 2.13748C0.731055 3.54373 0.731055 5.90623 2.19355 7.31248L2.2498 7.36873L3.8248 8.99998L4.6123 8.21248L2.98105 6.58123C2.0248 5.62498 2.0248 3.99373 2.98105 3.03748C3.9373 2.08123 5.56855 2.02498 6.5248 2.98123L6.58105 3.03748L14.9623 11.4187C15.9748 12.375 15.9748 14.0062 15.0186 14.9625C14.0623 15.975 12.4311 15.975 11.4748 15.0187L11.4186 14.9625L7.25605 10.8C6.69355 10.2375 6.7498 9.33748 7.25605 8.83123C7.52572 8.58696 7.87658 8.45167 8.24043 8.45167C8.60428 8.45167 8.95514 8.58696 9.2248 8.83123L11.5311 11.1375L12.3186 10.35L9.95605 7.98748C9.71659 7.76102 9.43467 7.58419 9.12654 7.4672C8.81841 7.3502 8.49018 7.29535 8.16075 7.30581C7.83133 7.31627 7.50723 7.39182 7.20715 7.52813C6.90706 7.66443 6.63692 7.85878 6.4123 8.09998C5.5123 9.05623 5.5123 10.575 6.4123 11.5875L10.6311 15.8062C12.0373 17.2687 14.3436 17.2687 15.8061 15.8625C17.2686 14.4562 17.2686 12.0937 15.8061 10.6312C15.8061 10.6875 15.8061 10.6312 15.8061 10.6312Z",fill:"currentColor"},null,-1)]))}const HL=As(qL,[["render",ZL]]),WL={class:"cursor-pointer hover:text-primary"},XL={class:"flex gap-2 items-center"},YL={class:"underline text-xs"},KL={key:0,class:"text-red-500"},JL={__name:"InputImage",emits:["uploaded"],setup(d,{emit:g}){const M=g,R=fn(""),O=U=>{const $=U.target.files[0];if(console.log("file.size in bytes: ",$.size),$.size>3*1024*1024){R.value="File size is too large - max 3Mb";return}const K=new FileReader;K.readAsDataURL($),K.onload=()=>{R.value="",M("uploaded",K.result)}};return(U,$)=>(Si(),hr("div",null,[Ut("label",WL,[Ut("input",{type:"file",accept:"image/*",class:"hidden",onChange:O},null,32),Ut("span",XL,[Ei(HL),Ut("span",YL,[Ms(U.$slots,"default")])])]),R.value?(Si(),hr("div",KL,ll(R.value),1)):Kd("",!0)]))}},QL={class:"flex gap-2 justify-center font-bold text-center mb-10"},eD={class:"flex gap-3 items-center mb-10"},tD=["src"],iD={__name:"CreateNewPlaceModal",props:{isOpen:{default:!1,type:Boolean}},emits:["close","submit"],setup(d,{emit:g}){const M=d,R=g,O=mc({title:"",description:"",img:""}),U=zr(()=>O.img?"Click here to change photo":"Click here to add a photo"),$=K=>{O.img=K};return(K,s)=>M.isOpen?(Si(),ts(GL,{key:0,onClose:s[3]||(s[3]=ce=>R("close"))},{default:nn(()=>[Ut("form",{onSubmit:s[2]||(s[2]=Am(ce=>R("submit",O),["prevent"])),class:"min-w-[420px]"},[Ut("div",QL,[Ei(PT),s[4]||(s[4]=cs("Add marker "))]),Ei(hc,{label:"Location",class:"mb-4",modelValue:O.title,"onUpdate:modelValue":s[0]||(s[0]=ce=>O.title=ce)},null,8,["modelValue"]),Ei(hc,{label:"Description",type:"textarea",class:"mb-3",modelValue:O.description,"onUpdate:modelValue":s[1]||(s[1]=ce=>O.description=ce)},null,8,["modelValue"]),Ut("div",eD,[O.img?(Si(),hr("img",{key:0,src:O.img,alt:"Preview",class:"w-8 h-8 object-cover"},null,8,tD)):Kd("",!0),Ei(JL,{onUploaded:$},{default:nn(()=>[cs(ll(U.value),1)]),_:1})]),Ei(rf,{class:"w-full",variant:"gradient"},{default:nn(()=>s[5]||(s[5]=[cs("Add point")])),_:1})],32)]),_:1})):Kd("",!0)}},rD={class:"flex h-screen"},nD={class:"bg-white h-full w-[400px] shrink-0 overflow-auto pb-10 pt-5"},sD={class:"w-full h-full flex items-center justify-center text-6xl"},oD=["onClick"],aD={__name:"HomepageView",setup(d){const g=fn(null),M=fn(!1);let R=null;const O=fn(null),U=et=>{et.setMaxPitch(85),et.setMinPitch(0),et.setFog({range:[1,10],color:"white","horizon-blend":.03});const ct=()=>{et.getZoom()>=15?et.setConfigProperty("basemap","lightPreset","dawn"):et.setConfigProperty("basemap","lightPreset","day")};ct(),R=()=>ct(),et.on("zoom",R)},$=et=>{et.setMaxPitch(60),et.setMinPitch(0),R&&(et.off("zoom",R),R=null)},K=(et=null)=>{g.value=et,et.on("style.load",()=>{et.setFog({range:[1,10],color:"white","horizon-blend":.1})}),M.value&&U(et)},s=[{id:1,title:"Berlin",description:"Currently known as the largest and the most populated city of the European Union, Berlin is the capital city of Germany",img:new URL("/VueMap-Explorer/assets/Berlin-BDjHduYj.jpg",import.meta.url).href,lngLat:[13.404954,52.520008]},{id:2,title:"Rome",description:"Rome, or the Metropolitan City of Rome, is the capital, the largest and the most important city of Italy",img:new URL("/VueMap-Explorer/assets/Rome-f-zjCaUo.jpg",import.meta.url).href,lngLat:[12.496366,41.902782]},{id:3,title:"Venice",description:"Venice (Venezia) is an amazingly beautiful old city and the center of the Metropolitan City of Venice",img:new URL("/VueMap-Explorer/assets/marking_point-C7mcpzeg.jpg",import.meta.url).href,lngLat:[12.327145,45.438759]}],ce=()=>{if(M.value=!M.value,g.value){const et=M.value?"mapbox://styles/mapbox/standard":"mapbox://styles/mapbox/streets-v11";g.value.setStyle(et),g.value.once("style.load",()=>{M.value?U(g.value):$(g.value)})}},pe=et=>{O.value=et;const{lngLat:ct}=s.find(St=>St.id===et);g.value.flyTo({center:ct})},me=et=>{const{lngLat:ct}=s.find(St=>St.id===et);pe(et),g.value.flyTo({center:ct})},ke=fn(!1),qe=()=>{ke.value=!1},it=()=>{ke.value=!0};return(et,ct)=>(Si(),hr("main",rD,[Ut("div",nD,[Ei(TL,{items:s,"active-id":O.value,onPlaceClicked:me},null,8,["active-id"]),Ut("button",{class:"p-3",onClick:it},"Click modal"),Ei(iD,{"is-open":ke.value,onClose:qe,onSubmit:console.log},null,8,["is-open","onSubmit"])]),Ut("div",sD,[Ei(Hi(UR),{id:"map",class:"w-full h-full overflow-auto",center:[13.376481,52.509663],zoom:10,"access-token":Hi(qg).apiToken,"map-style":Hi(qg).style,projection:Hi(qg).projection,onMbCreated:K},{default:nn(()=>[(Si(),hr(Fn,null,sw(s,St=>Ei(Hi(JR),{key:St.id,lngLat:St.lngLat},{default:nn(()=>[Ut("button",{onClick:_t=>pe(St.id)},[Ei(PT,{isActive:St.id===O.value},null,8,["isActive"])],8,oD)]),_:2},1032,["lngLat"])),64)),Ei(Hi(eL),{position:"bottom-right",showZoom:!1,showCompass:!0})]),_:1},8,["access-token","map-style","projection"]),Ei(DL,{is3DEnabled:M.value,onToggle3D:ce},null,8,["is3DEnabled"]),Ei(OL,{mapInstance:g.value,defaultZoom:10},null,8,["mapInstance"])])]))}},lD="data:image/svg+xml,%3csvg%20width='100'%20height='100'%20viewBox='0%200%20100%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='ooui:map-pin'%20clip-path='url(%23clip0_15_235)'%3e%3cpath%20id='Vector'%20d='M50%20-4.74975e-06C44.681%20-0.249475%2039.3684%200.614402%2034.4024%202.53633C29.4364%204.45825%2024.9265%207.39588%2021.1612%2011.1612C17.3959%2014.9264%2014.4583%2019.4364%2012.5363%2024.4024C10.6144%2029.3684%209.75054%2034.6809%2010%2040C10%2052.6%2020%2065%2025%2070C30%2075%2050%20100%2050%20100C50%20100%2070%2075%2075%2070C80%2065%2090%2052.6%2090%2040C90.2495%2034.6809%2089.3856%2029.3684%2087.4637%2024.4024C85.5418%2019.4364%2082.6041%2014.9264%2078.8389%2011.1612C75.0736%207.39588%2070.5636%204.45825%2065.5976%202.53633C60.6317%200.614402%2055.3191%20-0.249475%2050%20-4.74975e-06ZM50%2056.25C46.7861%2056.25%2043.6443%2055.2969%2040.972%2053.5114C38.2997%2051.7258%2036.2169%2049.1879%2034.987%2046.2186C33.7571%2043.2493%2033.4352%2039.982%2034.0623%2036.8298C34.6893%2033.6776%2036.2369%2030.7821%2038.5095%2028.5095C40.7821%2026.2369%2043.6776%2024.6892%2046.8298%2024.0622C49.982%2023.4352%2053.2493%2023.757%2056.2186%2024.9869C59.1879%2026.2169%2061.7258%2028.2997%2063.5114%2030.972C65.297%2033.6443%2066.25%2036.786%2066.25%2040C66.25%2042.134%2065.8297%2044.2471%2065.0131%2046.2186C64.1964%2048.1901%2062.9995%2049.9815%2061.4905%2051.4905C59.9816%2052.9994%2058.1902%2054.1964%2056.2186%2055.013C54.2471%2055.8297%2052.134%2056.25%2050%2056.25Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_15_235'%3e%3crect%20width='100'%20height='100'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",cD={class:"text-center"},uD={__name:"GreetingView",setup(d){return console.log("GreetingView BASE",Es),(g,M)=>(Si(),ts(Gw,null,{default:nn(()=>[Ut("div",cD,[M[1]||(M[1]=Ut("img",{class:"inline mb-6",src:lD,alt:""},null,-1)),M[2]||(M[2]=Ut("h1",{class:"font-bold text-4xl mb-7"},"IT traveler",-1)),M[3]||(M[3]=Ut("p",{class:"leading-6 mb-11 text-lg"}," A simple and easy-to-use web application that lets you mark your favorite places, as well as those you'd love to visit. So don't wait — give it a try! ",-1)),Ei(rf,{to:`${Hi(Es)}/auth/registration`},{default:nn(()=>M[0]||(M[0]=[cs("Get Started")])),_:1},8,["to"])])]),_:1}))}},Es="";console.log("BASE ROUTER: ",Es);const hD=[{path:`${Es}/`,component:uD},{path:`${Es}/map`,component:aD},{path:`${Es}/auth`,component:ZC,redirect:`${Es}/auth/login`,children:[{path:"login",component:sP},{path:"registration",component:lP}]},{path:`${Es}/:catchAll(.*)`,component:dP}],dD=OC({history:pC(),routes:hD}),fD={class:"fixed top-0 left-1"},pD={class:"flex gap-4"},mD={__name:"App",setup(d){return console.log("App BASE:",Es),(g,M)=>(Si(),hr(Fn,null,[Ut("section",fD,[Ut("nav",pD,[M[2]||(M[2]=Ut("strong",null,"Current route path:",-1)),cs(" "+ll(g.$route.fullPath)+" ",1),Ei(Hi(fc),{class:"underline","exact-active-class":"text-blue-600",to:`${Hi(Es)}/`},{default:nn(()=>M[0]||(M[0]=[cs("GreetingPage")])),_:1},8,["to"]),Ei(Hi(fc),{class:"underline","exact-active-class":"text-blue-600",to:`${Hi(Es)}/map`},{default:nn(()=>M[1]||(M[1]=[cs("MapPage")])),_:1},8,["to"])])]),Ut("main",null,[Ei(Hi(zy))]),M[3]||(M[3]=Ut("footer",{class:"fixed bottom-1 left-0 right-0 text-gray-600 text-center mt-12 pointer-events-none"},[Ut("p",{class:"text-sm"},"© Created by maxexc")],-1))],64))}},Uy=zI(mD);Uy.use(NI());Uy.use(dD);Uy.mount("#app");
